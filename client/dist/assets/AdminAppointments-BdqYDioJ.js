import{g as is,r as c,x as N,j as e,L as Vt,a3 as os,P as Ne,a4 as Ge,a5 as ds,H as fe,U as cs,a6 as Pe,a7 as ht,f as ms,a8 as us,a9 as hs,y as g,a1 as j,aa as Ye,ab as zt,ac as Ot,D as ct,A as xe,ad as Ut,ae as xs,af as fs,G as $e,ag as Jt,t as mt,ah as gs}from"./index-DXO7rKz0.js";const T="https://urbansetu.onrender.com";function ps(){const{currentUser:s}=is(r=>r.user),[h,F]=c.useState([]),[ge,te]=c.useState([]),[qe,re]=c.useState(!0),[B,ze]=c.useState("all"),[$,We]=c.useState(""),[M,Qe]=c.useState(null),[Ce,be]=c.useState(!1),[Xe,Oe]=c.useState(!1),[le,ye]=c.useState(!1),[U,Ze]=c.useState(""),[Q,et]=c.useState(""),[P,K]=c.useState(null),[me,y]=c.useState(""),[A,ae]=c.useState(!1),[z,Se]=c.useState(!1),[ke,D]=c.useState(!1),[se,J]=c.useState(!1);c.useEffect(()=>(A||z||ke||se?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[A,z,ke,se]);const[X,Ae]=c.useState({}),ie=c.useRef(!1),oe=c.useCallback((r,l)=>{ie.current||Ae(x=>{const u=x[r];if(u&&l){if(l.some((R,Y)=>{const V=u[Y];return!V||JSON.stringify(V)!==JSON.stringify(R)}))return ie.current=!0,setTimeout(()=>{ie.current=!1},100),{...x,[r]:l}}else if(JSON.stringify(u)!==JSON.stringify(l))return ie.current=!0,setTimeout(()=>{ie.current=!1},100),{...x,[r]:l};return x})},[]),ue=c.useCallback(async()=>{try{const l=await(await fetch(`${T}/api/bookings`,{credentials:"include"})).json();F(l),re(!1)}catch(r){console.error("Failed to fetch appointments",r),re(!1)}},[]),k=c.useCallback(async()=>{try{const l=await(await fetch(`${T}/api/bookings/archived`,{credentials:"include"})).json();te(l)}catch(r){console.error("Failed to fetch archived appointments",r)}},[]);c.useEffect(()=>{N.connected&&s&&N.emit("adminAppointmentsActive",{adminId:s._id,role:s.role});const r=setInterval(()=>{s&&N.emit("adminAppointmentsActive",{adminId:s._id,role:s.role})},1e3);ue(),k();const l=setInterval(()=>{ue(),k()},5e3),x=i=>{F(S=>S.map(d=>{const w={...d};return d.buyerId&&(d.buyerId._id===i.userId||d.buyerId===i.userId)&&(w.buyerId={...w.buyerId,username:i.username,email:i.email,mobileNumber:i.mobileNumber,avatar:i.avatar}),d.sellerId&&(d.sellerId._id===i.userId||d.sellerId===i.userId)&&(w.sellerId={...w.sellerId,username:i.username,email:i.email,mobileNumber:i.mobileNumber,avatar:i.avatar}),w})),te(S=>S.map(d=>{const w={...d};return d.buyerId&&(d.buyerId._id===i.userId||d.buyerId===i.userId)&&(w.buyerId={...w.buyerId,username:i.username,email:i.email,mobileNumber:i.mobileNumber,avatar:i.avatar}),d.sellerId&&(d.sellerId._id===i.userId||d.sellerId===i.userId)&&(w.sellerId={...w.sellerId,username:i.username,email:i.email,mobileNumber:i.mobileNumber,avatar:i.avatar}),w}))};N.on("profileUpdated",x);const u=i=>{i.comment.senderEmail!==(s==null?void 0:s.email)&&(F(S=>S.map(d=>{var w;if(d._id===i.appointmentId){const E=(w=d.comments)==null?void 0:w.findIndex(I=>I._id===i.comment._id);if(E!==-1){const I=d.comments[E];if(JSON.stringify(I)!==JSON.stringify(i.comment)){const L=[...d.comments||[]];return L[E]=i.comment,{...d,comments:L}}return d}else{const I=[...d.comments||[],i.comment];return{...d,comments:I}}}return d})),te(S=>S.map(d=>{var w;if(d._id===i.appointmentId){const E=(w=d.comments)==null?void 0:w.findIndex(I=>I._id===i.comment._id);if(E!==-1){const I=d.comments[E];if(JSON.stringify(I)!==JSON.stringify(i.comment)){const L=[...d.comments||[]];return L[E]=i.comment,{...d,comments:L}}return d}else{const I=[...d.comments||[],i.comment];return{...d,comments:I}}}return d})),Ae(S=>{const w=[...S[i.appointmentId]||[]],E=w.findIndex(I=>I._id===i.comment._id);return E!==-1?w[E]=i.comment:w.push(i.comment),{...S,[i.appointmentId]:w}}))};N.on("commentUpdate",u);const C=i=>{F(S=>S.map(d=>d._id===i.appointmentId?{...d,...i.updatedAppointment}:d)),te(S=>S.map(d=>d._id===i.appointmentId?{...d,...i.updatedAppointment}:d))};N.on("appointmentUpdate",C);const R=i=>{const S=i.appointment;F(d=>[S,...d])};N.on("appointmentCreated",R);const Y=()=>{s&&N.emit("adminAppointmentsActive",{adminId:s._id,role:s.role})},V=()=>{};return N.on("connect",Y),N.on("disconnect",V),()=>{clearInterval(l),clearInterval(r),N.off("profileUpdated",x),N.off("commentUpdate",u),N.off("appointmentUpdate",C),N.off("appointmentCreated",R),N.off("connect",Y),N.off("disconnect",V)}},[ue,k,s]),c.useEffect(()=>(Ce?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[Ce]),c.useEffect(()=>{s&&(F(r=>r.map(l=>{const x={...l};return l.buyerId&&(l.buyerId._id===s._id||l.buyerId===s._id)&&(x.buyerId={...x.buyerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),l.sellerId&&(l.sellerId._id===s._id||l.sellerId===s._id)&&(x.sellerId={...x.sellerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),x})),te(r=>r.map(l=>{const x={...l};return l.buyerId&&(l.buyerId._id===s._id||l.buyerId===s._id)&&(x.buyerId={...x.buyerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),l.sellerId&&(l.sellerId._id===s._id||l.sellerId===s._id)&&(x.sellerId={...x.sellerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),x})))},[s]);const Ie=async r=>{K(r),y(""),ae(!0)},Ue=async()=>{if(!me.trim()){g.error("Please provide a reason for cancelling this appointment.");return}try{const r=await fetch(`${T}/api/bookings/${P}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:me})}),l=await r.json();r.ok?(F(x=>x.map(u=>u._id===P?{...u,status:"cancelledByAdmin",cancelReason:me}:u)),g.success("Appointment cancelled successfully. Both buyer and seller have been notified of the cancellation.")):g.error(l.message||"Failed to cancel appointment."),ae(!1),K(null),y("")}catch(r){console.error("Error in confirmAdminCancel:",r),g.error("An error occurred. Please try again.")}},pe=async r=>{K(r),Se(!0)},_e=async()=>{try{const r=await fetch(`${T}/api/bookings/${P}/reinitiate`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),l=await r.json();r.ok?(F(x=>x.map(u=>u._id===P?{...u,status:"pending",cancelReason:""}:u)),g.success("Appointment reinitiated successfully. Both buyer and seller have been notified.")):g.error(l.message||"Failed to reinitiate appointment."),Se(!1),K(null)}catch(r){console.error("Error in confirmReinitiate:",r),g.error("An error occurred. Please try again.")}},De=async r=>{K(r),D(!0)},Je=async()=>{try{const r=await fetch(`${T}/api/bookings/${P}/archive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),l=await r.json();if(r.ok){const x=h.find(u=>u._id===P);x&&(F(u=>u.filter(C=>C._id!==P)),te(u=>[{...x,archivedByAdmin:!0,archivedAt:new Date},...u])),g.success("Appointment archived successfully.")}else g.error(l.message||"Failed to archive appointment.");D(!1),K(null)}catch(r){console.error("Error in confirmArchive:",r),g.error("An error occurred. Please try again.")}},ve=async r=>{K(r),J(!0)},he=async()=>{try{const r=await fetch(`${T}/api/bookings/${P}/unarchive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),l=await r.json();if(r.ok){const x=ge.find(u=>u._id===P);x&&(te(u=>u.filter(C=>C._id!==P)),F(u=>[{...x,archivedByAdmin:!1,archivedAt:void 0},...u])),g.success("Appointment unarchived successfully.")}else g.error(l.message||"Failed to unarchive appointment.");J(!1),K(null)}catch(r){console.error("Error in confirmUnarchive:",r),g.error("An error occurred. Please try again.")}},we=async r=>{if(!r){g.error("User ID not available");return}Oe(!0),be(!0);try{const l=await fetch(`${T}/api/user/id/${r}`),x=await l.json();l.ok?Qe(x):(g.error("Failed to fetch user details."),be(!1))}catch{g.error("An error occurred while fetching user details."),be(!1)}Oe(!1)},Ee=c.useMemo(()=>h.filter(r=>{var R,Y,V,i,S,d,w,E,I;const l=new Date(r.date)<new Date||new Date(r.date).toDateString()===new Date().toDateString()&&r.time&&r.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),x=B==="all"?!0:B==="outdated"?l:r.status===B,u=((Y=(R=r.buyerId)==null?void 0:R.email)==null?void 0:Y.toLowerCase().includes($.toLowerCase()))||((i=(V=r.sellerId)==null?void 0:V.email)==null?void 0:i.toLowerCase().includes($.toLowerCase()))||((S=r.propertyName)==null?void 0:S.toLowerCase().includes($.toLowerCase()))||((w=(d=r.buyerId)==null?void 0:d.username)==null?void 0:w.toLowerCase().includes($.toLowerCase()))||((I=(E=r.sellerId)==null?void 0:E.username)==null?void 0:I.toLowerCase().includes($.toLowerCase()));let C=!0;return U&&(C=C&&new Date(r.date)>=new Date(U)),Q&&(C=C&&new Date(r.date)<=new Date(Q)),x&&u&&C}).map(r=>({...r,comments:X[r._id]||r.comments||[]})),[h,B,$,U,Q,X]),Te=c.useMemo(()=>ge.filter(r=>{var R,Y,V,i,S,d,w,E,I;const l=new Date(r.date)<new Date||new Date(r.date).toDateString()===new Date().toDateString()&&r.time&&r.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),x=B==="all"?!0:B==="outdated"?l:r.status===B,u=((Y=(R=r.buyerId)==null?void 0:R.email)==null?void 0:Y.toLowerCase().includes($.toLowerCase()))||((i=(V=r.sellerId)==null?void 0:V.email)==null?void 0:i.toLowerCase().includes($.toLowerCase()))||((S=r.propertyName)==null?void 0:S.toLowerCase().includes($.toLowerCase()))||((w=(d=r.buyerId)==null?void 0:d.username)==null?void 0:w.toLowerCase().includes($.toLowerCase()))||((I=(E=r.sellerId)==null?void 0:E.username)==null?void 0:I.toLowerCase().includes($.toLowerCase()));let C=!0;return U&&(C=C&&new Date(r.date)>=new Date(U)),Q&&(C=C&&new Date(r.date)<=new Date(Q)),x&&u&&C}).map(r=>({...r,comments:X[r._id]||r.comments||[]})),[ge,B,$,U,Q,X]),H=async()=>{re(!0);try{const r=await fetch(`${T}/api/bookings`,{credentials:"include"});if(r.ok){const x=await r.json();F(x)}const l=await fetch(`${T}/api/bookings/archived`,{credentials:"include"});if(l.ok){const x=await l.json();te(Array.isArray(x)?x:[])}}catch{}finally{re(!1)}},ne=r=>{if(!r){g.error("No message to copy");return}navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(r).then(()=>{g.success("Copied",{autoClose:2e3,position:"bottom-center"})}).catch(()=>{f(r)}):f(r)},f=r=>{try{const l=document.createElement("textarea");l.value=r,l.style.position="fixed",l.style.left="-999999px",l.style.top="-999999px",document.body.appendChild(l),l.focus(),l.select();const x=document.execCommand("copy");document.body.removeChild(l),x?g.success("Copied",{autoClose:2e3,position:"bottom-center"}):(console.error("Fallback copy failed"),g.error("Failed to copy message"))}catch(l){console.error("Fallback copy error:",l),g.error("Copy not supported")}};return qe?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading appointments..."})]})}):Array.isArray(h)?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:[e.jsx(os,{position:"top-center",autoClose:2e3,closeOnClick:!0,containerClassName:"!z-[100]",toastOptions:{style:{fontSize:"0.9rem",borderRadius:"8px",boxShadow:"0 2px 8px #0001"}}}),e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-6",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-extrabold text-blue-700 drop-shadow",children:le?"Archived Appointments":"All Appointments (Admin View)"}),e.jsxs("div",{className:"flex flex-row w-full sm:w-auto gap-2 sm:gap-4 justify-center sm:justify-end mt-2 sm:mt-0",children:[e.jsx("button",{onClick:H,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-2.5 py-1.5 rounded-md hover:from-blue-600 hover:to-purple-600 transition-all font-semibold shadow-md text-xs sm:text-base sm:px-4 sm:py-2 sm:rounded-lg w-1/2 sm:w-auto",title:"Refresh appointments",children:"Refresh"}),e.jsx("button",{onClick:()=>ye(!le),className:`bg-gradient-to-r text-white px-2.5 py-1.5 rounded-md transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-xs sm:text-base w-1/2 sm:w-auto sm:px-6 sm:py-3 sm:rounded-lg justify-center ${le?"from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600":"from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:le?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{})," ",e.jsx("span",{children:"Active Appointments"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{})," ",e.jsxs("span",{children:["Archived Appointments (",ge.length,")"]})]})})]})]}),e.jsx("p",{className:"text-center text-gray-600 mb-6",children:le?"View and manage archived appointments. You can unarchive them to move them back to active appointments.":"ðŸ’¡ High data traffic may cause this page to slow down or stop working. Please refresh to continue using it normally.âš ï¸ Chats are encrypted and secure. View only for valid purposes like disputes or fraud checks. Unauthorized access or sharing is prohibited and will be logged."}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"Status:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:B,onChange:r=>ze(r.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"pending",children:"Pending Appointments"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelledByBuyer",children:"Cancelled by Buyer"}),e.jsx("option",{value:"cancelledBySeller",children:"Cancelled by Seller"}),e.jsx("option",{value:"cancelledByAdmin",children:"Cancelled by Admin"}),e.jsx("option",{value:"deletedByAdmin",children:"Deleted by Admin"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"noShow",children:"No Show"}),e.jsx("option",{value:"outdated",children:"Outdated"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"From:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:U,onChange:r=>Ze(r.target.value),max:Q||void 0}),e.jsx("label",{className:"font-semibold",children:"To:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:Q,onChange:r=>et(r.target.value),min:U||void 0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"text-gray-500 hover:text-blue-500 transition-colors duration-200"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",placeholder:"Search by email, property, or username...",value:$,onChange:r=>We(r.target.value)})]})]}),le?Te.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No archived appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:Te.map(r=>e.jsx(Ht,{appt:r,currentUser:s,handleAdminCancel:Ie,handleReinitiateAppointment:pe,handleArchiveAppointment:De,handleUnarchiveAppointment:ve,onUserClick:we,isArchived:!0,copyMessageToClipboard:ne,updateAppointmentComments:oe,showCancelModal:A,setShowCancelModal:ae,showReinitiateModal:z,setShowReinitiateModal:Se,showArchiveModal:ke,setShowArchiveModal:D,showUnarchiveModal:se,setShowUnarchiveModal:J,appointmentToHandle:P,setAppointmentToHandle:K,cancelReason:me,setCancelReason:y,confirmAdminCancel:Ue,confirmReinitiate:_e,confirmArchive:Je,confirmUnarchive:he},r._id))})]})}):Ee.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:Ee.map(r=>e.jsx(Ht,{appt:r,currentUser:s,handleAdminCancel:Ie,handleReinitiateAppointment:pe,handleArchiveAppointment:De,handleUnarchiveAppointment:ve,onUserClick:we,isArchived:!1,copyMessageToClipboard:ne,updateAppointmentComments:oe,showCancelModal:A,setShowCancelModal:ae,showReinitiateModal:z,setShowReinitiateModal:Se,showArchiveModal:ke,setShowArchiveModal:D,showUnarchiveModal:se,setShowUnarchiveModal:J,appointmentToHandle:P,setAppointmentToHandle:K,cancelReason:me,setCancelReason:y,confirmAdminCancel:Ue,confirmReinitiate:_e,confirmArchive:Je,confirmUnarchive:he},r._id))})]})})]}),Ce&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",style:{overflow:"hidden"},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto relative animate-fadeIn",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>be(!1),title:"Close","aria-label":"Close",children:e.jsx(fe,{className:"w-4 h-4"})}),Xe?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-4 text-gray-600",children:"Loading user details..."})]}):M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(cs,{user:{username:M.username,avatar:M.avatar},size:"w-16 h-16",textSize:"text-lg",showBorder:!0,className:"border-4 border-white shadow-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 border-2 border-white rounded-full flex items-center justify-center",children:M.role==="admin"||M.role==="rootadmin"?e.jsx(Pe,{className:"w-3 h-3 text-white"}):e.jsx(ht,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:[M.username,(M.role==="admin"||M.role==="rootadmin")&&e.jsx(Pe,{className:"text-purple-600 text-base",title:"Admin user"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("p",{className:"text-sm text-gray-600 capitalize font-medium bg-white px-3 py-1 rounded-full shadow-sm",children:M.role||"User"}),M.adminApprovalStatus&&e.jsx("p",{className:`text-xs font-medium px-2 py-1 rounded-full ${M.adminApprovalStatus==="approved"?"bg-green-100 text-green-700":M.adminApprovalStatus==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:M.adminApprovalStatus})]})]})]})}),e.jsx("div",{className:"px-6 py-6 space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx(ms,{className:"text-blue-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Email"}),e.jsx("p",{className:"text-gray-800 font-medium",children:M.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-green-500",children:[e.jsx(us,{className:"text-green-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Phone"}),e.jsx("p",{className:"text-gray-800 font-medium",children:M.mobileNumber||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-purple-500",children:[e.jsx(hs,{className:"text-purple-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Member Since"}),e.jsx("p",{className:"text-gray-800 font-medium",children:new Date(M.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("p",{className:"text-gray-600",children:"User not found"})})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-blue-100",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Session expired or unauthorized"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Please sign in again to access admin appointments."}),e.jsx(Vt,{to:"/sign-in",className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Go to Sign In"})]})})}function ut(s){const h=new Date,F=new Date;return F.setDate(h.getDate()-1),s.toDateString()===h.toDateString()?"Today":s.toDateString()===F.toDateString()?"Yesterday":s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}function Ht({appt:s,currentUser:h,handleAdminCancel:F,handleReinitiateAppointment:ge,handleArchiveAppointment:te,handleUnarchiveAppointment:qe,onUserClick:re,isArchived:B,copyMessageToClipboard:ze,updateAppointmentComments:$,showCancelModal:We,setShowCancelModal:M,showReinitiateModal:Qe,setShowReinitiateModal:Ce,showArchiveModal:be,setShowArchiveModal:Xe,showUnarchiveModal:Oe,setShowUnarchiveModal:le,appointmentToHandle:ye,setAppointmentToHandle:U,cancelReason:Ze,setCancelReason:Q,confirmAdminCancel:et,confirmReinitiate:P,confirmArchive:K,confirmUnarchive:me}){var Nt,Ct,St,kt,At,It,_t,Dt;const[y,A]=j.useState(s.comments||[]),[ae,z]=c.useState(""),[Se,ke]=c.useState(!1),[D,se]=c.useState(null),[J,X]=c.useState(""),[Ae,ie]=c.useState(null),[oe,ue]=c.useState(null),[k,Ie]=c.useState(!1),[Ue,pe]=c.useState(!1),[_e,De]=c.useState(""),[Je,ve]=c.useState(!1),[he,we]=c.useState(null),[Ee,Te]=c.useState(!1),H=j.useRef(null),ne=j.useRef(null),f=j.useRef(null),r=j.useRef({}),[l,x]=c.useState(!0),[u,C]=c.useState(0),[R,Y]=c.useState(""),[V,i]=c.useState(!1),[S,d]=c.useState(!1),[w,E]=c.useState(()=>rs(s._id)),[I,L]=c.useState(null),Me=j.useRef(null),[Kt,Fe]=c.useState(!1),[Re,Le]=c.useState(""),[tt,He]=c.useState(!1),[Yt,xt]=c.useState(!1),[G,ft]=c.useState(null),[st,gt]=c.useState(!1),[Gt,bt]=c.useState(!1),[Be,de]=c.useState(!1),O=I?y.find(t=>t._id===I):null;j.useEffect(()=>{k&&(C(0),fetch(`${T}/api/bookings/${s._id}/comments/read`,{method:"PATCH",credentials:"include"}))},[k,s._id]),j.useEffect(()=>{if(S){const t=setTimeout(()=>{d(!1)},1e4);return()=>clearTimeout(t)}},[S]),j.useEffect(()=>{const t=n=>{Be&&!n.target.closest(".chat-options-menu")&&de(!1)},a=()=>{Be&&de(!1)};return document.addEventListener("mousedown",t),document.addEventListener("scroll",a,!0),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("scroll",a,!0)}},[Be]),j.useEffect(()=>{if(st){const t=setTimeout(()=>{gt(!1),bt(!0);const a=setTimeout(()=>bt(!1),1e3);return()=>clearTimeout(a)},800);return()=>clearTimeout(t)}},[st]),j.useEffect(()=>{const t=s.comments||[];if(JSON.stringify(y)!==JSON.stringify(t)){const a=y.length;if(A(t),t.length>a){const o=t.slice(a).filter(m=>m.senderEmail!==h.email);o.length>0&&(k||C(m=>m+o.length),k&&l&&setTimeout(()=>{H.current&&H.current.scrollIntoView({behavior:"smooth"})},100),k&&setTimeout(()=>{fetch(`${T}/api/bookings/${s._id}/comments/read`,{method:"PATCH",credentials:"include"})},100))}}},[s.comments,s._id,k,l,h.email]),j.useEffect(()=>{if(k){const t=`chatClearTime_${s._id}`,a=Number(localStorage.getItem(t))||0,n=(()=>{const p=s.role==="buyer"?s.buyerChatClearedAt:s.sellerChatClearedAt;return p?new Date(p).getTime():0})(),o=Math.max(a,n),b=(p=>{try{return JSON.parse(localStorage.getItem(`removedDeletedMsgs_${p}`))||[]}catch{return[]}})(s._id),_=y.find(p=>{var q,Z,je;return!((q=p.readBy)!=null&&q.includes(h._id))&&p.senderEmail!==h.email&&!p.deleted&&new Date(p.timestamp).getTime()>o&&!((je=(Z=p.removedFor)==null?void 0:Z.includes)!=null&&je.call(Z,h._id))&&!b.includes(p._id)});_&&r.current[_._id]?setTimeout(()=>{const p=r.current[_._id];p&&p.scrollIntoView({behavior:"smooth",block:"start"})},100):H.current&&setTimeout(()=>{H.current.scrollIntoView({behavior:"smooth"})},100)}},[k,y,h._id,s._id,s.role,s.buyerChatClearedAt,s.sellerChatClearedAt]);const yt=j.useRef(y.length),qt=j.useRef(y);j.useEffect(()=>{const t=y.slice(yt.current),a=t.length;if(yt.current=y.length,qt.current=y,a>0&&k){const n=t.some(m=>m.senderEmail===h.email),o=t.filter(m=>m.senderEmail!==h.email);n||l?setTimeout(()=>{H.current&&H.current.scrollIntoView({behavior:"smooth"})},100):o.length>0&&C(m=>m+o.length)}},[y.length,l,k,h.email]),j.useEffect(()=>{C(0)},[k]);const rt=j.useCallback(()=>{if(!ne.current||y.length===0)return;const a=ne.current.getBoundingClientRect(),n=a.top+60;let o="";for(let m=0;m<y.length;m++){const b=r.current[y[m]._id];if(b){const _=b.getBoundingClientRect();if(_.top>=n&&_.bottom<=a.bottom){const p=new Date(y[m].timestamp);o=ut(p);break}}}if(!o)for(let m=0;m<y.length;m++){const b=r.current[y[m]._id];if(b&&b.getBoundingClientRect().bottom>n){const p=new Date(y[m].timestamp);o=ut(p);break}}o&&o!==R&&Y(o)},[y,R]),at=j.useRef(!1),Ve=j.useCallback(async()=>{if(at.current)return;const t=y.filter(a=>{var n;return!((n=a.readBy)!=null&&n.includes(h._id))&&a.senderEmail!==h.email});if(t.length>0){at.current=!0;try{(await fetch(`${T}/api/bookings/${s._id}/comments/read`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"})).ok&&(A(n=>n.map(o=>t.some(m=>m._id===o._id)?{...o,readBy:[...o.readBy||[],h._id],status:"read"}:o)),t.forEach(n=>{N.emit("messageRead",{appointmentId:s._id,messageId:n._id,userId:h._id})}))}catch(a){console.error("Error marking messages as read:",a)}finally{at.current=!1}}},[y,h._id,s._id,N]),nt=j.useCallback(()=>{if(ne.current){const{scrollTop:t,scrollHeight:a,clientHeight:n}=ne.current,o=a-t-n<5;x(o),o&&u>0&&(C(0),Ve())}},[u,Ve]);j.useEffect(()=>{const t=ne.current;if(t&&k){const a=()=>{nt(),rt(),i(!0),Me.current&&clearTimeout(Me.current),Me.current=setTimeout(()=>{i(!1)},1e3)};return t.addEventListener("scroll",a),nt(),setTimeout(rt,100),()=>{t.removeEventListener("scroll",a),Me.current&&clearTimeout(Me.current)}}},[k,nt,rt]);const pt=j.useCallback(()=>{H.current&&(H.current.scrollIntoView({behavior:"smooth"}),C(0),setTimeout(()=>{Ve()},500))},[Ve]);j.useEffect(()=>(k?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[k]),j.useEffect(()=>{function t(a){var n,o;if(a.appointmentId===s._id&&!k){if(a.comment.deleted)return;const m=a.comment.senderEmail===((n=s.buyerId)==null?void 0:n.email),b=a.comment.senderEmail===((o=s.sellerId)==null?void 0:o.email),p=!m&&!b?"UrbanSetu":a.comment.senderEmail||"User";g.info(`New message from ${p}`)}}return N.on("commentUpdate",t),()=>{N.off("commentUpdate",t)}},[s._id,k]),j.useEffect(()=>{function t({appointmentId:n,clearedAt:o}){n===s._id&&(A([]),C(0))}function a({appointmentId:n,commentId:o}){n===s._id&&A(m=>m.filter(b=>b._id!==o))}return N.on("chatClearedForUser",t),N.on("commentRemovedForUser",a),()=>{N.off("chatClearedForUser",t),N.off("commentRemovedForUser",a)}},[s._id]),j.useEffect(()=>{const t=o=>{o.appointmentId===s._id&&A(m=>m.map(b=>b._id===o.commentId?{...b,status:b.status==="read"?"read":"delivered",deliveredAt:new Date}:b))},a=o=>{o.appointmentId===s._id&&A(m=>m.map(b=>{var _;return(_=b.readBy)!=null&&_.includes(o.userId)?b:{...b,status:"read",readBy:[...b.readBy||[],o.userId],readAt:new Date}}))},n=o=>{o.appointmentId===s._id&&(A([]),g.success("Chat deleted by admin"))};return N.on("chatCleared",n),N.on("commentDelivered",t),N.on("commentRead",a),()=>{N.off("chatCleared",n),N.off("commentDelivered",t),N.off("commentRead",a)}},[s._id,k,h.email,l]),j.useEffect(()=>{if(!k)return;const t=a=>{var n;a.ctrlKey&&a.key==="f"&&(a.preventDefault(),(n=f.current)==null||n.focus())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[k]);const lt=async()=>{if(!ae.trim())return;gt(!0);const t=ae.trim(),a=oe,n=`temp-${Date.now()}`,o={_id:n,sender:h._id,senderEmail:h.email,senderName:h.username,message:t,status:"sending",timestamp:new Date().toISOString(),readBy:[h._id],...a?{replyTo:a._id}:{}};A(b=>[...b,o]),z(""),ue(null);const m=()=>{f.current&&(f.current.focus(),f.current.setSelectionRange(0,0),document.activeElement!==f.current&&(f.current.click(),f.current.focus()))};m(),requestAnimationFrame(m),setTimeout(m,10),H.current&&H.current.scrollIntoView({behavior:"smooth"}),(async()=>{try{const b=await fetch(`${T}/api/bookings/${s._id}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:t,...a?{replyTo:a._id}:{}})}),_=await b.json();if(b.ok){const p=_.comments[_.comments.length-1];A(q=>q.map(Z=>Z._id===n?{...p}:Z))}else{A(q=>q.filter(Z=>Z._id!==n)),z(t),g.error(_.message||"Failed to send message.");const p=()=>{f.current&&(f.current.focus(),f.current.setSelectionRange(0,0),document.activeElement!==f.current&&(f.current.click(),f.current.focus()))};p(),requestAnimationFrame(p)}}catch{A(p=>p.filter(q=>q._id!==n)),z(t),g.error("An error occurred. Please try again.");const _=()=>{f.current&&(f.current.focus(),f.current.setSelectionRange(0,0),document.activeElement!==f.current&&(f.current.click(),f.current.focus()))};_(),requestAnimationFrame(_)}})()},it=async t=>{if(!J.trim())return;ie(t),A(n=>n.map(o=>o._id===t?{...o,message:J,edited:!0,editedAt:new Date}:o));try{const n=await fetch(`${T}/api/bookings/${s._id}/comment/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:J})}),o=await n.json();if(console.log("Edit response:",{status:n.status,data:o}),n.ok){A(b=>b.map(_=>{const p=o.comments.find(q=>q._id===_._id);return p?p._id===t?p:_.status==="read"&&p.status!=="read"?{...p,status:"read"}:p:_})),se(null),X(""),z("");const m=()=>{f.current&&(f.current.focus(),f.current.setSelectionRange(0,0),document.activeElement!==f.current&&(f.current.click(),f.current.focus()))};m(),requestAnimationFrame(m),setTimeout(m,10),g.success("Message edited successfully!")}else A(m=>m.map(b=>b._id===t?{...b,message:b.originalMessage||b.message,edited:b.wasEdited||!1}:b)),se(t),X(J),z(J),g.error(o.message||"Failed to edit message.")}catch(n){console.error("Error editing comment:",n),A(o=>o.map(m=>m._id===t?{...m,message:m.originalMessage||m.message,edited:m.wasEdited||!1}:m)),se(t),X(J),z(J),g.error("An error occurred. Please try again.")}finally{ie(null)}},Wt=t=>{se(t._id),X(t.message),z(t.message),A(a=>a.map(n=>n._id===t._id?{...n,originalMessage:n.message,wasEdited:n.edited}:n)),setTimeout(()=>{if(f.current){f.current.focus();const a=f.current.value.length;f.current.setSelectionRange(a,a)}},100)},Qt=t=>{ue(t);const a=()=>{if(f.current){f.current.focus();const n=f.current.value.length;f.current.setSelectionRange(n,n),document.activeElement!==f.current&&(f.current.click(),f.current.focus())}};setTimeout(a,50),setTimeout(a,100),setTimeout(a,200)},Xt=t=>{ft(t),xt(!0)},vt=new Date(s.date)>new Date||new Date(s.date).toDateString()===new Date().toDateString()&&(!s.time||s.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),Zt=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-700";case"accepted":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"cancelledByBuyer":return"bg-red-100 text-red-700";case"cancelledBySeller":return"bg-red-100 text-red-700";case"cancelledByAdmin":return"bg-red-100 text-red-700";case"deletedByAdmin":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},es=()=>{pe(!0),De("")},wt=async()=>{try{const t=await fetch(`${T}/api/bookings/${s._id}`,{credentials:"include"});if(t.ok){const a=await t.json();a.comments&&a.comments.length!==y.length&&A(a.comments)}}catch(t){console.error("Error fetching latest comments:",t)}},ts=async t=>{t.preventDefault(),Te(!0);try{const a=await fetch(`${T}/api/auth/verify-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:_e})}),n=await a.json();a.ok&&n.success?(pe(!1),Ie(!0),setTimeout(()=>{wt()},100)):g.error("Incorrect password. Please try again.")}catch{g.error("Failed to verify password. Please try again.")}Te(!1)},jt=t=>{we(t),ve(!0)},ss=async()=>{var t;if(he){try{const a=!((t=he.readBy)!=null&&t.includes(h._id))&&he.senderEmail!==h.email,n=await fetch(`${T}/api/bookings/${s._id}/comment/${he._id}`,{method:"DELETE",credentials:"include"}),o=await n.json();n.ok?(A(o.comments),a&&C(m=>Math.max(0,m-1)),g.success("Message deleted successfully!")):g.error(o.message||"Failed to delete message.")}catch{g.error("An error occurred. Please try again.")}ve(!1),we(null)}};function rs(t){try{return JSON.parse(localStorage.getItem(`hiddenDeletedMsgs_${t}`))||[]}catch{return[]}}const as=j.useCallback(t=>{E(a=>{if(!a.includes(t)){const n=[...a,t];return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${s._id}`,JSON.stringify(n))},0),n}return a})},[s._id]),ns=j.useCallback(t=>{E(a=>{const n=a.filter(o=>o!==t);return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${s._id}`,JSON.stringify(n))},0),n})},[s._id]);return e.jsxs("tr",{className:`hover:bg-blue-50 transition align-top ${B?"bg-gray-50":""} ${vt?"":"bg-gray-100"}`,children:[e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[e.jsx("div",{children:new Date(s.date).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-sm text-gray-600",children:s.time}),!vt&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"Outdated"}),B&&s.archivedAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Archived: ",new Date(s.archivedAt).toLocaleDateString("en-GB")]})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{children:s.listingId?e.jsx(Vt,{to:`/admin/listing/${s.listingId._id}`,className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:s.propertyName}):e.jsx("div",{className:"font-semibold",children:s.propertyName})})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return re((t=s.buyerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view buyer details",children:[e.jsx("div",{className:"font-semibold",children:((Nt=s.buyerId)==null?void 0:Nt.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:((Ct=s.buyerId)==null?void 0:Ct.email)||s.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((St=s.buyerId)==null?void 0:St.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return re((t=s.sellerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view seller details",children:[e.jsx("div",{className:"font-semibold",children:((kt=s.sellerId)==null?void 0:kt.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:(At=s.sellerId)==null?void 0:At.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((It=s.sellerId)==null?void 0:It.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2 capitalize",children:s.purpose}),e.jsx("td",{className:"border p-2 max-w-xs truncate",children:s.message}),e.jsxs("td",{className:"border p-2 text-center",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${Zt(s.status)}`,children:s.status==="deletedByAdmin"?"Deleted by Admin":s.status==="cancelledByBuyer"?"Cancelled by Buyer":s.status==="cancelledBySeller"?"Cancelled by Seller":s.status==="cancelledByAdmin"?"Cancelled by Admin":s.status.charAt(0).toUpperCase()+s.status.slice(1)}),s.status==="deletedByAdmin"&&s.adminComment&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:['"',s.adminComment,'"']})]}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("div",{className:"flex flex-col gap-2",children:B?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>qe(s._id),title:"Unarchive Appointment",children:[e.jsx(Ne,{})," Unarchive"]}):e.jsxs(e.Fragment,{children:[s.status==="cancelledByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>ge(s._id),title:"Reinitiate Appointment (Admin)",children:[e.jsx(Pe,{})," Reinitiate"]}):s.status!=="deletedByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>F(s._id),title:"Cancel Appointment (Admin)",children:[e.jsx(Pe,{})," Cancel"]}):null,e.jsxs("button",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>te(s._id),title:"Archive Appointment",children:[e.jsx(Ge,{})," Archive"]})]})})}),e.jsxs("td",{className:"border p-2 text-center relative",children:[e.jsxs("button",{className:"flex items-center justify-center bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 mx-auto relative group",title:"Open Chat",onClick:es,children:[e.jsx(Ye,{size:22,className:"group-hover:animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-white rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-200"}),u>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold animate-pulse",children:u>9?"9+":u})]}),Ue&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs relative flex flex-col items-center",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",onClick:()=>pe(!1),title:"Close",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-blue-700 flex items-center gap-2",children:[e.jsx(Pe,{})," Admin Password Required"]}),e.jsxs("form",{onSubmit:ts,className:"w-full flex flex-col gap-3",children:[e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-blue-200",placeholder:"Enter your password",value:_e,onChange:t=>De(t.target.value),required:!0,autoFocus:!0}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full font-semibold",disabled:Ee,children:Ee?"Verifying...":"Unlock Chat"})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl w-full h-full max-w-6xl max-h-full p-0 relative animate-fadeIn flex flex-col border border-gray-200 transform transition-all duration-500 hover:shadow-3xl",children:[e.jsx("div",{className:"flex items-center gap-3 px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-700 via-purple-700 to-blue-900 rounded-t-3xl relative shadow-2xl ring-2 ring-blue-800",children:I&&O?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!O.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Qt(O),L(null)},title:"Reply","aria-label":"Reply",children:e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),!O.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{ze(O.message),L(null)},title:"Copy message","aria-label":"Copy message",children:e.jsx(zt,{size:18})}),!O.deleted&&e.jsx("button",{className:"text-white hover:text-blue-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Xt(O),L(null)},title:"Message info","aria-label":"Message info",children:e.jsx(Ot,{size:18})}),O.senderEmail===h.email&&!O.deleted&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Wt(O),L(null)},className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",title:"Edit comment","aria-label":"Edit comment",disabled:D!==null,children:e.jsx(ct,{size:18})}),e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{jt(O),L(null)},title:"Delete","aria-label":"Delete",children:e.jsx(xe,{size:18})})]}),O.senderEmail!==h.email&&!O.deleted&&e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{jt(O),L(null)},title:"Delete","aria-label":"Delete",children:e.jsx(xe,{size:18})})]}),e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>L(null),title:"Close options","aria-label":"Close options",children:e.jsx(fe,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-full p-1.5 shadow-lg",children:e.jsx(Ye,{className:"text-blue-600 text-lg"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Live Chat"}),u>0&&e.jsxs("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold animate-pulse",children:[u," new message",u>1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors shadow",onClick:()=>de(!Be),title:"Chat options","aria-label":"Chat options",children:e.jsx(Ut,{className:"text-sm"})}),Be&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-20 min-w-[180px] chat-options-menu",children:[e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{wt(),de(!1)},children:[e.jsx(xs,{className:"text-sm"}),"Refresh Messages"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{var t;re((t=s.buyerId)==null?void 0:t._id),de(!1)},children:[e.jsx(ht,{className:"text-sm"}),"View Buyer Details"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{var t;re((t=s.sellerId)==null?void 0:t._id),de(!1)},children:[e.jsx(ht,{className:"text-sm"}),"View Seller Details"]}),y.length>0&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{Fe(!0),de(!1)},children:[e.jsx(xe,{className:"text-sm"}),"Delete Entire Chat"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{d(!S),de(!1)},children:[e.jsx(fs,{className:"text-sm"}),"Keyboard Shortcuts"]})]})]}),S&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 text-white text-xs rounded-lg px-3 py-2 shadow-lg z-20 whitespace-nowrap",children:["Press Ctrl + F to quickly focus and type your message.",e.jsx("div",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-800 transform rotate-45"})]}),u>0&&!l&&e.jsx("button",{className:"text-blue-500 hover:text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-full p-2 transition-colors shadow animate-bounce",onClick:pt,title:"Scroll to latest messages","aria-label":"Scroll to latest messages",children:e.jsx(Ye,{className:"text-sm"})}),e.jsx("button",{className:"text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>Ie(!1),title:"Close","aria-label":"Close",children:e.jsx(fe,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{ref:ne,className:"flex-1 overflow-y-auto space-y-2 mb-4 px-4 pt-4 animate-fadeInChat relative bg-gradient-to-b from-transparent to-blue-50/30",style:{minHeight:"400px",maxHeight:"calc(100vh - 200px)"},children:[e.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-400 rounded-r-lg mb-4 transform transition-all duration-500 hover:scale-105 hover:shadow-lg hover:from-blue-100 hover:to-purple-100 hover:border-blue-500 hover:border-l-6 backdrop-blur-sm",children:e.jsxs("p",{className:"text-sm text-blue-700 font-medium text-center flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-gentlePulse",children:"ðŸ”’"}),"Chats are encrypted and secure. View only for valid purposes like disputes or fraud checks. Unauthorized access or sharing is prohibited and will be logged."]})}),R&&y.length>0&&e.jsx("div",{className:`sticky top-0 left-0 right-0 z-30 pointer-events-none transition-all duration-300 ease-in-out ${V?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:e.jsx("div",{className:"w-full flex justify-center py-2",children:e.jsx("div",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:R})})}),y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx(Ye,{className:"text-gray-300 text-4xl mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"No messages yet"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Start a conversation to communicate with the parties"})]}):y.map((t,a)=>{var Et,Ke,Tt,Mt,Ft,Rt,Lt,Bt;const n=t.senderEmail===h.email,o=D===t._id,m=new Date(t.timestamp),b=a>0?new Date(y[a-1].timestamp):null,_=b?m.toDateString()!==b.toDateString():!0,p=`chatClearTime_${s._id}`,q=Number(localStorage.getItem(p))||0,Z=(()=>{const v=s.role==="buyer"?s.buyerChatClearedAt:s.sellerChatClearedAt;return v?new Date(v).getTime():0})(),je=Math.max(q,Z),ot=(v=>{try{return JSON.parse(localStorage.getItem(`removedDeletedMsgs_${v}`))||[]}catch{return[]}})(s._id),ls=!n&&!((Et=t.readBy)!=null&&Et.includes(h._id))&&!t.deleted&&new Date(t.timestamp).getTime()>je&&!((Tt=(Ke=t.removedFor)==null?void 0:Ke.includes)!=null&&Tt.call(Ke,h._id))&&!ot.includes(t._id)&&!y.slice(0,a).some(v=>{var ee,W,ce;return!((ee=v.readBy)!=null&&ee.includes(h._id))&&v.senderEmail!==h.email&&!v.deleted&&new Date(v.timestamp).getTime()>je&&!((ce=(W=v.removedFor)==null?void 0:W.includes)!=null&&ce.call(W,h._id))&&!ot.includes(v._id)}),dt=y.filter(v=>{var ee,W,ce;return!((ee=v.readBy)!=null&&ee.includes(h._id))&&v.senderEmail!==h.email&&!v.deleted&&new Date(v.timestamp).getTime()>je&&!((ce=(W=v.removedFor)==null?void 0:W.includes)!=null&&ce.call(W,h._id))&&!ot.includes(v._id)}).length;return e.jsxs(j.Fragment,{children:[_&&e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("span",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:ut(m)})}),ls&&dt>0&&e.jsx("div",{className:"w-full flex justify-center my-3",children:e.jsxs("div",{className:"bg-red-500 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white animate-pulse",children:[dt," unread message",dt>1?"s":""]})}),e.jsx("div",{className:`flex w-full ${n?"justify-end":"justify-start"} animate-fadeInChatBubble`,style:{animationDelay:`${.03*a}s`},children:e.jsxs("div",{ref:v=>r.current[t._id]=v,className:`rounded-2xl px-4 sm:px-5 py-3 text-sm shadow-xl max-w-[90%] sm:max-w-[80%] md:max-w-[70%] lg:max-w-[60%] xl:max-w-[50%] break-words overflow-hidden relative transition-all duration-300 min-h-[60px] ${n?"bg-gradient-to-r from-blue-600 to-purple-700 hover:from-blue-500 hover:to-purple-600 text-white shadow-blue-200 hover:shadow-blue-300 hover:shadow-2xl":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200 shadow-gray-200 hover:shadow-lg hover:border-gray-300 hover:shadow-xl"}`,children:[t.replyTo&&e.jsx("div",{className:"border-l-4 border-purple-400 pl-3 mb-2 text-xs bg-gradient-to-r from-purple-50 to-blue-50 hover:from-purple-100 hover:to-blue-100 rounded-lg w-full max-w-full break-words cursor-pointer transition-all duration-200 hover:shadow-sm",onClick:()=>{r.current[t.replyTo]&&(r.current[t.replyTo].scrollIntoView({behavior:"smooth",block:"center"}),r.current[t.replyTo].classList.add("reply-highlight"),setTimeout(()=>{var v;(v=r.current[t.replyTo])==null||v.classList.remove("reply-highlight")},1600))},role:"button",tabIndex:0,"aria-label":"Go to replied message",children:e.jsxs("span",{className:"text-xs text-gray-700 font-medium truncate max-w-[150px] flex items-center gap-1",children:[e.jsx("span",{className:"text-purple-500",children:"â†©"}),((Ft=(Mt=y.find(v=>v._id===t.replyTo))==null?void 0:Mt.message)==null?void 0:Ft.substring(0,30))||"Original message",((Lt=(Rt=y.find(v=>v._id===t.replyTo))==null?void 0:Rt.message)==null?void 0:Lt.length)>30?"...":""]})}),e.jsx("div",{className:"font-semibold mb-2 flex items-center gap-2 justify-start text-left",children:e.jsx("span",{className:`truncate max-w-[120px] min-w-[60px] inline-block align-middle overflow-hidden text-ellipsis text-left ${n?"text-blue-100":"text-gray-700"}`,children:n?"You":(()=>{var W,ce,$t,Pt;const v=t.senderEmail===((W=s.buyerId)==null?void 0:W.email),ee=t.senderEmail===((ce=s.sellerId)==null?void 0:ce.email);return v?(($t=s.buyerId)==null?void 0:$t.username)||t.senderName||t.senderEmail:ee?((Pt=s.sellerId)==null?void 0:Pt.username)||t.senderName||t.senderEmail:t.senderName||t.senderEmail})()})}),e.jsx("div",{className:`text-left ${n?"text-base font-medium":"text-sm"}`,children:t.deleted?(()=>{const v=w.includes(t._id);return h&&(h.role==="admin"||h.role==="rootadmin")?v?e.jsx("div",{className:"border border-gray-300 bg-gray-100 rounded p-2 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 text-xs",children:[e.jsx($e,{className:"inline-block"}),e.jsx("span",{children:"Deleted message hidden from view"})]}),e.jsx("button",{className:"text-xs text-blue-500 hover:text-blue-700 underline",onClick:()=>ns(t._id),title:"Show this deleted message content",children:"Show"})]})}):e.jsxs("div",{className:"border border-red-300 bg-red-50 rounded p-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-xs font-semibold mb-1",children:[e.jsx($e,{className:"inline-block"}),"Message deleted by ",t.deletedBy||"user"," (Admin view - preserved for records)"]}),e.jsx("div",{className:"text-gray-800 bg-white p-2 rounded border-l-4 border-red-400 relative group",children:(()=>{const ee=t.originalMessage||t.message;return ee?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap break-words",children:ee}),e.jsx("button",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-gray-500 hover:text-gray-700 bg-white rounded p-1 shadow-sm",onClick:()=>ze(ee),title:"Copy deleted message content","aria-label":"Copy deleted message content",children:e.jsx(zt,{className:"text-xs"})})]}):e.jsx("span",{className:"text-gray-500 italic",children:"[Message content not preserved - this message was deleted before content preservation was implemented]"})})()}),e.jsx("button",{className:"mt-2 text-xs text-red-500 hover:text-red-700 underline",onClick:()=>as(t._id),title:"Hide this deleted message from your admin view",children:"Hide from admin view"})]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx($e,{className:"inline-block text-lg"})," This message has been deleted."]})})():e.jsx("div",{children:o?e.jsx("div",{className:"bg-yellow-100 border-l-4 border-yellow-400 px-2 py-1 rounded",children:e.jsx("span",{className:"text-yellow-800 text-xs font-medium",children:"âœï¸ Editing this message below..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap break-words",children:(t.message||"").replace(/\n+$/,"")}),t.edited&&e.jsx("span",{className:"ml-2 text-[10px] italic text-gray-300 whitespace-nowrap",children:"(Edited)"})]})})}),e.jsxs("div",{className:"flex items-center gap-1 justify-end mt-2","data-message-actions":!0,children:[e.jsx("span",{className:`${n?"text-blue-200":"text-gray-500"} text-[10px]`,children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),!t.deleted&&e.jsx("button",{className:`${t.senderEmail===h.email?"text-blue-200 hover:text-white":"text-gray-500 hover:text-gray-700"} transition-all duration-200 hover:scale-110 p-1 rounded-full hover:bg-white hover:bg-opacity-20 ml-1`,onClick:v=>{v.stopPropagation(),L(t._id)},title:"Message options","aria-label":"Message options",children:e.jsx(Ut,{size:t.senderEmail===h.email?14:12})}),t.senderEmail===h.email&&!t.deleted&&e.jsx("span",{className:"ml-1 flex items-center gap-1",children:(Bt=t.readBy)!=null&&Bt.some(v=>v!==h._id)?e.jsx(Jt,{className:"text-green-400 text-xs",title:"Read"}):t.status==="delivered"?e.jsx(Jt,{className:"text-blue-200 text-xs",title:"Delivered"}):t.status==="sending"?e.jsx(mt,{className:"text-blue-200 text-xs animate-pulse",title:"Sending..."}):e.jsx(mt,{className:"text-blue-200 text-xs",title:"Sent"})})]})]})})]},t._id||a)}),e.jsx("div",{ref:H})]}),oe&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsxs("span",{className:"text-xs text-gray-600 truncate max-w-[200px]",children:[(_t=oe.message)==null?void 0:_t.substring(0,40),((Dt=oe.message)==null?void 0:Dt.length)>40?"...":""]}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-1 transition-colors",onClick:()=>ue(null),title:"Cancel reply",children:e.jsx(fe,{className:"w-3 h-3"})})]})}),D&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-yellow-50 border-l-4 border-yellow-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold mr-2",children:"âœï¸ Editing message:"}),e.jsx("span",{className:"text-xs text-yellow-600 truncate",children:J}),e.jsx("button",{className:"ml-auto text-yellow-400 hover:text-yellow-700 bg-yellow-100 hover:bg-yellow-200 rounded-full p-1 transition-colors",onClick:()=>{se(null),X(""),z("")},title:"Cancel edit",children:e.jsx(fe,{className:"w-3 h-3"})})]})}),e.jsxs("div",{className:"flex gap-2 mt-1 px-3 pb-2",children:[e.jsx("textarea",{rows:1,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-2xl text-sm focus:ring-2 focus:ring-blue-300 focus:border-blue-400 shadow-lg transition-all duration-300 bg-white resize-y whitespace-pre-wrap break-all hover:border-blue-300 hover:shadow-xl focus:shadow-2xl transform hover:scale-[1.01]",placeholder:D?"Edit your message...":"Type a message...",value:ae,onChange:t=>{z(t.target.value),D&&X(t.target.value)},onClick:()=>{I&&(L(null),g.info("You can hit reply icon in header to reply"))},onKeyDown:t=>{const a=window.matchMedia("(min-width: 768px)").matches;if(t.key==="Enter"){if(t.isComposing||t.keyCode===229)return;(a&&!t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),D?it(D):lt())}},ref:f}),e.jsx("button",{onClick:t=>{t.preventDefault(),D?it(D):lt()},disabled:D?Ae===D:!ae.trim(),className:"bg-gradient-to-r from-blue-600 to-purple-700 text-white w-12 h-12 rounded-full shadow-lg hover:from-blue-700 hover:to-purple-800 hover:shadow-xl transform hover:scale-110 transition-all duration-300 disabled:opacity-50 disabled:transform-none flex items-center justify-center hover:shadow-2xl active:scale-95 group",children:D?Ae===D?e.jsx(ct,{className:"text-lg text-white animate-editSaving"}):e.jsx(ct,{className:"text-lg text-white group-hover:scale-110 transition-transform duration-200"}):e.jsx("div",{className:"relative",children:Gt?e.jsx(mt,{className:"text-lg text-white group-hover:scale-110 transition-all duration-300 send-icon animate-sent"}):e.jsx(gs,{className:`text-lg text-white group-hover:scale-110 transition-all duration-300 send-icon ${st?"animate-fly":""}`})})})]}),e.jsx("style",{jsx:!0,children:`
                @keyframes fadeInChatBubble {
                  from { opacity: 0; transform: translateY(20px) scale(0.95); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
                .animate-fadeInChatBubble {
                  animation: fadeInChatBubble 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                }
                @keyframes fadeInChat {
                  from { opacity: 0; transform: translateY(10px); }
                  to { opacity: 1; transform: translateY(0); }
                }
                .animate-fadeInChat {
                  animation: fadeInChat 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                }
                @keyframes gentlePulse {
                  0%, 100% { opacity: 1; transform: scale(1); }
                  50% { opacity: 0.9; transform: scale(1.01); }
                }
                .animate-gentlePulse {
                  animation: gentlePulse 3s ease-in-out infinite;
                }
                @keyframes attentionGlow {
                  0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
                  50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6); }
                }
                .animate-attentionGlow {
                  animation: attentionGlow 2s ease-in-out infinite;
                }
                @keyframes slideInFromTop {
                  from { opacity: 0; transform: translateY(-20px) scale(0.95); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
                                  .animate-slideInFromTop {
                    animation: slideInFromTop 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                  }
                  @keyframes sendIconFly {
                    0% { 
                      transform: translate(0, 0) scale(1); 
                      opacity: 1;
                    }
                    20% { 
                      transform: translate(0, 0) scale(1.2); 
                      opacity: 1;
                    }
                    40% { 
                      transform: translate(15px, -20px) scale(1.3); 
                      opacity: 0.8;
                    }
                    60% { 
                      transform: translate(25px, -35px) scale(1.4); 
                      opacity: 0.6;
                    }
                    80% { 
                      transform: translate(15px, -20px) scale(1.2); 
                      opacity: 0.8;
                    }
                    100% { 
                      transform: translate(0, 0) scale(1); 
                      opacity: 1;
                    }
                  }
                  .send-icon.animate-fly {
                    animation: sendIconFly 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                  }
                  @keyframes sentSuccess {
                    0% { 
                      transform: scale(0.8); 
                      opacity: 0;
                    }
                    50% { 
                      transform: scale(1.2); 
                      opacity: 1;
                    }
                    100% { 
                      transform: scale(1); 
                      opacity: 1;
                    }
                  }
                  .send-icon.animate-sent {
                    animation: sentSuccess 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                  }
                  @keyframes editSaving {
                    0% { 
                      transform: scale(1) rotate(0deg) translate(0, 0); 
                      opacity: 1;
                    }
                    20% { 
                      transform: scale(1.15) rotate(-8deg) translate(-1px, -1px); 
                      opacity: 0.9;
                    }
                    40% { 
                      transform: scale(1.25) rotate(0deg) translate(0, -2px); 
                      opacity: 1;
                    }
                    60% { 
                      transform: scale(1.15) rotate(8deg) translate(1px, -1px); 
                      opacity: 0.9;
                    }
                    80% { 
                      transform: scale(1.1) rotate(-4deg) translate(-1px, 0); 
                      opacity: 0.95;
                    }
                    100% { 
                      transform: scale(1) rotate(0deg) translate(0, 0); 
                      opacity: 1;
                    }
                  }
                  .animate-editSaving {
                    animation: editSaving 1.2s ease-in-out infinite;
                  }
                `}),!l&&!D&&!oe&&e.jsx("div",{className:"absolute bottom-20 right-6 z-20",children:e.jsxs("button",{onClick:pt,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-xl transition-all duration-200 hover:scale-110 relative transform hover:shadow-2xl",title:u>0?`${u} new message${u>1?"s":""}`:"Scroll to bottom","aria-label":u>0?`${u} new messages, scroll to bottom`:"Scroll to bottom",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})}),u>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 border-2 border-white shadow-lg",children:u>99?"99+":u})]})}),Kt&&e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm relative shadow-2xl",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",onClick:()=>{Fe(!1),Le("")},title:"Close","aria-label":"Close",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-red-600 flex items-center gap-2",children:[e.jsx(xe,{})," Delete Entire Chat"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This will permanently delete all messages for this appointment. Enter admin password to confirm."}),e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-red-200 mb-4",placeholder:"Admin password",value:Re,onChange:t=>Le(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Re.trim()&&!tt&&(t.preventDefault(),(async()=>{try{He(!0);const a=await fetch(`${T}/api/bookings/${s._id}/comments`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Re})}),n=await a.json();a.ok?(A([]),g.success("Chat deleted successfully."),Fe(!1),Le("")):g.error(n.message||"Failed to delete chat")}catch{g.error("An error occurred. Please try again.")}finally{He(!1)}})())},autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Fe(!1),Le("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",disabled:tt||!Re,onClick:async()=>{try{He(!0);const t=await fetch(`${T}/api/bookings/${s._id}/comments`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Re})}),a=await t.json();t.ok?(A([]),g.success("Chat deleted successfully."),Fe(!1),Le("")):g.error(a.message||"Failed to delete chat")}catch{g.error("An error occurred. Please try again.")}finally{He(!1)}},className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-60",children:tt?"Deleting...":e.jsxs(e.Fragment,{children:[e.jsx(xe,{size:12})," Delete Chat"]})})]})]})})]})}),Je&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(xe,{className:"text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Delete Message"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to delete this message for everyone?"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{ve(!1),we(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:ss,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(xe,{size:14}),"Delete"]})]})]})})}),We&&ye===s._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx($e,{className:"text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Cancel Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify mb-4",children:"Are you sure you want to cancel this appointment?"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for cancellation (required):"}),e.jsx("textarea",{value:Ze,onChange:t=>Q(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:"3",placeholder:"Please provide a reason for cancelling this appointment..."})]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{M(!1),U(null),Q("")},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:et,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx($e,{size:14}),"Cancel Appointment"]})]})]})})}),Qe&&ye===s._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Reinitiate Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to reinitiate this appointment? This will notify both buyer and seller."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Ce(!1),U(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:P,className:"px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(Ne,{size:14}),"Reinitiate"]})]})]})})}),be&&ye===s._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Ge,{className:"text-blue-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Archive Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to archive this appointment? It will be moved to the archived section."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Xe(!1),U(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:K,className:"px-4 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Ge,{size:14}),"Archive"]})]})]})})}),Oe&&ye===s._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Unarchive Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to unarchive this appointment? It will be moved back to the active appointments."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{le(!1),U(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:me,className:"px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(Ne,{size:14}),"Unarchive"]})]})]})})}),Yt&&G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ot,{className:"text-blue-500"})," Message Info"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm text-gray-700",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Message:"}),e.jsxs("div",{className:"whitespace-pre-wrap break-words",children:[(G.message||"").slice(0,200),(G.message||"").length>200?"...":""]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Sent:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(G.timestamp).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),G.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Delivered:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(G.deliveredAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),G.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Read:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(G.readAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),!G.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Not delivered yet"})]}),G.deliveredAt&&!G.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Delivered"})]}),G.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-green-600",children:"Read"})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{xt(!1),ft(null)},className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})})]})]})}export{ps as default};
