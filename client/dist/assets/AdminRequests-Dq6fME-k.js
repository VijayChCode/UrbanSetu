import{r as n,b,a as y,j as e,C as N}from"./index-crh2KQ3K.js";const w=()=>{const[r,i]=n.useState([]),[h,m]=n.useState(!0),[x,u]=n.useState(null),{currentUser:s}=b(t=>t.user),l=y();n.useEffect(()=>{if(console.log("=== AdminRequests Page Debug ==="),console.log("Current User:",s),console.log("User Email:",s==null?void 0:s.email),console.log("User Role:",s==null?void 0:s.role),console.log("Is Default Admin:",s==null?void 0:s.isDefaultAdmin),console.log("================================"),!s){console.log("No current user yet, waiting...");return}if(s.role!=="admin"&&s.role!=="rootadmin"&&!s.isDefaultAdmin){console.log("User is not admin or rootadmin, redirecting..."),l("/sign-in");return}console.log("User is default admin, fetching requests..."),p()},[s,l]);const p=async()=>{try{m(!0);const t=await fetch("http://localhost:3000/api/admin/pending-requests",{headers:{"Content-Type":"application/json"},credentials:"include"}),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to fetch requests");i(a)}catch(t){u(t.message)}finally{m(!1)}},g=async t=>{try{const a=await fetch(`http://localhost:3000/api/admin/approve/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentUserId:s._id,rootAdminPassword:"Salendra@2004"})}),o=await a.json();if(!a.ok)throw new Error(o.message||"Failed to approve request");i(d=>d.filter(c=>c._id!==t)),alert("Admin request approved successfully!"),window.location.reload()}catch(a){alert(a.message)}},f=async t=>{try{const a=await fetch(`http://localhost:3000/api/admin/reject/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentUserId:s._id,rootAdminPassword:"Salendra@2004"})}),o=await a.json();if(!a.ok)throw new Error(o.message||"Failed to reject request");i(d=>d.filter(c=>c._id!==t)),alert("Admin request rejected successfully!"),window.location.reload()}catch(a){alert(a.message)}},j=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return s?h?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):(console.log("Final check - User email:",s.email),console.log("Final check - Is default admin:",s.isDefaultAdmin),s.isDefaultAdmin||s.role==="rootadmin"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Requests"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage pending admin approval requests (Root Admin Only)"}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Welcome, ",s.email," (Root Admin)"]})]}),e.jsxs("div",{className:"bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium",children:[r.length," Pending"]})]}),x&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:x}),r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Pending Requests"}),e.jsx("p",{className:"text-gray-600",children:"All admin requests have been processed."})]}):e.jsx("div",{className:"space-y-6",children:r.map(t=>e.jsx("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:t.username.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.username}),e.jsx("p",{className:"text-gray-600",children:t.email}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Requested: ",j(t.adminRequestDate)]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>g(t._id),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[e.jsx("span",{children:"âœ“"}),e.jsx("span",{children:"Approve"})]}),e.jsxs("button",{onClick:()=>f(t._id),className:"bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[e.jsx("span",{children:"âœ•"}),e.jsx("span",{children:"Reject"})]})]})]})},t._id))})]})})}),e.jsx(N,{})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"ðŸš«"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"Only the default admin or root admin can approve new admin requests."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current user: ",s.email]}),e.jsx("button",{onClick:()=>l("/admin"),className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200",children:"Back to Dashboard"})]})})})})):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})};export{w as default};
