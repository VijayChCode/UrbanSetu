import{g as ge,r as c,j as e,v as M,U as Ne,w as he,x as Pe,z as ae,A as Ye,B as we,C as ve,D as ke,y as h,b as De,E as Ge,G as Ke,H as _e,I as Qe,J as Xe,K as Ze,t as es,u as ss,h as ts,M as as,L as Re,O as rs,P as ns,Q as ls,R as is,S as os,T as ds,V as cs,W as ms,X as xs}from"./index-CGrQkIao.js";import{S as us,N as ps,a as Se}from"./navigation-qCVBWv5P.js";import{C as hs}from"./ContactSupportWrapper-KCDHpeWF.js";import{R as Fe}from"./ReviewForm-B3pLYPnj.js";import{s as Ce,m as gs,g as Le}from"./addressMasking-3vIUwCOC.js";const fs="https://urbansetu.onrender.com";function $e({reviewId:b,onReplyAdded:w}){const{currentUser:F}=ge(C=>C.user),[t,a]=c.useState(""),[g,J]=c.useState(!1),[O,P]=c.useState("");if(!F)return null;const T=async C=>{if(C.preventDefault(),!t.trim()){P("Reply cannot be empty");return}J(!0),P("");try{const R=await fetch(`${fs}/api/review/reply/${b}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:t})}),L=await R.json();R.ok?(a(""),w&&w()):P(L.message||"Failed to add reply")}catch{P("Network error. Please try again.")}finally{J(!1)}};return e.jsxs("form",{onSubmit:T,className:"flex flex-col gap-2 mt-2",children:[e.jsx("textarea",{value:t,onChange:C=>a(C.target.value),rows:2,className:"w-full border border-gray-300 rounded p-2 text-sm",placeholder:"Write a reply...",disabled:g}),O&&e.jsx("div",{className:"text-red-600 text-xs",children:O}),e.jsx("button",{type:"submit",className:"self-end bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm",disabled:g||!t.trim(),children:g?"Replying...":"Reply"})]})}const N="https://urbansetu.onrender.com";function bs({listingId:b,onReviewDeleted:w,listingOwnerId:F}){const{currentUser:t}=ge(s=>s.user),[a,g]=c.useState([]),[J,O]=c.useState(!0),[P,T]=c.useState(""),[C,R]=c.useState(null),[L,re]=c.useState("date"),[U,W]=c.useState("desc"),[q,ie]=c.useState({}),[oe,Y]=c.useState({}),[Z,v]=c.useState({}),[A,S]=c.useState({}),[k,$]=c.useState(null),[B,G]=c.useState(!1),[ne,ee]=c.useState(""),[se,K]=c.useState(null),[te,I]=c.useState(""),[D,de]=c.useState(!1),[z,V]=c.useState({}),[H,ce]=c.useState({});c.useEffect(()=>{le();const s=r=>{(r.listingId===b||r.listingId&&r.listingId._id===b)&&(g(o=>o.some(i=>i._id===r._id)?o.map(i=>i._id===r._id?r:i):[r,...o]),Q(r._id))};M.on("reviewUpdated",s);const n=({action:r,replies:o,reviewId:m,reply:i,replyId:x})=>{r==="updatedAll"&&m&&o?S(f=>({...f,[m]:o})):r==="deleted"&&m?Q(m):i&&i.reviewId&&Q(i.reviewId)};M.on("reviewReplyUpdated",n);const l=r=>{console.log("[ReviewList] Received profileUpdated socket event:",r),console.log("[ReviewList] Current reviews:",a.length),g(o=>{const m=o.map(i=>i.userId===r.userId?(console.log("[ReviewList] Updating review:",i._id,"for user:",r.userId),{...i,userName:r.username,userAvatar:r.avatar}):i);return console.log("[ReviewList] Updated reviews:",m.length),m}),S(o=>{const m={...o};return Object.keys(m).forEach(i=>{var x;m[i]=(x=m[i])==null?void 0:x.map(f=>f.userId===r.userId?(console.log("[ReviewList] Updating reply:",f._id,"for user:",r.userId),{...f,userName:r.username,userAvatar:r.avatar}):f)}),m})};return M.on("profileUpdated",l),console.log("[ReviewList] Socket listeners set up for profileUpdated"),M.emit("testConnection",{message:"ReviewList component connected"},r=>{console.log("[ReviewList] Test socket response:",r)}),()=>{M.off("reviewUpdated",s),M.off("reviewReplyUpdated",n),M.off("profileUpdated",l),console.log("[ReviewList] Socket listeners cleaned up")}},[b,L,U]),c.useEffect(()=>{t&&(g(s=>s.map(n=>n.userId===t._id?{...n,userName:t.username,userAvatar:t.avatar}:n)),S(s=>{const n={...s};return Object.keys(n).forEach(l=>{var r;n[l]=(r=n[l])==null?void 0:r.map(o=>o.userId===t._id?{...o,userName:t.username,userAvatar:t.avatar}:o)}),n}))},[t]),c.useEffect(()=>{const s=setInterval(async()=>{if(t)try{const n=await fetch(`${N}/api/user/id/${t._id}`);if(n.ok){const l=await n.json();(l.username!==t.username||l.avatar!==t.avatar)&&(console.log("[ReviewList] Profile updated via polling:",l),g(r=>r.map(o=>o.userId===l._id?{...o,userName:l.username,userAvatar:l.avatar}:o)),S(r=>{const o={...r};return Object.keys(o).forEach(m=>{var i;o[m]=(i=o[m])==null?void 0:i.map(x=>x.userId===l._id?{...x,userName:l.username,userAvatar:l.avatar}:x)}),o}))}}catch(n){console.error("[ReviewList] Error polling for profile updates:",n)}},3e4);return()=>clearInterval(s)},[t]);const le=async()=>{try{const s=await fetch(`${N}/api/review/listing/${b}?sort=${L}&order=${U}`,{credentials:"include"}),n=await s.json();s.ok?g(n):T(n.message||"Failed to load reviews")}catch{T("Network error. Please try again.")}finally{O(!1)}},me=async s=>{if(window.confirm("Are you sure you want to delete this review?"))try{const n=await fetch(`${N}/api/review/delete/${s}`,{method:"DELETE",credentials:"include"}),l=await n.json();n.ok?(g(a.filter(r=>r._id!==s)),w&&w(),h.success("Review deleted successfully")):h.error(l.message||"Failed to delete review")}catch{h.error("Network error. Please try again.")}},p=s=>{R(s)},y=()=>{R(null),le()},j=async s=>{if(!t){h.info("Please sign in to vote on reviews");return}g(n=>n.map(l=>{var r;if(l._id===s){const o=(r=l.helpfulVotes)==null?void 0:r.some(x=>x.userId===t._id);let m,i=l.helpfulCount||0;return o?(m=l.helpfulVotes.filter(x=>x.userId!==t._id),i=Math.max(0,i-1)):(m=[...l.helpfulVotes||[],{userId:t._id}],i=i+1),{...l,helpfulVotes:m,helpfulCount:i}}return l}));try{const n=await fetch(`${N}/api/review/helpful/${s}`,{method:"POST",credentials:"include"})}catch{h.error("Network error. Please try again.")}},xe=async s=>{Y(n=>({...n,[s]:!0})),v(n=>({...n,[s]:""}));try{const n=await fetch(`${N}/api/review/respond/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({ownerResponse:q[s]})}),l=await n.json();n.ok?(g(r=>r.map(o=>o._id===s?{...o,ownerResponse:q[s]}:o)),ie(r=>({...r,[s]:""}))):v(r=>({...r,[s]:l.message||"Failed to submit response"}))}catch{v(l=>({...l,[s]:"Network error. Please try again."}))}finally{Y(n=>({...n,[s]:!1}))}},Ae=s=>[...Array(5)].map((n,l)=>e.jsx(De,{className:`text-lg ${l<s?"text-yellow-400":"text-gray-300"}`},l)),Oe=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),Te=s=>{const l={pending:{color:"bg-yellow-100 text-yellow-800",icon:_e},approved:{color:"bg-green-100 text-green-800",icon:_e},rejected:{color:"bg-red-100 text-red-800",icon:Ke},removed:{color:"bg-gray-100 text-gray-800",icon:Ge}}[s];if(!l)return e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:s?s.charAt(0).toUpperCase()+s.slice(1):"Unknown"});const r=l.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.color}`,children:[e.jsx(r,{className:"mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},fe=s=>{var n;return t?(n=s.helpfulVotes)==null?void 0:n.some(l=>l.userId===t._id):!1},ue=s=>L!==s?e.jsx(Qe,{className:"text-gray-400"}):U==="desc"?e.jsx(Xe,{className:"text-blue-600"}):e.jsx(Ze,{className:"text-blue-600"}),pe=s=>{L===s?(W(U==="desc"?"asc":"desc"),h.info(`Sorted by ${s} (${U==="desc"?"ascending":"descending"})`)):(re(s),W("desc"),h.info(`Sorted by ${s} (descending)`))},Q=async s=>{try{const n=await fetch(`${N}/api/review/reply/${s}`);if(n.ok){const l=await n.json();S(r=>({...r,[s]:l}))}}catch{}};c.useEffect(()=>{a.forEach(s=>Q(s._id))},[a]);const be=async(s,n,l)=>{var r,o,m;if(!t){h.info("Please sign in to vote on reviews");return}V(i=>({...i,[s]:!0}));try{const i=(r=A[l])==null?void 0:r.find(d=>d._id===s);let x=n;i&&(n==="like"?(o=i.likes)!=null&&o.includes(t==null?void 0:t._id)?(x="remove_like",S(d=>({...d,[l]:d[l].map(u=>u._id===s?{...u,likes:u.likes.filter(_=>_!==t._id)}:u)}))):S(d=>({...d,[l]:d[l].map(u=>{var _;return u._id===s?{...u,likes:[...u.likes||[],t._id],dislikes:(_=u.dislikes)==null?void 0:_.filter(X=>X!==t._id)}:u})})):n==="dislike"&&((m=i.dislikes)!=null&&m.includes(t==null?void 0:t._id)?(x="remove_dislike",S(d=>({...d,[l]:d[l].map(u=>u._id===s?{...u,dislikes:u.dislikes.filter(_=>_!==t._id)}:u)}))):S(d=>({...d,[l]:d[l].map(u=>{var _;return u._id===s?{...u,dislikes:[...u.dislikes||[],t._id],likes:(_=u.likes)==null?void 0:_.filter(X=>X!==t._id)}:u})}))));const f=await fetch(`${N}/api/review/reply/like/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:x})})}catch{h.error("Network error. Please try again.")}finally{V(i=>({...i,[s]:!1}))}},Ue=async s=>{if(!t){h.info("Please sign in to vote on reviews");return}try{g(l=>l.map(r=>{var o;if(r._id===s){const m=(o=r.dislikes)==null?void 0:o.some(f=>f.userId===(t==null?void 0:t._id));let i,x=r.dislikeCount||0;return m?(i=r.dislikes.filter(f=>f.userId!==t._id),x=Math.max(0,x-1)):(i=[...r.dislikes||[],{userId:t._id}],x=x+1),{...r,dislikes:i,dislikeCount:x}}return r}));const n=await fetch(`${N}/api/review/dislike/${s}`,{method:"POST",credentials:"include"})}catch{h.error("Network error. Please try again.")}},Be=s=>{$(s)},Ie=async()=>{!k||!k.comment.trim()||(await fetch(`${N}/api/review/reply/${k._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:k.comment})}),$(null))},ze=async s=>{window.confirm("Delete this reply?")&&await fetch(`${N}/api/review/reply/${s}`,{method:"DELETE",credentials:"include"})},Ve=s=>{G(s._id),ee(s.ownerResponse||"")},He=async s=>{await xe(s),G(!1)},Me=async s=>{window.confirm("Delete owner response?")&&(await fetch(`${N}/api/review/respond/${s}`,{method:"DELETE",credentials:"include"}),G(!1))},ye=async(s,n)=>{if(!t){h.info("Please sign in to vote on reviews");return}g(l=>l.map(r=>{if(r._id===s){let o=r.ownerResponseLikes||[],m=r.ownerResponseDislikes||[];return n==="like"?o.includes(t._id)?o=o.filter(i=>i!==t._id):(o=[...o,t._id],m=m.filter(i=>i!==t._id)):n==="dislike"&&(m.includes(t._id)?m=m.filter(i=>i!==t._id):(m=[...m,t._id],o=o.filter(i=>i!==t._id))),{...r,ownerResponseLikes:o,ownerResponseDislikes:m}}return r}));try{await fetch(`${N}/api/review/respond/like/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:n})})}catch{}},E=s=>s&&(s.role==="admin"||s.role==="rootadmin"),Je=s=>{K(s),I("")},We=async()=>{if(!te.trim()){h.info("Please provide a reason for reporting.");return}de(!0);try{const s=await fetch(`${N}/api/review/report/${se._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:te})}),n=await s.json();s.ok?(h.success("Thank you for reporting. Our team will review this issue."),K(null),I("")):h.error(n.message||"Failed to report issue.")}catch{h.error("Network error. Please try again.")}finally{de(!1)}};return J?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading reviews..."})]}):P?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800",children:P})}):a.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"No reviews yet. Be the first to review this property!"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800",children:["Reviews (",a.filter(s=>s.status==="approved").length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),e.jsxs("button",{onClick:()=>pe("date"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Date ",ue("date")]}),e.jsxs("button",{onClick:()=>pe("rating"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Rating ",ue("rating")]}),e.jsxs("button",{onClick:()=>pe("helpful"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Helpful ",ue("helpful")]})]})]}),a.filter(s=>s.status==="approved").map(s=>{var n,l,r,o,m,i,x,f;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[!E(s)&&e.jsx(Ne,{user:{username:s.userName,avatar:s.userAvatar},size:"w-10 h-10",textSize:"text-sm",showBorder:!1}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[E(s)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1",children:["From organization ",e.jsx(he,{className:"text-green-500"})]}):e.jsx("h4",{className:"font-semibold text-gray-800",children:s.userName}),(s.isVerified||s.verifiedByBooking)&&!E(s)&&e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(he,{className:"mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[Ae(s.rating),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:[s.rating," star",s.rating>1?"s":""]})]})]})]}),t&&(t._id===s.userId||E(t))&&s.status!=="approved"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>p(s),className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit review",children:e.jsx(Pe,{})}),e.jsx("button",{onClick:()=>me(s._id),className:"text-red-600 hover:text-red-800 p-1",title:"Delete review",children:e.jsx(ae,{})})]})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:s.comment}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:Oe(s.createdAt)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>j(s._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${fe(s)?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,disabled:s.status!=="approved",children:[e.jsx(Ye,{className:fe(s)?"text-blue-600":""}),e.jsx("span",{children:"Helpful"}),s.helpfulCount>0&&e.jsxs("span",{className:"ml-1",children:["(",s.helpfulCount,")"]})]}),e.jsxs("button",{onClick:()=>Ue(s._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${(n=s.dislikes)!=null&&n.some(d=>d.userId===(t==null?void 0:t._id))?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("span",{role:"img","aria-label":"dislike",children:"ðŸ‘Ž"}),e.jsx("span",{children:"Dislike"}),s.dislikeCount>0&&e.jsxs("span",{className:"ml-1",children:["(",s.dislikeCount,")"]})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[Te(s.status),s.verifiedByBooking&&e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded",children:"Booked this property"})]}),s.adminNote&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Admin Note:"})," ",s.adminNote]})}),s.ownerResponse&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-md border border-blue-200 flex justify-between items-center",children:[e.jsx("div",{className:"flex-1",children:B===s._id?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded-md p-2 text-sm mb-2",rows:"2",value:ne,onChange:d=>ee(d.target.value)}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm ml-2",onClick:()=>He(s._id),children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm ml-2",onClick:()=>G(!1),children:"Cancel"})]}):e.jsx(e.Fragment,{children:e.jsxs("p",{className:"text-sm text-blue-800 flex items-center gap-2",children:[e.jsx(we,{className:"inline-block text-blue-500"}),e.jsx("strong",{children:"Owner Response:"})," ",s.ownerResponse]})})}),t&&F&&t._id!==F&&!B&&e.jsxs("div",{className:"flex gap-2 ml-4 items-center",children:[e.jsxs("button",{onClick:()=>ye(s._id,"like"),className:`flex items-center gap-1 ${(l=s.ownerResponseLikes)!=null&&l.includes(t._id)?"text-blue-600":"text-gray-500"}`,children:["ðŸ‘ Like ",((r=s.ownerResponseLikes)==null?void 0:r.length)>0&&`(${s.ownerResponseLikes.length})`]}),e.jsxs("button",{onClick:()=>ye(s._id,"dislike"),className:`flex items-center gap-1 ${(o=s.ownerResponseDislikes)!=null&&o.includes(t._id)?"text-red-600":"text-gray-500"}`,children:["ðŸ‘Ž Dislike ",((m=s.ownerResponseDislikes)==null?void 0:m.length)>0&&`(${s.ownerResponseDislikes.length})`]})]}),t&&F&&t._id===F&&!B&&e.jsxs("span",{className:"flex gap-2 ml-2",children:[e.jsx(ve,{className:"cursor-pointer text-blue-600",title:"Edit",onClick:()=>Ve(s)}),e.jsx(ae,{className:"cursor-pointer text-red-600",title:"Delete",onClick:()=>Me(s._id)})]})]}),e.jsxs("div",{className:"mt-4 ml-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(we,{className:"text-blue-500"}),"Replies (",((i=A[s._id])==null?void 0:i.length)||0,")"]}),((x=A[s._id])==null?void 0:x.length)>0&&e.jsxs("button",{onClick:()=>ce(d=>({...d,[s._id]:!d[s._id]})),className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center gap-1 transition-colors",children:[H[s._id]?"Hide":"Show"," Replies",e.jsx("span",{className:`transform transition-transform duration-200 ${H[s._id]?"rotate-180":""}`,children:"â–¼"})]})]}),H[s._id]&&e.jsxs("div",{className:"space-y-3 animate-slideDown",children:[(f=A[s._id])==null?void 0:f.map(d=>{var u,_,X,je;return e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-white rounded-lg p-3 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!E(d)&&e.jsx(Ne,{user:{username:d.userName,avatar:d.userAvatar},size:"w-6 h-6",textSize:"text-xs",showBorder:!1}),E(d)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1 text-xs",children:["From organization ",e.jsx(he,{className:"text-green-500"})]}):e.jsx("span",{className:"font-medium text-gray-800 text-xs",children:d.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(d.createdAt).toLocaleString()}),t&&e.jsxs("div",{className:"flex gap-2 ml-auto",children:[(d.userId===t._id||E(t)&&E(d))&&e.jsx("button",{onClick:()=>Be(d),className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Edit reply",children:e.jsx(ve,{size:10})}),(d.userId===t._id||E(t))&&e.jsx("button",{onClick:()=>ze(d._id),className:"text-red-600 hover:text-red-800 transition-colors",title:"Delete reply",children:e.jsx(ae,{size:10})})]})]}),k&&k._id===d._id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded p-2 text-sm",value:k.comment,onChange:qe=>$({...k,comment:qe.target.value}),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700 transition-colors",onClick:Ie,children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-600 transition-colors",onClick:()=>$(null),children:"Cancel"})]})]}):e.jsx("div",{className:"text-gray-700 text-sm leading-relaxed",children:d.comment}),e.jsxs("div",{className:"flex gap-3 mt-2 text-xs",children:[e.jsxs("button",{onClick:()=>be(d._id,"like",s._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(u=d.likes)!=null&&u.includes(t==null?void 0:t._id)?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"}`,disabled:z[d._id],children:["ðŸ‘ Like ",((_=d.likes)==null?void 0:_.length)>0&&`(${d.likes.length})`]}),e.jsxs("button",{onClick:()=>be(d._id,"dislike",s._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(X=d.dislikes)!=null&&X.includes(t==null?void 0:t._id)?"bg-red-100 text-red-700":"text-gray-500 hover:bg-gray-100"}`,disabled:z[d._id],children:["ðŸ‘Ž Dislike ",((je=d.dislikes)==null?void 0:je.length)>0&&`(${d.dislikes.length})`]})]})]},d._id)}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx($e,{reviewId:s._id,onReplyAdded:()=>Q(s._id)})})]}),(!A[s._id]||A[s._id].length===0)&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx($e,{reviewId:s._id,onReplyAdded:()=>Q(s._id)})})]}),t&&!E(t)&&e.jsxs("button",{className:"flex items-center gap-1 text-yellow-600 hover:text-yellow-800 text-xs mt-2",title:"Report an issue with this review",onClick:()=>Je(s),children:[e.jsx(ke,{className:"inline-block"}),"Report an Issue"]})]},s._id)}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Review"}),e.jsx(Fe,{listingId:b,existingReview:C,onReviewSubmitted:y}),e.jsx("button",{onClick:()=>R(null),className:"mt-4 w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})}),se&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-yellow-700",children:[e.jsx(ke,{})," Report an Issue"]}),e.jsx("p",{className:"mb-2 text-gray-700",children:"Please describe the issue with this review:"}),e.jsx("textarea",{className:"w-full border border-yellow-300 rounded-md p-2 text-sm mb-2",rows:"3",value:te,onChange:s=>I(s.target.value),placeholder:"Enter reason (required)"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm",onClick:()=>K(null),disabled:D,children:"Cancel"}),e.jsx("button",{className:"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 text-sm",onClick:We,disabled:D,children:D?"Reporting...":"Submit Report"})]})]})})]})}const ys=`
  @keyframes slideDown {
    from { 
      opacity: 0; 
      transform: translateY(-10px);
    }
    to { 
      opacity: 1; 
      transform: translateY(0);
    }
  }
  .animate-slideDown {
    animation: slideDown 0.3s ease-out;
  }
`;if(typeof document<"u"){const b=document.createElement("style");b.textContent=ys,document.head.appendChild(b)}const Ee="https://urbansetu.onrender.com";function _s(){const b=es(),w=ss(),F=ts(),{currentUser:t}=ge(p=>p.user),[a,g]=c.useState(null),[J,O]=c.useState(!1),[P,T]=c.useState(!0),[C,R]=c.useState(!1),[L,re]=c.useState(""),[U,W]=c.useState(!1),[q,ie]=c.useState(""),[oe,Y]=c.useState(!1),[Z,v]=c.useState(""),{addToWishlist:A,removeFromWishlist:S,isInWishlist:k}=as(),[$,B]=c.useState(null),[G,ne]=c.useState(!1),[ee,se]=c.useState(""),[K,te]=c.useState(!1),I=(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="rootadmin",D=F.pathname.includes("/admin"),z=t?D?{path:"/admin",text:"Back to Dashboard"}:{path:"/user",text:"Back to Home"}:{path:"/",text:"Back to Home"},V=p=>`â‚¹${Number(p).toLocaleString("en-IN")}`,H=()=>a.offer&&a.regularPrice&&a.discountPrice?Math.round((a.regularPrice-a.discountPrice)/a.regularPrice*100):0,ce=()=>{re(""),v(""),R(!0)},le=p=>{if(p.preventDefault(),!L.trim()){v("Reason is required");return}R(!1),v(""),W(!0)},me=async p=>{if(p.preventDefault(),!q){v("Password is required");return}Y(!0),v("");try{if(!(await fetch(`/api/user/verify-password/${t._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:q})})).ok){v("Incorrect password. Property not deleted."),Y(!1);return}const j=await fetch(`/api/listing/delete/${a._id}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:L})});if(j.ok)h.success("Property deleted successfully!"),W(!1),w("/admin/listings");else{const xe=await j.json();v(xe.message||"Failed to delete property.")}}catch{v("An error occurred while deleting the property.")}finally{Y(!1)}};return c.useEffect(()=>{(async()=>{T(!0);try{const j=await(await fetch(`${Ee}/api/listing/get/${b.listingId}`)).json();if(j.success===!1){console.log(j.message);return}g(j)}catch(y){console.error("Error fetching listing:",y)}finally{T(!1)}})()},[b.listingId]),c.useEffect(()=>{(async()=>{if(a&&a.userRef){ne(!0),se("");try{const y=await fetch(`${Ee}/api/user/id/${a.userRef}`);if(!y.ok)throw new Error("Failed to fetch owner details");const j=await y.json();B(j)}catch{se("Could not load owner details"),B(null)}finally{ne(!1)}}else B(null)})()},[a]),P?e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-3 text-lg font-semibold text-blue-600",children:"Loading property details..."})]})})}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl w-full mx-auto bg-white rounded-xl shadow-lg p-3 sm:p-6 relative overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:()=>w(z.path),className:"bg-gradient-to-r from-gray-500 to-gray-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(rs,{})," ",z.text]})}),I&&D&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs(Re,{to:`/admin/update-listing/${a._id}`,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(Pe,{})," Edit Property"]}),e.jsxs("button",{onClick:ce,className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(ae,{})," Delete Property"]})]})]}),e.jsxs("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:["Property Details ",I&&D&&"(Admin View)"]}),e.jsx(us,{navigation:!0,modules:[ps],className:"rounded-lg overflow-hidden relative mb-6",children:a.imageUrls&&a.imageUrls.length>0?a.imageUrls.map((p,y)=>e.jsx(Se,{children:e.jsx("img",{src:p,alt:`${a.name} - Image ${y+1}`,className:"w-full h-40 sm:h-64 md:h-96 object-cover",onError:j=>{j.target.src="https://via.placeholder.com/800x600?text=Image+Not+Available",j.target.className="w-full h-40 sm:h-64 md:h-96 object-cover opacity-50"}})},y)):e.jsx(Se,{children:e.jsx("div",{className:"w-full h-64 md:h-96 bg-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ "}),e.jsx("p",{className:"text-lg",children:"No images available"})]})})})}),e.jsx("div",{className:"flex justify-end items-center space-x-4 mb-4 pr-2",children:e.jsx(ns,{className:"cursor-pointer text-gray-500 hover:text-gray-700 text-xl",onClick:()=>{navigator.clipboard.writeText(window.location.href),O(!0),setTimeout(()=>O(!1),2e3)}})}),J&&e.jsx("p",{className:"text-green-500 text-sm text-center mb-4",children:"Link copied!"}),e.jsxs("div",{className:"p-3 sm:p-6 bg-gray-50 shadow-md rounded-lg mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl md:text-3xl font-bold text-gray-800 break-words flex items-center gap-2",children:[a.name,e.jsx("button",{onClick:()=>{if(!t){h.info("Please sign in to add properties to your wishlist."),w("/sign-in");return}k(a._id)?S(a._id):A(a)},className:`ml-2 p-2 rounded-full transition z-20 ${k(a._id)?"bg-red-500 text-white":"bg-gray-200 text-red-500 hover:text-red-600"} focus:outline-none`,title:k(a._id)?"Remove from wishlist":"Add to wishlist",style:{lineHeight:0},children:e.jsx(ls,{className:"text-base sm:text-lg"})})]}),a.offer&&H()>0&&e.jsxs("span",{className:"bg-yellow-400 text-gray-900 text-sm font-semibold px-4 py-1 rounded-full shadow-md animate-pulse w-max sm:w-auto ml-0 sm:ml-2 mt-2 sm:mt-0",style:{alignSelf:"flex-start"},title:"Limited-time offer!",children:[H(),"% OFF"]})]}),e.jsx("div",{className:"mb-4",children:a.offer&&H()>0?e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[V(a.discountPrice),a.type==="rent"&&" / month"]}),e.jsx("p",{className:"text-base sm:text-xl text-gray-500 line-through",children:V(a.regularPrice)}),e.jsxs("span",{className:"text-xs sm:text-sm text-green-600 font-semibold",children:["Save ",V(a.regularPrice-a.discountPrice)]})]}):e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[V(a.regularPrice),a.type==="rent"&&" / month"]})}),e.jsxs("p",{className:"flex items-center text-gray-600 mb-4",children:[e.jsx(is,{className:"mr-2 text-red-500"}),gs(a.propertyNumber||a.city?{propertyNumber:a.propertyNumber,landmark:a.landmark,city:a.city,district:a.district,state:a.state,pincode:a.pincode}:a.address,!!t)]}),a.locationLink&&Ce(!!t)&&e.jsx("div",{className:"mb-4",children:e.jsx("a",{href:a.locationLink,rel:"noopener noreferrer",className:"inline-block bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:Le(!!t)})}),a.locationLink&&!Ce(!!t)&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>w("/sign-in"),className:"inline-block bg-gradient-to-r from-gray-500 to-gray-600 text-white px-6 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:Le(!!t)})}),e.jsx("div",{className:"flex space-x-4 mb-4",children:e.jsx("span",{className:`px-3 py-1 text-white rounded-md ${a.type==="rent"?"bg-blue-500":"bg-green-500"}`,children:a.type==="rent"?"For Rent":"For Sale"})}),e.jsxs("p",{className:"text-gray-700 mb-4 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Description:"})," ",a.description]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(os,{className:"mr-2 text-blue-500"})," ",a.bedrooms," ",a.bedrooms>1?"beds":"bed"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ds,{className:"mr-2 text-blue-500"})," ",a.bathrooms," ",a.bathrooms>1?"baths":"bath"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(cs,{className:"mr-2 text-blue-500"})," ",a.parking?"Parking":"No Parking"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ms,{className:"mr-2 text-blue-500"})," ",a.furnished?"Furnished":"Unfurnished"]})]})]}),I&&D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 bg-blue-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-blue-800 mb-4",children:"Admin Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Property ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Updated"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created By"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a.userRef||"Unknown"})]})]})]}),e.jsxs("div",{className:"p-6 bg-green-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-green-800 mb-4",children:"Property Owner Details"}),G?e.jsx("p",{className:"text-gray-500",children:"Loading owner details..."}):ee?e.jsx("p",{className:"text-red-500",children:ee}):$?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Name"}),e.jsx("p",{className:"font-semibold text-gray-800",children:$.username})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Email"}),e.jsx("p",{className:"font-semibold text-gray-800",children:$.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Mobile Number"}),e.jsx("p",{className:"font-semibold text-gray-800",children:$.mobileNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:$._id})]})]}):e.jsx("p",{className:"text-gray-500",children:"No owner details found."})]})]}),e.jsx("div",{className:"flex justify-center",children:t&&(a.sellerId===t._id||a.userRef===t._id)?e.jsx("div",{className:"text-red-500 font-semibold text-lg py-3",children:"You cannot book an appointment for your own property."}):e.jsx("button",{onClick:()=>{if(!t){h.info("Please sign in to book appointments."),w("/sign-in");return}const p=D?`/admin/appointmentlisting?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`:`/user/appointment?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`;w(p)},className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:"ðŸ“… Book Appointment"})}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("button",{onClick:()=>te(p=>!p),className:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white px-6 py-2 rounded-lg shadow font-semibold flex items-center gap-2 hover:from-yellow-500 hover:to-yellow-700 transition-all",children:[K?"Hide Reviews":"Show Reviews",a.reviewCount>0&&e.jsx("span",{className:"ml-2 bg-white text-yellow-700 rounded-full px-2 py-0.5 text-xs font-bold",children:a.reviewCount})]})}),K&&e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"border-t border-gray-200 pt-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h3",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[e.jsx(De,{className:"text-yellow-500 mr-2"}),"Reviews",a.averageRating>0&&e.jsxs("span",{className:"ml-2 text-lg text-gray-600",children:["(",a.averageRating.toFixed(1)," â­ â€¢ ",a.reviewCount," review",a.reviewCount!==1?"s":"",")"]})]})}),e.jsx(Fe,{listingId:a._id,onReviewSubmitted:()=>{window.location.reload()}}),e.jsx(bs,{listingId:a._id,onReviewDeleted:()=>{window.location.reload()},listingOwnerId:a.userRef})]})})]})}),e.jsx(hs,{}),C&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:le,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(ae,{})," Reason for Deletion"]}),e.jsx("textarea",{className:"border rounded p-2 w-full",placeholder:"Enter reason for deleting this property",value:L,onChange:p=>re(p.target.value),rows:3,autoFocus:!0}),Z&&e.jsx("div",{className:"text-red-600 text-sm",children:Z}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>R(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-red-600 text-white font-semibold",children:"Next"})]})]})}),U&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:me,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(xs,{})," Confirm Password"]}),e.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:q,onChange:p=>ie(p.target.value),autoFocus:!0}),Z&&e.jsx("div",{className:"text-red-600 text-sm",children:Z}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>W(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:oe,children:oe?"Deleting...":"Confirm & Delete"})]})]})})]}):e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-red-600 mb-4",children:"Property Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The property you're looking for doesn't exist or has been removed."}),e.jsx(Re,{to:z.path,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold",children:z.text})]})})})}export{_s as default};
