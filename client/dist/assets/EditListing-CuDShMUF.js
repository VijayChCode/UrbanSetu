import{r as d,g as q,u as D,t as F,h as A,j as e,y as b}from"./index-DNwTbvcj.js";import{L as $}from"./LocationSelector-C8WdPudO.js";import"./countries_states_cities-CCOM4uJJ.js";const k="https://urbansetu.onrender.com";function _(){const[t,u]=d.useState({imageUrls:[],name:"",description:"",propertyNumber:"",landmark:"",city:"",state:"",pincode:"",address:"",type:"sale",bedrooms:1,bathrooms:1,regularPrice:0,discountPrice:0,offer:!1,parking:!1,furnished:!1,locationLink:""}),[y,n]=d.useState(""),[j,f]=d.useState(!1),[m,N]=d.useState({}),{currentUser:c}=q(s=>s.user),U=D(),x=F(),C=A(),[v,L]=d.useState(!1),[p,w]=d.useState({state:"",district:"",city:"",cities:[]}),I=()=>{var r;const s=(r=C.state)==null?void 0:r.from;return s||(c.role==="admin"||c.role==="rootadmin"?"/admin/my-listings":"/user/my-listings")};d.useEffect(()=>{(async()=>{const r=x.listingId,a=`${k}/api/listing/get/${r}`,l=await(await fetch(a,{credentials:"include"})).json();if(l.success===!1){n(l.message);return}u({...t,...l}),w({state:l.state||"",district:l.district||"",city:l.city||"",cities:[]})})()},[x.listingId]),d.useEffect(()=>{u(s=>({...s,state:p.state,city:p.city||""}))},[p]);const E=s=>{if(!s)return!0;try{new URL(s)}catch{return!1}return[".jpg",".jpeg",".png",".gif",".webp",".svg"].some(o=>s.toLowerCase().includes(o))||s.includes("images")||s.includes("img")},S=(s,r)=>{const a=[...t.imageUrls];a[s]=r,u({...t,imageUrls:a});const o={...m};r&&!E(r)?o[s]="Please enter a valid image URL":delete o[s],N(o)},P=s=>{u({...t,imageUrls:t.imageUrls.filter((a,o)=>o!==s)});const r={...m};delete r[s],N(r)},i=s=>{const{id:r,value:a,checked:o,type:l,name:h}=s.target;let g=l==="checkbox"?o:a;["regularPrice","discountPrice","bedrooms","bathrooms"].includes(r)&&(g=Number(a)),u({...t,[h||r]:g})},R=async s=>{if(s.preventDefault(),!t.type)return n("Please select a listing type (Sale or Rent)");if(t.imageUrls.length<1)return n("At least one image must be uploaded");if(t.regularPrice<t.discountPrice)return n("Discount price should be less than regular price");if(!t.propertyNumber)return n("Property number is required");if(!t.city)return n("City is required");if(!t.state)return n("State is required");if(!t.pincode)return n("Pincode is required");if(Object.keys(m).length>0)return n("Please fix the image URL errors before submitting");if(c.role!=="admin"&&c.role!=="rootadmin"&&!v)return n("You must confirm that the data provided is genuine.");f(!0),n("");try{const r=`${k}/api/listing/update/${x.listingId}`;let a=t;c.role==="admin"||c.role==="rootadmin"?a=t:a={...t,userRef:c._id};const o={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)},l=await fetch(r,o),h=await l.json();if(l.ok)b.success(h.message||"Property Details Updated Successfully!!"),U(I());else{const g=h.message||"Failed to update listing";n(g),b.error(g)}f(!1)}catch(r){const a=r.message||"An error occurred while updating the listing";n(a),b.error(a),f(!1)}};return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:"Edit Listing"}),e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Basic Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("input",{type:"text",id:"name",placeholder:"Property Name",required:!0,onChange:i,value:t.name,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("textarea",{id:"description",placeholder:"Property Description",required:!0,onChange:i,value:t.description,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mt-4 resize-y",rows:4})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Address Information"}),e.jsx("div",{className:"mb-4",children:e.jsx($,{value:p,onChange:w,mode:"form"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",id:"propertyNumber",placeholder:"Property Number/Flat Number",required:!0,onChange:i,value:t.propertyNumber,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"landmark",placeholder:"Landmark (optional)",onChange:i,value:t.landmark,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"pincode",placeholder:"Pincode",required:!0,onChange:i,value:t.pincode,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"locationLink",placeholder:"Google Maps Location Link (Optional)",onChange:i,value:t.locationLink,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Type"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"radio",name:"type",value:"sale",onChange:i,checked:t.type==="sale",className:"text-blue-600"}),e.jsx("span",{className:"font-medium",children:"For Sale"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"radio",name:"type",value:"rent",onChange:i,checked:t.type==="rent",className:"text-blue-600"}),e.jsx("span",{className:"font-medium",children:"For Rent"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Bedrooms"}),e.jsx("input",{type:"number",id:"bedrooms",onChange:i,value:t.bedrooms,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Bathrooms"}),e.jsx("input",{type:"number",id:"bathrooms",onChange:i,value:t.bathrooms,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Regular Price (â‚¹)"}),e.jsx("input",{type:"number",id:"regularPrice",onChange:i,value:t.regularPrice,placeholder:"Enter price",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Discount Price (â‚¹)"}),e.jsx("input",{type:"number",id:"discountPrice",onChange:i,value:t.discountPrice,placeholder:"Enter discount",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Features"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["parking","furnished","offer"].map(s=>e.jsxs("label",{className:"flex items-center space-x-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"checkbox",id:s,onChange:i,checked:t[s],className:"text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium capitalize",children:s})]},s))})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Images"}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Add as many image URLs as you want. Use direct links to images (ending in .jpg, .png, .gif, etc.)"}),e.jsx("p",{className:"text-gray-500 text-xs mb-3",children:"ðŸ’¡ Tip: You can upload images to services like Imgur, Google Drive (with sharing enabled), or use any public image URL"}),e.jsxs("div",{className:"space-y-3",children:[t.imageUrls.map((s,r)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:`Image URL ${r+1} (e.g., https://example.com/image.jpg)`,value:s||"",onChange:a=>S(r,a.target.value),className:`w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${m[r]?"border-red-500":""}`}),e.jsx("button",{type:"button",onClick:()=>P(r),className:"bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition",title:"Remove this photo",children:"Ã—"}),m[r]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m[r]})]},r)),e.jsx("button",{type:"button",onClick:()=>u({...t,imageUrls:[...t.imageUrls,""]}),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2",children:"Add Photo"})]}),t.imageUrls.some(s=>s)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Image Preview:"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:t.imageUrls.map((s,r)=>s&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:"listing",className:"w-full h-24 object-cover rounded-lg",onError:a=>{a.target.src="https://via.placeholder.com/400x300?text=Image+Not+Found",a.target.className="w-full h-24 object-cover rounded-lg opacity-50"}}),e.jsx("button",{onClick:()=>P(r),type:"button",className:"absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 rounded-full hover:bg-red-600 transition",children:"Ã—"})]},s))})]})]}),c.role!=="admin"&&c.role!=="rootadmin"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"consent",checked:v,onChange:s=>L(s.target.checked),className:"accent-blue-600 w-4 h-4",required:!0}),e.jsxs("label",{htmlFor:"consent",className:"text-sm text-gray-700 select-none",children:["I confirm that ",e.jsx("span",{className:"font-semibold text-blue-700",children:"all the information provided in this listing is true and genuine to the best of my knowledge"}),". Providing false information may result in account suspension or legal action."]})]}),e.jsx("button",{disabled:j,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white p-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Updating...":"Update Listing"}),y&&e.jsx("p",{className:"text-red-500 text-center",children:y})]})]})})}export{_ as default};
