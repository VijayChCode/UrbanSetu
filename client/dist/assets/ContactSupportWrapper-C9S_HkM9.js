import{j as e,G as K,z as ae,D as xe,H as he,g as re,r as a,h as ie,aC as _,a7 as ce,f as Q,aD as pe,ak as de,aE as me,y,m as le,B as oe}from"./index-T5xbu-4v.js";function ue({isOpen:n,onClose:d,onConfirm:m,title:f="Confirm Action",message:u="Are you sure you want to proceed?",confirmText:k="Confirm",cancelText:x="Cancel",confirmButtonColor:h="bg-blue-600 hover:bg-blue-700",isDestructive:l=!1,isLoading:c=!1}){if(!n)return null;const N=()=>{m(),c||d()},g=()=>l?e.jsx(xe,{className:"w-6 h-6 text-red-500"}):e.jsx(he,{className:"w-6 h-6 text-blue-500"}),j=()=>l?"bg-red-600 hover:bg-red-700 focus:ring-red-500":h+" focus:ring-blue-500";return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[10000] p-4 animate-fadeIn",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full animate-slideUp",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[g(),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:f})]}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-full",disabled:c,children:e.jsx(K,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:u})}),e.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[e.jsx("button",{onClick:d,disabled:c,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:x}),e.jsx("button",{onClick:N,disabled:c,className:`flex-1 px-4 py-2 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 ${j()}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[l&&e.jsx(ae,{className:"w-4 h-4"}),k]})})]})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }
        
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
      `})]})}const te="https://urbansetu.onrender.com";function fe(){const{currentUser:n}=re(t=>t.user),[d,m]=a.useState(!1),[f,u]=a.useState([]),[k,x]=a.useState(!1),[h,l]=a.useState(0),[c,N]=a.useState("send"),[g,j]=a.useState({subject:"",message:"",email:"",name:""}),[I,B]=a.useState(!1),[z,v]=a.useState(""),[H,q]=a.useState(!0),D=a.useRef(null),O=a.useRef(null),G=ie(),[F,R]=a.useState(!1),[A,E]=a.useState(null),[J,T]=a.useState(!1);a.useEffect(()=>{d&&n&&j(t=>({...t,name:n.username||"",email:n.email||""})),d||j({subject:"",message:"",email:"",name:""})},[d,n]),a.useEffect(()=>{n!=null&&n.email&&M()},[n]),a.useEffect(()=>{n!=null&&n.email&&c==="messages"&&M()},[n,c]),a.useEffect(()=>(d?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[d]);const P=a.useCallback(()=>{if(D.current){const{scrollTop:t,scrollHeight:o,clientHeight:C}=D.current,i=o-t-C<5;q(i)}},[]);a.useEffect(()=>{const t=D.current;if(t&&c==="messages")return t.addEventListener("scroll",P),P(),()=>{t.removeEventListener("scroll",P)}},[c,P]);const W=a.useCallback(()=>{O.current&&O.current.scrollIntoView({behavior:"smooth"})},[]),M=async()=>{x(!0);try{const o=await(await fetch(`${te}/api/contact/user-messages/${encodeURIComponent(n.email)}`,{credentials:"include"})).json();if(!Array.isArray(o)){u([]),l(0);return}u(o);const C=o.filter(i=>i.adminReply&&i.status==="unread").length;l(C)}catch(t){console.error("Error fetching user messages:",t),u([]),l(0)}finally{x(!1)}},w=t=>{const o=new Date(t),i=new Date-o,$=Math.floor(i/(1e3*60)),V=Math.floor(i/(1e3*60*60)),s=Math.floor(i/(1e3*60*60*24));return $<1?"Just now":$<60?`${$}m ago`:V<24?`${V}h ago`:s<7?`${s}d ago`:o.toLocaleDateString()},U=async t=>{E(t),R(!0)},X=async()=>{if(A){T(!0);try{const t=await fetch(`${te}/api/contact/user-messages/${A}?email=${encodeURIComponent(n.email)}`,{method:"DELETE",credentials:"include"});if(t.ok){u(i=>i.filter($=>$._id!==A));const C=f.filter(i=>i._id!==A).filter(i=>i.adminReply&&i.status==="unread").length;l(C),y.success("Message deleted successfully!")}else{const o=await t.json();y.error(o.message||"Failed to delete message. Please try again.")}}catch(t){console.error("Error deleting message:",t),y.error("Failed to delete message. Please try again.")}finally{T(!1),R(!1),E(null)}}},p=()=>{const t=G.pathname,o=new URLSearchParams(G.search);if(t==="/forgot-password"&&o.get("step")==="2")return"#059669";switch(t){case"/sign-in":return"#6366f1";case"/sign-up":return"#0891b2";case"/forgot-password":return"#dc2626";default:return"#3b82f6"}},b=t=>{j({...g,[t.target.name]:t.target.value})},Z=async t=>{t.preventDefault(),B(!0),v("");try{(await(await fetch(`${te}/api/contact/support`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(g)})).json()).success?(v("success"),j({subject:"",message:"",email:"",name:""}),y.success("Message sent successfully!"),setTimeout(()=>{m(!1),v("")},3e3)):(v("error"),y.error("Failed to send message. Please try again or contact us directly."))}catch{v("error"),y.error("Failed to send message. Please try again or contact us directly.")}finally{B(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsxs("button",{onClick:()=>m(!0),className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${p()}, ${p()}dd)`,boxShadow:`0 10px 25px ${p()}40`},title:"Need help? Contact our support team!",children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:`3px solid ${p()}55`}}),e.jsx(_,{className:"w-5 h-5 text-white drop-shadow-lg"}),n&&h>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold animate-pulse",children:h>99?"99+":h}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ’¬"}),e.jsx("span",{className:"font-medium",children:n&&h>0?`${h} new repl${h!==1?"ies":"y"}`:"Need help? Contact us!"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto animate-slideUp",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:p()},children:e.jsx(_,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Contact Support"}),e.jsx("p",{className:"text-sm text-gray-600",children:"We're here to help you!"})]})]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full",children:e.jsx(K,{className:"w-5 h-5"})})]}),n&&e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{onClick:()=>N("send"),className:`flex-1 px-6 py-3 text-sm font-medium transition-colors ${c==="send"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:"Send Message"}),e.jsxs("button",{onClick:()=>N("messages"),className:`flex-1 px-6 py-3 text-sm font-medium transition-colors relative ${c==="messages"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:["My Messages",h>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:h>99?"99+":h})]})]}),!n||c==="send"?e.jsxs("form",{onSubmit:Z,className:"p-6 space-y-6",children:[z==="success"&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 text-green-800 rounded-xl flex items-center gap-3 animate-bounce",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Message sent successfully!"}),e.jsx("p",{className:"text-sm",children:"We'll get back to you within 24 hours."})]})]}),z==="error"&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 text-red-800 rounded-xl flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Failed to send message"}),e.jsx("p",{className:"text-sm",children:"Please try again or contact us directly."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"name",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(ce,{className:"w-4 h-4"}),"Your Name *"]}),e.jsx("input",{type:"text",id:"name",name:"name",value:g.name,onChange:b,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Enter your full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(Q,{className:"w-4 h-4"}),"Email Address *"]}),e.jsx("input",{type:"email",id:"email",name:"email",value:g.email,onChange:b,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"your@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"subject",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(pe,{className:"w-4 h-4"}),"Subject *"]}),e.jsx("input",{type:"text",id:"subject",name:"subject",value:g.subject,onChange:b,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Brief description of your issue"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"message",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(_,{className:"w-4 h-4"}),"Message *"]}),e.jsx("textarea",{id:"message",name:"message",value:g.message,onChange:b,required:!0,rows:5,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none",placeholder:"Please describe your issue or question in detail..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all duration-200 font-medium contact-support-action-btn",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:I,className:"flex-1 px-6 py-3 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-medium flex items-center justify-center gap-2 contact-support-action-btn",style:{backgroundColor:p(),boxShadow:`0 4px 14px ${p()}40`},children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4"}),"Send Message"]})})]})]}):e.jsx("div",{className:"p-6",children:k?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Loading your messages..."})]}):f.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(Q,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h4",{className:"text-lg font-medium mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-sm mb-4",children:"Send a support message to get started"}),e.jsx("button",{onClick:()=>N("send"),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Send Message"})]}):e.jsxs("div",{ref:D,className:"space-y-4 max-h-96 overflow-y-auto relative",children:[f.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.subject}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsx(me,{className:"w-3 h-3"}),w(t.createdAt),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.status==="replied"?"bg-green-100 text-green-800":t.status==="read"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="replied"?"Replied":t.status==="read"?"Read":"Unread"})]})]})}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-3",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed text-sm",children:t.message})}),t.adminReply&&e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h6",{className:"font-medium text-green-700 text-sm",children:"Admin Reply"}),e.jsx("span",{className:"text-xs text-gray-500",children:w(t.adminReplyAt)})]}),e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed text-sm",children:t.adminReply})]}),e.jsx("div",{className:"flex items-center justify-end mt-2",children:e.jsx("button",{onClick:()=>U(t._id),className:"text-red-500 hover:text-red-700 transition-colors p-2 rounded-full hover:bg-red-50",title:"Delete this message",children:e.jsx(ae,{className:"w-4 h-4"})})})]},t._id)),e.jsx("div",{ref:O})]})}),!H&&f.length>0&&c==="messages"&&e.jsx("div",{className:"absolute bottom-6 right-6 z-20",children:e.jsx("button",{onClick:W,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 animate-pulse",title:"Scroll to bottom","aria-label":"Scroll to bottom",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})})})})]})}),e.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }
        @keyframes slideDown {
          from { 
            opacity: 0; 
            transform: translateY(-10px);
          }
          to { 
            opacity: 1; 
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
        .animate-slideDown {
          animation: slideDown 0.2s ease-out;
        }
        .shadow-3xl {
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        /* Mobile button size reduction for Send Message and Cancel */
        @media (max-width: 640px) {
          .contact-support-action-btn {
            padding: 0.5rem 0.75rem !important;
            font-size: 0.95rem !important;
            border-radius: 0.75rem !important;
          }
        }
      `}),e.jsx(ue,{isOpen:F,onClose:()=>{R(!1),E(null)},onConfirm:X,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",isDestructive:!0,isLoading:J})]})}const L="https://urbansetu.onrender.com";function ge(){const[n,d]=a.useState(!1),[m,f]=a.useState([]),[u,k]=a.useState(!1),[x,h]=a.useState(0),[l,c]=a.useState(null),[N,g]=a.useState(""),[j,I]=a.useState(null),[B,z]=a.useState(!1),{currentUser:v}=re(s=>s.user),H=ie(),[q,D]=a.useState(""),[O,G]=a.useState(!0),F=a.useRef(null),R=a.useRef(null),[A,E]=a.useState(!1),[J,T]=a.useState(null),[P,W]=a.useState(!1),M=v&&(v.role==="admin"||v.role==="rootadmin"),w=()=>{const s=H.pathname,r=new URLSearchParams(H.search);if(s==="/forgot-password"&&r.get("step")==="2")return"#059669";switch(s){case"/sign-in":return"#6366f1";case"/sign-up":return"#0891b2";case"/forgot-password":return"#dc2626";default:return"#3b82f6"}};a.useEffect(()=>{let s;return M&&(b(),s=setInterval(b,3e4)),()=>s&&clearInterval(s)},[M]),a.useEffect(()=>{n&&M&&(p(),b())},[n,M]),a.useEffect(()=>(n?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[n]);const U=a.useCallback(()=>{if(F.current){const{scrollTop:s,scrollHeight:r,clientHeight:S}=F.current,Y=r-s-S<5;G(Y)}},[]);a.useEffect(()=>{const s=F.current;if(s&&n)return s.addEventListener("scroll",U),U(),()=>{s.removeEventListener("scroll",U)}},[n,U]);const X=a.useCallback(()=>{R.current&&R.current.scrollIntoView({behavior:"smooth"})},[]),p=async()=>{k(!0),D("");try{const s=await fetch(`${L}/api/contact/messages`,{credentials:"include"});if(!s.ok){const S=await s.json();D(S.message||"Failed to fetch messages."),f([]);return}const r=await s.json();f(r)}catch(s){D("Network error or server unavailable."),f([]),console.error("Error fetching messages:",s)}finally{k(!1)}},b=async()=>{try{const r=await(await fetch(`${L}/api/contact/unread-count`,{credentials:"include"})).json();h(r.count)}catch(s){console.error("Error fetching unread count:",s)}},Z=async s=>{try{await fetch(`${L}/api/contact/messages/${s}/read`,{method:"PUT",credentials:"include"}),p(),b()}catch(r){console.error("Error marking message as read:",r)}},t=async s=>{try{await fetch(`${L}/api/contact/messages/${s}/replied`,{method:"PUT",credentials:"include"}),p(),b()}catch(r){console.error("Error marking message as replied:",r)}},o=async s=>{T(s),E(!0)},C=async()=>{if(J){W(!0);try{await fetch(`${L}/api/contact/messages/${J}`,{method:"DELETE",credentials:"include"}),p(),b(),y.success("Message deleted successfully!")}catch(s){console.error("Error deleting message:",s),y.error("Failed to delete message. Please try again.")}finally{W(!1),E(!1),T(null)}}},i=async s=>{if(!N.trim()){y.error("Please enter a reply message");return}z(!0);try{(await(await fetch(`${L}/api/contact/messages/${s}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({replyMessage:N.trim()})})).json()).success?(g(""),I(null),p(),b(),y.success("Reply sent successfully!")):y.error("Failed to send reply. Please try again.")}catch(r){console.error("Error sending reply:",r),y.error("Failed to send reply. Please try again.")}finally{z(!1)}},$=s=>{const r={unread:{color:"bg-red-100 text-red-800 border-red-200",text:"Unread",icon:e.jsx(Q,{className:"w-3 h-3"})},read:{color:"bg-blue-100 text-blue-800 border-blue-200",text:"Read",icon:e.jsx(le,{className:"w-3 h-3"})},replied:{color:"bg-green-100 text-green-800 border-green-200",text:"Replied",icon:e.jsx(oe,{className:"w-3 h-3"})}},S=r[s]||r.unread;return e.jsxs("span",{className:`px-3 py-1 text-xs font-medium rounded-full border flex items-center gap-1 ${S.color}`,children:[S.icon,S.text]})},V=s=>{const r=new Date(s),Y=new Date-r,ee=Math.floor(Y/(1e3*60)),ne=Math.floor(Y/(1e3*60*60)),se=Math.floor(Y/(1e3*60*60*24));return ee<1?"Just now":ee<60?`${ee}m ago`:ne<24?`${ne}h ago`:se===1?"Yesterday":se<7?`${se} days ago`:r.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-6 right-6 z-[9999]",children:e.jsxs("button",{onClick:()=>d(!0),className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${w()}, ${w()}dd)`,boxShadow:`0 10px 25px ${w()}40`},title:"View support messages",children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:`3px solid ${w()}55`}}),e.jsx(_,{className:"w-5 h-5 text-white drop-shadow-lg"}),x>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold animate-pulse",children:x>99?"99+":x}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“¬"}),e.jsx("span",{className:"font-medium",children:x>0?`${x} new message${x!==1?"s":""}`:"Support Messages"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-slideUp",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:w()},children:e.jsx(_,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Support Messages"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[x," unread message",x!==1?"s":""," â€¢ ",m.length," total"]})]})]}),e.jsx("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{ref:F,className:"overflow-y-auto max-h-[calc(90vh-120px)] relative",children:[q&&e.jsx("div",{className:"p-6 text-center text-red-600 font-semibold bg-red-50 border border-red-200 rounded-xl mb-4",children:q}),u?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Loading messages..."})]}):m.length===0?e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(_,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h4",{className:"text-lg font-medium mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Support messages from users will appear here"})]}):e.jsxs("div",{className:"divide-y divide-gray-100",children:[m.map(s=>e.jsxs("div",{className:`p-6 hover:bg-gray-50 transition-all duration-200 cursor-pointer ${s.status==="unread"?"bg-blue-50 border-l-4 border-blue-500":""} ${(l==null?void 0:l._id)===s._id?"bg-blue-100":""}`,onClick:()=>c((l==null?void 0:l._id)===s._id?null:s),children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:s.subject}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ce,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.name||"Anonymous"}),e.jsx("span",{className:"text-gray-400",children:"â€¢"}),e.jsx(Q,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.email})]})]}),$(s.status)]}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),V(s.createdAt)]})}),e.jsx("p",{className:"text-gray-700 mt-3 line-clamp-2",children:s.message})]})}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[s.status==="unread"&&e.jsxs("button",{onClick:r=>{r.stopPropagation(),Z(s._id)},className:"px-3 py-1 text-xs text-white rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105",style:{backgroundColor:w()},children:[e.jsx(le,{className:"w-3 h-3"}),"Mark Read"]}),s.status!=="replied"&&e.jsxs("button",{onClick:r=>{r.stopPropagation(),t(s._id)},className:"px-3 py-1 text-xs text-white rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105",style:{backgroundColor:w()},children:[e.jsx(oe,{className:"w-3 h-3"}),"Mark Replied"]}),e.jsxs("button",{onClick:r=>{r.stopPropagation(),o(s._id)},className:"px-3 py-1 text-xs text-white bg-red-500 rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105 hover:bg-red-700",children:[e.jsx(ae,{className:"w-3 h-3"}),"Delete"]})]}),(l==null?void 0:l._id)===s._id&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded-xl animate-slideDown",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:"Full Message"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border mb-4",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:s.message})}),s.adminReply&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h6",{className:"font-medium text-green-700",children:"Admin Reply"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.adminReplyAt).toLocaleString()})]}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:s.adminReply})})]}),!s.adminReply&&e.jsxs("div",{className:"space-y-3",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h6",{className:"font-medium text-blue-700",children:"Send Reply"}),e.jsx("button",{onClick:r=>{r.stopPropagation(),I(j===s._id?null:s._id)},className:"text-sm text-blue-600 hover:text-blue-800",children:j===s._id?"Cancel":"Reply"})]}),j===s._id&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:N,onChange:r=>g(r.target.value),onClick:r=>r.stopPropagation(),onFocus:r=>r.stopPropagation(),placeholder:"Type your reply here...",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:"4"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),i(s._id)},disabled:B,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 admin-contact-support-action-btn",children:B?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4"}),"Send Reply"]})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),I(null),g("")},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 admin-contact-support-action-btn",children:"Cancel"})]})]})]})]})]},s._id)),e.jsx("div",{ref:R})]})]}),!O&&m.length>0&&e.jsx("div",{className:"absolute bottom-6 right-6 z-20",children:e.jsx("button",{onClick:X,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 animate-pulse",title:"Scroll to bottom","aria-label":"Scroll to bottom",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})})})})]})}),e.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }

        @keyframes slideDown {
          from { 
            opacity: 0; 
            transform: translateY(-10px);
          }
          to { 
            opacity: 1; 
            transform: translateY(0);
          }
        }
        
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }

        .animate-slideDown {
          animation: slideDown 0.2s ease-out;
        }
        
        .shadow-3xl {
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        /* Mobile button size reduction for Send/Cancel in admin contact support */
        @media (max-width: 640px) {
          .admin-contact-support-action-btn {
            padding: 0.5rem 0.75rem !important;
            font-size: 0.95rem !important;
            border-radius: 0.75rem !important;
          }
        }
      `}),e.jsx(ue,{isOpen:A,onClose:()=>{E(!1),T(null)},onConfirm:C,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",isDestructive:!0,isLoading:P})]}):null}function ye(){const{currentUser:n}=re(u=>u.user),[d,m]=a.useState(!1);a.useEffect(()=>{const u=k=>{m(k.detail.isOpen)};return window.addEventListener("geminiChatboxToggle",u),()=>{window.removeEventListener("geminiChatboxToggle",u)}},[]);const f=n&&(n.role==="admin"||n.role==="rootadmin")&&(n.adminApprovalStatus==="approved"||n.isDefaultAdmin);return d?null:f?e.jsx(ge,{}):e.jsx(fe,{})}export{ye as C};
