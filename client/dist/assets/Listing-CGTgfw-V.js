import{g as ye,r as o,j as e,v as ee,U as ke,w as be,x as Te,z as me,A as Ze,B as Se,C as Re,D as _e,y as j,b as Ae,E as qe,G as Ue,H as Ce,I as Ke,J as Ge,K as Qe,M as et,O as tt,P as st,Q as at,t as nt,u as rt,h as lt,R as ot,L as Le,S as it,T as dt,V as ct,W as mt,X as xt,Y as ut,Z as ht,_ as pt,$ as gt,a0 as ft}from"./index-ia1yj80S.js";import{S as bt,N as yt,a as Ee}from"./navigation-B-tLxoaG.js";import{C as jt}from"./ContactSupportWrapper-DuzVRekk.js";import{R as Ie}from"./ReviewForm-DUQ_u7KX.js";import{s as De,m as Nt,g as $e}from"./addressMasking-3vIUwCOC.js";const wt="https://urbansetu.onrender.com";function Pe({reviewId:g,onReplyAdded:N}){const{currentUser:b}=ye(w=>w.user),[s,a]=o.useState(""),[f,E]=o.useState(!1),[P,U]=o.useState("");if(!b)return null;const I=async w=>{if(w.preventDefault(),!s.trim()){U("Reply cannot be empty");return}E(!0),U("");try{const v=await fetch(`${wt}/api/review/reply/${g}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:s})}),S=await v.json();v.ok?(a(""),N&&N()):U(S.message||"Failed to add reply")}catch{U("Network error. Please try again.")}finally{E(!1)}};return e.jsxs("form",{onSubmit:I,className:"flex flex-col gap-2 mt-2",children:[e.jsx("textarea",{value:s,onChange:w=>a(w.target.value),rows:2,className:"w-full border border-gray-300 rounded p-2 text-sm",placeholder:"Write a reply...",disabled:f}),P&&e.jsx("div",{className:"text-red-600 text-xs",children:P}),e.jsx("button",{type:"submit",className:"self-end bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm",disabled:f||!s.trim(),children:f?"Replying...":"Reply"})]})}const $="https://urbansetu.onrender.com";function vt({listingId:g,onReviewDeleted:N,listingOwnerId:b}){const{currentUser:s}=ye(t=>t.user),[a,f]=o.useState([]),[E,P]=o.useState(!0),[U,I]=o.useState(""),[w,v]=o.useState(null),[S,z]=o.useState("date"),[F,V]=o.useState("desc"),[Y,q]=o.useState({}),[K,H]=o.useState({}),[G,R]=o.useState({}),[B,_]=o.useState({}),[C,T]=o.useState(null),[W,X]=o.useState(!1),[te,m]=o.useState(""),[Z,D]=o.useState(null),[O,oe]=o.useState(""),[se,xe]=o.useState(!1),[ie,ae]=o.useState({}),[J,je]=o.useState({});o.useEffect(()=>{Q();const t=n=>{(n.listingId===g||n.listingId&&n.listingId._id===g)&&(f(d=>d.some(i=>i._id===n._id)?d.map(i=>i._id===n._id?n:i):[n,...d]),re(n._id))};ee.on("reviewUpdated",t);const r=({action:n,replies:d,reviewId:x,reply:i,replyId:h})=>{n==="updatedAll"&&x&&d?_(L=>({...L,[x]:d})):n==="deleted"&&x?re(x):i&&i.reviewId&&re(i.reviewId)};ee.on("reviewReplyUpdated",r);const l=n=>{console.log("[ReviewList] Received profileUpdated socket event:",n),console.log("[ReviewList] Current reviews:",a.length),f(d=>{const x=d.map(i=>i.userId===n.userId?(console.log("[ReviewList] Updating review:",i._id,"for user:",n.userId),{...i,userName:n.username,userAvatar:n.avatar}):i);return console.log("[ReviewList] Updated reviews:",x.length),x}),_(d=>{const x={...d};return Object.keys(x).forEach(i=>{var h;x[i]=(h=x[i])==null?void 0:h.map(L=>L.userId===n.userId?(console.log("[ReviewList] Updating reply:",L._id,"for user:",n.userId),{...L,userName:n.username,userAvatar:n.avatar}):L)}),x})};return ee.on("profileUpdated",l),console.log("[ReviewList] Socket listeners set up for profileUpdated"),ee.emit("testConnection",{message:"ReviewList component connected"},n=>{console.log("[ReviewList] Test socket response:",n)}),()=>{ee.off("reviewUpdated",t),ee.off("reviewReplyUpdated",r),ee.off("profileUpdated",l),console.log("[ReviewList] Socket listeners cleaned up")}},[g,S,F]),o.useEffect(()=>{s&&(f(t=>t.map(r=>r.userId===s._id?{...r,userName:s.username,userAvatar:s.avatar}:r)),_(t=>{const r={...t};return Object.keys(r).forEach(l=>{var n;r[l]=(n=r[l])==null?void 0:n.map(d=>d.userId===s._id?{...d,userName:s.username,userAvatar:s.avatar}:d)}),r}))},[s]),o.useEffect(()=>{const t=setInterval(async()=>{if(s)try{const r=await fetch(`${$}/api/user/id/${s._id}`);if(r.ok){const l=await r.json();(l.username!==s.username||l.avatar!==s.avatar)&&(console.log("[ReviewList] Profile updated via polling:",l),f(n=>n.map(d=>d.userId===l._id?{...d,userName:l.username,userAvatar:l.avatar}:d)),_(n=>{const d={...n};return Object.keys(d).forEach(x=>{var i;d[x]=(i=d[x])==null?void 0:i.map(h=>h.userId===l._id?{...h,userName:l.username,userAvatar:l.avatar}:h)}),d}))}}catch(r){console.error("[ReviewList] Error polling for profile updates:",r)}},3e4);return()=>clearInterval(t)},[s]);const Q=async()=>{try{const t=await fetch(`${$}/api/review/listing/${g}?sort=${S}&order=${F}`,{credentials:"include"}),r=await t.json();t.ok?f(r):I(r.message||"Failed to load reviews")}catch{I("Network error. Please try again.")}finally{P(!1)}},ne=async t=>{if(window.confirm("Are you sure you want to delete this review?"))try{const r=await fetch(`${$}/api/review/delete/${t}`,{method:"DELETE",credentials:"include"}),l=await r.json();r.ok?(f(a.filter(n=>n._id!==t)),N&&N(),j.success("Review deleted successfully")):j.error(l.message||"Failed to delete review")}catch{j.error("Network error. Please try again.")}},de=t=>{v(t)},he=()=>{v(null),Q()},pe=async t=>{if(!s){j.info("Please sign in to vote on reviews");return}f(r=>r.map(l=>{var n;if(l._id===t){const d=(n=l.helpfulVotes)==null?void 0:n.some(h=>h.userId===s._id);let x,i=l.helpfulCount||0;return d?(x=l.helpfulVotes.filter(h=>h.userId!==s._id),i=Math.max(0,i-1)):(x=[...l.helpfulVotes||[],{userId:s._id}],i=i+1),{...l,helpfulVotes:x,helpfulCount:i}}return l}));try{const r=await fetch(`${$}/api/review/helpful/${t}`,{method:"POST",credentials:"include"})}catch{j.error("Network error. Please try again.")}},ue=async t=>{H(r=>({...r,[t]:!0})),R(r=>({...r,[t]:""}));try{const r=await fetch(`${$}/api/review/respond/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({ownerResponse:Y[t]})}),l=await r.json();r.ok?(f(n=>n.map(d=>d._id===t?{...d,ownerResponse:Y[t]}:d)),q(n=>({...n,[t]:""}))):R(n=>({...n,[t]:l.message||"Failed to submit response"}))}catch{R(l=>({...l,[t]:"Network error. Please try again."}))}finally{H(r=>({...r,[t]:!1}))}},ge=t=>[...Array(5)].map((r,l)=>e.jsx(Ae,{className:`text-lg ${l<t?"text-yellow-400":"text-gray-300"}`},l)),u=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),k=t=>{const l={pending:{color:"bg-yellow-100 text-yellow-800",icon:Ce},approved:{color:"bg-green-100 text-green-800",icon:Ce},rejected:{color:"bg-red-100 text-red-800",icon:Ue},removed:{color:"bg-gray-100 text-gray-800",icon:qe}}[t];if(!l)return e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:t?t.charAt(0).toUpperCase()+t.slice(1):"Unknown"});const n=l.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.color}`,children:[e.jsx(n,{className:"mr-1"}),t.charAt(0).toUpperCase()+t.slice(1)]})},y=t=>{var r;return s?(r=t.helpfulVotes)==null?void 0:r.some(l=>l.userId===s._id):!1},ce=t=>S!==t?e.jsx(Ke,{className:"text-gray-400"}):F==="desc"?e.jsx(Ge,{className:"text-blue-600"}):e.jsx(Qe,{className:"text-blue-600"}),fe=t=>{S===t?(V(F==="desc"?"asc":"desc"),j.info(`Sorted by ${t} (${F==="desc"?"ascending":"descending"})`)):(z(t),V("desc"),j.info(`Sorted by ${t} (descending)`))},re=async t=>{try{const r=await fetch(`${$}/api/review/reply/${t}`);if(r.ok){const l=await r.json();_(n=>({...n,[t]:l}))}}catch{}};o.useEffect(()=>{a.forEach(t=>re(t._id))},[a]);const Ne=async(t,r,l)=>{var n,d,x;if(!s){j.info("Please sign in to vote on reviews");return}ae(i=>({...i,[t]:!0}));try{const i=(n=B[l])==null?void 0:n.find(c=>c._id===t);let h=r;i&&(r==="like"?(d=i.likes)!=null&&d.includes(s==null?void 0:s._id)?(h="remove_like",_(c=>({...c,[l]:c[l].map(p=>p._id===t?{...p,likes:p.likes.filter(A=>A!==s._id)}:p)}))):_(c=>({...c,[l]:c[l].map(p=>{var A;return p._id===t?{...p,likes:[...p.likes||[],s._id],dislikes:(A=p.dislikes)==null?void 0:A.filter(le=>le!==s._id)}:p})})):r==="dislike"&&((x=i.dislikes)!=null&&x.includes(s==null?void 0:s._id)?(h="remove_dislike",_(c=>({...c,[l]:c[l].map(p=>p._id===t?{...p,dislikes:p.dislikes.filter(A=>A!==s._id)}:p)}))):_(c=>({...c,[l]:c[l].map(p=>{var A;return p._id===t?{...p,dislikes:[...p.dislikes||[],s._id],likes:(A=p.likes)==null?void 0:A.filter(le=>le!==s._id)}:p})}))));const L=await fetch(`${$}/api/review/reply/like/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:h})})}catch{j.error("Network error. Please try again.")}finally{ae(i=>({...i,[t]:!1}))}},Oe=async t=>{if(!s){j.info("Please sign in to vote on reviews");return}try{f(l=>l.map(n=>{var d;if(n._id===t){const x=(d=n.dislikes)==null?void 0:d.some(L=>L.userId===(s==null?void 0:s._id));let i,h=n.dislikeCount||0;return x?(i=n.dislikes.filter(L=>L.userId!==s._id),h=Math.max(0,h-1)):(i=[...n.dislikes||[],{userId:s._id}],h=h+1),{...n,dislikes:i,dislikeCount:h}}return n}));const r=await fetch(`${$}/api/review/dislike/${t}`,{method:"POST",credentials:"include"})}catch{j.error("Network error. Please try again.")}},Be=t=>{T(t)},Me=async()=>{!C||!C.comment.trim()||(await fetch(`${$}/api/review/reply/${C._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:C.comment})}),T(null))},ze=async t=>{window.confirm("Delete this reply?")&&await fetch(`${$}/api/review/reply/${t}`,{method:"DELETE",credentials:"include"})},Ve=t=>{X(t._id),m(t.ownerResponse||"")},He=async t=>{await ue(t),X(!1)},We=async t=>{window.confirm("Delete owner response?")&&(await fetch(`${$}/api/review/respond/${t}`,{method:"DELETE",credentials:"include"}),X(!1))},we=async(t,r)=>{if(!s){j.info("Please sign in to vote on reviews");return}f(l=>l.map(n=>{if(n._id===t){let d=n.ownerResponseLikes||[],x=n.ownerResponseDislikes||[];return r==="like"?d.includes(s._id)?d=d.filter(i=>i!==s._id):(d=[...d,s._id],x=x.filter(i=>i!==s._id)):r==="dislike"&&(x.includes(s._id)?x=x.filter(i=>i!==s._id):(x=[...x,s._id],d=d.filter(i=>i!==s._id))),{...n,ownerResponseLikes:d,ownerResponseDislikes:x}}return n}));try{await fetch(`${$}/api/review/respond/like/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:r})})}catch{}},M=t=>t&&(t.role==="admin"||t.role==="rootadmin"),Je=t=>{D(t),oe("")},Ye=async()=>{if(!O.trim()){j.info("Please provide a reason for reporting.");return}xe(!0);try{const t=await fetch(`${$}/api/review/report/${Z._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:O})}),r=await t.json();t.ok?(j.success("Thank you for reporting. Our team will review this issue."),D(null),oe("")):j.error(r.message||"Failed to report issue.")}catch{j.error("Network error. Please try again.")}finally{xe(!1)}};return E?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading reviews..."})]}):U?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800",children:U})}):a.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"No reviews yet. Be the first to review this property!"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800",children:["Reviews (",a.filter(t=>t.status==="approved").length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),e.jsxs("button",{onClick:()=>fe("date"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Date ",ce("date")]}),e.jsxs("button",{onClick:()=>fe("rating"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Rating ",ce("rating")]}),e.jsxs("button",{onClick:()=>fe("helpful"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Helpful ",ce("helpful")]})]})]}),a.filter(t=>t.status==="approved").map(t=>{var r,l,n,d,x,i,h,L;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[!M(t)&&e.jsx(ke,{user:{username:t.userName,avatar:t.userAvatar},size:"w-10 h-10",textSize:"text-sm",showBorder:!1}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[M(t)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1",children:["From organization ",e.jsx(be,{className:"text-green-500"})]}):e.jsx("h4",{className:"font-semibold text-gray-800",children:t.userName}),(t.isVerified||t.verifiedByBooking)&&!M(t)&&e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(be,{className:"mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[ge(t.rating),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:[t.rating," star",t.rating>1?"s":""]})]})]})]}),s&&(s._id===t.userId||M(s))&&t.status!=="approved"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>de(t),className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit review",children:e.jsx(Te,{})}),e.jsx("button",{onClick:()=>ne(t._id),className:"text-red-600 hover:text-red-800 p-1",title:"Delete review",children:e.jsx(me,{})})]})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:t.comment}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:u(t.createdAt)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>pe(t._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${y(t)?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,disabled:t.status!=="approved",children:[e.jsx(Ze,{className:y(t)?"text-blue-600":""}),e.jsx("span",{children:"Helpful"}),t.helpfulCount>0&&e.jsxs("span",{className:"ml-1",children:["(",t.helpfulCount,")"]})]}),e.jsxs("button",{onClick:()=>Oe(t._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${(r=t.dislikes)!=null&&r.some(c=>c.userId===(s==null?void 0:s._id))?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("span",{role:"img","aria-label":"dislike",children:"👎"}),e.jsx("span",{children:"Dislike"}),t.dislikeCount>0&&e.jsxs("span",{className:"ml-1",children:["(",t.dislikeCount,")"]})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[k(t.status),t.verifiedByBooking&&e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded",children:"Booked this property"})]}),t.adminNote&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Admin Note:"})," ",t.adminNote]})}),t.ownerResponse&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-md border border-blue-200 flex justify-between items-center",children:[e.jsx("div",{className:"flex-1",children:W===t._id?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded-md p-2 text-sm mb-2",rows:"2",value:te,onChange:c=>m(c.target.value)}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm ml-2",onClick:()=>He(t._id),children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm ml-2",onClick:()=>X(!1),children:"Cancel"})]}):e.jsx(e.Fragment,{children:e.jsxs("p",{className:"text-sm text-blue-800 flex items-center gap-2",children:[e.jsx(Se,{className:"inline-block text-blue-500"}),e.jsx("strong",{children:"Owner Response:"})," ",t.ownerResponse]})})}),s&&b&&s._id!==b&&!W&&e.jsxs("div",{className:"flex gap-2 ml-4 items-center",children:[e.jsxs("button",{onClick:()=>we(t._id,"like"),className:`flex items-center gap-1 ${(l=t.ownerResponseLikes)!=null&&l.includes(s._id)?"text-blue-600":"text-gray-500"}`,children:["👍 Like ",((n=t.ownerResponseLikes)==null?void 0:n.length)>0&&`(${t.ownerResponseLikes.length})`]}),e.jsxs("button",{onClick:()=>we(t._id,"dislike"),className:`flex items-center gap-1 ${(d=t.ownerResponseDislikes)!=null&&d.includes(s._id)?"text-red-600":"text-gray-500"}`,children:["👎 Dislike ",((x=t.ownerResponseDislikes)==null?void 0:x.length)>0&&`(${t.ownerResponseDislikes.length})`]})]}),s&&b&&s._id===b&&!W&&e.jsxs("span",{className:"flex gap-2 ml-2",children:[e.jsx(Re,{className:"cursor-pointer text-blue-600",title:"Edit",onClick:()=>Ve(t)}),e.jsx(me,{className:"cursor-pointer text-red-600",title:"Delete",onClick:()=>We(t._id)})]})]}),e.jsxs("div",{className:"mt-4 ml-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(Se,{className:"text-blue-500"}),"Replies (",((i=B[t._id])==null?void 0:i.length)||0,")"]}),((h=B[t._id])==null?void 0:h.length)>0&&e.jsxs("button",{onClick:()=>je(c=>({...c,[t._id]:!c[t._id]})),className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center gap-1 transition-colors",children:[J[t._id]?"Hide":"Show"," Replies",e.jsx("span",{className:`transform transition-transform duration-200 ${J[t._id]?"rotate-180":""}`,children:"▼"})]})]}),J[t._id]&&e.jsxs("div",{className:"space-y-3 animate-slideDown",children:[(L=B[t._id])==null?void 0:L.map(c=>{var p,A,le,ve;return e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-white rounded-lg p-3 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!M(c)&&e.jsx(ke,{user:{username:c.userName,avatar:c.userAvatar},size:"w-6 h-6",textSize:"text-xs",showBorder:!1}),M(c)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1 text-xs",children:["From organization ",e.jsx(be,{className:"text-green-500"})]}):e.jsx("span",{className:"font-medium text-gray-800 text-xs",children:c.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(c.createdAt).toLocaleString()}),s&&e.jsxs("div",{className:"flex gap-2 ml-auto",children:[(c.userId===s._id||M(s)&&M(c))&&e.jsx("button",{onClick:()=>Be(c),className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Edit reply",children:e.jsx(Re,{size:10})}),(c.userId===s._id||M(s))&&e.jsx("button",{onClick:()=>ze(c._id),className:"text-red-600 hover:text-red-800 transition-colors",title:"Delete reply",children:e.jsx(me,{size:10})})]})]}),C&&C._id===c._id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded p-2 text-sm",value:C.comment,onChange:Xe=>T({...C,comment:Xe.target.value}),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700 transition-colors",onClick:Me,children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-600 transition-colors",onClick:()=>T(null),children:"Cancel"})]})]}):e.jsx("div",{className:"text-gray-700 text-sm leading-relaxed",children:c.comment}),e.jsxs("div",{className:"flex gap-3 mt-2 text-xs",children:[e.jsxs("button",{onClick:()=>Ne(c._id,"like",t._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(p=c.likes)!=null&&p.includes(s==null?void 0:s._id)?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"}`,disabled:ie[c._id],children:["👍 Like ",((A=c.likes)==null?void 0:A.length)>0&&`(${c.likes.length})`]}),e.jsxs("button",{onClick:()=>Ne(c._id,"dislike",t._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(le=c.dislikes)!=null&&le.includes(s==null?void 0:s._id)?"bg-red-100 text-red-700":"text-gray-500 hover:bg-gray-100"}`,disabled:ie[c._id],children:["👎 Dislike ",((ve=c.dislikes)==null?void 0:ve.length)>0&&`(${c.dislikes.length})`]})]})]},c._id)}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx(Pe,{reviewId:t._id,onReplyAdded:()=>re(t._id)})})]}),(!B[t._id]||B[t._id].length===0)&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx(Pe,{reviewId:t._id,onReplyAdded:()=>re(t._id)})})]}),s&&!M(s)&&e.jsxs("button",{className:"flex items-center gap-1 text-yellow-600 hover:text-yellow-800 text-xs mt-2",title:"Report an issue with this review",onClick:()=>Je(t),children:[e.jsx(_e,{className:"inline-block"}),"Report an Issue"]})]},t._id)}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Review"}),e.jsx(Ie,{listingId:g,existingReview:w,onReviewSubmitted:he}),e.jsx("button",{onClick:()=>v(null),className:"mt-4 w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})}),Z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-yellow-700",children:[e.jsx(_e,{})," Report an Issue"]}),e.jsx("p",{className:"mb-2 text-gray-700",children:"Please describe the issue with this review:"}),e.jsx("textarea",{className:"w-full border border-yellow-300 rounded-md p-2 text-sm mb-2",rows:"3",value:O,onChange:t=>oe(t.target.value),placeholder:"Enter reason (required)"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm",onClick:()=>D(null),disabled:se,children:"Cancel"}),e.jsx("button",{className:"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 text-sm",onClick:Ye,disabled:se,children:se?"Reporting...":"Submit Report"})]})]})})]})}const kt=`
  @keyframes slideDown {
    from { 
      opacity: 0; 
      transform: translateY(-10px);
    }
    to { 
      opacity: 1; 
      transform: translateY(0);
    }
  }
  .animate-slideDown {
    animation: slideDown 0.3s ease-out;
  }
`;if(typeof document<"u"){const g=document.createElement("style");g.textContent=kt,document.head.appendChild(g)}const St=({isOpen:g,onClose:N,images:b,initialIndex:s=0})=>{const[a,f]=o.useState(s),[E,P]=o.useState(1),[U,I]=o.useState(0),[w,v]=o.useState({x:0,y:0}),[S,z]=o.useState(!1),[F,V]=o.useState({x:0,y:0}),Y=o.useRef(null);o.useEffect(()=>{g&&(f(s),P(1),I(0),v({x:0,y:0}))},[g,s]),o.useEffect(()=>{const m=D=>{if(g)switch(D.key){case"Escape":N();break;case"ArrowLeft":f(O=>O>0?O-1:b.length-1);break;case"ArrowRight":f(O=>O<b.length-1?O+1:0);break;case"+":case"=":D.preventDefault(),q();break;case"-":D.preventDefault(),K();break;case"0":H();break}},Z=D=>{g&&(D.preventDefault(),D.deltaY<0?q():K())};return document.addEventListener("keydown",m),document.addEventListener("wheel",Z,{passive:!1}),()=>{document.removeEventListener("keydown",m),document.removeEventListener("wheel",Z)}},[g,b.length,N]),o.useEffect(()=>(g?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[g]);const q=()=>{P(m=>Math.min(m*1.2,5))},K=()=>{P(m=>Math.max(m/1.2,.1))},H=()=>{P(1),I(0),v({x:0,y:0})},G=()=>{I(m=>m+90)},R=m=>{E>1&&(z(!0),V({x:m.clientX-w.x,y:m.clientY-w.y}))},B=m=>{S&&E>1&&v({x:m.clientX-F.x,y:m.clientY-F.y})},_=()=>{z(!1)},C=m=>{E>1&&m.touches.length===1&&(z(!0),V({x:m.touches[0].clientX-w.x,y:m.touches[0].clientY-w.y}))},T=m=>{S&&E>1&&m.touches.length===1&&(m.preventDefault(),v({x:m.touches[0].clientX-F.x,y:m.touches[0].clientY-F.y}))},W=()=>{z(!1)},X=()=>{const m=document.createElement("a");m.href=b[a],m.download=`property-image-${a+1}.jpg`,document.body.appendChild(m),m.click(),document.body.removeChild(m)},te=m=>{m.target===m.currentTarget&&N()};return!g||!b||b.length===0?null:e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",onClick:te,onMouseMove:B,onMouseUp:_,onMouseLeave:_,children:[e.jsx("button",{onClick:N,className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-2",children:e.jsx(Ue,{size:24})}),b.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f(m=>m>0?m-1:b.length-1),className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-3",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>f(m=>m<b.length-1?m+1:0),className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-3",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"relative max-w-full max-h-full overflow-hidden",children:e.jsx("img",{ref:Y,src:b[a],alt:`Property image ${a+1}`,className:"max-w-full max-h-full object-contain cursor-move",style:{transform:`scale(${E}) rotate(${U}deg) translate(${w.x}px, ${w.y}px)`,transition:S?"none":"transform 0.1s ease-out"},onMouseDown:R,onTouchStart:C,onTouchMove:T,onTouchEnd:W,draggable:!1})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-2 bg-black bg-opacity-50 rounded-lg p-2",children:[e.jsx("button",{onClick:q,className:"text-white hover:text-gray-300 p-2 rounded",title:"Zoom In (Ctrl + +)",children:e.jsx(et,{size:16})}),e.jsx("button",{onClick:K,className:"text-white hover:text-gray-300 p-2 rounded",title:"Zoom Out (Ctrl + -)",children:e.jsx(tt,{size:16})}),e.jsx("button",{onClick:G,className:"text-white hover:text-gray-300 p-2 rounded",title:"Rotate",children:e.jsx(st,{size:16})}),e.jsx("button",{onClick:H,className:"text-white hover:text-gray-300 p-2 rounded",title:"Reset (0)",children:e.jsx("span",{className:"text-sm font-bold",children:"0"})}),e.jsx("button",{onClick:X,className:"text-white hover:text-gray-300 p-2 rounded",title:"Download",children:e.jsx(at,{size:16})})]}),b.length>1&&e.jsxs("div",{className:"absolute top-4 left-4 text-white bg-black bg-opacity-50 rounded-lg px-3 py-1",children:[a+1," / ",b.length]}),e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 rounded-lg px-3 py-1",children:[Math.round(E*100),"%"]}),e.jsx("div",{className:"absolute bottom-16 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 rounded-lg px-4 py-2 text-sm max-w-xs",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"hidden sm:block",children:"Use mouse wheel or +/- to zoom"}),e.jsx("div",{className:"hidden sm:block",children:"Drag to pan • Click outside to close"}),e.jsx("div",{className:"hidden sm:block",children:"Arrow keys to navigate • ESC to close"}),e.jsx("div",{className:"sm:hidden",children:"Tap to zoom • Swipe to navigate"}),e.jsx("div",{className:"sm:hidden",children:"Pinch to zoom • Tap outside to close"})]})})]})},Fe="https://urbansetu.onrender.com";function Dt(){const g=nt(),N=rt(),b=lt(),{currentUser:s}=ye(u=>u.user),[a,f]=o.useState(null),[E,P]=o.useState(!1),[U,I]=o.useState(!0),[w,v]=o.useState(!1),[S,z]=o.useState(""),[F,V]=o.useState(!1),[Y,q]=o.useState(""),[K,H]=o.useState(!1),[G,R]=o.useState(""),{addToWishlist:B,removeFromWishlist:_,isInWishlist:C}=ot(),[T,W]=o.useState(null),[X,te]=o.useState(!1),[m,Z]=o.useState(""),[D,O]=o.useState(!1),[oe,se]=o.useState(!1),[xe,ie]=o.useState(0),ae=(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="rootadmin",J=b.pathname.includes("/admin"),Q=s?J?{path:"/admin",text:"Back to Dashboard"}:{path:"/user",text:"Back to Home"}:{path:"/",text:"Back to Home"},ne=u=>`₹${Number(u).toLocaleString("en-IN")}`,de=()=>a.offer&&a.regularPrice&&a.discountPrice?Math.round((a.regularPrice-a.discountPrice)/a.regularPrice*100):0,he=()=>{z(""),R(""),v(!0)},pe=u=>{if(u.preventDefault(),!S.trim()){R("Reason is required");return}v(!1),R(""),V(!0)},ue=u=>{console.log("Image clicked:",u),ie(u),se(!0)},ge=async u=>{if(u.preventDefault(),!Y){R("Password is required");return}H(!0),R("");try{if(!(await fetch(`/api/user/verify-password/${s._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Y})})).ok){R("Incorrect password. Property not deleted."),H(!1);return}const y=await fetch(`/api/listing/delete/${a._id}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:S})});if(y.ok)j.success("Property deleted successfully!"),V(!1),N("/admin/listings");else{const ce=await y.json();R(ce.message||"Failed to delete property.")}}catch{R("An error occurred while deleting the property.")}finally{H(!1)}};return o.useEffect(()=>{(async()=>{I(!0);try{const y=await(await fetch(`${Fe}/api/listing/get/${g.listingId}`)).json();if(y.success===!1){console.log(y.message);return}f(y)}catch(k){console.error("Error fetching listing:",k)}finally{I(!1)}})()},[g.listingId]),o.useEffect(()=>{(async()=>{if(a&&a.userRef){te(!0),Z("");try{const k=await fetch(`${Fe}/api/user/id/${a.userRef}`);if(!k.ok)throw new Error("Failed to fetch owner details");const y=await k.json();W(y)}catch{Z("Could not load owner details"),W(null)}finally{te(!1)}}else W(null)})()},[a]),U?e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-3 text-lg font-semibold text-blue-600",children:"Loading property details..."})]})})}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl w-full mx-auto bg-white rounded-xl shadow-lg p-3 sm:p-6 relative overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:()=>N(Q.path),className:"bg-gradient-to-r from-gray-500 to-gray-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(it,{})," ",Q.text]})}),ae&&J&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs(Le,{to:`/admin/update-listing/${a._id}`,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(Te,{})," Edit Property"]}),e.jsxs("button",{onClick:he,className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(me,{})," Delete Property"]})]})]}),e.jsxs("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:["Property Details ",ae&&J&&"(Admin View)"]}),e.jsx("div",{className:"relative mb-6",children:e.jsx(bt,{navigation:!0,modules:[yt],className:"rounded-lg overflow-hidden relative",onSlideChange:u=>{ie(u.activeIndex)},children:a.imageUrls&&a.imageUrls.length>0?a.imageUrls.map((u,k)=>e.jsx(Ee,{children:e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:u,alt:`${a.name} - Image ${k+1}`,className:"w-full h-40 sm:h-64 md:h-96 object-cover transition-transform duration-200 group-hover:scale-105",onError:y=>{y.target.src="https://via.placeholder.com/800x600?text=Image+Not+Available",y.target.className="w-full h-40 sm:h-64 md:h-96 object-cover opacity-50"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"bg-white bg-opacity-90 rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx(dt,{className:"text-gray-700"})})}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"Click to expand"}),e.jsx("button",{className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onClick:y=>{y.preventDefault(),y.stopPropagation(),ue(k)},onTouchEnd:y=>{y.preventDefault(),y.stopPropagation(),ue(k)},"aria-label":`Expand image ${k+1}`})]})},k)):e.jsx(Ee,{children:e.jsx("div",{className:"w-full h-64 md:h-96 bg-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🏠"}),e.jsx("p",{className:"text-lg",children:"No images available"})]})})})})}),e.jsx("div",{className:"flex justify-end items-center space-x-4 mb-4 pr-2",children:e.jsx(ct,{className:"cursor-pointer text-gray-500 hover:text-gray-700 text-xl",onClick:()=>{navigator.clipboard.writeText(window.location.href),P(!0),setTimeout(()=>P(!1),2e3)}})}),E&&e.jsx("p",{className:"text-green-500 text-sm text-center mb-4",children:"Link copied!"}),e.jsxs("div",{className:"p-3 sm:p-6 bg-gray-50 shadow-md rounded-lg mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl md:text-3xl font-bold text-gray-800 break-words flex items-center gap-2",children:[a.name,e.jsx("button",{onClick:()=>{if(!s){j.info("Please sign in to add properties to your wishlist."),N("/sign-in");return}C(a._id)?_(a._id):B(a)},className:`ml-2 p-2 rounded-full transition z-20 ${C(a._id)?"bg-red-500 text-white":"bg-gray-200 text-red-500 hover:text-red-600"} focus:outline-none`,title:C(a._id)?"Remove from wishlist":"Add to wishlist",style:{lineHeight:0},children:e.jsx(mt,{className:"text-base sm:text-lg"})})]}),a.offer&&de()>0&&e.jsxs("span",{className:"bg-yellow-400 text-gray-900 text-sm font-semibold px-4 py-1 rounded-full shadow-md animate-pulse w-max sm:w-auto ml-0 sm:ml-2 mt-2 sm:mt-0",style:{alignSelf:"flex-start"},title:"Limited-time offer!",children:[de(),"% OFF"]})]}),e.jsx("div",{className:"mb-4",children:a.offer&&de()>0?e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[ne(a.discountPrice),a.type==="rent"&&" / month"]}),e.jsx("p",{className:"text-base sm:text-xl text-gray-500 line-through",children:ne(a.regularPrice)}),e.jsxs("span",{className:"text-xs sm:text-sm text-green-600 font-semibold",children:["Save ",ne(a.regularPrice-a.discountPrice)]})]}):e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[ne(a.regularPrice),a.type==="rent"&&" / month"]})}),e.jsxs("p",{className:"flex items-center text-gray-600 mb-4",children:[e.jsx(xt,{className:"mr-2 text-red-500"}),Nt(a.propertyNumber||a.city?{propertyNumber:a.propertyNumber,landmark:a.landmark,city:a.city,district:a.district,state:a.state,pincode:a.pincode}:a.address,!!s)]}),a.locationLink&&De(!!s)&&e.jsx("div",{className:"mb-4",children:e.jsx("a",{href:a.locationLink,rel:"noopener noreferrer",className:"inline-block bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:$e(!!s)})}),a.locationLink&&!De(!!s)&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>N("/sign-in"),className:"inline-block bg-gradient-to-r from-gray-500 to-gray-600 text-white px-6 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:$e(!!s)})}),e.jsx("div",{className:"flex space-x-4 mb-4",children:e.jsx("span",{className:`px-3 py-1 text-white rounded-md ${a.type==="rent"?"bg-blue-500":"bg-green-500"}`,children:a.type==="rent"?"For Rent":"For Sale"})}),e.jsxs("p",{className:"text-gray-700 mb-4 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Description:"})," ",a.description]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ut,{className:"mr-2 text-blue-500"})," ",a.bedrooms," ",a.bedrooms>1?"beds":"bed"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ht,{className:"mr-2 text-blue-500"})," ",a.bathrooms," ",a.bathrooms>1?"baths":"bath"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(pt,{className:"mr-2 text-blue-500"})," ",a.parking?"Parking":"No Parking"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(gt,{className:"mr-2 text-blue-500"})," ",a.furnished?"Furnished":"Unfurnished"]})]})]}),ae&&J&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 bg-blue-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-blue-800 mb-4",children:"Admin Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Property ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Updated"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created By"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a.userRef||"Unknown"})]})]})]}),e.jsxs("div",{className:"p-6 bg-green-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-green-800 mb-4",children:"Property Owner Details"}),X?e.jsx("p",{className:"text-gray-500",children:"Loading owner details..."}):m?e.jsx("p",{className:"text-red-500",children:m}):T?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Name"}),e.jsx("p",{className:"font-semibold text-gray-800",children:T.username})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Email"}),e.jsx("p",{className:"font-semibold text-gray-800",children:T.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Mobile Number"}),e.jsx("p",{className:"font-semibold text-gray-800",children:T.mobileNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:T._id})]})]}):e.jsx("p",{className:"text-gray-500",children:"No owner details found."})]})]}),e.jsx("div",{className:"flex justify-center",children:s&&(a.sellerId===s._id||a.userRef===s._id)?e.jsx("div",{className:"text-red-500 font-semibold text-lg py-3",children:"You cannot book an appointment for your own property."}):e.jsx("button",{onClick:()=>{if(!s){j.info("Please sign in to book appointments."),N("/sign-in");return}const u=J?`/admin/appointmentlisting?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`:`/user/appointment?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`;N(u)},className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:"📅 Book Appointment"})}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("button",{onClick:()=>O(u=>!u),className:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white px-6 py-2 rounded-lg shadow font-semibold flex items-center gap-2 hover:from-yellow-500 hover:to-yellow-700 transition-all",children:[D?"Hide Reviews":"Show Reviews",a.reviewCount>0&&e.jsx("span",{className:"ml-2 bg-white text-yellow-700 rounded-full px-2 py-0.5 text-xs font-bold",children:a.reviewCount})]})}),D&&e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"border-t border-gray-200 pt-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h3",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[e.jsx(Ae,{className:"text-yellow-500 mr-2"}),"Reviews",a.averageRating>0&&e.jsxs("span",{className:"ml-2 text-lg text-gray-600",children:["(",a.averageRating.toFixed(1)," ⭐ • ",a.reviewCount," review",a.reviewCount!==1?"s":"",")"]})]})}),e.jsx(Ie,{listingId:a._id,onReviewSubmitted:()=>{window.location.reload()}}),e.jsx(vt,{listingId:a._id,onReviewDeleted:()=>{window.location.reload()},listingOwnerId:a.userRef})]})})]})}),e.jsx(jt,{}),w&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:pe,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(me,{})," Reason for Deletion"]}),e.jsx("textarea",{className:"border rounded p-2 w-full",placeholder:"Enter reason for deleting this property",value:S,onChange:u=>z(u.target.value),rows:3,autoFocus:!0}),G&&e.jsx("div",{className:"text-red-600 text-sm",children:G}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-red-600 text-white font-semibold",children:"Next"})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:ge,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(ft,{})," Confirm Password"]}),e.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:Y,onChange:u=>q(u.target.value),autoFocus:!0}),G&&e.jsx("div",{className:"text-red-600 text-sm",children:G}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>V(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:K,children:K?"Deleting...":"Confirm & Delete"})]})]})}),a&&a.imageUrls&&a.imageUrls.length>0&&e.jsx(St,{isOpen:oe,onClose:()=>se(!1),images:a.imageUrls,initialIndex:xe})]}):e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-red-600 mb-4",children:"Property Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The property you're looking for doesn't exist or has been removed."}),e.jsx(Le,{to:Q.path,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold",children:Q.text})]})})})}export{Dt as default};
