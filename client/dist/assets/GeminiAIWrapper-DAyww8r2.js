import{R as N,r as n,u as I,h as k,g as E,j as e,W as $,z as A,L as C,y as g,G as j,ai as L,aj as P,ak as R}from"./index-CMpHVNtH.js";import{M as S}from"./index-BlxSbNx8.js";import{m as _}from"./addressMasking-3vIUwCOC.js";function D({listing:t,onDelete:u}){const{addToWishlist:x,removeFromWishlist:h,isInWishlist:i}=N(),[c,l]=n.useState(!1),m=I(),p=k(),{currentUser:d}=E(a=>a.user),f=p.pathname.includes("/admin");n.useEffect(()=>{l(i(t._id))},[i,t._id]);const b=async()=>{if(!d){g.info("Please sign in to add properties to your wishlist."),m("/sign-in");return}c?(await h(t._id),l(!1)):(await x(t),l(!0))},y=()=>{if(!d){g.info("Please sign in to book appointments."),m("/sign-in");return}const a=f?`/admin/appointmentlisting?listingId=${t._id}&listingType=${t.type}&propertyName=${encodeURIComponent(t.name)}&propertyDescription=${encodeURIComponent(t.description)}`:`/user/appointment?listingId=${t._id}&listingType=${t.type}&propertyName=${encodeURIComponent(t.name)}&propertyDescription=${encodeURIComponent(t.description)}`;m(a)},s=a=>`â‚¹${Number(a).toLocaleString("en-IN")}`,r=()=>t.offer&&t.regularPrice&&t.discountPrice?Math.round((t.regularPrice-t.discountPrice)/t.regularPrice*100):0;let o=`/listing/${t._id}`;return f?o=`/admin/listing/${t._id}`:p.pathname.startsWith("/user")&&(o=`/user/listing/${t._id}`),e.jsxs("div",{className:"relative bg-white shadow-md rounded-lg overflow-hidden p-2 sm:p-4",children:[t.offer&&r()>0&&e.jsx("div",{className:"absolute top-2 sm:top-4 left-2 sm:left-4 z-20",children:e.jsxs("span",{className:"bg-yellow-400 text-gray-900 text-xs font-semibold px-2 py-1 rounded-full shadow-md animate-pulse",title:"Limited-time offer!",children:[r(),"% OFF"]})}),e.jsx("button",{onClick:b,className:`absolute top-2 sm:top-4 right-2 sm:right-4 p-2 rounded-full transition z-20 ${c?"bg-red-500 text-white":"bg-gray-200 text-red-500"}`,title:c?"Remove from wishlist":"Add to wishlist",children:e.jsx($,{className:"text-base sm:text-lg"})}),u&&e.jsx("button",{onClick:()=>u(t._id),className:"absolute top-2 sm:top-4 left-2 sm:left-4 p-2 rounded-full bg-red-100 text-red-600 hover:bg-red-500 hover:text-white transition shadow-md z-10",title:"Delete Listing",style:{left:t.offer&&r()>0?"4.5rem":"0.5rem"},children:e.jsx(A,{className:"text-base sm:text-lg"})}),e.jsxs(C,{to:o,children:[t.imageUrls&&t.imageUrls.length>0?e.jsx("img",{src:t.imageUrls[0],alt:"home",className:"w-full h-32 sm:h-48 object-cover rounded-md",onError:a=>{a.target.src="https://via.placeholder.com/400x300?text=No+Image",a.target.className="w-full h-32 sm:h-48 object-cover rounded-md opacity-50"}}):e.jsx("div",{className:"w-full h-48 bg-gray-200 rounded-md flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ "}),e.jsx("p",{className:"text-sm",children:"No Image"})]})}),e.jsxs("div",{className:"p-2 sm:p-3",children:[e.jsx("p",{className:"text-gray-700 font-semibold text-base sm:text-lg truncate",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(S,{className:"text-red-500"}),e.jsx("p",{className:"truncate",children:_(t.propertyNumber||t.city?{propertyNumber:t.propertyNumber,landmark:t.landmark,city:t.city,district:t.district,state:t.state,pincode:t.pincode}:t.address,!!d)})]}),e.jsx("p",{className:"text-gray-600 text-xs sm:text-sm mt-2 truncate",children:t.description}),e.jsx("div",{className:"mt-2",children:t.offer&&r()>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-base sm:text-lg font-bold text-blue-500",children:[s(t.discountPrice),t.type==="rent"&&" / month"]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 line-through",children:s(t.regularPrice)})]}):e.jsxs("p",{className:"text-base sm:text-lg font-bold text-blue-500",children:[s(t.regularPrice),t.type==="rent"&&" / month"]})}),e.jsxs("div",{className:"flex space-x-2 sm:space-x-4 text-gray-600 text-xs sm:text-sm mt-2",children:[e.jsx("p",{children:t.bedrooms>1?`${t.bedrooms} beds`:`${t.bedrooms} bed`}),e.jsx("p",{children:t.bathrooms>1?`${t.bathrooms} bathrooms`:`${t.bathrooms} bathroom`})]})]})]}),e.jsx("div",{className:"mt-2 sm:mt-4",children:d&&d._id===t.userRef?e.jsx("div",{className:"w-full text-red-500 font-semibold text-center py-2 sm:py-3 rounded-lg bg-red-50 border border-red-200",children:"You cannot book an appointment for your own property."}):e.jsx("button",{onClick:y,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center justify-center gap-2 text-sm sm:text-base",children:"ðŸ“… Book Appointment"})})]})}const F=()=>{const[t,u]=n.useState(!1),[x,h]=n.useState([{role:"assistant",content:"Hello! I'm your AI assistant powered by Gemini. How can I help you with your real estate needs today?"}]),[i,c]=n.useState(""),[l,m]=n.useState(!1),p=n.useRef(null),d=n.useRef(null),f=()=>{var s;(s=p.current)==null||s.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{f()},[x]),n.useEffect(()=>{if(!t)return;const s=r=>{var o;r.ctrlKey&&r.key==="f"&&(r.preventDefault(),(o=d.current)==null||o.focus())};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[t]),n.useEffect(()=>{if(t){const s=window.scrollY;document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${s}px`,document.body.style.width="100%",document.body.style.height="100%",document.documentElement.style.overflow="hidden",document.documentElement.style.height="100%";const r=o=>{o.target.closest(".gemini-chatbox-modal")||o.preventDefault()};return document.addEventListener("touchmove",r,{passive:!1}),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.width="",document.body.style.height="",document.documentElement.style.overflow="",document.documentElement.style.height="",document.removeEventListener("touchmove",r),window.scrollTo(0,s)}}},[t]),n.useEffect(()=>{const s=new CustomEvent("geminiChatboxToggle",{detail:{isOpen:t}});window.dispatchEvent(s)},[t]);const b=async s=>{if(s.preventDefault(),!i.trim()||l)return;const r=i.trim();c(""),h(o=>[...o,{role:"user",content:r}]),m(!0);try{const a=await fetch("https://urbansetu.onrender.com/api/gemini/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r,history:x.slice(-10)})});if(!a.ok)throw new Error("Failed to get response");const w=await a.json();h(v=>[...v,{role:"assistant",content:w.response}])}catch(o){console.error("Error:",o),h(a=>[...a,{role:"assistant",content:"Sorry, I'm having trouble connecting right now. Please try again later."}])}finally{m(!1)}},y=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),b(s))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-20 right-6 z-50",children:e.jsxs("button",{onClick:()=>u(!t),className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:"linear-gradient(135deg, #6366f1, #6366f1dd)",boxShadow:"0 10px 25px #6366f140"},"aria-label":"Open AI Chat",title:"Chat with Gemini AI Assistant!",children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:"3px solid #6366f155"}}),t?e.jsx(j,{className:"w-5 h-5 text-white drop-shadow-lg"}):e.jsx(L,{className:"w-5 h-5 text-white drop-shadow-lg"}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ¤–"}),e.jsx("span",{className:"font-medium",children:"Chat with AI Assistant!"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4 md:p-0 md:items-end md:justify-end gemini-chatbox-modal",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col w-full max-w-md h-full max-h-[90vh] md:w-96 md:h-[500px] md:mb-32 md:mr-6 md:max-h-[500px]",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-t-2xl flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{size:20}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Gemini AI Assistant"}),e.jsx("p",{className:"text-xs opacity-90",children:"Real Estate Helper"})]})]}),e.jsx("button",{onClick:()=>u(!1),className:"text-white hover:text-gray-200 transition-colors",children:e.jsx(j,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:[x.map((s,r)=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] p-3 rounded-2xl break-words ${s.role==="user"?"bg-gradient-to-r from-blue-600 to-purple-600 text-white":"bg-gray-100 text-gray-800"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:s.content})})},r)),l&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 text-gray-800 p-3 rounded-2xl",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),e.jsx("div",{ref:p})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 flex-shrink-0",children:e.jsxs("form",{onSubmit:b,className:"flex space-x-2",children:[e.jsx("input",{ref:d,type:"text",value:i,onChange:s=>c(s.target.value),onKeyPress:y,placeholder:"Ask me anything about real estate...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",disabled:l}),e.jsx("button",{type:"submit",disabled:!i.trim()||l,className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-2 rounded-full hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex-shrink-0 flex items-center justify-center w-10 h-10",children:e.jsx(R,{size:16})})]})})]})})]})};function W(){return e.jsx(F,{})}export{W as G,D as L};
