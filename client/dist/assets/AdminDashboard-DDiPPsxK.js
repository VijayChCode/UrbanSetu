import{g as ne,r as a,u as re,j as e,L as x,ag as U,c as M,ah as I,b as L,A as de,a0 as oe,y as ce}from"./index-Bo2fB3Tt.js";import{L as k,G as xe}from"./GeminiAIWrapper-5T37fM9v.js";import{C as me}from"./ContactSupportWrapper-N721wB6Z.js";import"./index-BRc6CsCo.js";import"./addressMasking-3vIUwCOC.js";const i="https://urbansetu.onrender.com";function je(){const{currentUser:B}=ne(s=>s.user),[D,P]=a.useState([]),[C,E]=a.useState([]),[F,_]=a.useState([]),[j,G]=a.useState(0),[V,z]=a.useState(!0),[l,H]=a.useState({totalUsers:0,totalAdmins:0,totalListings:0,totalReviews:0,pendingReviews:0,averageRating:0,recentActivity:[],topProperties:[],userGrowth:[],listingStats:{sale:0,rent:0,offer:0}}),[g,W]=a.useState({total:0,accepted:0,pending:0,rejected:0}),[w,b]=a.useState(!1),[v,$]=a.useState(""),[N,y]=a.useState(!1),[R,q]=a.useState(""),[O,S]=a.useState(!1),[f,r]=a.useState(""),[u,J]=a.useState({id:null,ownerId:null});a.useEffect(()=>(w||N?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[w,N]);const K=re();a.useEffect(()=>{(async()=>{try{await Promise.all([Q(),X(),Y(),Z(),ee(),T()])}catch(t){console.error("Error fetching dashboard data:",t)}finally{z(!1)}})()},[]);const Q=async()=>{try{const t=await(await fetch(`${i}/api/listing/get?offer=true&limit=6`)).json();P(t)}catch(s){console.error("Error fetching offer listings",s)}},X=async()=>{try{const t=await(await fetch(`${i}/api/listing/get?type=rent&limit=6`)).json();_(t)}catch(s){console.error("Error fetching rent listings",s)}},Y=async()=>{try{const t=await(await fetch(`${i}/api/listing/get?type=sale&limit=6`)).json();E(t)}catch(s){console.error("Error fetching sale listings",s)}},Z=async()=>{try{const s=await fetch(`${i}/api/bookings`,{headers:{"Content-Type":"application/json"},credentials:"include"});if(s.ok){const t=await s.json();G(t.length)}}catch(s){console.error("Failed to fetch appointment count:",s)}},ee=async()=>{try{const s=await fetch(`${i}/api/bookings/stats`,{credentials:"include"});if(s.ok){const t=await s.json();W(t)}}catch(s){console.error("Failed to fetch booking stats:",s)}},T=async()=>{try{const s=await fetch(`${i}/api/admin/management/users`,{credentials:"include"}),t=await fetch(`${i}/api/admin/management/admins`,{credentials:"include"}),m=await fetch(`${i}/api/review/admin/stats`,{credentials:"include"}),h=await fetch(`${i}/api/listing/get?limit=10000`,{credentials:"include"});let d=[],o=[],p={totalReviews:0,pendingReviews:0,averageRating:0},c=[];s.ok&&(d=await s.json()),t.ok&&(o=await t.json()),m.ok&&(p=await m.json()),h.ok&&(c=await h.json());const ae={sale:c.filter(n=>n.type==="sale").length,rent:c.filter(n=>n.type==="rent").length,offer:c.filter(n=>n.offer).length},le=c.filter(n=>n.averageRating>0).sort((n,ie)=>ie.averageRating-n.averageRating).slice(0,5);H({totalUsers:d.length,totalAdmins:o.length,totalListings:c.length,totalReviews:p.totalReviews,pendingReviews:p.pendingReviews,averageRating:p.averageRating,listingStats:ae,topProperties:le,recentActivity:[],userGrowth:[]})}catch(s){console.error("Failed to fetch analytics:",s)}},A=(s,t)=>{J({id:s,ownerId:t}),$(""),r(""),b(!0)},se=s=>{if(s.preventDefault(),!v.trim()){r("Reason is required");return}b(!1),r(""),y(!0)},te=async s=>{if(s.preventDefault(),!R){r("Password is required");return}S(!0),r("");try{if(!(await fetch(`${i}/api/user/verify-password/${B._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:R})})).ok){r("Incorrect password. Property not deleted."),S(!1);return}const m=await fetch(`${i}/api/listing/delete/${u.id}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:v})}),h=await m.json();m.ok?(P(d=>d.filter(o=>o._id!==u.id)),_(d=>d.filter(o=>o._id!==u.id)),E(d=>d.filter(o=>o._id!==u.id)),y(!1),ce.success(h.message||"Listing deleted successfully."),T()):r(h.message||"Failed to delete listing.")}catch{r("An error occurred. Please try again.")}finally{S(!1)}};return V?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading dashboard..."})]})}):e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen",children:[e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row md:items-center md:justify-between mb-10 gap-6 animate-fade-in-down bg-white rounded-xl shadow-lg p-8 mt-10",children:[e.jsxs("div",{className:"text-left w-full md:w-auto flex flex-col items-start",children:[e.jsx("h2",{className:"text-4xl font-extrabold text-blue-700 animate-fade-in mb-2 drop-shadow",children:"Welcome, Admin!"}),e.jsx("p",{className:"mt-2 text-lg text-blue-600 animate-fade-in delay-200",children:"Manage all properties and appointments from your dashboard."})]}),e.jsx("div",{className:"w-full md:w-auto flex justify-end",children:e.jsx(x,{to:"/admin/appointments",children:e.jsxs("div",{className:"relative",children:[j>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold z-10",children:j>99?"99+":j}),e.jsxs("button",{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2 mt-4 md:mt-0",children:[e.jsx(U,{className:"text-2xl drop-shadow-lg animate-pulse"}),e.jsx("span",{className:"tracking-wide",children:"Appointments"})]})]})})})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"📊 Analytics Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:l.totalUsers})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(M,{className:"text-2xl text-blue-600"})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Admins: ",l.totalAdmins]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Properties"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:l.totalListings})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(I,{className:"text-2xl text-green-600"})})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["For Sale: ",l.listingStats.sale]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["For Rent: ",l.listingStats.rent]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Offers: ",l.listingStats.offer]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Reviews"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:l.totalReviews})]}),e.jsx("div",{className:"bg-yellow-100 p-3 rounded-full",children:e.jsx(L,{className:"text-2xl text-yellow-600"})})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Avg Rating: ",l.averageRating.toFixed(1)," ⭐"]}),e.jsxs("p",{className:"text-sm text-orange-500",children:["Pending: ",l.pendingReviews]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Appointments"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:g.total})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:e.jsx(U,{className:"text-2xl text-purple-600"})})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs("p",{className:"text-sm text-green-600",children:["Accepted: ",g.accepted]}),e.jsxs("p",{className:"text-sm text-orange-500",children:["Pending: ",g.pending]}),e.jsxs("p",{className:"text-sm text-red-500",children:["Rejected: ",g.rejected]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("button",{className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all hover:scale-105 w-full text-left",onClick:()=>K("/admin/management"),children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(M,{className:"text-2xl text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Manage Users"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View and manage user accounts"})]})]})}),e.jsx(x,{to:"/admin/reviews",className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all hover:scale-105",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-yellow-100 p-3 rounded-full",children:e.jsx(L,{className:"text-2xl text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Review Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Approve and manage reviews"}),l.pendingReviews>0&&e.jsxs("span",{className:"inline-block bg-orange-500 text-white text-xs px-2 py-1 rounded-full mt-1",children:[l.pendingReviews," pending"]})]})]})}),e.jsx(x,{to:"/admin/explore",className:"bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all hover:scale-105",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(I,{className:"text-2xl text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"All Properties"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Browse and manage listings"})]})]})})]}),l.topProperties.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(L,{className:"text-yellow-500 mr-2"}),"Top Rated Properties"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.topProperties.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-800 truncate",children:s.name}),e.jsxs("span",{className:"text-sm text-yellow-600 font-semibold",children:[s.averageRating.toFixed(1)," ⭐"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[s.city,", ",s.state]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.reviewCount," review",s.reviewCount!==1?"s":""]})]},s._id))})]})]}),e.jsxs("div",{className:"max-w-6xl w-full mx-auto px-2 sm:px-4 md:px-8 py-8 overflow-x-hidden",children:[D.length>0&&e.jsxs("div",{className:"mb-8 bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 animate-slide-in-left",children:"🔥 Exclusive Offers"}),e.jsx(x,{to:"/admin/explore?offer=true",className:"text-blue-600 hover:underline",children:"View All Offers"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:D.map(s=>e.jsx("div",{className:"transition-transform duration-300 hover:scale-105 hover:shadow-xl",children:e.jsx(k,{listing:s,onDelete:()=>A(s._id,s.userRef)})},s._id))})]}),F.length>0&&e.jsxs("div",{className:"mb-8 bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 animate-slide-in-left delay-200",children:"🏡 Homes for Rent"}),e.jsx(x,{to:"/admin/explore?type=rent",className:"text-blue-600 hover:underline",children:"View All Rentals"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:F.map(s=>e.jsx("div",{className:"transition-transform duration-300 hover:scale-105 hover:shadow-xl",children:e.jsx(k,{listing:s,onDelete:()=>A(s._id,s.userRef)})},s._id))})]}),C.length>0&&e.jsxs("div",{className:"mb-8 bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-700 animate-slide-in-left delay-400",children:"🏠 Homes for Sale"}),e.jsx(x,{to:"/admin/explore?type=sale",className:"text-blue-600 hover:underline",children:"View All Sales"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:C.map(s=>e.jsx("div",{className:"transition-transform duration-300 hover:scale-105 hover:shadow-xl",children:e.jsx(k,{listing:s,onDelete:()=>A(s._id,s.userRef)})},s._id))})]})]}),e.jsx(xe,{}),e.jsx(me,{}),w&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:se,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(de,{})," Reason for Deletion"]}),e.jsx("textarea",{className:"border rounded p-2 w-full",placeholder:"Enter reason for deleting this property",value:v,onChange:s=>$(s.target.value),rows:3,autoFocus:!0}),f&&e.jsx("div",{className:"text-red-600 text-sm",children:f}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-red-600 text-white font-semibold",children:"Next"})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:te,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(oe,{})," Confirm Password"]}),e.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:R,onChange:s=>q(s.target.value),autoFocus:!0}),f&&e.jsx("div",{className:"text-red-600 text-sm",children:f}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:O,children:O?"Deleting...":"Confirm & Delete"})]})]})})]})}export{je as default};
