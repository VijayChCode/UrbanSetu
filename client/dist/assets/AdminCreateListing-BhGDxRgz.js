import{r as i,b as z,a as M,u as _,j as e,V as P}from"./index-crh2KQ3K.js";import{L as G}from"./LocationSelector-ch0Ubu6o.js";function Q(){const[a,c]=i.useState({imageUrls:[],name:"",description:"",propertyNumber:"",landmark:"",city:"",state:"",pincode:"",address:"",type:"sale",bedrooms:1,bathrooms:1,regularPrice:0,discountPrice:0,offer:!1,parking:!1,furnished:!1,locationLink:"",area:"",assignToEmail:""}),[f,n]=i.useState(""),[x,g]=i.useState(!1),[d,b]=i.useState({}),{currentUser:S}=z(s=>s.user),U=M(),k=_(),[p,h]=i.useState(""),[H,y]=i.useState(!1),[j,N]=i.useState([]),[L,m]=i.useState(!1),[v,T]=i.useState([]),[J,w]=i.useState(!1),[u,I]=i.useState({state:"",district:"",city:"",cities:[]}),R=()=>{var r;const s=(r=k.state)==null?void 0:r.from;return s||"/admin/my-listings"};i.useEffect(()=>{A()},[]);const A=async()=>{try{w(!0);const s=await fetch("/api/user/all-users-autocomplete",{credentials:"include"});if(s.ok){const r=await s.json();T(r)}else console.error("Failed to fetch users for autocomplete")}catch(s){console.error("Error fetching users:",s)}finally{w(!1)}};i.useEffect(()=>{c(s=>({...s,state:u.state,city:u.city||""}))},[u]),i.useEffect(()=>{if(a.assignToEmail.trim()){const s=v.filter(r=>r.email.toLowerCase().includes(a.assignToEmail.toLowerCase()));N(s),m(s.length>0)}else N([]),m(!1)},[a.assignToEmail,v]);const F=s=>{if(!s)return!0;try{new URL(s)}catch{return!1}return[".jpg",".jpeg",".png",".gif",".webp",".svg"].some(o=>s.toLowerCase().includes(o))||s.includes("images")||s.includes("img")},q=(s,r)=>{const t=[...a.imageUrls];t[s]=r,c({...a,imageUrls:t});const o={...d};r&&!F(r)?o[s]="Please enter a valid image URL":delete o[s],b(o)},E=s=>{c({...a,imageUrls:a.imageUrls.filter((t,o)=>o!==s)});const r={...d};delete r[s],b(r)},l=s=>{const{id:r,value:t,checked:o,type:B,name:O}=s.target;let C=B==="checkbox"?o:t;["regularPrice","discountPrice","bedrooms","bathrooms"].includes(r)&&(C=Number(t)),c({...a,[O||r]:C}),r==="assignToEmail"&&h("")},D=s=>{c({...a,assignToEmail:s}),m(!1),h("")},V=async s=>{if(!s.trim())return!0;try{return y(!0),!!(await fetch(`/api/user/validate-email/${encodeURIComponent(s.trim())}`,{credentials:"include"})).ok}catch{return!1}finally{y(!1)}},$=async s=>{if(s.preventDefault(),!a.type)return n("Please select a listing type (Sale or Rent)");if(a.imageUrls.length<1)return n("At least one image must be uploaded");if(a.regularPrice<a.discountPrice)return n("Discount price should be less than regular price");if(!a.propertyNumber)return n("Property number is required");if(!a.city)return n("City is required");if(!a.state)return n("State is required");if(!a.pincode)return n("Pincode is required");if(Object.keys(d).length>0)return n("Please fix the image URL errors before submitting");if(a.assignToEmail.trim()&&!await V(a.assignToEmail)){h("User not found with this email");return}g(!0),n("");try{console.log("Sending form data:",a);const r=await fetch("/api/listing/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,userRef:S._id})}),t=await r.json();if(g(!1),r.ok)a.assignToEmail.trim()?alert(`Property added successfully to ${a.assignToEmail}`):alert("Listing created under admin ownership"),U(R());else{const o=t.message||"Failed to create listing";n(o),P.error(o)}}catch(r){const t=r.message||"An error occurred while creating the listing";n(t),P.error(t),g(!1)}};return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:"Create a Listing (Admin)"}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Basic Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("input",{type:"text",id:"name",placeholder:"Property Name",required:!0,onChange:l,value:a.name,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("textarea",{id:"description",placeholder:"Property Description",required:!0,onChange:l,value:a.description,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mt-4 resize-y",rows:4})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"User Assignment"}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"assignToEmail",className:"block text-sm font-medium text-blue-700 mb-2",children:"Assign to (User Email - optional)"}),e.jsx("input",{type:"email",id:"assignToEmail",placeholder:"Enter user email to assign listing (leave empty for admin ownership)",onChange:l,value:a.assignToEmail,className:`w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${p?"border-red-500":"border-gray-300"}`,onFocus:()=>m(j.length>0),onBlur:()=>setTimeout(()=>m(!1),200)}),L&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:j.map(s=>e.jsxs("div",{className:"px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>D(s.email),children:[e.jsx("div",{className:"font-medium text-gray-800",children:s.email}),e.jsx("div",{className:"text-sm text-gray-500",children:s.username})]},s._id))}),p&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:p}),e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"ðŸ’¡ Tip: Start typing to see email suggestions. If left empty, the listing will be owned by the admin."})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Address Information"}),e.jsx("div",{className:"mb-4",children:e.jsx(G,{value:u,onChange:I,mode:"form"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",id:"propertyNumber",placeholder:"Property Number/Flat Number",required:!0,onChange:l,value:a.propertyNumber,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"landmark",placeholder:"Landmark (optional)",onChange:l,value:a.landmark,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"pincode",placeholder:"Pincode",required:!0,onChange:l,value:a.pincode,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"locationLink",placeholder:"Google Maps Location Link (Optional)",onChange:l,value:a.locationLink,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Type"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"radio",name:"type",value:"sale",onChange:l,checked:a.type==="sale",className:"text-blue-600"}),e.jsx("span",{className:"font-medium",children:"For Sale"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"radio",name:"type",value:"rent",onChange:l,checked:a.type==="rent",className:"text-blue-600"}),e.jsx("span",{className:"font-medium",children:"For Rent"})]})]}),a.type==="sale"&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Area (sq ft)"}),e.jsx("input",{type:"number",id:"area",placeholder:"Enter property area in square feet",onChange:l,value:a.area,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Bedrooms"}),e.jsx("input",{type:"number",id:"bedrooms",onChange:l,value:a.bedrooms,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Bathrooms"}),e.jsx("input",{type:"number",id:"bathrooms",onChange:l,value:a.bathrooms,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Regular Price (â‚¹)"}),e.jsx("input",{type:"number",id:"regularPrice",onChange:l,value:a.regularPrice,placeholder:"Enter price",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Discount Price (â‚¹)"}),e.jsx("input",{type:"number",id:"discountPrice",onChange:l,value:a.discountPrice,placeholder:"Enter discount",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Features"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["parking","furnished","offer"].map(s=>e.jsxs("label",{className:"flex items-center space-x-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"checkbox",id:s,onChange:l,checked:a[s],className:"text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium capitalize",children:s})]},s))})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Images"}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Add as many image URLs as you want. Use direct links to images (ending in .jpg, .png, .gif, etc.)"}),e.jsx("p",{className:"text-gray-500 text-xs mb-3",children:"ðŸ’¡ Tip: You can upload images to services like Imgur, Google Drive (with sharing enabled), or use any public image URL"}),e.jsxs("div",{className:"space-y-3",children:[a.imageUrls.map((s,r)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:`Image URL ${r+1} (e.g., https://example.com/image.jpg)`,value:s||"",onChange:t=>q(r,t.target.value),className:`w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${d[r]?"border-red-500":""}`}),e.jsx("button",{type:"button",onClick:()=>E(r),className:"bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition",title:"Remove this photo",children:"Ã—"}),d[r]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d[r]})]},r)),e.jsx("button",{type:"button",onClick:()=>c({...a,imageUrls:[...a.imageUrls,""]}),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2",children:"Add Photo"})]}),a.imageUrls.some(s=>s)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Image Preview:"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:a.imageUrls.map((s,r)=>s&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:"listing",className:"w-full h-24 object-cover rounded-lg",onError:t=>{t.target.src="https://via.placeholder.com/400x300?text=Image+Not+Found",t.target.className="w-full h-24 object-cover rounded-lg opacity-50"}}),e.jsx("button",{onClick:()=>E(r),type:"button",className:"absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 rounded-full hover:bg-red-600 transition",children:"Ã—"})]},s))})]})]}),e.jsx("button",{disabled:x,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white p-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Creating...":"Create Listing"}),f&&e.jsx("p",{className:"text-red-500 text-center",children:f})]})]})})}export{Q as default};
