import{g as Ee,r as l,j as e,x as ne,U as Pe,z as Ne,v as ve,A as he,B as Xe,C as Ae,D as Fe,E as Oe,y as p,b as Ve,G as Ze,H as He,t as Te,I as qe,J as Ke,K as Qe,M as es,O as ss,P as ts,Q as as,w as ns,u as rs,h as ls,R as os,L as Ue,S as is,T as ds,V as cs,W as ms,X as xs,Y as us,Z as hs,_ as gs,$ as ps,a0 as fs}from"./index-CQOyksa3.js";import{S as bs,N as ys,a as Ie}from"./navigation-DQTaFh6x.js";import{C as js}from"./ContactSupportWrapper-nHRiGCnk.js";import{R as Je}from"./ReviewForm-Cq7ONjsy.js";import{s as Be,m as ws,g as Me}from"./addressMasking-3vIUwCOC.js";const Ns="https://urbansetu.onrender.com";function ze({reviewId:f,onReplyAdded:v}){const{currentUser:j}=Ee(N=>N.user),[t,a]=l.useState(""),[b,E]=l.useState(!1),[P,I]=l.useState("");if(!j)return null;const B=async N=>{if(N.preventDefault(),!t.trim()){I("Reply cannot be empty");return}E(!0),I("");try{const k=await fetch(`${Ns}/api/review/reply/${f}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:t})}),S=await k.json();k.ok?(a(""),v&&v()):I(S.message||"Failed to add reply")}catch{I("Network error. Please try again.")}finally{E(!1)}};return e.jsxs("form",{onSubmit:B,className:"flex flex-col gap-2 mt-2",children:[e.jsx("textarea",{value:t,onChange:N=>a(N.target.value),rows:2,className:"w-full border border-gray-300 rounded p-2 text-sm",placeholder:"Write a reply...",disabled:b}),P&&e.jsx("div",{className:"text-red-600 text-xs",children:P}),e.jsx("button",{type:"submit",className:"self-end bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm",disabled:b||!t.trim(),children:b?"Replying...":"Reply"})]})}const $="https://urbansetu.onrender.com";function vs({listingId:f,onReviewDeleted:v,listingOwnerId:j}){const{currentUser:t}=Ee(s=>s.user),[a,b]=l.useState([]),[E,P]=l.useState(!0),[I,B]=l.useState(""),[N,k]=l.useState(null),[S,V]=l.useState("date"),[R,H]=l.useState("desc"),[Y,ee]=l.useState({}),[se,J]=l.useState({}),[te,_]=l.useState({}),[M,C]=l.useState({}),[L,A]=l.useState(null),[W,G]=l.useState(!1),[x,X]=l.useState(""),[F,O]=l.useState(null),[de,ce]=l.useState(""),[re,ge]=l.useState(!1),[me,le]=l.useState({}),[ae,ke]=l.useState({});l.useEffect(()=>{pe();const s=n=>{(n.listingId===f||n.listingId&&n.listingId._id===f)&&(b(d=>d.some(i=>i._id===n._id)?d.map(i=>i._id===n._id?n:i):[n,...d]),z(n._id))};ne.on("reviewUpdated",s);const r=({action:n,replies:d,reviewId:u,reply:i,replyId:h})=>{n==="updatedAll"&&u&&d?C(D=>({...D,[u]:d})):n==="deleted"&&u?z(u):i&&i.reviewId&&z(i.reviewId)};ne.on("reviewReplyUpdated",r);const o=n=>{console.log("[ReviewList] Received profileUpdated socket event:",n),console.log("[ReviewList] Current reviews:",a.length),b(d=>{const u=d.map(i=>i.userId===n.userId?(console.log("[ReviewList] Updating review:",i._id,"for user:",n.userId),{...i,userName:n.username,userAvatar:n.avatar}):i);return console.log("[ReviewList] Updated reviews:",u.length),u}),C(d=>{const u={...d};return Object.keys(u).forEach(i=>{var h;u[i]=(h=u[i])==null?void 0:h.map(D=>D.userId===n.userId?(console.log("[ReviewList] Updating reply:",D._id,"for user:",n.userId),{...D,userName:n.username,userAvatar:n.avatar}):D)}),u})};return ne.on("profileUpdated",o),console.log("[ReviewList] Socket listeners set up for profileUpdated"),ne.emit("testConnection",{message:"ReviewList component connected"},n=>{console.log("[ReviewList] Test socket response:",n)}),()=>{ne.off("reviewUpdated",s),ne.off("reviewReplyUpdated",r),ne.off("profileUpdated",o),console.log("[ReviewList] Socket listeners cleaned up"),document.body.style.overflow="unset"}},[f,S,R]),l.useEffect(()=>{t&&(b(s=>s.map(r=>r.userId===t._id?{...r,userName:t.username,userAvatar:t.avatar}:r)),C(s=>{const r={...s};return Object.keys(r).forEach(o=>{var n;r[o]=(n=r[o])==null?void 0:n.map(d=>d.userId===t._id?{...d,userName:t.username,userAvatar:t.avatar}:d)}),r}))},[t]),l.useEffect(()=>{const s=setInterval(async()=>{if(t)try{const r=await fetch(`${$}/api/user/id/${t._id}`);if(r.ok){const o=await r.json();(o.username!==t.username||o.avatar!==t.avatar)&&(console.log("[ReviewList] Profile updated via polling:",o),b(n=>n.map(d=>d.userId===o._id?{...d,userName:o.username,userAvatar:o.avatar}:d)),C(n=>{const d={...n};return Object.keys(d).forEach(u=>{var i;d[u]=(i=d[u])==null?void 0:i.map(h=>h.userId===o._id?{...h,userName:o.username,userAvatar:o.avatar}:h)}),d}))}}catch(r){console.error("[ReviewList] Error polling for profile updates:",r)}},3e4);return()=>clearInterval(s)},[t]);const pe=async()=>{try{const s=await fetch(`${$}/api/review/listing/${f}?sort=${S}&order=${R}`,{credentials:"include"}),r=await s.json();s.ok?b(r):B(r.message||"Failed to load reviews")}catch{B("Network error. Please try again.")}finally{P(!1)}},xe=async s=>{if(window.confirm("Are you sure you want to delete this review?"))try{const r=await fetch(`${$}/api/review/delete/${s}`,{method:"DELETE",credentials:"include"}),o=await r.json();r.ok?(b(a.filter(n=>n._id!==s)),v&&v(),p.success("Review deleted successfully")):p.error(o.message||"Failed to delete review")}catch{p.error("Network error. Please try again.")}},fe=s=>{k(s)},oe=()=>{k(null),pe()},be=async s=>{if(!t){p.info("Please sign in to vote on reviews");return}b(r=>r.map(o=>{var n;if(o._id===s){const d=(n=o.helpfulVotes)==null?void 0:n.some(h=>h.userId===t._id);let u,i=o.helpfulCount||0;return d?(u=o.helpfulVotes.filter(h=>h.userId!==t._id),i=Math.max(0,i-1)):(u=[...o.helpfulVotes||[],{userId:t._id}],i=i+1),{...o,helpfulVotes:u,helpfulCount:i}}return o}));try{const r=await fetch(`${$}/api/review/helpful/${s}`,{method:"POST",credentials:"include"})}catch{p.error("Network error. Please try again.")}},Se=async s=>{J(r=>({...r,[s]:!0})),_(r=>({...r,[s]:""}));try{const r=await fetch(`${$}/api/review/respond/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({ownerResponse:Y[s]})}),o=await r.json();r.ok?(b(n=>n.map(d=>d._id===s?{...d,ownerResponse:Y[s]}:d)),ee(n=>({...n,[s]:""}))):_(n=>({...n,[s]:o.message||"Failed to submit response"}))}catch{_(o=>({...o,[s]:"Network error. Please try again."}))}finally{J(r=>({...r,[s]:!1}))}},ue=s=>[...Array(5)].map((r,o)=>e.jsx(Ve,{className:`text-lg ${o<s?"text-yellow-400":"text-gray-300"}`},o)),Z=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),q=s=>{const o={pending:{color:"bg-yellow-100 text-yellow-800",icon:Te},approved:{color:"bg-green-100 text-green-800",icon:Te},rejected:{color:"bg-red-100 text-red-800",icon:He},removed:{color:"bg-gray-100 text-gray-800",icon:Ze}}[s];if(!o)return e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:s?s.charAt(0).toUpperCase()+s.slice(1):"Unknown"});const n=o.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.color}`,children:[e.jsx(n,{className:"mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},Re=s=>{var r;return t?(r=s.helpfulVotes)==null?void 0:r.some(o=>o.userId===t._id):!1},K=s=>S!==s?e.jsx(qe,{className:"text-gray-400"}):R==="desc"?e.jsx(Ke,{className:"text-blue-600"}):e.jsx(Qe,{className:"text-blue-600"}),Q=s=>{S===s?(H(R==="desc"?"asc":"desc"),p.info(`Sorted by ${s} (${R==="desc"?"ascending":"descending"})`)):(V(s),H("desc"),p.info(`Sorted by ${s} (descending)`))},z=async s=>{try{const r=await fetch(`${$}/api/review/reply/${s}`);if(r.ok){const o=await r.json();C(n=>({...n,[s]:o}))}}catch{}};l.useEffect(()=>{a.forEach(s=>z(s._id))},[a]);const ye=async(s,r,o)=>{var n,d,u;if(!t){p.info("Please sign in to vote on reviews");return}le(i=>({...i,[s]:!0}));try{const i=(n=M[o])==null?void 0:n.find(m=>m._id===s);let h=r;i&&(r==="like"?(d=i.likes)!=null&&d.includes(t==null?void 0:t._id)?(h="remove_like",C(m=>({...m,[o]:m[o].map(g=>g._id===s?{...g,likes:g.likes.filter(U=>U!==t._id)}:g)}))):C(m=>({...m,[o]:m[o].map(g=>{var U;return g._id===s?{...g,likes:[...g.likes||[],t._id],dislikes:(U=g.dislikes)==null?void 0:U.filter(ie=>ie!==t._id)}:g})})):r==="dislike"&&((u=i.dislikes)!=null&&u.includes(t==null?void 0:t._id)?(h="remove_dislike",C(m=>({...m,[o]:m[o].map(g=>g._id===s?{...g,dislikes:g.dislikes.filter(U=>U!==t._id)}:g)}))):C(m=>({...m,[o]:m[o].map(g=>{var U;return g._id===s?{...g,dislikes:[...g.dislikes||[],t._id],likes:(U=g.likes)==null?void 0:U.filter(ie=>ie!==t._id)}:g})}))));const D=await fetch(`${$}/api/review/reply/like/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:h})})}catch{p.error("Network error. Please try again.")}finally{le(i=>({...i,[s]:!1}))}},_e=async s=>{if(!t){p.info("Please sign in to vote on reviews");return}try{b(o=>o.map(n=>{var d;if(n._id===s){const u=(d=n.dislikes)==null?void 0:d.some(D=>D.userId===(t==null?void 0:t._id));let i,h=n.dislikeCount||0;return u?(i=n.dislikes.filter(D=>D.userId!==t._id),h=Math.max(0,h-1)):(i=[...n.dislikes||[],{userId:t._id}],h=h+1),{...n,dislikes:i,dislikeCount:h}}return n}));const r=await fetch(`${$}/api/review/dislike/${s}`,{method:"POST",credentials:"include"})}catch{p.error("Network error. Please try again.")}},je=s=>{A(s)},Ce=async()=>{!L||!L.comment.trim()||(await fetch(`${$}/api/review/reply/${L._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:L.comment})}),A(null))},Le=async s=>{window.confirm("Delete this reply?")&&await fetch(`${$}/api/review/reply/${s}`,{method:"DELETE",credentials:"include"})},De=s=>{G(s._id),X(s.ownerResponse||"")},c=async s=>{await Se(s),G(!1)},y=async s=>{window.confirm("Delete owner response?")&&(await fetch(`${$}/api/review/respond/${s}`,{method:"DELETE",credentials:"include"}),G(!1))},w=async(s,r)=>{if(!t){p.info("Please sign in to vote on reviews");return}b(o=>o.map(n=>{if(n._id===s){let d=n.ownerResponseLikes||[],u=n.ownerResponseDislikes||[];return r==="like"?d.includes(t._id)?d=d.filter(i=>i!==t._id):(d=[...d,t._id],u=u.filter(i=>i!==t._id)):r==="dislike"&&(u.includes(t._id)?u=u.filter(i=>i!==t._id):(u=[...u,t._id],d=d.filter(i=>i!==t._id))),{...n,ownerResponseLikes:d,ownerResponseDislikes:u}}return n}));try{await fetch(`${$}/api/review/respond/like/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:r})})}catch{}},T=s=>s&&(s.role==="admin"||s.role==="rootadmin"),We=s=>{O(s),ce(""),document.body.style.overflow="hidden"},Ye=async()=>{if(!de.trim()){p.info("Please provide a reason for reporting.");return}ge(!0);try{const s=await fetch(`${$}/api/review/report/${F._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:de})}),r=await s.json();s.ok?(p.success("Thank you for reporting. Our team will review this issue."),O(null),ce(""),document.body.style.overflow="unset"):p.error(r.message||"Failed to report issue.")}catch{p.error("Network error. Please try again.")}finally{ge(!1)}};return E?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading reviews..."})]}):I?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800",children:I})}):a.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"No reviews yet. Be the first to review this property!"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800",children:["Reviews (",a.filter(s=>s.status==="approved").length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),e.jsxs("button",{onClick:()=>Q("date"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Date ",K("date")]}),e.jsxs("button",{onClick:()=>Q("rating"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Rating ",K("rating")]}),e.jsxs("button",{onClick:()=>Q("helpful"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Helpful ",K("helpful")]})]})]}),a.filter(s=>s.status==="approved").map(s=>{var r,o,n,d,u,i,h,D;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[!T(s)&&e.jsx(Pe,{user:{username:s.userName,avatar:s.userAvatar},size:"w-10 h-10",textSize:"text-sm",showBorder:!1}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[T(s)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1",children:["From organization ",e.jsx(Ne,{className:"text-green-500"})]}):e.jsx("h4",{className:"font-semibold text-gray-800",children:s.userName}),(s.isVerified||s.verifiedByBooking)&&!T(s)&&e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(Ne,{className:"mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[ue(s.rating),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:[s.rating," star",s.rating>1?"s":""]})]})]})]}),t&&(t._id===s.userId||T(t))&&s.status!=="approved"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>fe(s),className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit review",children:e.jsx(ve,{})}),e.jsx("button",{onClick:()=>xe(s._id),className:"text-red-600 hover:text-red-800 p-1",title:"Delete review",children:e.jsx(he,{})})]})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:s.comment}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:Z(s.createdAt)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>be(s._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${Re(s)?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,disabled:s.status!=="approved",children:[e.jsx(Xe,{className:Re(s)?"text-blue-600":""}),e.jsx("span",{children:"Helpful"}),s.helpfulCount>0&&e.jsxs("span",{className:"ml-1",children:["(",s.helpfulCount,")"]})]}),e.jsxs("button",{onClick:()=>_e(s._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${(r=s.dislikes)!=null&&r.some(m=>m.userId===(t==null?void 0:t._id))?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("span",{role:"img","aria-label":"dislike",children:"👎"}),e.jsx("span",{children:"Dislike"}),s.dislikeCount>0&&e.jsxs("span",{className:"ml-1",children:["(",s.dislikeCount,")"]})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[q(s.status),s.verifiedByBooking&&e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded",children:"Booked this property"})]}),s.adminNote&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Admin Note:"})," ",s.adminNote]})}),s.ownerResponse&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-md border border-blue-200 flex justify-between items-center",children:[e.jsx("div",{className:"flex-1",children:W===s._id?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded-md p-2 text-sm mb-2",rows:"2",value:x,onChange:m=>X(m.target.value)}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm ml-2",onClick:()=>c(s._id),children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm ml-2",onClick:()=>G(!1),children:"Cancel"})]}):e.jsx(e.Fragment,{children:e.jsxs("p",{className:"text-sm text-blue-800 flex items-center gap-2",children:[e.jsx(Ae,{className:"inline-block text-blue-500"}),e.jsx("strong",{children:"Owner Response:"})," ",s.ownerResponse]})})}),t&&j&&t._id!==j&&!W&&e.jsxs("div",{className:"flex gap-2 ml-4 items-center",children:[e.jsxs("button",{onClick:()=>w(s._id,"like"),className:`flex items-center gap-1 ${(o=s.ownerResponseLikes)!=null&&o.includes(t._id)?"text-blue-600":"text-gray-500"}`,children:["👍 Like ",((n=s.ownerResponseLikes)==null?void 0:n.length)>0&&`(${s.ownerResponseLikes.length})`]}),e.jsxs("button",{onClick:()=>w(s._id,"dislike"),className:`flex items-center gap-1 ${(d=s.ownerResponseDislikes)!=null&&d.includes(t._id)?"text-red-600":"text-gray-500"}`,children:["👎 Dislike ",((u=s.ownerResponseDislikes)==null?void 0:u.length)>0&&`(${s.ownerResponseDislikes.length})`]})]}),t&&j&&t._id===j&&!W&&e.jsxs("span",{className:"flex gap-2 ml-2",children:[e.jsx(Fe,{className:"cursor-pointer text-blue-600",title:"Edit",onClick:()=>De(s)}),e.jsx(he,{className:"cursor-pointer text-red-600",title:"Delete",onClick:()=>y(s._id)})]})]}),e.jsxs("div",{className:"mt-4 ml-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(Ae,{className:"text-blue-500"}),"Replies (",((i=M[s._id])==null?void 0:i.length)||0,")"]}),((h=M[s._id])==null?void 0:h.length)>0&&e.jsxs("button",{onClick:()=>ke(m=>({...m,[s._id]:!m[s._id]})),className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center gap-1 transition-colors",children:[ae[s._id]?"Hide":"Show"," Replies",e.jsx("span",{className:`transform transition-transform duration-200 ${ae[s._id]?"rotate-180":""}`,children:"▼"})]})]}),ae[s._id]&&e.jsxs("div",{className:"space-y-3 animate-slideDown",children:[(D=M[s._id])==null?void 0:D.map(m=>{var g,U,ie,$e;return e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-white rounded-lg p-3 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!T(m)&&e.jsx(Pe,{user:{username:m.userName,avatar:m.userAvatar},size:"w-6 h-6",textSize:"text-xs",showBorder:!1}),T(m)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1 text-xs",children:["From organization ",e.jsx(Ne,{className:"text-green-500"})]}):e.jsx("span",{className:"font-medium text-gray-800 text-xs",children:m.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(m.createdAt).toLocaleString()}),t&&e.jsxs("div",{className:"flex gap-2 ml-auto",children:[(m.userId===t._id||T(t)&&T(m))&&e.jsx("button",{onClick:()=>je(m),className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Edit reply",children:e.jsx(Fe,{size:10})}),(m.userId===t._id||T(t))&&e.jsx("button",{onClick:()=>Le(m._id),className:"text-red-600 hover:text-red-800 transition-colors",title:"Delete reply",children:e.jsx(he,{size:10})})]})]}),L&&L._id===m._id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded p-2 text-sm",value:L.comment,onChange:Ge=>A({...L,comment:Ge.target.value}),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700 transition-colors",onClick:Ce,children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-600 transition-colors",onClick:()=>A(null),children:"Cancel"})]})]}):e.jsx("div",{className:"text-gray-700 text-sm leading-relaxed",children:m.comment}),e.jsxs("div",{className:"flex gap-3 mt-2 text-xs",children:[e.jsxs("button",{onClick:()=>ye(m._id,"like",s._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(g=m.likes)!=null&&g.includes(t==null?void 0:t._id)?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"}`,disabled:me[m._id],children:["👍 Like ",((U=m.likes)==null?void 0:U.length)>0&&`(${m.likes.length})`]}),e.jsxs("button",{onClick:()=>ye(m._id,"dislike",s._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(ie=m.dislikes)!=null&&ie.includes(t==null?void 0:t._id)?"bg-red-100 text-red-700":"text-gray-500 hover:bg-gray-100"}`,disabled:me[m._id],children:["👎 Dislike ",(($e=m.dislikes)==null?void 0:$e.length)>0&&`(${m.dislikes.length})`]})]})]},m._id)}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx(ze,{reviewId:s._id,onReplyAdded:()=>z(s._id)})})]}),(!M[s._id]||M[s._id].length===0)&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx(ze,{reviewId:s._id,onReplyAdded:()=>z(s._id)})})]}),t&&!T(t)&&e.jsxs("button",{className:"flex items-center gap-1 text-yellow-600 hover:text-yellow-800 text-xs mt-2",title:"Report an issue with this review",onClick:()=>We(s),children:[e.jsx(Oe,{className:"inline-block"}),"Report an Issue"]})]},s._id)}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Review"}),e.jsx(Je,{listingId:f,existingReview:N,onReviewSubmitted:oe}),e.jsx("button",{onClick:()=>k(null),className:"mt-4 w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-yellow-700",children:[e.jsx(Oe,{})," Report an Issue"]}),e.jsx("p",{className:"mb-2 text-gray-700",children:"Please describe the issue with this review:"}),e.jsx("textarea",{className:"w-full border border-yellow-300 rounded-md p-2 text-sm mb-2",rows:"3",value:de,onChange:s=>ce(s.target.value),placeholder:"Enter reason (required)"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm",onClick:()=>{O(null),document.body.style.overflow="unset"},disabled:re,children:"Cancel"}),e.jsx("button",{className:"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 text-sm",onClick:Ye,disabled:re,children:re?"Reporting...":"Submit Report"})]})]})})]})}const ks=`
  @keyframes slideDown {
    from { 
      opacity: 0; 
      transform: translateY(-10px);
    }
    to { 
      opacity: 1; 
      transform: translateY(0);
    }
  }
  .animate-slideDown {
    animation: slideDown 0.3s ease-out;
  }
`;if(typeof document<"u"){const f=document.createElement("style");f.textContent=ks,document.head.appendChild(f)}const Ss=({isOpen:f,onClose:v,images:j,initialIndex:t=0})=>{const[a,b]=l.useState(t),[E,P]=l.useState(1),[I,B]=l.useState(0),[N,k]=l.useState({x:0,y:0}),[S,V]=l.useState(!1),[R,H]=l.useState({x:0,y:0}),Y=l.useRef(null);l.useEffect(()=>{f&&(b(t),P(1),B(0),k({x:0,y:0}))},[f,t]),l.useEffect(()=>{const x=F=>{if(f)switch(F.key){case"Escape":v();break;case"ArrowLeft":b(O=>O>0?O-1:j.length-1);break;case"ArrowRight":b(O=>O<j.length-1?O+1:0);break;case"+":case"=":F.preventDefault(),ee();break;case"-":F.preventDefault(),se();break;case"0":J();break}},X=F=>{f&&(F.preventDefault(),F.deltaY<0?ee():se())};return document.addEventListener("keydown",x),document.addEventListener("wheel",X,{passive:!1}),()=>{document.removeEventListener("keydown",x),document.removeEventListener("wheel",X)}},[f,j.length,v]),l.useEffect(()=>(f?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[f]);const ee=()=>{P(x=>Math.min(x*1.2,5))},se=()=>{P(x=>Math.max(x/1.2,.1))},J=()=>{P(1),B(0),k({x:0,y:0})},te=()=>{B(x=>x+90)},_=x=>{E>1&&(V(!0),H({x:x.clientX-N.x,y:x.clientY-N.y}))},M=x=>{S&&E>1&&k({x:x.clientX-R.x,y:x.clientY-R.y})},C=()=>{V(!1)},L=x=>{E>1&&x.touches.length===1&&(V(!0),H({x:x.touches[0].clientX-N.x,y:x.touches[0].clientY-N.y}))},A=x=>{S&&E>1&&x.touches.length===1&&(x.preventDefault(),k({x:x.touches[0].clientX-R.x,y:x.touches[0].clientY-R.y}))},W=()=>{V(!1)},G=()=>{const x=document.createElement("a");x.href=j[a],x.download=`property-image-${a+1}.jpg`,document.body.appendChild(x),x.click(),document.body.removeChild(x)};return!f||!j||j.length===0?null:e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",onMouseMove:M,onMouseUp:C,onMouseLeave:C,children:[e.jsx("button",{onClick:v,className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-2",children:e.jsx(He,{size:24})}),j.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>b(x=>x>0?x-1:j.length-1),className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-3",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>b(x=>x<j.length-1?x+1:0),className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-3",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"relative max-w-full max-h-full overflow-hidden",children:e.jsx("img",{ref:Y,src:j[a],alt:`Property image ${a+1}`,className:"max-w-full max-h-full object-contain cursor-move",style:{transform:`scale(${E}) rotate(${I}deg) translate(${N.x}px, ${N.y}px)`,transition:S?"none":"transform 0.1s ease-out"},onMouseDown:_,onTouchStart:L,onTouchMove:A,onTouchEnd:W,draggable:!1})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-2 bg-black bg-opacity-50 rounded-lg p-2",children:[e.jsx("button",{onClick:ee,className:"text-white hover:text-gray-300 p-2 rounded",title:"Zoom In (Ctrl + +)",children:e.jsx(es,{size:16})}),e.jsx("button",{onClick:se,className:"text-white hover:text-gray-300 p-2 rounded",title:"Zoom Out (Ctrl + -)",children:e.jsx(ss,{size:16})}),e.jsx("button",{onClick:te,className:"text-white hover:text-gray-300 p-2 rounded",title:"Rotate",children:e.jsx(ts,{size:16})}),e.jsx("button",{onClick:J,className:"text-white hover:text-gray-300 p-2 rounded",title:"Reset (0)",children:e.jsx("span",{className:"text-sm font-bold",children:"0"})}),e.jsx("button",{onClick:G,className:"text-white hover:text-gray-300 p-2 rounded",title:"Download",children:e.jsx(as,{size:16})})]}),j.length>1&&e.jsxs("div",{className:"absolute top-4 left-4 text-white bg-black bg-opacity-50 rounded-lg px-3 py-1",children:[a+1," / ",j.length]}),e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 rounded-lg px-3 py-1",children:[Math.round(E*100),"%"]}),e.jsx("div",{className:"absolute bottom-16 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 rounded-lg px-4 py-2 text-sm max-w-xs",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"hidden sm:block",children:"Use mouse wheel or +/- to zoom"}),e.jsx("div",{className:"hidden sm:block",children:"Drag to pan • Use close icon to exit"}),e.jsx("div",{className:"hidden sm:block",children:"Arrow keys to navigate • ESC to close"}),e.jsx("div",{className:"sm:hidden",children:"Tap to zoom • Swipe to navigate"}),e.jsx("div",{className:"sm:hidden",children:"Pinch to zoom • Use close icon to exit"})]})})]})},we="https://urbansetu.onrender.com";function Es(){const f=ns(),v=rs(),j=ls(),{currentUser:t}=Ee(c=>c.user),[a,b]=l.useState(null),[E,P]=l.useState(!1),[I,B]=l.useState(!0),[N,k]=l.useState(!1),[S,V]=l.useState(""),[R,H]=l.useState(!1),[Y,ee]=l.useState(""),[se,J]=l.useState(!1),[te,_]=l.useState(""),{addToWishlist:M,removeFromWishlist:C,isInWishlist:L}=os(),[A,W]=l.useState(null),[G,x]=l.useState(!1),[X,F]=l.useState(""),[O,de]=l.useState(!1),[ce,re]=l.useState(!1),[ge,me]=l.useState(0),[le,ae]=l.useState(!1),[ke,pe]=l.useState([]),[xe,fe]=l.useState(!1),[oe,be]=l.useState(""),[Se,ue]=l.useState({isActive:!1,owner:null});l.useEffect(()=>(N||R||le?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[N,R,le]);const Z=(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="rootadmin",q=j.pathname.includes("/admin"),K=t?q?{path:"/admin",text:"Back to Dashboard"}:{path:"/user",text:"Back to Home"}:{path:"/",text:"Back to Home"},Q=c=>`₹${Number(c).toLocaleString("en-IN")}`,z=()=>a.offer&&a.regularPrice&&a.discountPrice?Math.round((a.regularPrice-a.discountPrice)/a.regularPrice*100):0,ye=()=>{V(""),_(""),k(!0)},_e=c=>{if(c.preventDefault(),!S.trim()){_("Reason is required");return}k(!1),_(""),H(!0)},je=c=>{console.log("Image clicked:",c),me(c),re(!0)},Ce=async c=>{if(c.preventDefault(),!Y){_("Password is required");return}J(!0),_("");try{if(!(await fetch(`/api/user/verify-password/${t._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Y})})).ok){_("Incorrect password. Property not deleted."),J(!1);return}const w=await fetch(`/api/listing/delete/${a._id}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:S})});if(w.ok)p.success("Property deleted successfully!"),H(!1),v("/admin/listings");else{const T=await w.json();_(T.message||"Failed to delete property.")}}catch{_("An error occurred while deleting the property.")}finally{J(!1)}},Le=async()=>{try{const c=await fetch(`${we}/api/user/all-users-autocomplete`,{credentials:"include"});if(c.ok){const y=await c.json();pe(y)}else console.error("Failed to fetch available users")}catch(c){console.error("Error fetching available users:",c)}},De=async()=>{if(!oe){p.error("Please select a new owner");return}fe(!0);try{const c=await fetch(`${we}/api/listing/reassign-owner/${a._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({newOwnerId:oe})});if(c.ok){const y=await c.json();p.success(y.message||"Property owner assigned successfully!"),ae(!1),be(""),window.location.reload()}else{const y=await c.json();p.error(y.message||"Failed to assign new owner")}}catch(c){console.error("Error assigning new owner:",c),p.error("An error occurred while assigning new owner")}finally{fe(!1)}};return l.useEffect(()=>{(async()=>{B(!0);try{const w=await(await fetch(`${we}/api/listing/get/${f.listingId}`)).json();if(w.success===!1){console.log(w.message);return}b(w)}catch(y){console.error("Error fetching listing:",y)}finally{B(!1)}})()},[f.listingId]),l.useEffect(()=>{(async()=>{if(a&&a.userRef){x(!0),F("");try{const y=await fetch(`${we}/api/user/id/${a.userRef}`);if(!y.ok)throw new Error("Failed to fetch owner details");const w=await y.json();W(w),ue({isActive:!0,owner:w})}catch{F("Could not load owner details"),W(null),ue({isActive:!1,owner:null})}finally{x(!1)}}else W(null),ue({isActive:!1,owner:null})})()},[a]),I?e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-3 text-lg font-semibold text-blue-600",children:"Loading property details..."})]})})}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl w-full mx-auto bg-white rounded-xl shadow-lg p-3 sm:p-6 relative overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:()=>v(K.path),className:"bg-gradient-to-r from-gray-500 to-gray-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(is,{})," ",K.text]})}),Z&&q&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs(Ue,{to:`/admin/update-listing/${a._id}`,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(ve,{})," Edit Property"]}),e.jsxs("button",{onClick:ye,className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(he,{})," Delete Property"]})]})]}),e.jsxs("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:["Property Details ",Z&&q&&"(Admin View)"]}),e.jsx("div",{className:"relative mb-6",children:e.jsx(bs,{navigation:!0,modules:[ys],className:"rounded-lg overflow-hidden relative",onSlideChange:c=>{me(c.activeIndex)},children:a.imageUrls&&a.imageUrls.length>0?a.imageUrls.map((c,y)=>e.jsx(Ie,{children:e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:c,alt:`${a.name} - Image ${y+1}`,className:"w-full h-40 sm:h-64 md:h-96 object-cover transition-transform duration-200 group-hover:scale-105",onError:w=>{w.target.src="https://via.placeholder.com/800x600?text=Image+Not+Available",w.target.className="w-full h-40 sm:h-64 md:h-96 object-cover opacity-50"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"bg-white bg-opacity-90 rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx(ds,{className:"text-gray-700"})})}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"Click to expand"}),e.jsx("button",{className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onClick:w=>{w.preventDefault(),w.stopPropagation(),je(y)},onTouchEnd:w=>{w.preventDefault(),w.stopPropagation(),je(y)},"aria-label":`Expand image ${y+1}`})]})},y)):e.jsx(Ie,{children:e.jsx("div",{className:"w-full h-64 md:h-96 bg-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🏠"}),e.jsx("p",{className:"text-lg",children:"No images available"})]})})})})}),e.jsx("div",{className:"flex justify-end items-center space-x-4 mb-4 pr-2",children:e.jsx(cs,{className:"cursor-pointer text-gray-500 hover:text-gray-700 text-xl",onClick:()=>{navigator.clipboard.writeText(window.location.href),P(!0),setTimeout(()=>P(!1),2e3)}})}),E&&e.jsx("p",{className:"text-green-500 text-sm text-center mb-4",children:"Link copied!"}),e.jsxs("div",{className:"p-3 sm:p-6 bg-gray-50 shadow-md rounded-lg mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl md:text-3xl font-bold text-gray-800 break-words flex items-center gap-2",children:[a.name,e.jsx("button",{onClick:()=>{if(!t){p.info("Please sign in to add properties to your wishlist."),v("/sign-in");return}L(a._id)?C(a._id):M(a)},className:`ml-2 p-2 rounded-full transition z-20 ${L(a._id)?"bg-red-500 text-white":"bg-gray-200 text-red-500 hover:text-red-600"} focus:outline-none`,title:L(a._id)?"Remove from wishlist":"Add to wishlist",style:{lineHeight:0},children:e.jsx(ms,{className:"text-base sm:text-lg"})})]}),a.offer&&z()>0&&e.jsxs("span",{className:"bg-yellow-400 text-gray-900 text-sm font-semibold px-4 py-1 rounded-full shadow-md animate-pulse w-max sm:w-auto ml-0 sm:ml-2 mt-2 sm:mt-0",style:{alignSelf:"flex-start"},title:"Limited-time offer!",children:[z(),"% OFF"]})]}),e.jsx("div",{className:"mb-4",children:a.offer&&z()>0?e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[Q(a.discountPrice),a.type==="rent"&&" / month"]}),e.jsx("p",{className:"text-base sm:text-xl text-gray-500 line-through",children:Q(a.regularPrice)}),e.jsxs("span",{className:"text-xs sm:text-sm text-green-600 font-semibold",children:["Save ",Q(a.regularPrice-a.discountPrice)]})]}):e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[Q(a.regularPrice),a.type==="rent"&&" / month"]})}),e.jsxs("p",{className:"flex items-center text-gray-600 mb-4",children:[e.jsx(xs,{className:"mr-2 text-red-500"}),ws(a.propertyNumber||a.city?{propertyNumber:a.propertyNumber,landmark:a.landmark,city:a.city,district:a.district,state:a.state,pincode:a.pincode}:a.address,!!t)]}),a.locationLink&&Be(!!t)&&e.jsx("div",{className:"mb-4",children:e.jsx("a",{href:a.locationLink,rel:"noopener noreferrer",className:"inline-block bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:Me(!!t)})}),a.locationLink&&!Be(!!t)&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>v("/sign-in"),className:"inline-block bg-gradient-to-r from-gray-500 to-gray-600 text-white px-6 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:Me(!!t)})}),e.jsx("div",{className:"flex space-x-4 mb-4",children:e.jsx("span",{className:`px-3 py-1 text-white rounded-md ${a.type==="rent"?"bg-blue-500":"bg-green-500"}`,children:a.type==="rent"?"For Rent":"For Sale"})}),e.jsxs("p",{className:"text-gray-700 mb-4 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Description:"})," ",a.description]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(us,{className:"mr-2 text-blue-500"})," ",a.bedrooms," ",a.bedrooms>1?"beds":"bed"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(hs,{className:"mr-2 text-blue-500"})," ",a.bathrooms," ",a.bathrooms>1?"baths":"bath"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(gs,{className:"mr-2 text-blue-500"})," ",a.parking?"Parking":"No Parking"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ps,{className:"mr-2 text-blue-500"})," ",a.furnished?"Furnished":"Unfurnished"]})]})]}),Z&&q&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 bg-blue-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-blue-800 mb-4",children:"Admin Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Property ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.createdAt).toLocaleDateString("en-GB")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Updated"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.updatedAt).toLocaleDateString("en-GB")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created By"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a.userRef||"Unknown"})]})]})]}),e.jsxs("div",{className:"p-6 bg-green-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-green-800 mb-4",children:"Property Owner Details"}),G?e.jsx("p",{className:"text-gray-500",children:"Loading owner details..."}):A&&Se.isActive?e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Name"}),e.jsx("p",{className:"font-semibold text-gray-800",children:A.username})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Email"}),e.jsx("p",{className:"font-semibold text-gray-800",children:A.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Mobile Number"}),e.jsx("p",{className:"font-semibold text-gray-800",children:A.mobileNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:A._id})]})]}),Z&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-blue-700 text-sm font-medium",children:"ℹ️ Owner account is active and accessible. No reassignment needed."})})]}):X?e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2",children:[e.jsx("p",{className:"text-red-500",children:X}),Z&&e.jsxs("button",{onClick:()=>{Le(),ae(!0)},className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(ve,{})," Assign New Owner"]})]}):e.jsx("p",{className:"text-gray-500",children:"No owner details found."})]})]}),t&&(a.sellerId===t._id||a.userRef===t._id)&&!(Z&&q)&&e.jsxs("div",{className:"p-6 bg-gray-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-4",children:"Additional Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.createdAt).toLocaleDateString("en-GB")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Updated"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.updatedAt).toLocaleDateString("en-GB")})]})]})]}),e.jsx("div",{className:"flex justify-center",children:t&&(a.sellerId===t._id||a.userRef===t._id)?e.jsx("div",{className:"text-red-500 font-semibold text-lg py-3",children:"You cannot book an appointment for your own property."}):e.jsx("button",{onClick:()=>{if(!t){p.info("Please sign in to book appointments."),v("/sign-in");return}const c=q?`/admin/appointmentlisting?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`:`/user/appointment?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`;v(c)},className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:"📅 Book Appointment"})}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("button",{onClick:()=>de(c=>!c),className:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white px-6 py-2 rounded-lg shadow font-semibold flex items-center gap-2 hover:from-yellow-500 hover:to-yellow-700 transition-all",children:[O?"Hide Reviews":"Show Reviews",a.reviewCount>0&&e.jsx("span",{className:"ml-2 bg-white text-yellow-700 rounded-full px-2 py-0.5 text-xs font-bold",children:a.reviewCount})]})}),O&&e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"border-t border-gray-200 pt-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h3",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[e.jsx(Ve,{className:"text-yellow-500 mr-2"}),"Reviews",a.averageRating>0&&e.jsxs("span",{className:"ml-2 text-lg text-gray-600",children:["(",a.averageRating.toFixed(1)," ⭐ • ",a.reviewCount," review",a.reviewCount!==1?"s":"",")"]})]})}),e.jsx(Je,{listingId:a._id,onReviewSubmitted:()=>{window.location.reload()}}),e.jsx(vs,{listingId:a._id,onReviewDeleted:()=>{window.location.reload()},listingOwnerId:a.userRef})]})})]})}),e.jsx(js,{}),N&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:_e,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(he,{})," Reason for Deletion"]}),e.jsx("textarea",{className:"border rounded p-2 w-full",placeholder:"Enter reason for deleting this property",value:S,onChange:c=>V(c.target.value),rows:3,autoFocus:!0}),te&&e.jsx("div",{className:"text-red-600 text-sm",children:te}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>k(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-red-600 text-white font-semibold",children:"Next"})]})]})}),R&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:Ce,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(fs,{})," Confirm Password"]}),e.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:Y,onChange:c=>ee(c.target.value),autoFocus:!0}),te&&e.jsx("div",{className:"text-red-600 text-sm",children:te}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>H(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:se,children:se?"Deleting...":"Confirm & Delete"})]})]})}),a&&a.imageUrls&&a.imageUrls.length>0&&e.jsx(Ss,{isOpen:ce,onClose:()=>re(!1),images:a.imageUrls,initialIndex:ge}),le&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(ve,{})," Assign New Owner"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a user to assign as the new owner of this property."}),e.jsxs("select",{className:"border rounded p-2 w-full",value:oe,onChange:c=>be(c.target.value),disabled:xe,children:[e.jsx("option",{value:"",children:"Select a user"}),ke.map(c=>e.jsxs("option",{value:c._id,children:[c.username," (",c.email,")"]},c._id))]}),xe&&e.jsx("p",{className:"text-gray-500",children:"Assigning new owner..."}),oe&&!xe&&e.jsxs("button",{onClick:De,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(Ne,{})," Confirm Assignment"]}),e.jsx("button",{onClick:()=>ae(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"})]})})]}):e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-red-600 mb-4",children:"Property Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The property you're looking for doesn't exist or has been removed."}),e.jsx(Ue,{to:K.path,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold",children:K.text})]})})})}export{Es as default};
