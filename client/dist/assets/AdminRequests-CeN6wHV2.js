import{r,g as N,u as v,j as e,C as w,y as n}from"./index-C9O64TOP.js";const x="https://urbansetu.onrender.com",R=()=>{const[i,l]=r.useState([]),[p,u]=r.useState(!0),[h,g]=r.useState(null),{currentUser:s}=N(t=>t.user),o=v();r.useEffect(()=>{if(console.log("=== AdminRequests Page Debug ==="),console.log("Current User:",s),console.log("User Email:",s==null?void 0:s.email),console.log("User Role:",s==null?void 0:s.role),console.log("Is Default Admin:",s==null?void 0:s.isDefaultAdmin),console.log("================================"),!s){console.log("No current user yet, waiting...");return}if(s.role!=="admin"&&s.role!=="rootadmin"&&!s.isDefaultAdmin){console.log("User is not admin or rootadmin, redirecting..."),o("/sign-in");return}console.log("User is default admin, fetching requests..."),f()},[s,o]);const f=async()=>{try{u(!0);const t=await fetch(`${x}/api/admin/pending-requests`,{headers:{"Content-Type":"application/json"},credentials:"include"}),a=await t.json();if(!t.ok)throw new Error(a.message||"Failed to fetch requests");l(a)}catch(t){g(t.message)}finally{u(!1)}},j=async t=>{try{const a=await fetch(`${x}/api/admin/approve/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentUserId:s._id,rootAdminPassword:"Salendra@2004"})}),d=await a.json();if(!a.ok)throw new Error(d.message||"Failed to approve request");l(c=>c.filter(m=>m._id!==t)),n.success("Admin request approved successfully!")}catch(a){n.error(a.message)}},b=async t=>{try{const a=await fetch(`${x}/api/admin/reject/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentUserId:s._id,rootAdminPassword:"Salendra@2004"})}),d=await a.json();if(!a.ok)throw new Error(d.message||"Failed to reject request");l(c=>c.filter(m=>m._id!==t)),n.success("Admin request rejected successfully!")}catch(a){n.error(a.message)}},y=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return s?p?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading admin requests..."})]})}):(console.log("Final check - User email:",s.email),console.log("Final check - Is default admin:",s.isDefaultAdmin),s.isDefaultAdmin||s.role==="rootadmin"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Requests"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage pending admin approval requests (Root Admin Only)"}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Welcome, ",s.email," (Root Admin)"]})]}),e.jsxs("div",{className:"bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium",children:[i.length," Pending"]})]}),h&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:h}),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Pending Requests"}),e.jsx("p",{className:"text-gray-600",children:"All admin requests have been processed."})]}):e.jsx("div",{className:"space-y-6",children:i.map(t=>e.jsx("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:t.username.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.username}),e.jsx("p",{className:"text-gray-600",children:t.email}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Requested: ",y(t.adminRequestDate)]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-3 w-full sm:w-auto mt-4 sm:mt-0",children:[e.jsxs("button",{onClick:()=>j(t._id),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2 w-full sm:w-auto justify-center",children:[e.jsx("span",{children:"âœ“"}),e.jsx("span",{children:"Approve"})]}),e.jsxs("button",{onClick:()=>b(t._id),className:"bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2 w-full sm:w-auto justify-center",children:[e.jsx("span",{children:"âœ•"}),e.jsx("span",{children:"Reject"})]})]})]})},t._id))})]})})}),e.jsx(w,{})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"ðŸš«"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"Only the default admin or root admin can approve new admin requests."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current user: ",s.email]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:()=>o("/admin"),className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2 text-base mx-auto",children:"Back to Dashboard"})})]})})})})):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})};export{R as default};
