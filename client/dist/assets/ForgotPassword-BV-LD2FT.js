import{r as a,u as ae,h as re,g as le,j as e,N as ne,t as L,v as ie,L as Y,l as H,m as Z}from"./index-NZVv29Xq.js";import{C as oe}from"./ContactSupportWrapper-BiQ0K4_o.js";const C="https://urbansetu.onrender.com";function he({bootstrapped:I,sessionChecked:k}){const[_,F]=a.useState(1),[r,D]=a.useState({email:"",mobileNumber:"",newPassword:"",confirmPassword:"",userId:""}),[n,Q]=a.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,specialChar:!1}),[E,W]=a.useState(!1),[R,G]=a.useState(!1),[g,m]=a.useState(""),[V,h]=a.useState(""),[p,d]=a.useState(!1),u=ae(),c=re(),{currentUser:b}=le(s=>s.user),[w,O]=a.useState(""),[y,T]=a.useState(!1),[j,A]=a.useState(!1),[U,$]=a.useState(!1),[N,o]=a.useState(""),[l,z]=a.useState(!1),[x,M]=a.useState(!1),[f,v]=a.useState(0),[q,P]=a.useState(!0);a.useEffect(()=>{new URLSearchParams(c.search).get("step")==="2"&&F(2)},[c.search]),a.useEffect(()=>{let s=null;return f>0&&(s=setInterval(()=>{v(t=>t<=1?(P(!0),0):t-1)},1e3)),()=>{s&&clearInterval(s)}},[f]),a.useEffect(()=>{const s=J=>{new URLSearchParams(c.search).get("step")==="2"&&sessionStorage.setItem("resetPasswordInterrupted","true")},t=J=>{new URLSearchParams(c.search).get("step")};return sessionStorage.getItem("resetPasswordInterrupted")==="true"&&(sessionStorage.removeItem("resetPasswordInterrupted"),new URLSearchParams(c.search).get("step")),window.addEventListener("beforeunload",s),window.addEventListener("popstate",t),()=>{window.removeEventListener("beforeunload",s),window.removeEventListener("popstate",t)}},[c.search,r.userId,u]),a.useEffect(()=>()=>{new URLSearchParams(c.search).get("step")==="2"&&sessionStorage.setItem("resetPasswordInterrupted","true")},[c.search]),a.useEffect(()=>{I&&k&&b&&(b.role==="admin"||b.role==="rootadmin"?u("/admin",{replace:!0}):u("/user",{replace:!0}))},[I,k,b,u]);const K=s=>{const t={length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/[0-9]/.test(s),specialChar:/[^A-Za-z0-9]/.test(s)};Q(t)},S=s=>{const{id:t,value:i}=s.target;D({...r,[t]:i}),t==="email"&&(x?(z(!1),T(!1),O(""),o(""),v(0),P(!0),M(!1)):l||(T(!1),O(""),o(""),v(0),P(!0))),t==="newPassword"&&K(i)},B=async()=>{if(!r.email){o("Please enter an email address first");return}if(q){A(!0),o("");try{const t=await(await fetch(`${C}/api/auth/send-forgot-password-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r.email})})).json();t.success?(T(!0),h("OTP sent successfully to your email"),setTimeout(()=>h(""),3e3),v(30),P(!1)):o(t.message)}catch{o("Failed to send OTP. Please try again.")}finally{A(!1)}}},X=async()=>{if(!w){o("Please enter the OTP");return}$(!0),o("");try{const t=await(await fetch(`${C}/api/auth/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r.email,otp:w})})).json();t.success&&t.type==="forgotPassword"?(z(!0),D(i=>({...i,userId:t.userId})),h("Email verified successfully!"),setTimeout(()=>h(""),3e3)):o(t.message)}catch{o("Failed to verify OTP. Please try again.")}finally{$(!1)}},ee=async s=>{if(s.preventDefault(),!l){m("Please verify your email with OTP before proceeding.");return}d(!0),m("");try{const i=await(await fetch(`${C}/api/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r.email,mobileNumber:r.mobileNumber})})).json();i.success===!1?(m(i.message),d(!1)):(F(2),u("/forgot-password?step=2",{replace:!0}),d(!1))}catch{m("Something went wrong. Please try again."),d(!1)}},se=async s=>{if(s.preventDefault(),d(!0),m(""),r.newPassword!==r.confirmPassword){m("Passwords do not match"),d(!1);return}try{const i=await(await fetch(`${C}/api/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r.userId,newPassword:r.newPassword,confirmPassword:r.confirmPassword})})).json();i.success===!1?(m(i.message),d(!1)):(h("Password reset successful. You can now log in."),setTimeout(()=>{u("/sign-in")},2e3),d(!1))}catch{m("Something went wrong. Please try again."),d(!1)}};return new URLSearchParams(c.search).get("step")==="2"&&!r.userId?e.jsx(ne,{}):_===1?e.jsxs("div",{className:"min-h-screen flex",children:[e.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-orange-600 to-red-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),e.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Reset Your Password"}),e.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:`"Don't worry, we've got you covered. Let's get you back to finding your dream home."`}),e.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Secure Password Reset"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("span",{children:"Quick & Easy Process"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),e.jsx("span",{children:"Back to Your Account"})]})]})]})}),e.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),e.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20 flex items-center justify-center",children:e.jsx("svg",{className:"w-16 h-16 text-white opacity-30",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-4 sm:p-8 bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2",children:"Forgot Password"}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:"Enter your registered email and mobile number to reset your password."})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-4 sm:p-8 border border-gray-100",children:[e.jsxs("form",{onSubmit:ee,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:["Registered Email",l&&e.jsx("span",{className:"ml-2 text-green-600",children:e.jsx(L,{className:"inline"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",placeholder:"Enter your email",id:"email",value:r.email,onChange:S,readOnly:l&&!x,className:`w-full px-4 py-3 pr-24 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200 ${l&&!x?"bg-gray-100 cursor-not-allowed border-green-500":l?"border-green-500":"border-gray-300"}`,required:!0}),!l&&!y&&!x&&e.jsx("button",{type:"button",onClick:B,disabled:j||!r.email||!q,className:"absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1 bg-orange-600 text-white rounded-md text-sm font-medium hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Sending...":"Send OTP"}),l&&!x&&e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>M(!0),className:"text-blue-600 hover:text-blue-800 transition-colors duration-200 p-1 rounded hover:bg-blue-50",title:"Edit email",children:e.jsx(ie,{className:"text-sm"})}),e.jsx("div",{className:"text-green-600",children:e.jsx(L,{className:"text-xl"})})]}),l&&x&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"text-green-600",children:e.jsx(L,{className:"text-xl"})})})]}),y&&!l&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["OTP sent to ",r.email]}),N&&!y&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:N})]}),y&&!l&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"otp",className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter OTP"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter 6-digit OTP",id:"otp",value:w,onChange:s=>O(s.target.value),maxLength:"6",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"}),e.jsx("button",{type:"button",onClick:X,disabled:U||!w,className:"w-full sm:w-auto px-4 py-3 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:U?"Verifying...":"Verify OTP"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Enter the 6-digit code sent to your email"}),e.jsx("div",{className:"flex items-center gap-2",children:f>0?e.jsxs("span",{className:"text-xs text-gray-500",children:["Resend in ",Math.floor(f/60),":",(f%60).toString().padStart(2,"0")]}):e.jsx("button",{type:"button",onClick:B,disabled:j,className:"text-xs text-orange-600 hover:text-orange-800 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Sending...":"Resend OTP"})})]}),N&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:N})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mobileNumber",className:"block text-sm font-medium text-gray-700 mb-2",children:"Registered Mobile Number"}),e.jsx("input",{type:"tel",placeholder:"Enter 10-digit mobile number",id:"mobileNumber",value:r.mobileNumber,onChange:S,pattern:"[0-9]{10}",maxLength:"10",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200",required:!0})]}),e.jsx("button",{disabled:p||!l,className:"w-full py-3 px-4 bg-gradient-to-r from-orange-600 to-red-600 text-white font-semibold rounded-lg hover:from-orange-700 hover:to-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:p?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Verifying..."]}):"Verify Account"}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:g})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Remember your password?"," ",e.jsx(Y,{to:"/sign-in",className:"text-orange-600 hover:text-orange-800 font-semibold hover:underline transition-colors duration-200",children:"Sign In"})]})})]})]})}),e.jsx(oe,{})]}):e.jsxs("div",{className:"min-h-screen flex",children:[e.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-green-600 to-teal-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),e.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Create New Password"}),e.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:'"A strong password is your first line of defense. Make it count!"'}),e.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Strong & Secure"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("span",{children:"Easy to Remember"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),e.jsx("span",{children:"Ready to Use"})]})]})]})}),e.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),e.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20 flex items-center justify-center",children:e.jsx("svg",{className:"w-16 h-16 text-white opacity-30",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8 bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Reset Password"}),e.jsx("p",{className:"text-gray-600",children:"Create a new strong password for your account."})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:E?"text":"password",placeholder:"Create a strong password",id:"newPassword",value:r.newPassword,onChange:S,className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>W(!E),children:E?e.jsx(H,{className:"text-gray-600"}):e.jsx(Z,{className:"text-gray-600"})})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"Password Requirements:"}),e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsxs("p",{className:`flex items-center ${n.length?"text-green-600":"text-red-500"}`,children:[n.length?"✔️":"❌"," Minimum 8 characters"]}),e.jsxs("p",{className:`flex items-center ${n.uppercase?"text-green-600":"text-red-500"}`,children:[n.uppercase?"✔️":"❌"," At least one uppercase letter"]}),e.jsxs("p",{className:`flex items-center ${n.lowercase?"text-green-600":"text-red-500"}`,children:[n.lowercase?"✔️":"❌"," At least one lowercase letter"]}),e.jsxs("p",{className:`flex items-center ${n.number?"text-green-600":"text-red-500"}`,children:[n.number?"✔️":"❌"," At least one number"]}),e.jsxs("p",{className:`flex items-center ${n.specialChar?"text-green-600":"text-red-500"}`,children:[n.specialChar?"✔️":"❌"," At least one special character"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:R?"text":"password",placeholder:"Confirm your password",id:"confirmPassword",value:r.confirmPassword,onChange:S,className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200",required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>G(!R),children:R?e.jsx(H,{className:"text-gray-600"}):e.jsx(Z,{className:"text-gray-600"})})]})]}),e.jsx("button",{disabled:p||Object.values(n).includes(!1),className:"w-full py-3 px-4 bg-gradient-to-r from-green-600 to-teal-600 text-white font-semibold rounded-lg hover:from-green-700 hover:to-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:p?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Resetting..."]}):"Reset Password"}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:g})}),V&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-600 text-sm",children:V})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Remember your password?"," ",e.jsx(Y,{to:"/sign-in",className:"text-green-600 hover:text-green-800 font-semibold hover:underline transition-colors duration-200",children:"Sign In"})]})})]})]})})]})}export{he as default};
