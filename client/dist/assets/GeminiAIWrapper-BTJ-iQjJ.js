import{R as I,r as n,u as C,h as E,g as P,j as e,W as R,A as $,L as S,y as w,H as N,aj as A,ak as L,ab as T,al as F}from"./index-DdxLgEwr.js";import{M as _}from"./index-w_wlSEwA.js";import{m as D}from"./addressMasking-3vIUwCOC.js";function G({listing:t,onDelete:p}){const{addToWishlist:h,removeFromWishlist:x,isInWishlist:c}=I(),[m,i]=n.useState(!1),u=C(),f=E(),{currentUser:d}=P(r=>r.user),y=f.pathname.includes("/admin");n.useEffect(()=>{i(c(t._id))},[c,t._id]);const g=async()=>{if(!d){w.info("Please sign in to add properties to your wishlist."),u("/sign-in");return}m?(await x(t._id),i(!1)):(await h(t),i(!0))},j=()=>{if(!d){w.info("Please sign in to book appointments."),u("/sign-in");return}const r=y?`/admin/appointmentlisting?listingId=${t._id}&listingType=${t.type}&propertyName=${encodeURIComponent(t.name)}&propertyDescription=${encodeURIComponent(t.description)}`:`/user/appointment?listingId=${t._id}&listingType=${t.type}&propertyName=${encodeURIComponent(t.name)}&propertyDescription=${encodeURIComponent(t.description)}`;u(r)},b=r=>`₹${Number(r).toLocaleString("en-IN")}`,s=()=>t.offer&&t.regularPrice&&t.discountPrice?Math.round((t.regularPrice-t.discountPrice)/t.regularPrice*100):0;let o=`/listing/${t._id}`;return y?o=`/admin/listing/${t._id}`:f.pathname.startsWith("/user")&&(o=`/user/listing/${t._id}`),e.jsxs("div",{className:"relative bg-white shadow-md rounded-lg overflow-hidden p-2 sm:p-4",children:[t.offer&&s()>0&&e.jsx("div",{className:"absolute top-2 sm:top-4 left-2 sm:left-4 z-20",children:e.jsxs("span",{className:"bg-yellow-400 text-gray-900 text-xs font-semibold px-2 py-1 rounded-full shadow-md animate-pulse",title:"Limited-time offer!",children:[s(),"% OFF"]})}),e.jsx("button",{onClick:g,className:`absolute top-2 sm:top-4 right-2 sm:right-4 p-2 rounded-full transition z-20 ${m?"bg-red-500 text-white":"bg-gray-200 text-red-500"}`,title:m?"Remove from wishlist":"Add to wishlist",children:e.jsx(R,{className:"text-base sm:text-lg"})}),p&&e.jsx("button",{onClick:()=>p(t._id),className:"absolute top-2 sm:top-4 left-2 sm:left-4 p-2 rounded-full bg-red-100 text-red-600 hover:bg-red-500 hover:text-white transition shadow-md z-10",title:"Delete Listing",style:{left:t.offer&&s()>0?"4.5rem":"0.5rem"},children:e.jsx($,{className:"text-base sm:text-lg"})}),e.jsxs(S,{to:o,children:[t.imageUrls&&t.imageUrls.length>0?e.jsx("img",{src:t.imageUrls[0],alt:"home",className:"w-full h-32 sm:h-48 object-cover rounded-md",onError:r=>{r.target.src="https://via.placeholder.com/400x300?text=No+Image",r.target.className="w-full h-32 sm:h-48 object-cover rounded-md opacity-50"}}):e.jsx("div",{className:"w-full h-48 bg-gray-200 rounded-md flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🏠"}),e.jsx("p",{className:"text-sm",children:"No Image"})]})}),e.jsxs("div",{className:"p-2 sm:p-3",children:[e.jsx("p",{className:"text-gray-700 font-semibold text-base sm:text-lg truncate",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(_,{className:"text-red-500"}),e.jsx("p",{className:"truncate",children:D(t.propertyNumber||t.city?{propertyNumber:t.propertyNumber,landmark:t.landmark,city:t.city,district:t.district,state:t.state,pincode:t.pincode}:t.address,!!d)})]}),e.jsx("p",{className:"text-gray-600 text-xs sm:text-sm mt-2 truncate",children:t.description}),e.jsx("div",{className:"mt-2",children:t.offer&&s()>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-base sm:text-lg font-bold text-blue-500",children:[b(t.discountPrice),t.type==="rent"&&" / month"]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 line-through",children:b(t.regularPrice)})]}):e.jsxs("p",{className:"text-base sm:text-lg font-bold text-blue-500",children:[b(t.regularPrice),t.type==="rent"&&" / month"]})}),e.jsxs("div",{className:"flex space-x-2 sm:space-x-4 text-gray-600 text-xs sm:text-sm mt-2",children:[e.jsx("p",{children:t.bedrooms>1?`${t.bedrooms} beds`:`${t.bedrooms} bed`}),e.jsx("p",{children:t.bathrooms>1?`${t.bathrooms} bathrooms`:`${t.bathrooms} bathroom`})]})]})]}),e.jsx("div",{className:"mt-2 sm:mt-4",children:d&&d._id===t.userRef?e.jsx("div",{className:"w-full text-red-500 font-semibold text-center py-2 sm:py-3 rounded-lg bg-red-50 border border-red-200",children:"You cannot book an appointment for your own property."}):e.jsx("button",{onClick:j,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center justify-center gap-2 text-sm sm:text-base",children:"📅 Book Appointment"})})]})}const z=()=>{const[t,p]=n.useState(!1),[h,x]=n.useState([{role:"assistant",content:"Hello! I'm your AI assistant powered by Gemini. How can I help you with your real estate needs today?"}]),[c,m]=n.useState(""),[i,u]=n.useState(!1),f=n.useRef(null),d=n.useRef(null),y=()=>{var s;(s=f.current)==null||s.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{y()},[h]),n.useEffect(()=>{if(!t)return;const s=o=>{var r;o.ctrlKey&&o.key==="f"&&(o.preventDefault(),(r=d.current)==null||r.focus())};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[t]),n.useEffect(()=>{if(t){const s=window.scrollY;document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${s}px`,document.body.style.width="100%",document.body.style.height="100%",document.documentElement.style.overflow="hidden",document.documentElement.style.height="100%";const o=r=>{r.target.closest(".gemini-chatbox-modal")||r.preventDefault()};return document.addEventListener("touchmove",o,{passive:!1}),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.width="",document.body.style.height="",document.documentElement.style.overflow="",document.documentElement.style.height="",document.removeEventListener("touchmove",o),window.scrollTo(0,s)}}},[t]),n.useEffect(()=>{const s=new CustomEvent("geminiChatboxToggle",{detail:{isOpen:t}});window.dispatchEvent(s)},[t]);const g=async s=>{if(s.preventDefault(),!c.trim()||i)return;const o=c.trim();m(""),x(r=>[...r,{role:"user",content:o}]),u(!0);try{const r="https://urbansetu.onrender.com";console.log("Sending message to Gemini:",o);const a=await fetch(`${r}/api/gemini/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o,history:h.slice(-10)})});if(console.log("Response status:",a.status),console.log("Response ok:",a.ok),!a.ok){const v=await a.json();throw new Error(v.message||`HTTP error! status: ${a.status}`)}const l=await a.json();if(console.log("Response data received:",l),console.log("Response content length:",l.response?l.response.length:0),l&&l.response&&typeof l.response=="string"){const v=l.response.trim();console.log("Setting message with response length:",v.length),x(k=>[...k,{role:"assistant",content:v}])}else throw console.error("Invalid response structure:",l),new Error("Invalid response structure from server")}catch(r){console.error("Error in handleSubmit:",r);let a="Sorry, I'm having trouble connecting right now. Please try again later.";r.message.includes("timeout")?a="Request timed out. The response is taking longer than expected. Please try again.":r.message.includes("HTTP error")?a="Server error. Please try again later.":r.message.includes("Invalid response structure")?a="I received an invalid response. Please try again.":r.message.includes("Failed to fetch")&&(a="Network error. Please check your connection and try again."),x(l=>[...l,{role:"assistant",content:a}])}finally{u(!1)}},j=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),g(s))},b=async s=>{try{await navigator.clipboard.writeText(s),w.success("Message copied to clipboard!")}catch{const r=document.createElement("textarea");r.value=s,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),w.success("Message copied to clipboard!")}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-20 right-6 z-50",children:e.jsxs("button",{onClick:()=>p(!t),className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:"linear-gradient(135deg, #6366f1, #6366f1dd)",boxShadow:"0 10px 25px #6366f140"},"aria-label":"Open AI Chat",title:"Chat with Gemini AI Assistant!",children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:"3px solid #6366f155"}}),t?e.jsx(N,{className:"w-5 h-5 text-white drop-shadow-lg"}):e.jsx(A,{className:"w-5 h-5 text-white drop-shadow-lg"}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"🤖"}),e.jsx("span",{className:"font-medium",children:"Chat with AI Assistant!"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4 md:p-0 md:items-end md:justify-end gemini-chatbox-modal",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col w-full max-w-md h-full max-h-[90vh] md:w-96 md:h-[500px] md:mb-32 md:mr-6 md:max-h-[500px]",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-t-2xl flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{size:20}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Gemini AI Assistant"}),e.jsx("p",{className:"text-xs opacity-90",children:"Real Estate Helper"})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"text-white hover:text-gray-200 transition-colors",children:e.jsx(N,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:[h.map((s,o)=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] p-3 rounded-2xl break-words relative group ${s.role==="user"?"bg-gradient-to-r from-blue-600 to-purple-600 text-white":"bg-gray-100 text-gray-800"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed pr-8",children:s.content}),s.role==="assistant"&&e.jsx("button",{onClick:()=>b(s.content),className:"absolute top-2 right-2 p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-all duration-200 opacity-0 group-hover:opacity-100",title:"Copy message","aria-label":"Copy message",children:e.jsx(T,{size:14})})]})},o)),i&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 text-gray-800 p-3 rounded-2xl",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"Gemini is thinking..."})]})})}),e.jsx("div",{ref:f})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 flex-shrink-0",children:e.jsxs("form",{onSubmit:g,className:"flex space-x-2",children:[e.jsx("input",{ref:d,type:"text",value:c,onChange:s=>m(s.target.value),onKeyPress:j,placeholder:"Ask me anything about real estate...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",disabled:i}),e.jsx("button",{type:"submit",disabled:!c.trim()||i,className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-2 rounded-full hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex-shrink-0 flex items-center justify-center w-10 h-10",children:e.jsx(F,{size:16})})]})})]})})]})};function H(){return e.jsx(z,{})}export{H as G,G as L};
