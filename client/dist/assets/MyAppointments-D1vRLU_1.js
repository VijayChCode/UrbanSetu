import{g as Pt,r as a,u as Vt,v as p,j as e,P as Xe,a4 as Ze,a5 as qt,G as Ce,U as Jt,a7 as Kt,a6 as bt,f as Yt,a8 as Gt,a9 as Wt,y as g,h as Qt,L as Xt,z as D,H as Ge,aa as We,ad as Zt,C as es,ab as ts,a1 as ss,E as Te,ac as ns,ae as gt}from"./index-CGqS_iGw.js";const T="https://urbansetu.onrender.com";function rs(){const{currentUser:t}=Pt(n=>n.user),[h,I]=a.useState([]),[et,Y]=a.useState(!0),[xe,ae]=a.useState(null),[L,tt]=a.useState(""),[G,Re]=a.useState("all"),[Se,le]=a.useState("all"),[he,re]=a.useState(""),[V,N]=a.useState(!1),[b,Ae]=a.useState(null),[q,k]=a.useState(""),[O,z]=a.useState(""),[W,ge]=a.useState(!1),[_,ie]=a.useState(null),[w,fe]=a.useState([]),[S,H]=a.useState(!1),U=Vt(),[$e,$]=a.useState(null);a.useEffect(()=>{const n=async()=>{if(!t){ae("Please sign in to view your appointments"),Y(!1);return}try{Y(!0),ae(null);const c=await fetch(`${T}/api/bookings/my`,{credentials:"include"});if(c.ok){const x=await c.json();I(x)}else throw new Error("Failed to fetch appointments")}catch{ae("Failed to load appointments. Please try again.")}finally{Y(!1)}},d=async()=>{try{const c=await fetch(`${T}/api/bookings/archived`,{credentials:"include"});if(!c.ok)throw new Error("Not allowed");const x=await c.json();fe(Array.isArray(x)?x:[])}catch{fe([]),t&&(t.role==="admin"||t.role==="rootadmin")&&g.error("Failed to fetch archived appointments")}};n(),d()},[t]),a.useEffect(()=>{const n=d=>{I(c=>c.filter(x=>x._id!==d.detail))};return window.addEventListener("removeAppointmentRow",n),()=>{window.removeEventListener("removeAppointmentRow",n)}},[t]),a.useEffect(()=>{t&&I(n=>n.map(d=>{const c={...d};return d.buyerId&&(d.buyerId._id===t._id||d.buyerId===t._id)&&(c.buyerId={...c.buyerId,username:t.username,email:t.email,mobileNumber:t.mobileNumber,avatar:t.avatar}),d.sellerId&&(d.sellerId._id===t._id||d.sellerId===t._id)&&(c.sellerId={...c.sellerId,username:t.username,email:t.email,mobileNumber:t.mobileNumber,avatar:t.avatar}),c}))},[t]),a.useEffect(()=>{function n(d){I(c=>c.map(x=>x._id===d.appointmentId?{...x,...d.updatedAppointment}:x))}return p.on("appointmentUpdate",n),()=>{p.off("appointmentUpdate",n)}},[]),a.useEffect(()=>{function n(c){const x=c.appointment;x.buyerId&&t&&(x.buyerId._id===t._id||x.buyerId===t._id)?x.role="buyer":x.sellerId&&t&&(x.sellerId._id===t._id||x.sellerId===t._id)&&(x.role="seller"),I(v=>[x,...v])}p.on("appointmentCreated",n);const d=c=>{I(x=>x.map(v=>{const j={...v};return v.buyerId&&(v.buyerId._id===c.userId||v.buyerId===c.userId)&&(j.buyerId={...j.buyerId,username:c.username,email:c.email,mobileNumber:c.mobileNumber,avatar:c.avatar}),v.sellerId&&(v.sellerId._id===c.userId||v.sellerId===c.userId)&&(j.sellerId={...j.sellerId,username:c.username,email:c.email,mobileNumber:c.mobileNumber,avatar:c.avatar}),j}))};return p.on("profileUpdated",d),()=>{p.off("appointmentCreated",n),p.off("profileUpdated",d)}},[t]),a.useEffect(()=>{if(!t)return;const n=setInterval(()=>{p.emit("userAppointmentsActive",{userId:t._id})},1e3);return()=>clearInterval(n)},[t]);const J=async(n,d)=>{re(n+d);try{const c=await fetch(`${T}/api/bookings/${n}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:d})}),x=await c.json();if(c.status===401){g.error("Session expired or unauthorized. Please sign in again."),U("/sign-in");return}if(c.ok){I(j=>j.map(R=>R._id===n?{...R,status:d}:R));const v=d==="accepted"?"accepted":"rejected";g.success(`Appointment ${v} successfully! ${d==="accepted"?"Contact information is now visible to both parties.":""}`,{autoClose:3e3,closeOnClick:!0,pauseOnHover:!1,draggable:!1}),U("/user/my-appointments")}else g.error(x.message||"Failed to update appointment status.")}catch{g.error("An error occurred. Please try again.")}re("")},oe=async n=>{setAppointmentToHandle(n),setDeleteReason(""),setShowDeleteAppointmentModal(!0)},Ee=async n=>{setAppointmentToHandle(n),setShowArchiveModal(!0)},Be=async n=>{setAppointmentToHandle(n),setShowUnarchiveModal(!0)},ke=h.filter(n=>{var R,E,X,P,C,Z,ce,K,Fe,be;if(t._id===((E=(R=n.buyerId)==null?void 0:R._id)==null?void 0:E.toString())&&n.visibleToBuyer===!1||t._id===((P=(X=n.sellerId)==null?void 0:X._id)==null?void 0:P.toString())&&n.visibleToSeller===!1)return!1;const d=new Date(n.date)<new Date||new Date(n.date).toDateString()===new Date().toDateString()&&n.time&&n.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(G==="outdated")return d;const c=G==="all"?!0:n.status===G,x=Se==="all"?!0:n.role===Se,v=((C=n.propertyName)==null?void 0:C.toLowerCase().includes(L.toLowerCase()))||((Z=n.message)==null?void 0:Z.toLowerCase().includes(L.toLowerCase()))||((K=(ce=n.buyerId)==null?void 0:ce.username)==null?void 0:K.toLowerCase().includes(L.toLowerCase()))||((be=(Fe=n.sellerId)==null?void 0:Fe.username)==null?void 0:be.toLowerCase().includes(L.toLowerCase()));let j=!0;return q&&(j=j&&new Date(n.date)>=new Date(q)),O&&(j=j&&new Date(n.date)<=new Date(O)),c&&x&&v&&j}),_e=Array.isArray(w)?w.filter(n=>{var v,j,R,E,X,P;const d=new Date(n.date)<new Date||new Date(n.date).toDateString()===new Date().toDateString()&&n.time&&n.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(G==="outdated")return d;G==="all"||n.status;const c=((v=n.propertyName)==null?void 0:v.toLowerCase().includes(L.toLowerCase()))||((j=n.message)==null?void 0:j.toLowerCase().includes(L.toLowerCase()))||((E=(R=n.buyerId)==null?void 0:R.username)==null?void 0:E.toLowerCase().includes(L.toLowerCase()))||((P=(X=n.sellerId)==null?void 0:X.username)==null?void 0:P.toLowerCase().includes(L.toLowerCase()));let x=!0;return q&&(x=x&&new Date(n.date)>=new Date(q)),O&&(x=x&&new Date(n.date)<=new Date(O)),c&&x}):[];function Me(n){ie({...n,date:n.date?new Date(n.date).toISOString().split("T")[0]:"",time:n.time||"",message:n.message||"",buyerReinitiationCount:n.buyerReinitiationCount||0,sellerReinitiationCount:n.sellerReinitiationCount||0}),ge(!0)}async function Le(n){var v,j;if(n.preventDefault(),!_)return;const d=t&&(((v=_.buyerId)==null?void 0:v._id)===t._id||_.buyerId===t._id);if(t&&(((j=_.sellerId)==null?void 0:j._id)===t._id||(_.sellerId,t._id)),(d?_.buyerReinitiationCount||0:_.sellerReinitiationCount||0)>=2){g.error("You have reached the maximum number of reinitiations for your role.");return}if(!_.buyerId||!_.sellerId){g.error("Cannot reinitiate: one of the parties no longer exists.");return}const x={..._,status:"pending"};try{const R=await fetch(`${T}/api/bookings/reinitiate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(x)}),E=await R.json();R.ok?(g.success("Appointment reinitiated successfully!",{autoClose:5e3,closeOnClick:!0,pauseOnHover:!1,draggable:!1}),ge(!1),ie(null),U("/user/my-appointments"),I(X=>X.map(P=>P._id===E.appointment._id?{...P,...E.appointment}:P))):g.error(E.message||"Failed to reinitiate appointment.")}catch{g.error("An error occurred. Please try again.")}}const Oe=(n,d)=>{I(c=>c.map(x=>x._id===n?{...x,status:d}:x))},Q=async()=>{Y(!0),ae(null);try{const n=await fetch(`${T}/api/bookings/my`,{credentials:"include"});if(n.ok){const c=await n.json();I(c)}else throw new Error("Failed to fetch appointments");const d=await fetch(`${T}/api/bookings/archived`,{credentials:"include"});if(d.ok){const c=await d.json();fe(Array.isArray(c)?c:[])}}catch{ae("Failed to refresh appointments. Please try again.")}finally{Y(!1)}},Ie=n=>{if(console.log("Copy button clicked, message:",n),!n){g.error("No message to copy");return}navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n).then(()=>{g.success("Copied",{autoClose:2e3,position:"bottom-center"})}).catch(()=>{de(n)}):de(n)},de=n=>{try{const d=document.createElement("textarea");d.value=n,d.style.position="fixed",d.style.left="-999999px",d.style.top="-999999px",document.body.appendChild(d),d.focus(),d.select();const c=document.execCommand("copy");document.body.removeChild(d),c?(console.log("Copy successful via fallback method"),g.success("Copied",{autoClose:2e3,position:"bottom-center"})):(console.error("Fallback copy failed"),g.error("Failed to copy message"))}catch(d){console.error("Fallback copy error:",d),g.error("Copy not supported")}};return et?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading your appointments..."})]})}):xe?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6",children:e.jsx("div",{className:"text-center text-red-600 text-lg",children:xe})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 drop-shadow",children:S?"Archived Appointments":"My Appointments"}),!S&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ðŸ’¡ Outdated appointments (past their scheduled date) are automatically ignored when booking new appointments."})]}),e.jsx("button",{onClick:Q,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all font-semibold shadow-md ml-4",title:"Refresh appointments",children:"Refresh"}),t&&(t.role==="admin"||t.role==="rootadmin")&&e.jsx("button",{onClick:()=>H(!S),className:`bg-gradient-to-r text-white px-6 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2 ${S?"from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600":"from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{})," Active Appointments"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{})," Archived Appointments (",w.length,")"]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"Status:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:G,onChange:n=>Re(n.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelledByBuyer",children:"Cancelled by Buyer"}),e.jsx("option",{value:"cancelledBySeller",children:"Cancelled by Seller"}),e.jsx("option",{value:"cancelledByAdmin",children:"Cancelled by Admin"}),e.jsx("option",{value:"deletedByAdmin",children:"Deleted by Admin"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"noShow",children:"No Show"}),e.jsx("option",{value:"outdated",children:"Outdated"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"From:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:q,onChange:n=>k(n.target.value),max:O||void 0}),e.jsx("label",{className:"font-semibold",children:"To:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:O,onChange:n=>z(n.target.value),min:q||void 0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"Role:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:Se,onChange:n=>le(n.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"buyer",children:"As Buyer"}),e.jsx("option",{value:"seller",children:"As Seller"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"text-gray-500"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",placeholder:"Search by property, message, or user...",value:L,onChange:n=>tt(n.target.value)})]})]}),S&&t&&(t.role==="admin"||t.role==="rootadmin")?_e.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No archived appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Role"}),e.jsx("th",{className:"border p-2",children:"Other Party"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:_e.map(n=>e.jsx(ft,{appt:n,currentUser:t,handleStatusUpdate:J,handleAdminDelete:oe,actionLoading:he,onShowOtherParty:d=>{Ae(d),N(!0)},onOpenReinitiate:()=>Me(n),handleArchiveAppointment:Ee,handleUnarchiveAppointment:Be,isArchived:!0,onCancelRefresh:Oe,copyMessageToClipboard:Ie},n._id))})]})}):ke.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Role"}),e.jsx("th",{className:"border p-2",children:"Other Party"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:ke.map(n=>e.jsx(ft,{appt:n,currentUser:t,handleStatusUpdate:J,handleAdminDelete:oe,actionLoading:he,onShowOtherParty:d=>{Ae(d),N(!0)},onOpenReinitiate:()=>Me(n),handleArchiveAppointment:Ee,handleUnarchiveAppointment:Be,isArchived:!1,onCancelRefresh:Oe,copyMessageToClipboard:Ie},n._id))})]})}),V&&b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto relative animate-fadeIn",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>N(!1),title:"Close","aria-label":"Close",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Jt,{user:{username:b.username,avatar:b.avatar},size:"w-16 h-16",textSize:"text-lg",showBorder:!0,className:"border-4 border-white shadow-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 border-2 border-white rounded-full flex items-center justify-center",children:e.jsx(Kt,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:[b.username||"User",b.role==="admin"&&e.jsx(bt,{className:"text-purple-600 text-base",title:"Admin user"})]}),e.jsx("p",{className:"text-sm text-gray-600 capitalize font-medium bg-white px-3 py-1 rounded-full shadow-sm",children:b.role||"User"})]})]})}),e.jsx("div",{className:"px-6 py-6 space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx(Yt,{className:"text-blue-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Email"}),e.jsx("p",{className:"text-gray-800 font-medium",children:b.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-green-500",children:[e.jsx(Gt,{className:"text-green-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Phone"}),e.jsx("p",{className:"text-gray-800 font-medium",children:b.mobileNumber||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-purple-500",children:[e.jsx(Wt,{className:"text-purple-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Member Since"}),e.jsx("p",{className:"text-gray-800 font-medium",children:b.createdAt?new Date(b.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not available"})]})]})]})})]})}),W&&_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md relative",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-blue-700",children:"Reinitiate Appointment"}),e.jsxs("form",{onSubmit:Le,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Date"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 w-full",value:_.date,onChange:n=>ie(d=>({...d,date:n.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Time"}),e.jsx("input",{type:"time",className:"border rounded px-2 py-1 w-full",value:_.time,onChange:n=>ie(d=>({...d,time:n.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Message"}),e.jsx("textarea",{className:"border rounded px-2 py-1 w-full",value:_.message,onChange:n=>ie(d=>({...d,message:n.target.value})),required:!0})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full",children:"Submit"}),e.jsx("button",{type:"button",className:"mt-2 w-full bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400",onClick:()=>ge(!1),children:"Cancel"})]})]})})]})})}function Qe(t){const h=new Date,I=new Date;return I.setDate(h.getDate()-1),t.toDateString()===h.toDateString()?"Today":t.toDateString()===I.toDateString()?"Yesterday":t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}function ft({appt:t,currentUser:h,handleStatusUpdate:I,handleAdminDelete:et,actionLoading:Y,onShowOtherParty:xe,onOpenReinitiate:ae,handleArchiveAppointment:L,handleUnarchiveAppointment:tt,isArchived:G,onCancelRefresh:Re,copyMessageToClipboard:Se}){var mt,ut;const[le,he]=a.useState(null),[re,V]=a.useState(""),[N,b]=a.useState(t.comments||[]),[Ae,q]=a.useState(!1),[k,O]=a.useState(null),[z,W]=a.useState(""),[ge,_]=a.useState(null),ie=Qt(),[w,fe]=a.useState(!1),S=a.useRef(null),H=a.useRef(null),[U,$e]=a.useState(!0),[$,J]=a.useState(0),[oe,Ee]=a.useState(""),[Be,ke]=a.useState(!1),[_e,Me]=a.useState(!1),[Le,Oe]=a.useState(!1),[Q,Ie]=a.useState(!1),[de,n]=a.useState(!1),[d,c]=a.useState(!1),x=a.useRef(null),v=a.useRef(null),j=a.useRef(null),[R,E]=a.useState(!1),[X,P]=a.useState(null),[C,Z]=a.useState(null),[ce,K]=a.useState(!0),[Fe,be]=a.useState(!1),[pt,yt]=a.useState(!1),[jt,wt]=a.useState(!1),[vt,Nt]=a.useState(!1),[Ct,ze]=a.useState(!1),[St,He]=a.useState(!1),[At,Ue]=a.useState(!1),[as,Pe]=a.useState(null),[pe,ee]=a.useState(""),[kt,st]=a.useState(""),me=a.useRef({}),[Ve,te]=a.useState(null);a.useEffect(()=>{if(de){const s=setTimeout(()=>{n(!1)},1e4);return()=>clearTimeout(s)}},[de]);function qe(s){try{return JSON.parse(localStorage.getItem(`removedDeletedMsgs_${s}`))||[]}catch{return[]}}function _t(s,l){const r=qe(s);if(!r.includes(l)){const u=[...r,l];localStorage.setItem(`removedDeletedMsgs_${s}`,JSON.stringify(u))}}const Je=(h.role==="admin"||h.role==="rootadmin")&&h.adminApprovalStatus==="approved",It=ie.pathname.includes("/admin"),B=t.role==="seller",ye=t.role==="buyer",se=new Date(t.date)>new Date||new Date(t.date).toDateString()===new Date().toDateString()&&(!t.time||t.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),F=!se||t.status==="pending"||t.status==="rejected"||t.status==="cancelledByAdmin",nt=(Je||t.status==="accepted")&&se,i=B?t.buyerId:t.sellerId,Dt=s=>{Z(s),K(!0),E(!0)},Tt=s=>{Z(s),K(!1),E(!0)},Rt=async()=>{var s;if(C){try{if(ce){const l=!((s=C.readBy)!=null&&s.includes(h._id))&&C.senderEmail!==h.email,r=await fetch(`${T}/api/bookings/${t._id}/comment/${C._id}`,{method:"DELETE",credentials:"include"}),u=await r.json();r.ok?(b(o=>u.comments.map(m=>{const f=o.find(y=>y._id===m._id);return f&&f.status==="read"&&m.status!=="read"?{...m,status:"read"}:m})),l&&J(o=>Math.max(0,o-1)),g.success("Message deleted for everyone!")):g.error(u.message||"Failed to delete message.")}else b(l=>l.filter(r=>r._id!==C._id)),_t(t._id,C._id),g.success("Message deleted for you!")}catch{g.error("An error occurred. Please try again.")}E(!1),Z(null),K(!0)}},Et=()=>{localStorage.setItem(ct,Date.now()),b([]),g.success("Chat Cleared"),be(!1)},at=async()=>{if(!re.trim())return;const s=re.trim(),l=le,r=`temp-${Date.now()}`,u={_id:r,sender:h._id,senderEmail:h.email,senderName:h.username,message:s,status:"sending",timestamp:new Date().toISOString(),readBy:[h._id],...l?{replyTo:l._id}:{}};b(o=>[...o,u]),V(""),he(null),q(!0),S.current&&S.current.scrollIntoView({behavior:"smooth"});try{const o=await fetch(`${T}/api/bookings/${t._id}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:s,...l?{replyTo:l._id}:{}})}),m=await o.json();if(o.ok){const f=m.comments[m.comments.length-1];b(y=>y.map(A=>A._id===r?{...f}:A))}else b(f=>f.filter(y=>y._id!==r)),g.error(m.message||"Failed to send message.")}catch{b(m=>m.filter(f=>f._id!==r)),g.error("An error occurred. Please try again.")}finally{q(!1)}},lt=async s=>{if(!z.trim())return;_(s),b(r=>r.map(u=>u._id===s?{...u,message:z,edited:!0,editedAt:new Date}:u)),O(null),W(""),V("");try{const r=await fetch(`${T}/api/bookings/${t._id}/comment/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:z})}),u=await r.json();r.ok?(b(o=>o.map(m=>{const f=u.comments.find(y=>y._id===m._id);return f?f._id===s?f:m.status==="read"&&f.status!=="read"?{...f,status:"read"}:f:m})),g.success("Message edited successfully!")):(b(o=>o.map(m=>m._id===s?{...m,message:m.originalMessage||m.message,edited:m.wasEdited||!1}:m)),O(s),W(z),V(z),g.error(u.message||"Failed to edit message."))}catch{b(u=>u.map(o=>o._id===s?{...o,message:o.originalMessage||o.message,edited:o.wasEdited||!1}:o)),O(s),W(z),V(z),g.error("An error occurred. Please try again.")}finally{_(null)}},Bt=s=>{O(s._id),W(s.message),V(s.message),b(l=>l.map(r=>r._id===s._id?{...r,originalMessage:r.message,wasEdited:r.edited}:r)),setTimeout(()=>{j.current&&(j.current.focus(),j.current.select())},100)},Mt=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-700";case"accepted":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"cancelledByBuyer":return"bg-orange-100 text-orange-700";case"cancelledBySeller":return"bg-pink-100 text-pink-700";case"cancelledByAdmin":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},rt=async()=>{ee(""),ze(!0)},Ot=async()=>{if(B&&!pe.trim()){g.error("Reason is required for seller cancellation.");return}try{const s=await fetch(`${T}/api/bookings/${t._id}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:pe})}),l=await s.json();if(s.status===401){g.error("Session expired or unauthorized. Please sign in again."),navigate("/sign-in");return}s.ok?(g.success("Appointment cancelled successfully."),typeof Re=="function"&&Re(t._id,B?"cancelledBySeller":"cancelledByBuyer")):g.error(l.message||"Failed to cancel appointment."),ze(!1),ee("")}catch{g.error("An error occurred. Please try again.")}},Ft=async()=>{ee(""),He(!0)},$t=async()=>{if(!pe.trim()){g.error("Reason is required for admin cancellation.");return}try{const s=await fetch(`${T}/api/bookings/${t._id}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:pe})}),l=await s.json();if(s.status===401){g.error("Session expired or unauthorized. Please sign in again."),navigate("/sign-in");return}s.ok?(g.success("Appointment cancelled by admin."),navigate("/user/my-appointments")):g.error(l.message||"Failed to cancel appointment."),He(!1),ee("")}catch{g.error("An error occurred. Please try again.")}},Ke=async()=>{Ue(!0)},Lt=async()=>{try{const s=ye?"buyer":B?"seller":null;if(!s)return;if((await fetch(`${T}/api/bookings/${t._id}/soft-delete`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({who:s})})).ok){if(typeof window<"u"){const r=new CustomEvent("removeAppointmentRow",{detail:t._id});window.dispatchEvent(r),g.success("Appointment removed from your table successfully")}}else g.error("Failed to remove appointment from table.");Ue(!1)}catch{g.error("An error occurred. Please try again.")}};a.useEffect(()=>{w&&S.current&&S.current.scrollIntoView({behavior:"smooth"})},[w]);const je=a.useCallback(async()=>{if(!H.current)return;const{scrollTop:s,scrollHeight:l,clientHeight:r}=H.current;if(!(l-s-r<10))return;const o=N.filter(m=>{var f;return!((f=m.readBy)!=null&&f.includes(h._id))&&m.senderEmail!==h.email});if(o.length>0)try{(await fetch(`${T}/api/bookings/${t._id}/comments/read`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"})).ok&&(b(f=>f.map(y=>o.some(A=>A._id===y._id)?{...y,readBy:[...y.readBy||[],h._id],status:"read"}:y)),o.forEach(f=>{p.emit("messageRead",{appointmentId:t._id,messageId:f._id,userId:h._id,readBy:h._id})}),console.log(`Marked ${o.length} messages as read for user ${h._id}`))}catch(m){console.error("Error marking messages as read:",m)}},[N,h._id,t._id,p]),it=a.useRef(N.length),zt=a.useRef(N);a.useEffect(()=>{const s=N.slice(it.current),l=s.length;if(it.current=N.length,zt.current=N,l>0&&w){const r=s.some(o=>o.senderEmail===h.email),u=s.filter(o=>o.senderEmail!==h.email);r||U?setTimeout(()=>{S.current&&(S.current.scrollIntoView({behavior:"smooth"}),U&&u.length>0&&setTimeout(()=>{je()},300))},100):u.length>0&&J(o=>o+u.length)}},[N.length,U,w,h.email,je]);const ot=a.useCallback(()=>{if(H.current){const{scrollTop:s,scrollHeight:l,clientHeight:r}=H.current,u=l-s-r<10;if($e(u),u){const o=N.filter(m=>{var f;return!((f=m.readBy)!=null&&f.includes(h._id))&&m.senderEmail!==h.email}).length;o>0&&(console.log(`User manually scrolled to bottom, marking ${o} messages as read`),je()),$>0&&J(0)}}},[$,je,N,h._id]),Ye=a.useCallback(()=>{if(!H.current||N.length===0)return;const s=`chatClearTime_${t._id}`,l=Number(localStorage.getItem(s))||0,r=qe(t._id),u=N.filter(A=>new Date(A.timestamp).getTime()>l&&!r.includes(A._id));if(u.length===0)return;const m=H.current.getBoundingClientRect(),f=m.top+60;let y="";for(let A=0;A<u.length;A++){const ne=me.current[u[A]._id];if(ne){const ve=ne.getBoundingClientRect();if(ve.top>=f&&ve.bottom<=m.bottom){const Ne=new Date(u[A].timestamp);y=Qe(Ne);break}}}if(!y)for(let A=0;A<u.length;A++){const ne=me.current[u[A]._id];if(ne&&ne.getBoundingClientRect().bottom>f){const Ne=new Date(u[A].timestamp);y=Qe(Ne);break}}y&&y!==oe&&Ee(y)},[N,oe,t._id]);a.useEffect(()=>{const s=H.current;if(s&&w){const l=()=>{ot(),Ye(),ke(!0),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{ke(!1)},1e3)};if(s.addEventListener("scroll",l),s){const{scrollTop:r,scrollHeight:u,clientHeight:o}=s,m=u-r-o<10;$e(m)}return setTimeout(Ye,100),()=>{s.removeEventListener("scroll",l),v.current&&clearTimeout(v.current)}}},[w,ot,Ye]),a.useEffect(()=>{w&&S.current&&S.current.scrollIntoView({behavior:"smooth"})},[w]);const Ht=a.useCallback(()=>{S.current&&(S.current.scrollIntoView({behavior:"smooth"}),J(0),setTimeout(()=>{je()},500))},[je]);a.useEffect(()=>{function s(l){var r,u;if(l.appointmentId===t._id&&!w){if(l.comment.deleted)return;const o=l.comment.senderEmail===((r=t.buyerId)==null?void 0:r.email),m=l.comment.senderEmail===((u=t.sellerId)==null?void 0:u.email),y=!o&&!m?"UrbanSetu":l.comment.senderEmail||"User";g.info(`New message from ${y}`)}}return p.on("commentUpdate",s),()=>{p.off("commentUpdate",s)}},[t._id,w]),a.useEffect(()=>{function s(l){l.appointmentId===t._id&&(b(r=>{const u=r.findIndex(o=>o._id===l.comment._id);if(u!==-1){const o=[...r],m=r[u],f=l.comment;let y=f.status;return m.status==="read"&&f.status!=="read"&&(y="read"),o[u]={...f,status:y},o}else return!r.some(m=>m._id.toString().startsWith("temp-"))||l.comment.senderEmail!==h.email?[...r,l.comment]:r}),l.comment.deleted&&l.comment.senderEmail!==h.email&&we>0&&J(r=>Math.max(0,r-1)),w&&l.comment.senderEmail!==h.email&&(setTimeout(()=>{fetch(`${T}/api/bookings/${t._id}/comments/read`,{method:"PATCH",credentials:"include"})},100),setTimeout(()=>{S.current&&U&&S.current.scrollIntoView({behavior:"smooth"})},50)))}return p.on("commentUpdate",s),()=>{p.off("commentUpdate",s)}},[t._id,b,w,h.email,U]),a.useEffect(()=>{w&&(fetch(`${T}/api/bookings/${t._id}/comments/read`,{method:"PATCH",credentials:"include"}),N.length===0&&(c(!0),fetch(`${T}/api/bookings/${t._id}`).then(s=>s.json()).then(s=>{s&&Array.isArray(s.comments)&&b(s.comments)}).catch(s=>console.error("Failed to fetch comments:",s)).finally(()=>c(!1))))},[w,t._id,N.length]),a.useEffect(()=>{function s(r){r.appointmentId===t._id&&b(u=>u.map(o=>o._id===r.commentId?{...o,status:o.status==="read"?"read":"delivered"}:o))}function l(r){r.appointmentId===t._id&&b(u=>u.map(o=>{var m;return(m=o.readBy)!=null&&m.includes(r.userId)?o:{...o,status:"read",readBy:[...o.readBy||[],r.userId]}}))}return p.on("commentDelivered",s),p.on("commentRead",l),()=>{p.off("commentDelivered",s),p.off("commentRead",l)}},[t._id,b]);const dt=qe(t._id),we=N.filter(s=>{var l;return!((l=s.readBy)!=null&&l.includes(h._id))&&s.senderEmail!==h.email&&!dt.includes(s._id)}).length;a.useEffect(()=>(w?document.body.style.overflow="hidden":(document.body.style.overflow="",J(0)),()=>{document.body.style.overflow=""}),[w]);const ct=`chatClearTime_${t._id}`,Ut=Number(localStorage.getItem(ct))||0,De=N.filter(s=>new Date(s.timestamp).getTime()>Ut&&!dt.includes(s._id));a.useEffect(()=>{if(!w||!(i!=null&&i._id))return;p.emit("checkUserOnline",{userId:i._id});function s(l){l.userId===i._id&&Me(!!l.online)}return p.on("userOnlineStatus",s),p.on("userOnlineUpdate",s),()=>{p.off("userOnlineStatus",s),p.off("userOnlineUpdate",s)}},[w,i==null?void 0:i._id]),a.useEffect(()=>{if(!(i!=null&&i._id))return;p.emit("checkUserOnline",{userId:i._id});function s(l){l.userId===i._id&&Oe(!!l.online)}return p.on("userOnlineStatus",s),p.on("userOnlineUpdate",s),()=>{p.off("userOnlineStatus",s),p.off("userOnlineUpdate",s)}},[i==null?void 0:i._id]),a.useEffect(()=>{function s(l){l.fromUserId===(i==null?void 0:i._id)&&l.appointmentId===t._id&&(Ie(!0),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>Ie(!1),1e3))}return p.on("typing",s),()=>{p.off("typing",s),x.current&&clearTimeout(x.current)}},[i==null?void 0:i._id,t._id]),a.useEffect(()=>{if(!w)return;const s=l=>{var r;l.ctrlKey&&l.key==="f"&&(l.preventDefault(),(r=j.current)==null||r.focus())};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[w]);const M=Ve?N.find(s=>s._id===Ve):null;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-blue-50 transition align-top ${se?"":"bg-gray-100"}`,children:[e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[e.jsx("div",{children:new Date(t.date).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-sm text-gray-600",children:t.time}),!se&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"Outdated"})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{children:t.listingId?e.jsx(Xt,{to:It?`/admin/listing/${t.listingId._id}`:`/user/listing/${t.listingId._id}`,className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:t.propertyName}):e.jsx("div",{className:"font-semibold",children:t.propertyName})})}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${B?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:B?"Seller":"Buyer"})}),e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[nt?e.jsx("button",{className:"font-semibold text-blue-700 hover:underline text-left",style:{cursor:"pointer"},onClick:()=>xe(i),title:"Click to view details",children:(i==null?void 0:i.username)||"Unknown"}):e.jsx("span",{className:"font-semibold",children:(i==null?void 0:i.username)||"Unknown"}),nt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-600",children:i==null?void 0:i.email}),e.jsx("div",{className:"text-sm text-gray-600",children:i!=null&&i.mobileNumber&&(i==null?void 0:i.mobileNumber)!==""?i.mobileNumber:"No phone"})]}):e.jsx("div",{className:"text-sm text-gray-500 italic",children:Je?"Contact info available":"Contact info hidden until accepted"})]})}),e.jsx("td",{className:"border p-2 capitalize",children:t.purpose}),e.jsx("td",{className:"border p-2 max-w-xs truncate",children:t.message}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${Mt(t.status)}`,children:t.status==="cancelledByBuyer"?"Cancelled by Buyer":t.status==="cancelledBySeller"?"Cancelled by Seller":t.status==="cancelledByAdmin"?"Cancelled by Admin":t.status.charAt(0).toUpperCase()+t.status.slice(1)})}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("div",{className:"flex flex-col gap-2",children:se?e.jsxs(e.Fragment,{children:[B&&t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-green-500 hover:text-green-700 text-xl disabled:opacity-50",onClick:()=>I(t._id,"accepted"),disabled:Y===t._id+"accepted",title:"Accept Appointment",children:e.jsx(Ge,{})}),e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl disabled:opacity-50",onClick:()=>I(t._id,"rejected"),disabled:Y===t._id+"rejected",title:"Reject Appointment",children:e.jsx(Ce,{})})]}),B&&t.status==="accepted"&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:rt,title:"Cancel Appointment (Seller)",children:e.jsx(D,{})}),B&&(t.status==="cancelledBySeller"||t.status==="cancelledByBuyer"||t.status==="cancelledByAdmin"||t.status==="rejected"||t.status==="deletedByAdmin")&&e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:Ke,title:"Remove from table",style:{opacity:.5},children:e.jsx(D,{className:"group-hover:text-red-900 group-hover:scale-125 group-hover:animate-shake transition-all duration-200"})}),ye&&(t.status==="pending"||t.status==="accepted")&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:rt,title:"Cancel Appointment (Buyer)",children:e.jsx(D,{})}),ye&&(t.status==="cancelledByBuyer"||t.status==="cancelledBySeller"||t.status==="cancelledByAdmin"||t.status==="deletedByAdmin"||t.status==="rejected")&&e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:Ke,title:"Remove from table",style:{opacity:.5},children:e.jsx(D,{className:"group-hover:text-red-900 group-hover:scale-125 group-hover:animate-shake transition-all duration-200"})}),Je&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:Ft,title:"Cancel Appointment (Admin)",children:e.jsx(bt,{})}),(t.status==="cancelledByBuyer"&&ye||t.status==="cancelledBySeller"&&B)&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{className:"text-blue-500 hover:text-blue-700 text-xs border border-blue-500 rounded px-2 py-1 mt-1",onClick:()=>ae(t),disabled:t.status==="cancelledByBuyer"&&ye&&(t.buyerReinitiationCount||0)>=2||t.status==="cancelledBySeller"&&B&&(t.sellerReinitiationCount||0)>=2||!t.buyerId||!t.sellerId,title:"Reinitiate or Reschedule Appointment",children:"Reinitiate"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:ye&&t.status==="cancelledByBuyer"?`${2-(t.buyerReinitiationCount||0)} left`:B&&t.status==="cancelledBySeller"?`${2-(t.sellerReinitiationCount||0)} left`:""})]})]}):e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:Ke,title:"Delete outdated appointment from table",style:{opacity:.7},children:e.jsx(D,{size:18})})})}),e.jsx("td",{className:"border p-2 text-center relative",children:e.jsxs("button",{className:`flex items-center justify-center rounded-full p-3 shadow-lg mx-auto relative transform transition-all duration-200 group ${F?"bg-gray-100 text-gray-400 cursor-not-allowed opacity-50":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white hover:shadow-xl hover:scale-105"}`,title:F?se?t.status==="pending"?"Chat not available for pending appointments":t.status==="rejected"?"Chat not available for rejected appointments":"Chat not available for appointments cancelled by admin":"Chat not available for outdated appointments":"Open Chat",onClick:F?void 0:()=>fe(!0),disabled:F,children:[e.jsx(We,{size:22,className:F?"":"group-hover:animate-pulse"}),!F&&e.jsx("div",{className:"absolute inset-0 bg-white rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-200"}),Q&&!F&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-bold border-2 border-white animate-pulse",children:"..."}),!Q&&we>0&&F&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-gray-400 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-bold border-2 border-white",children:we}),!Q&&we>0&&!F&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-bold border-2 border-white",children:we}),!Q&&we===0&&Le&&!F&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-green-500 border-2 border-white rounded-full w-3 h-3"})]})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl w-full h-full max-w-6xl max-h-full p-0 relative animate-fadeIn flex flex-col border border-gray-200",children:[F?e.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 p-8 min-h-96",children:[e.jsx(We,{className:"text-6xl text-gray-400 mb-6"}),e.jsx("div",{className:"text-xl font-semibold text-gray-500 text-center",children:se?t.status==="pending"?"Chat not available for pending appointments":t.status==="rejected"?"Chat not available for rejected appointments":"Chat not available for appointments cancelled by admin":"Chat not available for outdated appointments"}),e.jsx("div",{className:"text-gray-400 text-center mt-2",children:se?t.status==="pending"?"Chat will be enabled once the appointment is accepted":t.status==="rejected"?"This appointment has been rejected":"This appointment has been cancelled by admin":"This appointment has already passed"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 sm:gap-3 px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 bg-gradient-to-r from-blue-500 via-purple-500 to-blue-600 rounded-t-3xl relative",children:Ve&&M?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!M.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{var s;he(M),(s=j.current)==null||s.focus(),te(null)},title:"Reply","aria-label":"Reply",children:e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),!M.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Se(M.message),te(null)},title:"Copy message","aria-label":"Copy message",children:e.jsx(Zt,{size:18})}),M.senderEmail===h.email&&!M.deleted&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Bt(M),te(null)},className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",title:"Edit comment","aria-label":"Edit comment",disabled:k!==null,children:e.jsx(es,{size:18})}),e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Dt(M),te(null)},title:"Delete","aria-label":"Delete",children:e.jsx(D,{size:18})})]}),M.senderEmail!==h.email&&!M.deleted&&e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Tt(M),te(null)},title:"Delete locally","aria-label":"Delete locally",children:e.jsx(D,{size:18})}),M.deleted&&e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Z(M),K(!1),E(!0),te(null)},title:"Delete from chat locally","aria-label":"Delete from chat locally",children:e.jsx(D,{size:18})})]}),e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>te(null),title:"Close options","aria-label":"Close options",children:e.jsx(Ce,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-full p-1 sm:p-1.5 shadow-lg flex-shrink-0 cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>xe(i),title:"Click to view user details",children:i!=null&&i.avatar?e.jsx("img",{src:i.avatar,alt:i.username||"User",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold text-sm",children:((i==null?void 0:i.username)||"U").charAt(0).toUpperCase()})}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3 min-w-0 flex-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-white truncate cursor-pointer hover:underline",onClick:()=>xe(i),title:"Click to view user details",children:(i==null?void 0:i.username)||"Unknown User"}),e.jsx("div",{className:"flex items-center gap-1 sm:hidden",children:Q?e.jsx("span",{className:"text-yellow-100 font-semibold text-xs bg-yellow-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Typing..."}):_e?e.jsx("span",{className:"text-green-100 font-semibold text-xs bg-green-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Online"}):e.jsx("span",{className:"text-gray-100 font-semibold text-xs bg-gray-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Offline"})}),e.jsx("div",{className:"hidden sm:flex items-center gap-1",children:Q?e.jsx("span",{className:"text-yellow-100 font-semibold text-xs bg-yellow-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Typing..."}):_e?e.jsx("span",{className:"text-green-100 font-semibold text-xs bg-green-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Online"}):e.jsx("span",{className:"text-gray-100 font-semibold text-xs bg-gray-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Offline"})})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 ml-auto flex-shrink-0",children:[De.length>0&&e.jsx("button",{className:"text-xs text-red-600 hover:underline",onClick:()=>be(!0),title:"Clear chat locally",children:"Clear Chat"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"text-yellow-500 hover:text-yellow-600 bg-yellow-50 hover:bg-yellow-100 rounded-full p-2 transition-colors shadow",onClick:()=>n(!de),title:"Keyboard shortcut tip","aria-label":"Show keyboard shortcut tip",children:e.jsx(ts,{className:"text-sm"})}),de&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 text-white text-xs rounded-lg px-3 py-2 shadow-lg z-20 whitespace-nowrap",children:["Press Ctrl + F to quickly focus and type your message.",e.jsx("div",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-800 transform rotate-45"})]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>fe(!1),title:"Close","aria-label":"Close",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{ref:H,className:"flex-1 overflow-y-auto space-y-2 mb-4 px-4 pt-4 animate-fadeInChat relative",style:{minHeight:"400px",maxHeight:"calc(100vh - 200px)"},children:[oe&&De.length>0&&e.jsx("div",{className:`sticky top-0 left-0 right-0 z-30 pointer-events-none transition-all duration-300 ease-in-out ${Be?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:e.jsx("div",{className:"w-full flex justify-center py-2",children:e.jsx("div",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:oe})})}),d?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"Loading messages..."})]}):De.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx(We,{className:"text-gray-300 text-4xl mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"No messages yet"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Start the conversation and connect with the other party"})]}):De.map((s,l)=>{var y,A,ne,ve,Ne,xt,ht;const r=s.senderEmail===h.email,u=k===s._id,o=new Date(s.timestamp),m=l>0?new Date(De[l-1].timestamp):null,f=m?o.toDateString()!==m.toDateString():!0;return o.toLocaleDateString("en-US",{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),e.jsxs(ss.Fragment,{children:[f&&e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("span",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:Qe(o)})}),e.jsx("div",{className:`flex w-full ${r?"justify-end":"justify-start"} animate-fadeInChatBubble`,style:{animationDelay:`${.03*l}s`},children:e.jsxs("div",{ref:ue=>me.current[s._id]=ue,"data-message-id":s._id,className:`rounded-2xl px-4 sm:px-5 py-3 text-sm shadow-xl max-w-[85%] sm:max-w-[70%] md:max-w-[60%] break-words overflow-hidden relative transform hover:scale-[1.02] transition-transform duration-200 min-h-[60px] min-w-[140px] ${r?"pr-24":"pr-20"} ${r?"bg-gradient-to-r from-blue-600 to-purple-700 text-white shadow-blue-200":"bg-white text-gray-800 border border-gray-200 shadow-gray-200 hover:shadow-gray-300"}`,style:{animationDelay:`${.03*l}s`},children:[s.replyTo&&e.jsx("div",{className:"border-l-4 border-purple-400 pl-3 mb-2 text-xs bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg w-full max-w-full break-words cursor-pointer transform hover:scale-[1.02] transition-transform duration-200",onClick:()=>{me.current[s.replyTo]&&(me.current[s.replyTo].scrollIntoView({behavior:"smooth",block:"center"}),me.current[s.replyTo].classList.add("ring-2","ring-yellow-400"),setTimeout(()=>{me.current[s.replyTo].classList.remove("ring-2","ring-yellow-400")},1e3))},role:"button",tabIndex:0,"aria-label":"Go to replied message",children:e.jsxs("span",{className:"text-xs text-gray-700 font-medium truncate max-w-[150px] flex items-center gap-1",children:[e.jsx("span",{className:"text-purple-500",children:"â†©"}),((A=(y=N.find(ue=>ue._id===s.replyTo))==null?void 0:y.message)==null?void 0:A.substring(0,30))||"Original message",((ve=(ne=N.find(ue=>ue._id===s.replyTo))==null?void 0:ne.message)==null?void 0:ve.length)>30?"...":""]})}),!r&&s.senderEmail!==((Ne=t.buyerId)==null?void 0:Ne.email)&&s.senderEmail!==((xt=t.sellerId)==null?void 0:xt.email)&&e.jsx("div",{className:"font-semibold mb-1 text-xs text-purple-600",children:"UrbanSetu"}),e.jsx("div",{className:"flex items-center gap-1 mb-6",children:s.deleted?e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx(Te,{className:"inline-block text-lg"})," ",s.senderEmail===h.email?"You deleted this message":"This message was deleted."]}):e.jsx("div",{className:r?"text-base font-medium":"text-sm",children:u?e.jsx("div",{className:"bg-yellow-100 border-l-4 border-yellow-400 px-2 py-1 rounded",children:e.jsx("span",{className:"text-yellow-800 text-xs font-medium",children:"âœï¸ Editing this message below..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap",children:s.message}),s.edited&&e.jsx("span",{className:"ml-2 text-[10px] italic text-gray-300",children:"(Edited)"})]})})}),e.jsxs("div",{className:`absolute bottom-2 right-2 flex items-center gap-1 text-[10px] ${r?"text-blue-200":"text-gray-500"}`,children:[e.jsx("span",{children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("button",{className:`${r?"hover:bg-white hover:bg-opacity-20":"hover:bg-gray-100"} ml-1 p-1 rounded-full transition-colors`,onClick:ue=>{ue.stopPropagation(),te(s._id)},title:"Message options","aria-label":"Message options",children:e.jsx(ns,{size:r?14:12})}),s.senderEmail===h.email&&!s.deleted&&e.jsx("span",{className:"flex items-center gap-1 ml-1",children:(ht=s.readBy)!=null&&ht.includes(i==null?void 0:i._id)?e.jsx(gt,{className:"text-green-400 text-xs",title:"Read"}):s.status==="delivered"?e.jsx(gt,{className:"text-blue-200 text-xs",title:"Delivered"}):s.status==="sending"?e.jsx(Ge,{className:"text-blue-200 text-xs animate-pulse",title:"Sending..."}):e.jsx(Ge,{className:"text-blue-200 text-xs",title:"Sent"})})]})]})})]},s._id||l)}),e.jsx("div",{ref:S})]}),le&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsxs("span",{className:"text-xs text-gray-600 truncate max-w-[200px]",children:[(mt=le.message)==null?void 0:mt.substring(0,40),((ut=le.message)==null?void 0:ut.length)>40?"...":""]}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-1 transition-colors",onClick:()=>he(null),title:"Cancel reply",children:e.jsx(Ce,{className:"w-3 h-3"})})]})}),k&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-yellow-50 border-l-4 border-yellow-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold mr-2",children:"âœï¸ Editing message:"}),e.jsx("span",{className:"text-xs text-yellow-600 truncate",children:z}),e.jsx("button",{className:"ml-auto text-yellow-400 hover:text-yellow-700 bg-yellow-100 hover:bg-yellow-200 rounded-full p-1 transition-colors",onClick:()=>{O(null),W(""),V("")},title:"Cancel edit",children:e.jsx(Ce,{className:"w-3 h-3"})})]})}),e.jsxs("div",{className:"flex gap-2 mt-1 px-3 pb-2",children:[e.jsx("textarea",{rows:1,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-2xl text-sm focus:ring-2 focus:ring-blue-300 focus:border-blue-400 shadow-lg transition-all duration-200 bg-white resize-y whitespace-pre-wrap",placeholder:k?"Edit your message...":"Type a message...",value:re,onChange:s=>{V(s.target.value),k&&W(s.target.value),k||p.emit("typing",{toUserId:i._id,fromUserId:h._id,appointmentId:t._id})},onKeyDown:s=>{s.key==="Enter"&&(s.ctrlKey||s.metaKey)&&(s.preventDefault(),k?lt(k):at())},ref:j}),e.jsx("button",{onClick:k?()=>lt(k):at,disabled:(k?ge===k:Ae)||!re.trim(),className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-full text-sm font-semibold shadow-lg hover:from-blue-600 hover:to-purple-700 hover:shadow-xl transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:transform-none flex items-center gap-2 min-w-24",children:k?ge===k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save":Ae?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border border-white border-t-transparent rounded-full animate-spin"}),"Sending..."]}):"Send"})]}),e.jsx("style",{jsx:!0,children:`
                  @keyframes fadeInChatBubble {
                    from { opacity: 0; transform: translateY(10px) scale(0.98); }
                    to { opacity: 1; transform: translateY(0) scale(1); }
                  }
                  .animate-fadeInChatBubble {
                    animation: fadeInChatBubble 0.4s cubic-bezier(0.4,0,0.2,1) both;
                  }
                  @keyframes fadeInChat {
                    from { opacity: 0; }
                    to { opacity: 1; }
                  }
                  .animate-fadeInChat {
                    animation: fadeInChat 0.3s cubic-bezier(0.4,0,0.2,1) both;
                  }
                `})]}),!U&&!F&&!k&&!le&&e.jsx("div",{className:"absolute bottom-20 right-6 z-20",children:e.jsxs("button",{onClick:Ht,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-xl transition-all duration-200 hover:scale-110 relative transform hover:shadow-2xl",title:$>0?`${$} new message${$>1?"s":""}`:"Scroll to bottom","aria-label":$>0?`${$} new messages, scroll to bottom`:"Scroll to bottom",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})}),$>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 border-2 border-white shadow-lg",children:$>99?"99+":$})]})})]})}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"text-red-500"}),"Delete Message"]}),C!=null&&C.deleted?e.jsx("p",{className:"text-gray-600 mb-6",children:"Delete this message for me?"}):(C==null?void 0:C.senderEmail)===h.email?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to delete this message?"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ce,onChange:s=>K(s.target.checked),className:"form-checkbox h-4 w-4 text-red-600 rounded border-gray-300 focus:ring-red-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Also delete for"," ",e.jsx("span",{className:"font-medium text-gray-900",children:(i==null?void 0:i.username)||"other user"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 ml-7",children:ce?"The message will be permanently deleted for everyone":"The message will only be deleted for you"})]})]}):e.jsxs("p",{className:"text-gray-600 mb-6",children:["Delete message from"," ",e.jsx("span",{className:"font-medium text-gray-900",children:(i==null?void 0:i.username)||"other user"}),"?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{E(!1),Z(null),K(!0)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Rt,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(D,{size:12}),C!=null&&C.deleted?"Delete for me":(C==null?void 0:C.senderEmail)===h.email&&ce?"Delete for everyone":"Delete for me"]})]})]})}),Fe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"text-red-500"}),"Clear Chat"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to clear chat? This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>be(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Et,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(D,{size:12}),"Clear Chat"]})]})]})}),pt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"text-red-500"}),"Delete Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to delete this appointment?"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for deletion (required):"}),e.jsx("textarea",{value:kt,onChange:s=>st(s.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:"3",placeholder:"Please provide a reason for deleting this appointment..."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{yt(!1),Pe(null),st("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:confirmAdminDelete,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(D,{size:12}),"Delete Appointment"]})]})]})}),jt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ze,{className:"text-blue-500"}),"Archive Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to archive this appointment? It will be moved to the archived section."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{wt(!1),Pe(null)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:confirmArchive,className:"px-4 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Ze,{size:12}),"Archive"]})]})]})}),vt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Xe,{className:"text-green-500"}),"Unarchive Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to unarchive this appointment? It will be moved back to the active appointments."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Nt(!1),Pe(null)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:confirmUnarchive,className:"px-4 py-2 rounded bg-green-600 text-white font-semibold hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(Xe,{size:12}),"Unarchive"]})]})]})}),Ct&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Te,{className:"text-orange-500"}),"Cancel Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to cancel this appointment?"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason for cancellation ",B?"(required)":"(optional)",":"]}),e.jsx("textarea",{value:pe,onChange:s=>ee(s.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",rows:"3",placeholder:B?"Please provide a reason for cancelling...":"Optional reason for cancelling..."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{ze(!1),ee("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Ot,className:"px-4 py-2 rounded bg-orange-600 text-white font-semibold hover:bg-orange-700 transition-colors flex items-center gap-2",children:[e.jsx(Te,{size:12}),"Cancel Appointment"]})]})]})}),St&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Te,{className:"text-red-500"}),"Admin Cancel Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to cancel this appointment as admin?"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for admin cancellation (required):"}),e.jsx("textarea",{value:pe,onChange:s=>ee(s.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:"3",placeholder:"Please provide a reason for admin cancellation..."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{He(!1),ee("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:$t,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Te,{size:12}),"Cancel as Admin"]})]})]})}),At&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(D,{className:"text-red-500"}),"Remove Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to permanently remove this appointment from your table? This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>Ue(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Lt,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(D,{size:12}),"Remove Permanently"]})]})]})})]})}export{rs as default};
