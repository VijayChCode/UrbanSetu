import{g as zt,r as c,x as P,j as e,L as Nt,a3 as Ot,P as ue,a4 as $e,a5 as Ut,H as ne,U as Ht,a6 as _e,a7 as Vt,f as Jt,a8 as qt,a9 as Kt,y as m,a1 as v,aa as Xe,ab as Gt,ac as pt,D as Yt,A as le,ad as Wt,G as De,ae as Qt,af as wt,t as vt}from"./index-BYW4ZYE5.js";const A="https://urbansetu.onrender.com";function Zt(){const{currentUser:r}=zt(s=>s.user),[h,R]=c.useState([]),[he,Y]=c.useState([]),[Pe,ee]=c.useState(!0),[F,ze]=c.useState("all"),[D,Oe]=c.useState(""),[C,Ue]=c.useState(null),[xe,ie]=c.useState(!1),[He,Ee]=c.useState(!1),[W,oe]=c.useState(!1),[z,Ve]=c.useState(""),[J,Je]=c.useState(""),[k,B]=c.useState(null),[te,b]=c.useState(""),[j,q]=c.useState(!1),[E,ge]=c.useState(!1),[fe,N]=c.useState(!1),[U,L]=c.useState(!1);c.useEffect(()=>(j||E||fe||U?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[j,E,fe,U]);const[K,Me]=c.useState({}),be=(s,n)=>{Me(a=>({...a,[s]:n}))};c.useEffect(()=>{const s=async()=>{try{const _=await(await fetch(`${A}/api/bookings`,{credentials:"include"})).json();R(_),ee(!1)}catch(o){console.error("Failed to fetch appointments",o),ee(!1)}},n=async()=>{try{const _=await(await fetch(`${A}/api/bookings/archived`,{credentials:"include"})).json();Y(_)}catch(o){console.error("Failed to fetch archived appointments",o)}};s(),n();const a=setInterval(()=>{s(),n()},5e3),g=o=>{R(_=>_.map(f=>{const w={...f};return f.buyerId&&(f.buyerId._id===o.userId||f.buyerId===o.userId)&&(w.buyerId={...w.buyerId,username:o.username,email:o.email,mobileNumber:o.mobileNumber,avatar:o.avatar}),f.sellerId&&(f.sellerId._id===o.userId||f.sellerId===o.userId)&&(w.sellerId={...w.sellerId,username:o.username,email:o.email,mobileNumber:o.mobileNumber,avatar:o.avatar}),w})),Y(_=>_.map(f=>{const w={...f};return f.buyerId&&(f.buyerId._id===o.userId||f.buyerId===o.userId)&&(w.buyerId={...w.buyerId,username:o.username,email:o.email,mobileNumber:o.mobileNumber,avatar:o.avatar}),f.sellerId&&(f.sellerId._id===o.userId||f.sellerId===o.userId)&&(w.sellerId={...w.sellerId,username:o.username,email:o.email,mobileNumber:o.mobileNumber,avatar:o.avatar}),w}))};return P.on("profileUpdated",g),()=>{clearInterval(a),P.off("profileUpdated",g)}},[]),c.useEffect(()=>(xe?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[xe]),c.useEffect(()=>{r&&(R(s=>s.map(n=>{const a={...n};return n.buyerId&&(n.buyerId._id===r._id||n.buyerId===r._id)&&(a.buyerId={...a.buyerId,username:r.username,email:r.email,mobileNumber:r.mobileNumber,avatar:r.avatar}),n.sellerId&&(n.sellerId._id===r._id||n.sellerId===r._id)&&(a.sellerId={...a.sellerId,username:r.username,email:r.email,mobileNumber:r.mobileNumber,avatar:r.avatar}),a})),Y(s=>s.map(n=>{const a={...n};return n.buyerId&&(n.buyerId._id===r._id||n.buyerId===r._id)&&(a.buyerId={...a.buyerId,username:r.username,email:r.email,mobileNumber:r.mobileNumber,avatar:r.avatar}),n.sellerId&&(n.sellerId._id===r._id||n.sellerId===r._id)&&(a.sellerId={...a.sellerId,username:r.username,email:r.email,mobileNumber:r.mobileNumber,avatar:r.avatar}),a})))},[r]);const Q=async s=>{B(s),b(""),q(!0)},de=async()=>{if(!te.trim()){m.error("Please provide a reason for cancelling this appointment.");return}try{console.log("Attempting to cancel appointment:",k),console.log("Current user:",r),console.log("User role:",r.role),console.log("Admin approval status:",r.adminApprovalStatus);const s=h.find(g=>g._id===k);s&&(console.log("Current appointment status:",s.status),console.log("Appointment date:",s.date),console.log("Appointment time:",s.time));const n=await fetch(`${A}/api/bookings/${k}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:te})});console.log("Response status:",n.status);const a=await n.json();console.log("Response data:",a),n.ok?(R(g=>g.map(o=>o._id===k?{...o,status:"cancelledByAdmin",cancelReason:te}:o)),m.success("Appointment cancelled successfully. Both buyer and seller have been notified of the cancellation.")):m.error(a.message||"Failed to cancel appointment."),q(!1),B(null),b("")}catch(s){console.error("Error in confirmAdminCancel:",s),m.error("An error occurred. Please try again.")}},S=async s=>{B(s),ge(!0)},ye=async()=>{try{console.log("Attempting to reinitiate appointment:",k);const s=await fetch(`${A}/api/bookings/${k}/reinitiate`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"});console.log("Response status:",s.status);const n=await s.json();console.log("Response data:",n),s.ok?(R(a=>a.map(g=>g._id===k?{...g,status:"pending",cancelReason:""}:g)),m.success("Appointment reinitiated successfully. Both buyer and seller have been notified.")):m.error(n.message||"Failed to reinitiate appointment."),ge(!1),B(null)}catch(s){console.error("Error in confirmReinitiate:",s),m.error("An error occurred. Please try again.")}},Te=async s=>{B(s),N(!0)},ce=async()=>{try{const s=await fetch(`${A}/api/bookings/${k}/archive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),n=await s.json();if(s.ok){const a=h.find(g=>g._id===k);a&&(R(g=>g.filter(o=>o._id!==k)),Y(g=>[{...a,archivedByAdmin:!0,archivedAt:new Date},...g])),m.success("Appointment archived successfully.")}else m.error(n.message||"Failed to archive appointment.");N(!1),B(null)}catch(s){console.error("Error in confirmArchive:",s),m.error("An error occurred. Please try again.")}},pe=async s=>{B(s),L(!0)},we=async()=>{try{const s=await fetch(`${A}/api/bookings/${k}/unarchive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),n=await s.json();if(s.ok){const a=he.find(g=>g._id===k);a&&(Y(g=>g.filter(o=>o._id!==k)),R(g=>[{...a,archivedByAdmin:!1,archivedAt:void 0},...g])),m.success("Appointment unarchived successfully.")}else m.error(n.message||"Failed to unarchive appointment.");L(!1),B(null)}catch(s){console.error("Error in confirmUnarchive:",s),m.error("An error occurred. Please try again.")}},Re=async s=>{if(!s){m.error("User ID not available");return}Ee(!0),ie(!0);try{const n=await fetch(`${A}/api/user/id/${s}`),a=await n.json();n.ok?Ue(a):(m.error("Failed to fetch user details."),ie(!1))}catch{m.error("An error occurred while fetching user details."),ie(!1)}Ee(!1)},me=h.filter(s=>{var _,f,w,H,re,ae,X,V,Z;const n=new Date(s.date)<new Date||new Date(s.date).toDateString()===new Date().toDateString()&&s.time&&s.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=F==="all"?!0:F==="outdated"?n:s.status===F,g=((f=(_=s.buyerId)==null?void 0:_.email)==null?void 0:f.toLowerCase().includes(D.toLowerCase()))||((H=(w=s.sellerId)==null?void 0:w.email)==null?void 0:H.toLowerCase().includes(D.toLowerCase()))||((re=s.propertyName)==null?void 0:re.toLowerCase().includes(D.toLowerCase()))||((X=(ae=s.buyerId)==null?void 0:ae.username)==null?void 0:X.toLowerCase().includes(D.toLowerCase()))||((Z=(V=s.sellerId)==null?void 0:V.username)==null?void 0:Z.toLowerCase().includes(D.toLowerCase()));let o=!0;return z&&(o=o&&new Date(s.date)>=new Date(z)),J&&(o=o&&new Date(s.date)<=new Date(J)),a&&g&&o}).map(s=>({...s,comments:K[s._id]||s.comments||[]})),se=he.filter(s=>{var _,f,w,H,re,ae,X,V,Z;const n=new Date(s.date)<new Date||new Date(s.date).toDateString()===new Date().toDateString()&&s.time&&s.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=F==="all"?!0:F==="outdated"?n:s.status===F,g=((f=(_=s.buyerId)==null?void 0:_.email)==null?void 0:f.toLowerCase().includes(D.toLowerCase()))||((H=(w=s.sellerId)==null?void 0:w.email)==null?void 0:H.toLowerCase().includes(D.toLowerCase()))||((re=s.propertyName)==null?void 0:re.toLowerCase().includes(D.toLowerCase()))||((X=(ae=s.buyerId)==null?void 0:ae.username)==null?void 0:X.toLowerCase().includes(D.toLowerCase()))||((Z=(V=s.sellerId)==null?void 0:V.username)==null?void 0:Z.toLowerCase().includes(D.toLowerCase()));let o=!0;return z&&(o=o&&new Date(s.date)>=new Date(z)),J&&(o=o&&new Date(s.date)<=new Date(J)),a&&g&&o}).map(s=>({...s,comments:K[s._id]||s.comments||[]})),ve=async()=>{ee(!0);try{const s=await fetch(`${A}/api/bookings`,{credentials:"include"});if(s.ok){const a=await s.json();R(a)}const n=await fetch(`${A}/api/bookings/archived`,{credentials:"include"});if(n.ok){const a=await n.json();Y(Array.isArray(a)?a:[])}}catch{}finally{ee(!1)}},je=s=>{if(console.log("Copy button clicked, message:",s),!s){m.error("No message to copy");return}navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(s).then(()=>{m.success("Copied",{autoClose:2e3,position:"bottom-center"})}).catch(()=>{Ne(s)}):Ne(s)},Ne=s=>{try{const n=document.createElement("textarea");n.value=s,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select();const a=document.execCommand("copy");document.body.removeChild(n),a?(console.log("Copy successful via fallback method"),m.success("Copied",{autoClose:2e3,position:"bottom-center"})):(console.error("Fallback copy failed"),m.error("Failed to copy message"))}catch(n){console.error("Fallback copy error:",n),m.error("Copy not supported")}};return Pe?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading appointments..."})]})}):Array.isArray(h)?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:[e.jsx(Ot,{position:"top-center",autoClose:2e3,closeOnClick:!0,containerClassName:"!z-[100]",toastOptions:{style:{fontSize:"0.9rem",borderRadius:"8px",boxShadow:"0 2px 8px #0001"}}}),e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-6",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-extrabold text-blue-700 drop-shadow",children:W?"Archived Appointments":"All Appointments (Admin View)"}),e.jsxs("div",{className:"flex flex-row w-full sm:w-auto gap-2 sm:gap-4 justify-center sm:justify-end mt-2 sm:mt-0",children:[e.jsx("button",{onClick:ve,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-2.5 py-1.5 rounded-md hover:from-blue-600 hover:to-purple-600 transition-all font-semibold shadow-md text-xs sm:text-base sm:px-4 sm:py-2 sm:rounded-lg w-1/2 sm:w-auto",title:"Refresh appointments",children:"Refresh"}),e.jsx("button",{onClick:()=>oe(!W),className:`bg-gradient-to-r text-white px-2.5 py-1.5 rounded-md transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-xs sm:text-base w-1/2 sm:w-auto sm:px-6 sm:py-3 sm:rounded-lg justify-center ${W?"from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600":"from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:W?e.jsxs(e.Fragment,{children:[e.jsx(ue,{})," ",e.jsx("span",{children:"Active Appointments"})]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{})," ",e.jsxs("span",{children:["Archived Appointments (",he.length,")"]})]})})]})]}),e.jsx("p",{className:"text-center text-gray-600 mb-6",children:W?"View and manage archived appointments. You can unarchive them to move them back to active appointments.":"💡 High data traffic may cause this page to slow down or stop working. Please refresh to continue using it normally.⚠️ Chats are encrypted and secure. View only for valid purposes like disputes or fraud checks. Unauthorized access or sharing is prohibited and will be logged."}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"Status:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:F,onChange:s=>ze(s.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"pending",children:"Pending Appointments"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelledByBuyer",children:"Cancelled by Buyer"}),e.jsx("option",{value:"cancelledBySeller",children:"Cancelled by Seller"}),e.jsx("option",{value:"cancelledByAdmin",children:"Cancelled by Admin"}),e.jsx("option",{value:"deletedByAdmin",children:"Deleted by Admin"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"noShow",children:"No Show"}),e.jsx("option",{value:"outdated",children:"Outdated"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"From:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:z,onChange:s=>Ve(s.target.value),max:J||void 0}),e.jsx("label",{className:"font-semibold",children:"To:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:J,onChange:s=>Je(s.target.value),min:z||void 0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"text-gray-500"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",placeholder:"Search by email, property, or username...",value:D,onChange:s=>Oe(s.target.value)})]})]}),W?se.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No archived appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:se.map(s=>e.jsx(jt,{appt:s,currentUser:r,handleAdminCancel:Q,handleReinitiateAppointment:S,handleArchiveAppointment:Te,handleUnarchiveAppointment:pe,onUserClick:Re,isArchived:!0,copyMessageToClipboard:je,updateAppointmentComments:be,showCancelModal:j,setShowCancelModal:q,showReinitiateModal:E,setShowReinitiateModal:ge,showArchiveModal:fe,setShowArchiveModal:N,showUnarchiveModal:U,setShowUnarchiveModal:L,appointmentToHandle:k,setAppointmentToHandle:B,cancelReason:te,setCancelReason:b,confirmAdminCancel:de,confirmReinitiate:ye,confirmArchive:ce,confirmUnarchive:we},s._id))})]})}):me.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:me.map(s=>e.jsx(jt,{appt:s,currentUser:r,handleAdminCancel:Q,handleReinitiateAppointment:S,handleArchiveAppointment:Te,handleUnarchiveAppointment:pe,onUserClick:Re,isArchived:!1,copyMessageToClipboard:je,updateAppointmentComments:be,showCancelModal:j,setShowCancelModal:q,showReinitiateModal:E,setShowReinitiateModal:ge,showArchiveModal:fe,setShowArchiveModal:N,showUnarchiveModal:U,setShowUnarchiveModal:L,appointmentToHandle:k,setAppointmentToHandle:B,cancelReason:te,setCancelReason:b,confirmAdminCancel:de,confirmReinitiate:ye,confirmArchive:ce,confirmUnarchive:we},s._id))})]})})]}),xe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",style:{overflow:"hidden"},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto relative animate-fadeIn",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>ie(!1),title:"Close","aria-label":"Close",children:e.jsx(ne,{className:"w-4 h-4"})}),He?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-4 text-gray-600",children:"Loading user details..."})]}):C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ht,{user:{username:C.username,avatar:C.avatar},size:"w-16 h-16",textSize:"text-lg",showBorder:!0,className:"border-4 border-white shadow-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 border-2 border-white rounded-full flex items-center justify-center",children:C.role==="admin"||C.role==="rootadmin"?e.jsx(_e,{className:"w-3 h-3 text-white"}):e.jsx(Vt,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:[C.username,(C.role==="admin"||C.role==="rootadmin")&&e.jsx(_e,{className:"text-purple-600 text-base",title:"Admin user"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("p",{className:"text-sm text-gray-600 capitalize font-medium bg-white px-3 py-1 rounded-full shadow-sm",children:C.role||"User"}),C.adminApprovalStatus&&e.jsx("p",{className:`text-xs font-medium px-2 py-1 rounded-full ${C.adminApprovalStatus==="approved"?"bg-green-100 text-green-700":C.adminApprovalStatus==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:C.adminApprovalStatus})]})]})]})}),e.jsx("div",{className:"px-6 py-6 space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx(Jt,{className:"text-blue-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Email"}),e.jsx("p",{className:"text-gray-800 font-medium",children:C.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-green-500",children:[e.jsx(qt,{className:"text-green-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Phone"}),e.jsx("p",{className:"text-gray-800 font-medium",children:C.mobileNumber||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-purple-500",children:[e.jsx(Kt,{className:"text-purple-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Member Since"}),e.jsx("p",{className:"text-gray-800 font-medium",children:new Date(C.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("p",{className:"text-gray-600",children:"User not found"})})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-blue-100",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Session expired or unauthorized"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Please sign in again to access admin appointments."}),e.jsx(Nt,{to:"/sign-in",className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Go to Sign In"})]})})}function Ze(r){const h=new Date,R=new Date;return R.setDate(h.getDate()-1),r.toDateString()===h.toDateString()?"Today":r.toDateString()===R.toDateString()?"Yesterday":r.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}function jt({appt:r,currentUser:h,handleAdminCancel:R,handleReinitiateAppointment:he,handleArchiveAppointment:Y,handleUnarchiveAppointment:Pe,onUserClick:ee,isArchived:F,copyMessageToClipboard:ze,updateAppointmentComments:D,showCancelModal:Oe,setShowCancelModal:C,showReinitiateModal:Ue,setShowReinitiateModal:xe,showArchiveModal:ie,setShowArchiveModal:He,showUnarchiveModal:Ee,setShowUnarchiveModal:W,appointmentToHandle:oe,setAppointmentToHandle:z,cancelReason:Ve,setCancelReason:J,confirmAdminCancel:Je,confirmReinitiate:k,confirmArchive:B,confirmUnarchive:te}){var nt,it,ot,dt,ct,mt,ut,ht;const[b,j]=c.useState(r.comments||[]),[q,E]=c.useState(""),[ge,fe]=c.useState(!1),[N,U]=c.useState(null),[L,K]=c.useState(""),[Me,be]=c.useState(null),[Q,de]=c.useState(null),[S,ye]=c.useState(!1),[Te,ce]=c.useState(!1),[pe,we]=c.useState(""),[Re,me]=c.useState(!1),[se,ve]=c.useState(null),[je,Ne]=c.useState(!1),s=v.useRef(null),n=v.useRef(null),a=v.useRef(null),g=v.useRef({}),[o,_]=c.useState(!0),[f,w]=c.useState(0),[H,re]=c.useState(""),[ae,X]=c.useState(!1),[V,Z]=c.useState(!1),[Ct,et]=c.useState(()=>Ft(r._id)),[Le,G]=c.useState(null),Ce=v.useRef(null),[St,Se]=c.useState(!1),[ke,Ae]=c.useState(""),[qe,Fe]=c.useState(!1),[kt,tt]=c.useState(!1),[$,st]=c.useState(null),M=Le?b.find(t=>t._id===Le):null;v.useEffect(()=>{if(V){const t=setTimeout(()=>{Z(!1)},1e4);return()=>clearTimeout(t)}},[V]),v.useEffect(()=>{S&&s.current&&s.current.scrollIntoView({behavior:"smooth"})},[S]),v.useEffect(()=>{D&&D(r._id,b)},[b,r._id,D]),v.useEffect(()=>{r.comments&&r.comments.length>b.length&&j(r.comments)},[r.comments]);const rt=v.useRef(b.length),At=v.useRef(b);v.useEffect(()=>{const t=b.slice(rt.current),l=t.length;if(rt.current=b.length,At.current=b,l>0&&S){const d=t.some(i=>i.senderEmail===h.email),u=t.filter(i=>i.senderEmail!==h.email);d||o?setTimeout(()=>{s.current&&s.current.scrollIntoView({behavior:"smooth"})},100):u.length>0&&w(i=>i+u.length)}},[b.length,o,S,h.email]),v.useEffect(()=>{w(0)},[S]);const Ke=v.useCallback(()=>{if(!n.current||b.length===0)return;const l=n.current.getBoundingClientRect(),d=l.top+60;let u="";for(let i=0;i<b.length;i++){const x=g.current[b[i]._id];if(x){const y=x.getBoundingClientRect();if(y.top>=d&&y.bottom<=l.bottom){const p=new Date(b[i].timestamp);u=Ze(p);break}}}if(!u)for(let i=0;i<b.length;i++){const x=g.current[b[i]._id];if(x&&x.getBoundingClientRect().bottom>d){const p=new Date(b[i].timestamp);u=Ze(p);break}}u&&u!==H&&re(u)},[b,H]),Ge=v.useRef(!1),Be=v.useCallback(async()=>{if(Ge.current)return;const t=b.filter(l=>{var d;return!((d=l.readBy)!=null&&d.includes(h._id))&&l.senderEmail!==h.email});if(t.length>0){Ge.current=!0;try{(await fetch(`${A}/api/bookings/${r._id}/comments/read`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"})).ok&&(j(d=>d.map(u=>t.some(i=>i._id===u._id)?{...u,readBy:[...u.readBy||[],h._id],status:"read"}:u)),t.forEach(d=>{P.emit("messageRead",{appointmentId:r._id,messageId:d._id,userId:h._id})}))}catch(l){console.error("Error marking messages as read:",l)}finally{Ge.current=!1}}},[b,h._id,r._id,P]),Ye=v.useCallback(()=>{if(n.current){const{scrollTop:t,scrollHeight:l,clientHeight:d}=n.current,u=l-t-d<5;_(u),u&&f>0&&(w(0),Be())}},[f,Be]);v.useEffect(()=>{const t=n.current;if(t&&S){const l=()=>{Ye(),Ke(),X(!0),Ce.current&&clearTimeout(Ce.current),Ce.current=setTimeout(()=>{X(!1)},1e3)};return t.addEventListener("scroll",l),Ye(),setTimeout(Ke,100),()=>{t.removeEventListener("scroll",l),Ce.current&&clearTimeout(Ce.current)}}},[S,Ye,Ke]);const It=v.useCallback(()=>{s.current&&(s.current.scrollIntoView({behavior:"smooth"}),w(0),setTimeout(()=>{Be()},500))},[Be]);v.useEffect(()=>(S?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[S]),v.useEffect(()=>{function t(i){i.appointmentId===r._id&&(j(x=>{const y=x.findIndex(p=>p._id===i.comment._id);if(y!==-1){const p=[...x],T=x[y],O=i.comment;let Ie=O.status;return T.status==="read"&&O.status!=="read"&&(Ie="read"),p[y]={...O,status:Ie},p}else return!x.some(T=>T._id.toString().startsWith("temp-"))||i.comment.senderEmail!==h.email?[...x,i.comment]:x}),i.comment.deleted&&i.comment.senderEmail!==h.email&&f>0&&w(x=>Math.max(0,x-1)),S&&i.comment.senderEmail!==h.email&&(setTimeout(()=>{fetch(`${A}/api/bookings/${r._id}/comments/read`,{method:"PATCH",credentials:"include"})},100),setTimeout(()=>{s.current&&o&&s.current.scrollIntoView({behavior:"smooth"})},50)))}P.on("commentUpdate",t);const l=i=>{i.appointmentId===r._id&&j(x=>x.map(y=>y._id===i.commentId?{...y,status:y.status==="read"?"read":"delivered",deliveredAt:new Date}:y))},d=i=>{i.appointmentId===r._id&&j(x=>x.map(y=>{var p;return(p=y.readBy)!=null&&p.includes(i.userId)?y:{...y,status:"read",readBy:[...y.readBy||[],i.userId],readAt:new Date}}))},u=i=>{i.appointmentId===r._id&&(j([]),m.success("Chat deleted by admin"))};return P.on("chatCleared",u),P.on("commentDelivered",l),P.on("commentRead",d),()=>{P.off("commentUpdate",t),P.off("chatCleared",u),P.off("commentDelivered",l),P.off("commentRead",d)}},[r._id,j,S,h.email,o]),v.useEffect(()=>{if(!S)return;const t=l=>{var d;l.ctrlKey&&l.key==="f"&&(l.preventDefault(),(d=a.current)==null||d.focus())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[S]);const We=async()=>{if(!q.trim())return;const t=q.trim(),l=Q,d=`temp-${Date.now()}`,u={_id:d,sender:h._id,senderEmail:h.email,senderName:h.username,message:t,status:"sending",timestamp:new Date().toISOString(),readBy:[h._id],...l?{replyTo:l._id}:{}};j(x=>[...x,u]),E(""),de(null);const i=()=>{a.current&&(a.current.focus(),a.current.setSelectionRange(0,0),document.activeElement!==a.current&&(a.current.click(),a.current.focus()))};i(),requestAnimationFrame(i),setTimeout(i,10),s.current&&s.current.scrollIntoView({behavior:"smooth"}),(async()=>{try{const x=await fetch(`${A}/api/bookings/${r._id}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:t,...l?{replyTo:l._id}:{}})}),y=await x.json();if(x.ok){const p=y.comments[y.comments.length-1];j(T=>T.map(O=>O._id===d?{...p}:O))}else{j(T=>T.filter(O=>O._id!==d)),E(t),m.error(y.message||"Failed to send message.");const p=()=>{a.current&&(a.current.focus(),a.current.setSelectionRange(0,0),document.activeElement!==a.current&&(a.current.click(),a.current.focus()))};p(),requestAnimationFrame(p)}}catch{j(p=>p.filter(T=>T._id!==d)),E(t),m.error("An error occurred. Please try again.");const y=()=>{a.current&&(a.current.focus(),a.current.setSelectionRange(0,0),document.activeElement!==a.current&&(a.current.click(),a.current.focus()))};y(),requestAnimationFrame(y)}})()},Qe=async t=>{if(!L.trim())return;be(t),j(d=>d.map(u=>u._id===t?{...u,message:L,edited:!0,editedAt:new Date}:u));try{const d=await fetch(`${A}/api/bookings/${r._id}/comment/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:L})}),u=await d.json();if(d.ok){j(x=>x.map(y=>{const p=u.comments.find(T=>T._id===y._id);return p?p._id===t?p:y.status==="read"&&p.status!=="read"?{...p,status:"read"}:p:y})),U(null),K(""),E("");const i=()=>{a.current&&(a.current.focus(),a.current.setSelectionRange(0,0),document.activeElement!==a.current&&(a.current.click(),a.current.focus()))};i(),requestAnimationFrame(i),setTimeout(i,10),m.success("Message edited successfully!")}else j(i=>i.map(x=>x._id===t?{...x,message:x.originalMessage||x.message,edited:x.wasEdited||!1}:x)),U(t),K(L),E(L),m.error(u.message||"Failed to edit message.")}catch{j(u=>u.map(i=>i._id===t?{...i,message:i.originalMessage||i.message,edited:i.wasEdited||!1}:i)),U(t),K(L),E(L),m.error("An error occurred. Please try again.")}finally{be(null)}},Dt=t=>{U(t._id),K(t.message),E(t.message),j(l=>l.map(d=>d._id===t._id?{...d,originalMessage:d.message,wasEdited:d.edited}:d)),setTimeout(()=>{if(a.current){a.current.focus();const l=a.current.value.length;a.current.setSelectionRange(l,l)}},100)},_t=t=>{de(t);const l=()=>{a.current&&(a.current.focus(),a.current.setSelectionRange(0,0),document.activeElement!==a.current&&(a.current.click(),a.current.focus()))};setTimeout(l,50),setTimeout(l,100),setTimeout(l,200)},Et=t=>{st(t),tt(!0)},at=new Date(r.date)>new Date||new Date(r.date).toDateString()===new Date().toDateString()&&(!r.time||r.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),Mt=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-700";case"accepted":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"cancelledByBuyer":return"bg-red-100 text-red-700";case"cancelledBySeller":return"bg-red-100 text-red-700";case"cancelledByAdmin":return"bg-red-100 text-red-700";case"deletedByAdmin":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},Tt=()=>{ce(!0),we("")},Rt=async t=>{t.preventDefault(),Ne(!0);try{const l=await fetch(`${A}/api/auth/verify-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:pe})}),d=await l.json();l.ok&&d.success?(ce(!1),ye(!0)):m.error("Incorrect password. Please try again.")}catch{m.error("Failed to verify password. Please try again.")}Ne(!1)},lt=t=>{ve(t),me(!0)},Lt=async()=>{var t;if(se){try{const l=!((t=se.readBy)!=null&&t.includes(h._id))&&se.senderEmail!==h.email,d=await fetch(`${A}/api/bookings/${r._id}/comment/${se._id}`,{method:"DELETE",credentials:"include"}),u=await d.json();d.ok?(j(u.comments),l&&w(i=>Math.max(0,i-1)),m.success("Message deleted successfully!")):m.error(u.message||"Failed to delete message.")}catch{m.error("An error occurred. Please try again.")}me(!1),ve(null)}};function Ft(t){try{return JSON.parse(localStorage.getItem(`hiddenDeletedMsgs_${t}`))||[]}catch{return[]}}const Bt=v.useCallback(t=>{et(l=>{if(!l.includes(t)){const d=[...l,t];return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${r._id}`,JSON.stringify(d))},0),d}return l})},[r._id]),$t=v.useCallback(t=>{et(l=>{const d=l.filter(u=>u!==t);return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${r._id}`,JSON.stringify(d))},0),d})},[r._id]);return e.jsxs("tr",{className:`hover:bg-blue-50 transition align-top ${F?"bg-gray-50":""} ${at?"":"bg-gray-100"}`,children:[e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[e.jsx("div",{children:new Date(r.date).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-sm text-gray-600",children:r.time}),!at&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"Outdated"}),F&&r.archivedAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Archived: ",new Date(r.archivedAt).toLocaleDateString("en-GB")]})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{children:r.listingId?e.jsx(Nt,{to:`/admin/listing/${r.listingId._id}`,className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:r.propertyName}):e.jsx("div",{className:"font-semibold",children:r.propertyName})})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return ee((t=r.buyerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view buyer details",children:[e.jsx("div",{className:"font-semibold",children:((nt=r.buyerId)==null?void 0:nt.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:((it=r.buyerId)==null?void 0:it.email)||r.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((ot=r.buyerId)==null?void 0:ot.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return ee((t=r.sellerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view seller details",children:[e.jsx("div",{className:"font-semibold",children:((dt=r.sellerId)==null?void 0:dt.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:(ct=r.sellerId)==null?void 0:ct.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((mt=r.sellerId)==null?void 0:mt.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2 capitalize",children:r.purpose}),e.jsx("td",{className:"border p-2 max-w-xs truncate",children:r.message}),e.jsxs("td",{className:"border p-2 text-center",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${Mt(r.status)}`,children:r.status==="deletedByAdmin"?"Deleted by Admin":r.status==="cancelledByBuyer"?"Cancelled by Buyer":r.status==="cancelledBySeller"?"Cancelled by Seller":r.status==="cancelledByAdmin"?"Cancelled by Admin":r.status.charAt(0).toUpperCase()+r.status.slice(1)}),r.status==="deletedByAdmin"&&r.adminComment&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:['"',r.adminComment,'"']})]}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("div",{className:"flex flex-col gap-2",children:F?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>Pe(r._id),title:"Unarchive Appointment",children:[e.jsx(ue,{})," Unarchive"]}):e.jsxs(e.Fragment,{children:[r.status==="cancelledByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>he(r._id),title:"Reinitiate Appointment (Admin)",children:[e.jsx(_e,{})," Reinitiate"]}):r.status!=="deletedByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>R(r._id),title:"Cancel Appointment (Admin)",children:[e.jsx(_e,{})," Cancel"]}):null,e.jsxs("button",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>Y(r._id),title:"Archive Appointment",children:[e.jsx($e,{})," Archive"]})]})})}),e.jsxs("td",{className:"border p-2 text-center relative",children:[e.jsxs("button",{className:"flex items-center justify-center bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 mx-auto relative group",title:"Open Chat",onClick:Tt,children:[e.jsx(Xe,{size:22,className:"group-hover:animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-white rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-200"})]}),Te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs relative flex flex-col items-center",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",onClick:()=>ce(!1),title:"Close",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-blue-700 flex items-center gap-2",children:[e.jsx(_e,{})," Admin Password Required"]}),e.jsxs("form",{onSubmit:Rt,className:"w-full flex flex-col gap-3",children:[e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-blue-200",placeholder:"Enter your password",value:pe,onChange:t=>we(t.target.value),required:!0,autoFocus:!0}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full font-semibold",disabled:je,children:je?"Verifying...":"Unlock Chat"})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl w-full h-full max-w-6xl max-h-full p-0 relative animate-fadeIn flex flex-col border border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-3 px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-500 via-purple-500 to-blue-600 rounded-t-3xl relative",children:Le&&M?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!M.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{_t(M),G(null)},title:"Reply","aria-label":"Reply",children:e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),!M.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{ze(M.message),G(null)},title:"Copy message","aria-label":"Copy message",children:e.jsx(Gt,{size:18})}),!M.deleted&&e.jsx("button",{className:"text-white hover:text-blue-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Et(M),G(null)},title:"Message info","aria-label":"Message info",children:e.jsx(pt,{size:18})}),M.senderEmail===h.email&&!M.deleted&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Dt(M),G(null)},className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",title:"Edit comment","aria-label":"Edit comment",disabled:N!==null,children:e.jsx(Yt,{size:18})}),e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{lt(M),G(null)},title:"Delete","aria-label":"Delete",children:e.jsx(le,{size:18})})]}),M.senderEmail!==h.email&&!M.deleted&&e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{lt(M),G(null)},title:"Delete","aria-label":"Delete",children:e.jsx(le,{size:18})})]}),e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>G(null),title:"Close options","aria-label":"Close options",children:e.jsx(ne,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-full p-1.5 shadow-lg",children:e.jsx(Xe,{className:"text-blue-600 text-lg"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Live Chat"}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[b.length>0&&e.jsx("button",{className:"text-red-100 hover:text-white bg-red-500/30 hover:bg-red-500/50 rounded-full p-2 transition-colors shadow flex items-center gap-2",onClick:()=>Se(!0),title:"Delete entire chat","aria-label":"Delete chat",children:e.jsx(le,{className:"text-sm"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"text-yellow-500 hover:text-yellow-600 bg-yellow-50 hover:bg-yellow-100 rounded-full p-2 transition-colors shadow",onClick:()=>Z(!V),title:"Keyboard shortcut tip","aria-label":"Show keyboard shortcut tip",children:e.jsx(Wt,{className:"text-sm"})}),V&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 text-white text-xs rounded-lg px-3 py-2 shadow-lg z-20 whitespace-nowrap",children:["Press Ctrl + F to quickly focus and type your message.",e.jsx("div",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-800 transform rotate-45"})]})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>ye(!1),title:"Close","aria-label":"Close",children:e.jsx(ne,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{ref:n,className:"flex-1 overflow-y-auto space-y-2 mb-4 px-4 pt-4 animate-fadeInChat relative",style:{minHeight:"400px",maxHeight:"calc(100vh - 200px)"},children:[e.jsx("div",{className:"px-4 py-3 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg mb-4 transform transition-all duration-500 hover:scale-105 hover:shadow-lg hover:bg-blue-100 hover:border-blue-500 hover:border-l-6",children:e.jsxs("p",{className:"text-sm text-blue-700 font-medium text-center flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-gentlePulse",children:"🔒"}),"Chats are encrypted and secure. View only for valid purposes like disputes or fraud checks. Unauthorized access or sharing is prohibited and will be logged."]})}),H&&b.length>0&&e.jsx("div",{className:`sticky top-0 left-0 right-0 z-30 pointer-events-none transition-all duration-300 ease-in-out ${ae?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:e.jsx("div",{className:"w-full flex justify-center py-2",children:e.jsx("div",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:H})})}),b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx(Xe,{className:"text-gray-300 text-4xl mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"No messages yet"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Start a conversation to communicate with the parties"})]}):b.map((t,l)=>{var p,T,O,Ie,xt;const d=t.senderEmail===h.email,u=N===t._id,i=new Date(t.timestamp),x=l>0?new Date(b[l-1].timestamp):null,y=x?i.toDateString()!==x.toDateString():!0;return e.jsxs(v.Fragment,{children:[y&&e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("span",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:Ze(i)})}),e.jsx("div",{className:`flex w-full ${d?"justify-end":"justify-start"} animate-fadeInChatBubble`,style:{animationDelay:`${.03*l}s`},children:e.jsxs("div",{ref:I=>g.current[t._id]=I,className:`rounded-2xl px-4 sm:px-5 py-3 text-sm shadow-xl max-w-[90%] sm:max-w-[80%] md:max-w-[70%] break-words overflow-hidden relative transition-all duration-200 min-h-[60px] ${d?"bg-gradient-to-r from-blue-600 to-purple-700 hover:from-blue-500 hover:to-purple-600 text-white shadow-blue-200 hover:shadow-blue-300":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200 shadow-gray-200 hover:shadow-lg hover:border-gray-300"}`,children:[t.replyTo&&e.jsx("div",{className:"border-l-4 border-purple-400 pl-3 mb-2 text-xs bg-gradient-to-r from-purple-50 to-blue-50 hover:from-purple-100 hover:to-blue-100 rounded-lg w-full max-w-full break-words cursor-pointer transition-all duration-200 hover:shadow-sm",onClick:()=>{g.current[t.replyTo]&&(g.current[t.replyTo].scrollIntoView({behavior:"smooth",block:"center"}),g.current[t.replyTo].classList.add("reply-highlight"),setTimeout(()=>{var I;(I=g.current[t.replyTo])==null||I.classList.remove("reply-highlight")},1600))},role:"button",tabIndex:0,"aria-label":"Go to replied message",children:e.jsxs("span",{className:"text-xs text-gray-700 font-medium truncate max-w-[150px] flex items-center gap-1",children:[e.jsx("span",{className:"text-purple-500",children:"↩"}),((T=(p=b.find(I=>I._id===t.replyTo))==null?void 0:p.message)==null?void 0:T.substring(0,30))||"Original message",((Ie=(O=b.find(I=>I._id===t.replyTo))==null?void 0:O.message)==null?void 0:Ie.length)>30?"...":""]})}),e.jsx("div",{className:"font-semibold mb-2 flex items-center gap-2 justify-start text-left",children:e.jsx("span",{className:`truncate max-w-[120px] min-w-[60px] inline-block align-middle overflow-hidden text-ellipsis text-left ${d?"text-blue-100":"text-gray-700"}`,children:d?"You":(()=>{var gt,ft,bt,yt;const I=t.senderEmail===((gt=r.buyerId)==null?void 0:gt.email),Pt=t.senderEmail===((ft=r.sellerId)==null?void 0:ft.email);return I?((bt=r.buyerId)==null?void 0:bt.username)||t.senderName||t.senderEmail:Pt?((yt=r.sellerId)==null?void 0:yt.username)||t.senderName||t.senderEmail:t.senderName||t.senderEmail})()})}),e.jsx("div",{className:`text-left ${d?"text-base font-medium":"text-sm"}`,children:t.deleted?(()=>{const I=Ct.includes(t._id);return h&&(h.role==="admin"||h.role==="rootadmin")?I?e.jsx("div",{className:"border border-gray-300 bg-gray-100 rounded p-2 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 text-xs",children:[e.jsx(De,{className:"inline-block"}),e.jsx("span",{children:"Deleted message hidden from view"})]}),e.jsx("button",{className:"text-xs text-blue-500 hover:text-blue-700 underline",onClick:()=>$t(t._id),title:"Show this deleted message content",children:"Show"})]})}):e.jsxs("div",{className:"border border-red-300 bg-red-50 rounded p-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-xs font-semibold mb-1",children:[e.jsx(De,{className:"inline-block"}),"Message deleted by ",t.deletedBy||"user"," (Admin view - preserved for records)"]}),e.jsx("div",{className:"text-gray-800 bg-white p-2 rounded border-l-4 border-red-400",children:t.originalMessage?e.jsx("span",{className:"whitespace-pre-wrap break-words",children:t.originalMessage}):t.message?e.jsx("span",{className:"whitespace-pre-wrap break-words",children:t.message}):e.jsx("span",{className:"text-gray-500 italic",children:"[Message content not preserved - this message was deleted before content preservation was implemented]"})}),!1,e.jsx("button",{className:"mt-2 text-xs text-red-500 hover:text-red-700 underline",onClick:()=>Bt(t._id),title:"Hide this deleted message from your admin view",children:"Hide from admin view"})]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx(De,{className:"inline-block text-lg"})," This message has been deleted."]})})():e.jsx("div",{children:u?e.jsx("div",{className:"bg-yellow-100 border-l-4 border-yellow-400 px-2 py-1 rounded",children:e.jsx("span",{className:"text-yellow-800 text-xs font-medium",children:"✏️ Editing this message below..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap break-words",children:(t.message||"").replace(/\n+$/,"")}),t.edited&&e.jsx("span",{className:"ml-2 text-[10px] italic text-gray-300 whitespace-nowrap",children:"(Edited)"})]})})}),e.jsxs("div",{className:"flex items-center gap-1 justify-end mt-2","data-message-actions":!0,children:[e.jsx("span",{className:`${d?"text-blue-200":"text-gray-500"} text-[10px]`,children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),!t.deleted&&e.jsx("button",{className:`${t.senderEmail===h.email?"text-blue-200 hover:text-white":"text-gray-500 hover:text-gray-700"} transition-all duration-200 hover:scale-110 p-1 rounded-full hover:bg-white hover:bg-opacity-20 ml-1`,onClick:I=>{I.stopPropagation(),G(t._id)},title:"Message options","aria-label":"Message options",children:e.jsx(Qt,{size:t.senderEmail===h.email?14:12})}),t.senderEmail===h.email&&!t.deleted&&e.jsx("span",{className:"ml-1 flex items-center gap-1",children:(xt=t.readBy)!=null&&xt.some(I=>I!==h._id)?e.jsx(wt,{className:"text-green-400 text-xs",title:"Read"}):t.status==="delivered"?e.jsx(wt,{className:"text-blue-200 text-xs",title:"Delivered"}):t.status==="sending"?e.jsx(vt,{className:"text-blue-200 text-xs animate-pulse",title:"Sending..."}):e.jsx(vt,{className:"text-blue-200 text-xs",title:"Sent"})})]})]})})]},t._id||l)}),e.jsx("div",{ref:s})]}),Q&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsxs("span",{className:"text-xs text-gray-600 truncate max-w-[200px]",children:[(ut=Q.message)==null?void 0:ut.substring(0,40),((ht=Q.message)==null?void 0:ht.length)>40?"...":""]}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-1 transition-colors",onClick:()=>de(null),title:"Cancel reply",children:e.jsx(ne,{className:"w-3 h-3"})})]})}),N&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-yellow-50 border-l-4 border-yellow-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold mr-2",children:"✏️ Editing message:"}),e.jsx("span",{className:"text-xs text-yellow-600 truncate",children:L}),e.jsx("button",{className:"ml-auto text-yellow-400 hover:text-yellow-700 bg-yellow-100 hover:bg-yellow-200 rounded-full p-1 transition-colors",onClick:()=>{U(null),K(""),E("")},title:"Cancel edit",children:e.jsx(ne,{className:"w-3 h-3"})})]})}),e.jsxs("div",{className:"flex gap-2 mt-1 px-3 pb-2",children:[e.jsx("textarea",{rows:1,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-2xl text-sm focus:ring-2 focus:ring-blue-300 focus:border-blue-400 shadow-lg transition-all duration-200 bg-white resize-y whitespace-pre-wrap break-all",placeholder:N?"Edit your message...":"Type a message...",value:q,onChange:t=>{E(t.target.value),N&&K(t.target.value)},onClick:()=>{Le&&(G(null),m.info("You can hit reply icon in header to reply"))},onKeyDown:t=>{const l=window.matchMedia("(min-width: 768px)").matches;if(t.key==="Enter"){if(t.isComposing||t.keyCode===229)return;(l&&!t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),N?Qe(N):We())}},ref:a}),e.jsx("button",{onClick:t=>{t.preventDefault(),N?Qe(N):We()},disabled:N?Me===N:!q.trim(),className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-full text-sm font-semibold shadow-lg hover:from-blue-600 hover:to-purple-700 hover:shadow-xl transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:transform-none flex items-center gap-2 min-w-24",children:N?Me===N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save":"Send"})]}),e.jsx("style",{jsx:!0,children:`
                @keyframes fadeInChatBubble {
                  from { opacity: 0; transform: translateY(10px) scale(0.98); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
                .animate-fadeInChatBubble {
                  animation: fadeInChatBubble 0.4s cubic-bezier(0.4,0,0.2,1) both;
                }
                @keyframes fadeInChat {
                  from { opacity: 0; }
                  to { opacity: 1; }
                }
                .animate-fadeInChat {
                  animation: fadeInChat 0.3s cubic-bezier(0.4,0,0.2,1) both;
                }
              `}),!o&&!N&&!Q&&e.jsx("div",{className:"absolute bottom-20 right-6 z-20",children:e.jsxs("button",{onClick:It,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-xl transition-all duration-200 hover:scale-110 relative transform hover:shadow-2xl",title:f>0?`${f} new message${f>1?"s":""}`:"Scroll to bottom","aria-label":f>0?`${f} new messages, scroll to bottom`:"Scroll to bottom",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})}),f>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 border-2 border-white shadow-lg",children:f>99?"99+":f})]})}),St&&e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm relative shadow-2xl",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",onClick:()=>{Se(!1),Ae("")},title:"Close","aria-label":"Close",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-red-600 flex items-center gap-2",children:[e.jsx(le,{})," Delete Entire Chat"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This will permanently delete all messages for this appointment. Enter admin password to confirm."}),e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-red-200 mb-4",placeholder:"Admin password",value:ke,onChange:t=>Ae(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ke.trim()&&!qe&&(t.preventDefault(),(async()=>{try{Fe(!0);const l=await fetch(`${A}/api/bookings/${r._id}/comments`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:ke})}),d=await l.json();l.ok?(j([]),m.success("Chat deleted successfully."),Se(!1),Ae("")):m.error(d.message||"Failed to delete chat")}catch{m.error("An error occurred. Please try again.")}finally{Fe(!1)}})())},autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Se(!1),Ae("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",disabled:qe||!ke,onClick:async()=>{try{Fe(!0);const t=await fetch(`${A}/api/bookings/${r._id}/comments`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:ke})}),l=await t.json();t.ok?(j([]),m.success("Chat deleted successfully."),Se(!1),Ae("")):m.error(l.message||"Failed to delete chat")}catch{m.error("An error occurred. Please try again.")}finally{Fe(!1)}},className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-60",children:qe?"Deleting...":e.jsxs(e.Fragment,{children:[e.jsx(le,{size:12})," Delete Chat"]})})]})]})})]})}),Re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(le,{className:"text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Delete Message"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to delete this message for everyone?"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{me(!1),ve(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Lt,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(le,{size:14}),"Delete"]})]})]})})}),Oe&&oe===r._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(De,{className:"text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Cancel Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify mb-4",children:"Are you sure you want to cancel this appointment?"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for cancellation (required):"}),e.jsx("textarea",{value:Ve,onChange:t=>J(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:"3",placeholder:"Please provide a reason for cancelling this appointment..."})]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{C(!1),z(null),J("")},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Je,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(De,{size:14}),"Cancel Appointment"]})]})]})})}),Ue&&oe===r._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ue,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Reinitiate Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to reinitiate this appointment? This will notify both buyer and seller."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{xe(!1),z(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:k,className:"px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(ue,{size:14}),"Reinitiate"]})]})]})})}),ie&&oe===r._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx($e,{className:"text-blue-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Archive Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to archive this appointment? It will be moved to the archived section."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{He(!1),z(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:B,className:"px-4 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx($e,{size:14}),"Archive"]})]})]})})}),Ee&&oe===r._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ue,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Unarchive Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to unarchive this appointment? It will be moved back to the active appointments."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{W(!1),z(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:te,className:"px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(ue,{size:14}),"Unarchive"]})]})]})})}),kt&&$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(pt,{className:"text-blue-500"})," Message Info"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm text-gray-700",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Message:"}),e.jsxs("div",{className:"whitespace-pre-wrap break-words",children:[($.message||"").slice(0,200),($.message||"").length>200?"...":""]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Sent:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date($.timestamp).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),$.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Delivered:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date($.deliveredAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),$.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Read:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date($.readAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),!$.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Not delivered yet"})]}),$.deliveredAt&&!$.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Delivered"})]}),$.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-green-600",children:"Read"})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{tt(!1),st(null)},className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})})]})]})}export{Zt as default};
