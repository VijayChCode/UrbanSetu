import{g as Kt,r as m,x as w,j as e,L as Tt,a3 as Wt,P as ye,a4 as Oe,a5 as Qt,H as ue,U as Xt,a6 as Fe,a7 as Zt,f as es,a8 as ts,a9 as ss,y as b,a1 as j,aa as Ue,ab as ns,ac as It,D as _t,A as me,ad as rs,G as Re,ae as as,af as Dt,t as nt,ag as ls}from"./index-BB3VIKDG.js";const T="https://urbansetu.onrender.com";function is(){const{currentUser:s}=Kt(n=>n.user),[f,F]=m.useState([]),[he,X]=m.useState([]),[Je,le]=m.useState(!0),[z,He]=m.useState("all"),[M,Ve]=m.useState(""),[D,Ye]=m.useState(null),[we,xe]=m.useState(!1),[Ge,Le]=m.useState(!1),[ne,ge]=m.useState(!1),[J,qe]=m.useState(""),[K,Ke]=m.useState(""),[R,Y]=m.useState(null),[oe,g]=m.useState(""),[N,ee]=m.useState(!1),[U,ve]=m.useState(!1),[je,_]=m.useState(!1),[Z,H]=m.useState(!1);m.useEffect(()=>(N||U||je||Z?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[N,U,je,Z]);const[W,Ne]=m.useState({}),re=m.useRef(!1),ae=m.useCallback((n,a)=>{re.current||Ne(x=>{const u=x[n];if(u&&a){if(a.some((P,G)=>{const d=u[G];return!d||JSON.stringify(d)!==JSON.stringify(P)}))return re.current=!0,console.log("🔄 AdminAppointments: Updating appointment comments:",{appointmentId:n,oldCount:(u==null?void 0:u.length)||0,newCount:a.length,hasContentChanges:!0}),setTimeout(()=>{re.current=!1},100),{...x,[n]:a}}else if(JSON.stringify(u)!==JSON.stringify(a))return re.current=!0,console.log("🔄 AdminAppointments: Updating appointment comments:",{appointmentId:n,oldCount:(u==null?void 0:u.length)||0,newCount:(a==null?void 0:a.length)||0,hasContentChanges:!0}),setTimeout(()=>{re.current=!1},100),{...x,[n]:a};return x})},[]),ie=m.useCallback(async()=>{try{const a=await(await fetch(`${T}/api/bookings`,{credentials:"include"})).json();F(a),le(!1)}catch(n){console.error("Failed to fetch appointments",n),le(!1)}},[]),S=m.useCallback(async()=>{try{const a=await(await fetch(`${T}/api/bookings/archived`,{credentials:"include"})).json();X(a)}catch(n){console.error("Failed to fetch archived appointments",n)}},[]);m.useEffect(()=>{console.log("🔌 AdminAppointments: Socket connected:",w.connected),console.log("🔌 AdminAppointments: Socket ID:",w.id),w.connected&&s&&(w.emit("adminAppointmentsActive",{adminId:s._id,role:s.role}),console.log("🔌 AdminAppointments: Joined admin appointments room")),ie(),S();const n=setInterval(()=>{ie(),S()},5e3),a=d=>{F(A=>A.map(c=>{const v={...c};return c.buyerId&&(c.buyerId._id===d.userId||c.buyerId===d.userId)&&(v.buyerId={...v.buyerId,username:d.username,email:d.email,mobileNumber:d.mobileNumber,avatar:d.avatar}),c.sellerId&&(c.sellerId._id===d.userId||c.sellerId===d.userId)&&(v.sellerId={...v.sellerId,username:d.username,email:d.email,mobileNumber:d.mobileNumber,avatar:d.avatar}),v})),X(A=>A.map(c=>{const v={...c};return c.buyerId&&(c.buyerId._id===d.userId||c.buyerId===d.userId)&&(v.buyerId={...v.buyerId,username:d.username,email:d.email,mobileNumber:d.mobileNumber,avatar:d.avatar}),c.sellerId&&(c.sellerId._id===d.userId||c.sellerId===d.userId)&&(v.sellerId={...v.sellerId,username:d.username,email:d.email,mobileNumber:d.mobileNumber,avatar:d.avatar}),v}))};w.on("profileUpdated",a);const x=d=>{if(console.log("🔔 AdminAppointments: Received commentUpdate event:",d),d.comment.senderEmail===(s==null?void 0:s.email)){console.log("🔔 AdminAppointments: Skipping own message to prevent duplicate");return}F(A=>A.map(c=>{var v;if(c._id===d.appointmentId){const E=(v=c.comments)==null?void 0:v.findIndex(I=>I._id===d.comment._id);if(E!==-1){const I=c.comments[E];if(JSON.stringify(I)!==JSON.stringify(d.comment)){const L=[...c.comments||[]];return L[E]=d.comment,{...c,comments:L}}return c}else{const I=[...c.comments||[],d.comment];return{...c,comments:I}}}return c})),X(A=>A.map(c=>{var v;if(c._id===d.appointmentId){const E=(v=c.comments)==null?void 0:v.findIndex(I=>I._id===d.comment._id);if(E!==-1){const I=c.comments[E];if(JSON.stringify(I)!==JSON.stringify(d.comment)){const L=[...c.comments||[]];return L[E]=d.comment,{...c,comments:L}}return c}else{const I=[...c.comments||[],d.comment];return{...c,comments:I}}}return c})),Ne(A=>{const v=[...A[d.appointmentId]||[]],E=v.findIndex(I=>I._id===d.comment._id);return E!==-1?v[E]=d.comment:v.push(d.comment),{...A,[d.appointmentId]:v}})};w.on("commentUpdate",x);const u=d=>{F(A=>A.map(c=>c._id===d.appointmentId?{...c,...d.updatedAppointment}:c)),X(A=>A.map(c=>c._id===d.appointmentId?{...c,...d.updatedAppointment}:c))};w.on("appointmentUpdate",u);const y=d=>{const A=d.appointment;F(c=>[A,...c])};w.on("appointmentCreated",y);const P=()=>{console.log("🔌 AdminAppointments: Socket connected"),s&&(w.emit("adminAppointmentsActive",{adminId:s._id,role:s.role}),console.log("🔌 AdminAppointments: Re-joined admin appointments rooms on connect"))},G=()=>{console.log("🔌 AdminAppointments: Socket disconnected")};return w.on("connect",P),w.on("disconnect",G),()=>{clearInterval(n),w.off("profileUpdated",a),w.off("commentUpdate",x),w.off("appointmentUpdate",u),w.off("appointmentCreated",y),w.off("connect",P),w.off("disconnect",G)}},[ie,S,s]),m.useEffect(()=>(we?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[we]),m.useEffect(()=>{s&&(F(n=>n.map(a=>{const x={...a};return a.buyerId&&(a.buyerId._id===s._id||a.buyerId===s._id)&&(x.buyerId={...x.buyerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),a.sellerId&&(a.sellerId._id===s._id||a.sellerId===s._id)&&(x.sellerId={...x.sellerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),x})),X(n=>n.map(a=>{const x={...a};return a.buyerId&&(a.buyerId._id===s._id||a.buyerId===s._id)&&(x.buyerId={...x.buyerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),a.sellerId&&(a.sellerId._id===s._id||a.sellerId===s._id)&&(x.sellerId={...x.sellerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),x})))},[s]);const Ce=async n=>{Y(n),g(""),ee(!0)},Be=async()=>{if(!oe.trim()){b.error("Please provide a reason for cancelling this appointment.");return}try{console.log("Attempting to cancel appointment:",R),console.log("Current user:",s),console.log("User role:",s.role),console.log("Admin approval status:",s.adminApprovalStatus);const n=f.find(u=>u._id===R);n&&(console.log("Current appointment status:",n.status),console.log("Appointment date:",n.date),console.log("Appointment time:",n.time));const a=await fetch(`${T}/api/bookings/${R}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:oe})});console.log("Response status:",a.status);const x=await a.json();console.log("Response data:",x),a.ok?(F(u=>u.map(y=>y._id===R?{...y,status:"cancelledByAdmin",cancelReason:oe}:y)),b.success("Appointment cancelled successfully. Both buyer and seller have been notified of the cancellation.")):b.error(x.message||"Failed to cancel appointment."),ee(!1),Y(null),g("")}catch(n){console.error("Error in confirmAdminCancel:",n),b.error("An error occurred. Please try again.")}},fe=async n=>{Y(n),ve(!0)},Se=async()=>{try{console.log("Attempting to reinitiate appointment:",R);const n=await fetch(`${T}/api/bookings/${R}/reinitiate`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"});console.log("Response status:",n.status);const a=await n.json();console.log("Response data:",a),n.ok?(F(x=>x.map(u=>u._id===R?{...u,status:"pending",cancelReason:""}:u)),b.success("Appointment reinitiated successfully. Both buyer and seller have been notified.")):b.error(a.message||"Failed to reinitiate appointment."),ve(!1),Y(null)}catch(n){console.error("Error in confirmReinitiate:",n),b.error("An error occurred. Please try again.")}},Ae=async n=>{Y(n),_(!0)},$e=async()=>{try{const n=await fetch(`${T}/api/bookings/${R}/archive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),a=await n.json();if(n.ok){const x=f.find(u=>u._id===R);x&&(F(u=>u.filter(y=>y._id!==R)),X(u=>[{...x,archivedByAdmin:!0,archivedAt:new Date},...u])),b.success("Appointment archived successfully.")}else b.error(a.message||"Failed to archive appointment.");_(!1),Y(null)}catch(n){console.error("Error in confirmArchive:",n),b.error("An error occurred. Please try again.")}},be=async n=>{Y(n),H(!0)},de=async()=>{try{const n=await fetch(`${T}/api/bookings/${R}/unarchive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),a=await n.json();if(n.ok){const x=he.find(u=>u._id===R);x&&(X(u=>u.filter(y=>y._id!==R)),F(u=>[{...x,archivedByAdmin:!1,archivedAt:void 0},...u])),b.success("Appointment unarchived successfully.")}else b.error(a.message||"Failed to unarchive appointment.");H(!1),Y(null)}catch(n){console.error("Error in confirmUnarchive:",n),b.error("An error occurred. Please try again.")}},pe=async n=>{if(!n){b.error("User ID not available");return}Le(!0),xe(!0);try{const a=await fetch(`${T}/api/user/id/${n}`),x=await a.json();a.ok?Ye(x):(b.error("Failed to fetch user details."),xe(!1))}catch{b.error("An error occurred while fetching user details."),xe(!1)}Le(!1)},ke=m.useMemo(()=>f.filter(n=>{var P,G,d,A,c,v,E,I,L;const a=new Date(n.date)<new Date||new Date(n.date).toDateString()===new Date().toDateString()&&n.time&&n.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),x=z==="all"?!0:z==="outdated"?a:n.status===z,u=((G=(P=n.buyerId)==null?void 0:P.email)==null?void 0:G.toLowerCase().includes(M.toLowerCase()))||((A=(d=n.sellerId)==null?void 0:d.email)==null?void 0:A.toLowerCase().includes(M.toLowerCase()))||((c=n.propertyName)==null?void 0:c.toLowerCase().includes(M.toLowerCase()))||((E=(v=n.buyerId)==null?void 0:v.username)==null?void 0:E.toLowerCase().includes(M.toLowerCase()))||((L=(I=n.sellerId)==null?void 0:I.username)==null?void 0:L.toLowerCase().includes(M.toLowerCase()));let y=!0;return J&&(y=y&&new Date(n.date)>=new Date(J)),K&&(y=y&&new Date(n.date)<=new Date(K)),x&&u&&y}).map(n=>({...n,comments:W[n._id]||n.comments||[]})),[f,z,M,J,K,W]),Ie=m.useMemo(()=>he.filter(n=>{var P,G,d,A,c,v,E,I,L;const a=new Date(n.date)<new Date||new Date(n.date).toDateString()===new Date().toDateString()&&n.time&&n.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),x=z==="all"?!0:z==="outdated"?a:n.status===z,u=((G=(P=n.buyerId)==null?void 0:P.email)==null?void 0:G.toLowerCase().includes(M.toLowerCase()))||((A=(d=n.sellerId)==null?void 0:d.email)==null?void 0:A.toLowerCase().includes(M.toLowerCase()))||((c=n.propertyName)==null?void 0:c.toLowerCase().includes(M.toLowerCase()))||((E=(v=n.buyerId)==null?void 0:v.username)==null?void 0:E.toLowerCase().includes(M.toLowerCase()))||((L=(I=n.sellerId)==null?void 0:I.username)==null?void 0:L.toLowerCase().includes(M.toLowerCase()));let y=!0;return J&&(y=y&&new Date(n.date)>=new Date(J)),K&&(y=y&&new Date(n.date)<=new Date(K)),x&&u&&y}).map(n=>({...n,comments:W[n._id]||n.comments||[]})),[he,z,M,J,K,W]),V=async()=>{le(!0);try{const n=await fetch(`${T}/api/bookings`,{credentials:"include"});if(n.ok){const x=await n.json();F(x)}const a=await fetch(`${T}/api/bookings/archived`,{credentials:"include"});if(a.ok){const x=await a.json();X(Array.isArray(x)?x:[])}}catch{}finally{le(!1)}},te=n=>{if(!n){b.error("No message to copy");return}navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n).then(()=>{b.success("Copied",{autoClose:2e3,position:"bottom-center"})}).catch(()=>{p(n)}):p(n)},p=n=>{try{const a=document.createElement("textarea");a.value=n,a.style.position="fixed",a.style.left="-999999px",a.style.top="-999999px",document.body.appendChild(a),a.focus(),a.select();const x=document.execCommand("copy");document.body.removeChild(a),x?b.success("Copied",{autoClose:2e3,position:"bottom-center"}):(console.error("Fallback copy failed"),b.error("Failed to copy message"))}catch(a){console.error("Fallback copy error:",a),b.error("Copy not supported")}};return Je?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading appointments..."})]})}):Array.isArray(f)?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:[e.jsx(Wt,{position:"top-center",autoClose:2e3,closeOnClick:!0,containerClassName:"!z-[100]",toastOptions:{style:{fontSize:"0.9rem",borderRadius:"8px",boxShadow:"0 2px 8px #0001"}}}),e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-6",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-extrabold text-blue-700 drop-shadow",children:ne?"Archived Appointments":"All Appointments (Admin View)"}),e.jsxs("div",{className:"flex flex-row w-full sm:w-auto gap-2 sm:gap-4 justify-center sm:justify-end mt-2 sm:mt-0",children:[e.jsx("button",{onClick:V,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-2.5 py-1.5 rounded-md hover:from-blue-600 hover:to-purple-600 transition-all font-semibold shadow-md text-xs sm:text-base sm:px-4 sm:py-2 sm:rounded-lg w-1/2 sm:w-auto",title:"Refresh appointments",children:"Refresh"}),e.jsx("button",{onClick:()=>ge(!ne),className:`bg-gradient-to-r text-white px-2.5 py-1.5 rounded-md transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-xs sm:text-base w-1/2 sm:w-auto sm:px-6 sm:py-3 sm:rounded-lg justify-center ${ne?"from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600":"from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:ne?e.jsxs(e.Fragment,{children:[e.jsx(ye,{})," ",e.jsx("span",{children:"Active Appointments"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{})," ",e.jsxs("span",{children:["Archived Appointments (",he.length,")"]})]})})]})]}),e.jsx("p",{className:"text-center text-gray-600 mb-6",children:ne?"View and manage archived appointments. You can unarchive them to move them back to active appointments.":"💡 High data traffic may cause this page to slow down or stop working. Please refresh to continue using it normally.⚠️ Chats are encrypted and secure. View only for valid purposes like disputes or fraud checks. Unauthorized access or sharing is prohibited and will be logged."}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"Status:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:z,onChange:n=>He(n.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"pending",children:"Pending Appointments"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelledByBuyer",children:"Cancelled by Buyer"}),e.jsx("option",{value:"cancelledBySeller",children:"Cancelled by Seller"}),e.jsx("option",{value:"cancelledByAdmin",children:"Cancelled by Admin"}),e.jsx("option",{value:"deletedByAdmin",children:"Deleted by Admin"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"noShow",children:"No Show"}),e.jsx("option",{value:"outdated",children:"Outdated"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"From:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:J,onChange:n=>qe(n.target.value),max:K||void 0}),e.jsx("label",{className:"font-semibold",children:"To:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:K,onChange:n=>Ke(n.target.value),min:J||void 0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"text-gray-500 hover:text-blue-500 transition-colors duration-200"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",placeholder:"Search by email, property, or username...",value:M,onChange:n=>Ve(n.target.value)})]})]}),ne?Ie.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No archived appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:Ie.map(n=>e.jsx(Et,{appt:n,currentUser:s,handleAdminCancel:Ce,handleReinitiateAppointment:fe,handleArchiveAppointment:Ae,handleUnarchiveAppointment:be,onUserClick:pe,isArchived:!0,copyMessageToClipboard:te,updateAppointmentComments:ae,showCancelModal:N,setShowCancelModal:ee,showReinitiateModal:U,setShowReinitiateModal:ve,showArchiveModal:je,setShowArchiveModal:_,showUnarchiveModal:Z,setShowUnarchiveModal:H,appointmentToHandle:R,setAppointmentToHandle:Y,cancelReason:oe,setCancelReason:g,confirmAdminCancel:Be,confirmReinitiate:Se,confirmArchive:$e,confirmUnarchive:de},n._id))})]})}):ke.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:ke.map(n=>e.jsx(Et,{appt:n,currentUser:s,handleAdminCancel:Ce,handleReinitiateAppointment:fe,handleArchiveAppointment:Ae,handleUnarchiveAppointment:be,onUserClick:pe,isArchived:!1,copyMessageToClipboard:te,updateAppointmentComments:ae,showCancelModal:N,setShowCancelModal:ee,showReinitiateModal:U,setShowReinitiateModal:ve,showArchiveModal:je,setShowArchiveModal:_,showUnarchiveModal:Z,setShowUnarchiveModal:H,appointmentToHandle:R,setAppointmentToHandle:Y,cancelReason:oe,setCancelReason:g,confirmAdminCancel:Be,confirmReinitiate:Se,confirmArchive:$e,confirmUnarchive:de},n._id))})]})})]}),we&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",style:{overflow:"hidden"},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto relative animate-fadeIn",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>xe(!1),title:"Close","aria-label":"Close",children:e.jsx(ue,{className:"w-4 h-4"})}),Ge?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-4 text-gray-600",children:"Loading user details..."})]}):D?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Xt,{user:{username:D.username,avatar:D.avatar},size:"w-16 h-16",textSize:"text-lg",showBorder:!0,className:"border-4 border-white shadow-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 border-2 border-white rounded-full flex items-center justify-center",children:D.role==="admin"||D.role==="rootadmin"?e.jsx(Fe,{className:"w-3 h-3 text-white"}):e.jsx(Zt,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:[D.username,(D.role==="admin"||D.role==="rootadmin")&&e.jsx(Fe,{className:"text-purple-600 text-base",title:"Admin user"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("p",{className:"text-sm text-gray-600 capitalize font-medium bg-white px-3 py-1 rounded-full shadow-sm",children:D.role||"User"}),D.adminApprovalStatus&&e.jsx("p",{className:`text-xs font-medium px-2 py-1 rounded-full ${D.adminApprovalStatus==="approved"?"bg-green-100 text-green-700":D.adminApprovalStatus==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:D.adminApprovalStatus})]})]})]})}),e.jsx("div",{className:"px-6 py-6 space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx(es,{className:"text-blue-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Email"}),e.jsx("p",{className:"text-gray-800 font-medium",children:D.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-green-500",children:[e.jsx(ts,{className:"text-green-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Phone"}),e.jsx("p",{className:"text-gray-800 font-medium",children:D.mobileNumber||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-purple-500",children:[e.jsx(ss,{className:"text-purple-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Member Since"}),e.jsx("p",{className:"text-gray-800 font-medium",children:new Date(D.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("p",{className:"text-gray-600",children:"User not found"})})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-blue-100",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Session expired or unauthorized"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Please sign in again to access admin appointments."}),e.jsx(Tt,{to:"/sign-in",className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Go to Sign In"})]})})}function rt(s){const f=new Date,F=new Date;return F.setDate(f.getDate()-1),s.toDateString()===f.toDateString()?"Today":s.toDateString()===F.toDateString()?"Yesterday":s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}function Et({appt:s,currentUser:f,handleAdminCancel:F,handleReinitiateAppointment:he,handleArchiveAppointment:X,handleUnarchiveAppointment:Je,onUserClick:le,isArchived:z,copyMessageToClipboard:He,updateAppointmentComments:M,showCancelModal:Ve,setShowCancelModal:D,showReinitiateModal:Ye,setShowReinitiateModal:we,showArchiveModal:xe,setShowArchiveModal:Ge,showUnarchiveModal:Le,setShowUnarchiveModal:ne,appointmentToHandle:ge,setAppointmentToHandle:J,cancelReason:qe,setCancelReason:K,confirmAdminCancel:Ke,confirmReinitiate:R,confirmArchive:Y,confirmUnarchive:oe}){var ht,xt,gt,ft,bt,pt,yt,wt,vt,jt;const[g,N]=m.useState(s.comments||[]),[ee,U]=m.useState(""),[ve,je]=m.useState(!1),[_,Z]=m.useState(null),[H,W]=m.useState(""),[Ne,re]=m.useState(null),[ae,ie]=m.useState(null),[S,Ce]=m.useState(!1),[Be,fe]=m.useState(!1),[Se,Ae]=m.useState(""),[$e,be]=m.useState(!1),[de,pe]=m.useState(null),[ke,Ie]=m.useState(!1),V=j.useRef(null),te=j.useRef(null),p=j.useRef(null),n=j.useRef({}),[a,x]=m.useState(!0),[u,y]=m.useState(0),[P,G]=m.useState(""),[d,A]=m.useState(!1),[c,v]=m.useState(!1),[E,I]=m.useState(()=>Vt(s._id)),[L,se]=m.useState(null),_e=j.useRef(null),[Mt,De]=m.useState(!1),[Ee,Te]=m.useState(""),[We,Pe]=m.useState(!1),[Rt,at]=m.useState(!1),[q,lt]=m.useState(null),[Qe,ot]=m.useState(!1),[Ft,it]=m.useState(!1),ce=j.useRef(!1),O=L?g.find(t=>t._id===L):null;j.useEffect(()=>{if(c){const t=setTimeout(()=>{v(!1)},1e4);return()=>clearTimeout(t)}},[c]),j.useEffect(()=>{if(Qe){const t=setTimeout(()=>{ot(!1),it(!0);const r=setTimeout(()=>it(!1),1e3);return()=>clearTimeout(r)},800);return()=>clearTimeout(t)}},[Qe]),j.useEffect(()=>{S&&V.current&&V.current.scrollIntoView({behavior:"smooth"})},[S]),j.useEffect(()=>{if(M&&g.length>0&&!ce.current)try{const t=s.comments||[];g.some((l,o)=>{const i=t[o];return!i||JSON.stringify(i)!==JSON.stringify(l)})&&(ce.current=!0,M(s._id,g),setTimeout(()=>{ce.current=!1},100))}catch(t){console.error("Error updating parent with localComments:",t),ce.current=!1}},[g,s._id,M,s.comments]),j.useEffect(()=>{if(ce.current)return;const t=s.comments||[],r=JSON.stringify(g)!==JSON.stringify(t);if(r&&(console.log("🔄 AdminAppointments Chat: Received update from parent:",{appointmentId:s._id,serverCommentsCount:t.length,localCommentsCount:g.length,hasContentChanges:r}),t.some(o=>{const i=g.find(h=>h._id===o._id);return!i||JSON.stringify(i)!==JSON.stringify(o)}))){if(ce.current=!0,N(t),t.length>g.length){const i=t.slice(g.length).filter(h=>h.senderEmail!==f.email);i.length>0&&(S||y(h=>h+i.length),S&&a&&setTimeout(()=>{V.current&&V.current.scrollIntoView({behavior:"smooth"})},100),S&&setTimeout(()=>{fetch(`${T}/api/bookings/${s._id}/comments/read`,{method:"PATCH",credentials:"include"})},100))}setTimeout(()=>{ce.current=!1},100)}},[s.comments,s._id,S,a,f.email]),j.useEffect(()=>{s.comments&&g.length===0&&N(s.comments)},[s._id,(ht=s.comments)==null?void 0:ht.length]),j.useEffect(()=>{s.comments&&g.length>0&&Math.abs(s.comments.length-g.length)>1&&N(s.comments)},[s._id,(xt=s.comments)==null?void 0:xt.length]);const dt=j.useRef(g.length),Lt=j.useRef(g);j.useEffect(()=>{const t=g.slice(dt.current),r=t.length;if(dt.current=g.length,Lt.current=g,r>0&&S){const l=t.some(i=>i.senderEmail===f.email),o=t.filter(i=>i.senderEmail!==f.email);l||a?setTimeout(()=>{V.current&&V.current.scrollIntoView({behavior:"smooth"})},100):o.length>0&&y(i=>i+o.length)}},[g.length,a,S,f.email]),j.useEffect(()=>{y(0)},[S]);const Xe=j.useCallback(()=>{if(!te.current||g.length===0)return;const r=te.current.getBoundingClientRect(),l=r.top+60;let o="";for(let i=0;i<g.length;i++){const h=n.current[g[i]._id];if(h){const k=h.getBoundingClientRect();if(k.top>=l&&k.bottom<=r.bottom){const C=new Date(g[i].timestamp);o=rt(C);break}}}if(!o)for(let i=0;i<g.length;i++){const h=n.current[g[i]._id];if(h&&h.getBoundingClientRect().bottom>l){const C=new Date(g[i].timestamp);o=rt(C);break}}o&&o!==P&&G(o)},[g,P]),Ze=j.useRef(!1),ze=j.useCallback(async()=>{if(Ze.current)return;const t=g.filter(r=>{var l;return!((l=r.readBy)!=null&&l.includes(f._id))&&r.senderEmail!==f.email});if(t.length>0){Ze.current=!0;try{(await fetch(`${T}/api/bookings/${s._id}/comments/read`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"})).ok&&(N(l=>l.map(o=>t.some(i=>i._id===o._id)?{...o,readBy:[...o.readBy||[],f._id],status:"read"}:o)),t.forEach(l=>{w.emit("messageRead",{appointmentId:s._id,messageId:l._id,userId:f._id})}))}catch(r){console.error("Error marking messages as read:",r)}finally{Ze.current=!1}}},[g,f._id,s._id,w]),et=j.useCallback(()=>{if(te.current){const{scrollTop:t,scrollHeight:r,clientHeight:l}=te.current,o=r-t-l<5;x(o),o&&u>0&&(y(0),ze())}},[u,ze]);j.useEffect(()=>{const t=te.current;if(t&&S){const r=()=>{et(),Xe(),A(!0),_e.current&&clearTimeout(_e.current),_e.current=setTimeout(()=>{A(!1)},1e3)};return t.addEventListener("scroll",r),et(),setTimeout(Xe,100),()=>{t.removeEventListener("scroll",r),_e.current&&clearTimeout(_e.current)}}},[S,et,Xe]);const ct=j.useCallback(()=>{V.current&&(V.current.scrollIntoView({behavior:"smooth"}),y(0),setTimeout(()=>{ze()},500))},[ze]);j.useEffect(()=>(S?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[S]),j.useEffect(()=>{function t(r){var l,o;if(r.appointmentId===s._id&&!S){if(r.comment.deleted)return;const i=r.comment.senderEmail===((l=s.buyerId)==null?void 0:l.email),h=r.comment.senderEmail===((o=s.sellerId)==null?void 0:o.email),C=!i&&!h?"UrbanSetu":r.comment.senderEmail||"User";b.info(`New message from ${C}`)}}return w.on("commentUpdate",t),()=>{w.off("commentUpdate",t)}},[s._id,S]),j.useEffect(()=>{function t(o){o.appointmentId===s._id&&N(i=>{var k;const h=i.findIndex(C=>C._id===o.comment._id);if(h!==-1){const C=[...i],B=i[h],Q=o.comment;let Me=Q.status;return B.status==="read"&&Q.status!=="read"&&(Me="read"),C[h]={...Q,status:Me},C}else return!i.some(B=>B._id.toString().startsWith("temp-"))||o.comment.senderEmail!==f.email?(o.comment.senderEmail!==f.email&&!S&&!((k=o.comment.readBy)!=null&&k.includes(f._id))&&y(B=>B+1),[...i,o.comment]):i})}function r({appointmentId:o,clearedAt:i}){o===s._id&&(N([]),y(0))}function l({appointmentId:o,commentId:i}){o===s._id&&N(h=>h.filter(k=>k._id!==i))}return w.on("commentUpdate",t),w.on("chatClearedForUser",r),w.on("commentRemovedForUser",l),()=>{w.off("commentUpdate",t),w.off("chatClearedForUser",r),w.off("commentRemovedForUser",l)}},[s._id,f.email,f._id,S]),j.useEffect(()=>{const t=o=>{o.appointmentId===s._id&&N(i=>i.map(h=>h._id===o.commentId?{...h,status:h.status==="read"?"read":"delivered",deliveredAt:new Date}:h))},r=o=>{o.appointmentId===s._id&&N(i=>i.map(h=>{var k;return(k=h.readBy)!=null&&k.includes(o.userId)?h:{...h,status:"read",readBy:[...h.readBy||[],o.userId],readAt:new Date}}))},l=o=>{o.appointmentId===s._id&&(N([]),b.success("Chat deleted by admin"))};return w.on("chatCleared",l),w.on("commentDelivered",t),w.on("commentRead",r),()=>{w.off("chatCleared",l),w.off("commentDelivered",t),w.off("commentRead",r)}},[s._id,S,f.email,a]),j.useEffect(()=>{if(!S)return;const t=r=>{var l;r.ctrlKey&&r.key==="f"&&(r.preventDefault(),(l=p.current)==null||l.focus())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[S]);const tt=async()=>{if(!ee.trim())return;ot(!0);const t=ee.trim(),r=ae,l=`temp-${Date.now()}`,o={_id:l,sender:f._id,senderEmail:f.email,senderName:f.username,message:t,status:"sending",timestamp:new Date().toISOString(),readBy:[f._id],...r?{replyTo:r._id}:{}};N(h=>[...h,o]),U(""),ie(null);const i=()=>{p.current&&(p.current.focus(),p.current.setSelectionRange(0,0),document.activeElement!==p.current&&(p.current.click(),p.current.focus()))};i(),requestAnimationFrame(i),setTimeout(i,10),V.current&&V.current.scrollIntoView({behavior:"smooth"}),(async()=>{try{const h=await fetch(`${T}/api/bookings/${s._id}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:t,...r?{replyTo:r._id}:{}})}),k=await h.json();if(h.ok){const C=k.comments[k.comments.length-1];N(B=>B.map(Q=>Q._id===l?{...C}:Q))}else{N(B=>B.filter(Q=>Q._id!==l)),U(t),b.error(k.message||"Failed to send message.");const C=()=>{p.current&&(p.current.focus(),p.current.setSelectionRange(0,0),document.activeElement!==p.current&&(p.current.click(),p.current.focus()))};C(),requestAnimationFrame(C)}}catch{N(C=>C.filter(B=>B._id!==l)),U(t),b.error("An error occurred. Please try again.");const k=()=>{p.current&&(p.current.focus(),p.current.setSelectionRange(0,0),document.activeElement!==p.current&&(p.current.click(),p.current.focus()))};k(),requestAnimationFrame(k)}})()},st=async t=>{if(!H.trim())return;re(t),N(l=>l.map(o=>o._id===t?{...o,message:H,edited:!0,editedAt:new Date}:o));try{const l=await fetch(`${T}/api/bookings/${s._id}/comment/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:H})}),o=await l.json();if(l.ok){N(h=>h.map(k=>{const C=o.comments.find(B=>B._id===k._id);return C?C._id===t?C:k.status==="read"&&C.status!=="read"?{...C,status:"read"}:C:k})),Z(null),W(""),U("");const i=()=>{p.current&&(p.current.focus(),p.current.setSelectionRange(0,0),document.activeElement!==p.current&&(p.current.click(),p.current.focus()))};i(),requestAnimationFrame(i),setTimeout(i,10),b.success("Message edited successfully!")}else N(i=>i.map(h=>h._id===t?{...h,message:h.originalMessage||h.message,edited:h.wasEdited||!1}:h)),Z(t),W(H),U(H),b.error(o.message||"Failed to edit message.")}catch{N(o=>o.map(i=>i._id===t?{...i,message:i.originalMessage||i.message,edited:i.wasEdited||!1}:i)),Z(t),W(H),U(H),b.error("An error occurred. Please try again.")}finally{re(null)}},Bt=t=>{Z(t._id),W(t.message),U(t.message),N(r=>r.map(l=>l._id===t._id?{...l,originalMessage:l.message,wasEdited:l.edited}:l)),setTimeout(()=>{if(p.current){p.current.focus();const r=p.current.value.length;p.current.setSelectionRange(r,r)}},100)},$t=t=>{ie(t);const r=()=>{p.current&&(p.current.focus(),p.current.setSelectionRange(0,0),document.activeElement!==p.current&&(p.current.click(),p.current.focus()))};setTimeout(r,50),setTimeout(r,100),setTimeout(r,200)},Pt=t=>{lt(t),at(!0)},mt=new Date(s.date)>new Date||new Date(s.date).toDateString()===new Date().toDateString()&&(!s.time||s.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),zt=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-700";case"accepted":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"cancelledByBuyer":return"bg-red-100 text-red-700";case"cancelledBySeller":return"bg-red-100 text-red-700";case"cancelledByAdmin":return"bg-red-100 text-red-700";case"deletedByAdmin":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},Ut=()=>{fe(!0),Ae("")},Ot=async()=>{try{const t=await fetch(`${T}/api/bookings/${s._id}`,{credentials:"include"});if(t.ok){const r=await t.json();r.comments&&r.comments.length!==g.length&&(console.log("🔄 AdminAppointments Chat: Fetched latest comments from server:",{appointmentId:s._id,serverCommentsCount:r.comments.length,localCommentsCount:g.length}),N(r.comments))}}catch(t){console.error("Error fetching latest comments:",t)}},Jt=async t=>{t.preventDefault(),Ie(!0);try{const r=await fetch(`${T}/api/auth/verify-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Se})}),l=await r.json();r.ok&&l.success?(fe(!1),Ce(!0),setTimeout(()=>{Ot()},100)):b.error("Incorrect password. Please try again.")}catch{b.error("Failed to verify password. Please try again.")}Ie(!1)},ut=t=>{pe(t),be(!0)},Ht=async()=>{var t;if(de){try{const r=!((t=de.readBy)!=null&&t.includes(f._id))&&de.senderEmail!==f.email,l=await fetch(`${T}/api/bookings/${s._id}/comment/${de._id}`,{method:"DELETE",credentials:"include"}),o=await l.json();l.ok?(N(o.comments),r&&y(i=>Math.max(0,i-1)),b.success("Message deleted successfully!")):b.error(o.message||"Failed to delete message.")}catch{b.error("An error occurred. Please try again.")}be(!1),pe(null)}};function Vt(t){try{return JSON.parse(localStorage.getItem(`hiddenDeletedMsgs_${t}`))||[]}catch{return[]}}const Yt=j.useCallback(t=>{I(r=>{if(!r.includes(t)){const l=[...r,t];return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${s._id}`,JSON.stringify(l))},0),l}return r})},[s._id]),Gt=j.useCallback(t=>{I(r=>{const l=r.filter(o=>o!==t);return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${s._id}`,JSON.stringify(l))},0),l})},[s._id]);return e.jsxs("tr",{className:`hover:bg-blue-50 transition align-top ${z?"bg-gray-50":""} ${mt?"":"bg-gray-100"}`,children:[e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[e.jsx("div",{children:new Date(s.date).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-sm text-gray-600",children:s.time}),!mt&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"Outdated"}),z&&s.archivedAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Archived: ",new Date(s.archivedAt).toLocaleDateString("en-GB")]})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{children:s.listingId?e.jsx(Tt,{to:`/admin/listing/${s.listingId._id}`,className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:s.propertyName}):e.jsx("div",{className:"font-semibold",children:s.propertyName})})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return le((t=s.buyerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view buyer details",children:[e.jsx("div",{className:"font-semibold",children:((gt=s.buyerId)==null?void 0:gt.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:((ft=s.buyerId)==null?void 0:ft.email)||s.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((bt=s.buyerId)==null?void 0:bt.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return le((t=s.sellerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view seller details",children:[e.jsx("div",{className:"font-semibold",children:((pt=s.sellerId)==null?void 0:pt.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:(yt=s.sellerId)==null?void 0:yt.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((wt=s.sellerId)==null?void 0:wt.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2 capitalize",children:s.purpose}),e.jsx("td",{className:"border p-2 max-w-xs truncate",children:s.message}),e.jsxs("td",{className:"border p-2 text-center",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${zt(s.status)}`,children:s.status==="deletedByAdmin"?"Deleted by Admin":s.status==="cancelledByBuyer"?"Cancelled by Buyer":s.status==="cancelledBySeller"?"Cancelled by Seller":s.status==="cancelledByAdmin"?"Cancelled by Admin":s.status.charAt(0).toUpperCase()+s.status.slice(1)}),s.status==="deletedByAdmin"&&s.adminComment&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:['"',s.adminComment,'"']})]}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("div",{className:"flex flex-col gap-2",children:z?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>Je(s._id),title:"Unarchive Appointment",children:[e.jsx(ye,{})," Unarchive"]}):e.jsxs(e.Fragment,{children:[s.status==="cancelledByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>he(s._id),title:"Reinitiate Appointment (Admin)",children:[e.jsx(Fe,{})," Reinitiate"]}):s.status!=="deletedByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>F(s._id),title:"Cancel Appointment (Admin)",children:[e.jsx(Fe,{})," Cancel"]}):null,e.jsxs("button",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>X(s._id),title:"Archive Appointment",children:[e.jsx(Oe,{})," Archive"]})]})})}),e.jsxs("td",{className:"border p-2 text-center relative",children:[e.jsxs("button",{className:"flex items-center justify-center bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 mx-auto relative group",title:"Open Chat",onClick:Ut,children:[e.jsx(Ue,{size:22,className:"group-hover:animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-white rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-200"}),u>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold animate-pulse",children:u>9?"9+":u})]}),Be&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs relative flex flex-col items-center",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",onClick:()=>fe(!1),title:"Close",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-blue-700 flex items-center gap-2",children:[e.jsx(Fe,{})," Admin Password Required"]}),e.jsxs("form",{onSubmit:Jt,className:"w-full flex flex-col gap-3",children:[e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-blue-200",placeholder:"Enter your password",value:Se,onChange:t=>Ae(t.target.value),required:!0,autoFocus:!0}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full font-semibold",disabled:ke,children:ke?"Verifying...":"Unlock Chat"})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl w-full h-full max-w-6xl max-h-full p-0 relative animate-fadeIn flex flex-col border border-gray-200 transform transition-all duration-500 hover:shadow-3xl",children:[e.jsx("div",{className:"flex items-center gap-3 px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-700 via-purple-700 to-blue-900 rounded-t-3xl relative shadow-2xl ring-2 ring-blue-800",children:L&&O?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!O.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{$t(O),se(null)},title:"Reply","aria-label":"Reply",children:e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),!O.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{He(O.message),se(null)},title:"Copy message","aria-label":"Copy message",children:e.jsx(ns,{size:18})}),!O.deleted&&e.jsx("button",{className:"text-white hover:text-blue-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Pt(O),se(null)},title:"Message info","aria-label":"Message info",children:e.jsx(It,{size:18})}),O.senderEmail===f.email&&!O.deleted&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Bt(O),se(null)},className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",title:"Edit comment","aria-label":"Edit comment",disabled:_!==null,children:e.jsx(_t,{size:18})}),e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{ut(O),se(null)},title:"Delete","aria-label":"Delete",children:e.jsx(me,{size:18})})]}),O.senderEmail!==f.email&&!O.deleted&&e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{ut(O),se(null)},title:"Delete","aria-label":"Delete",children:e.jsx(me,{size:18})})]}),e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>se(null),title:"Close options","aria-label":"Close options",children:e.jsx(ue,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-full p-1.5 shadow-lg",children:e.jsx(Ue,{className:"text-blue-600 text-lg"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Live Chat"}),u>0&&e.jsxs("div",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold animate-pulse",children:[u," new message",u>1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[g.length>0&&e.jsx("button",{className:"text-red-100 hover:text-white bg-red-500/30 hover:bg-red-500/50 rounded-full p-2 transition-colors shadow flex items-center gap-2",onClick:()=>De(!0),title:"Delete entire chat","aria-label":"Delete chat",children:e.jsx(me,{className:"text-sm"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"text-yellow-500 hover:text-yellow-600 bg-yellow-50 hover:bg-yellow-100 rounded-full p-2 transition-colors shadow",onClick:()=>v(!c),title:"Keyboard shortcut tip","aria-label":"Show keyboard shortcut tip",children:e.jsx(rs,{className:"text-sm"})}),c&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 text-white text-xs rounded-lg px-3 py-2 shadow-lg z-20 whitespace-nowrap",children:["Press Ctrl + F to quickly focus and type your message.",e.jsx("div",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-800 transform rotate-45"})]})]}),u>0&&!a&&e.jsx("button",{className:"text-blue-500 hover:text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-full p-2 transition-colors shadow animate-bounce",onClick:ct,title:"Scroll to latest messages","aria-label":"Scroll to latest messages",children:e.jsx(Ue,{className:"text-sm"})}),e.jsx("button",{className:"text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>Ce(!1),title:"Close","aria-label":"Close",children:e.jsx(ue,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{ref:te,className:"flex-1 overflow-y-auto space-y-2 mb-4 px-4 pt-4 animate-fadeInChat relative bg-gradient-to-b from-transparent to-blue-50/30",style:{minHeight:"400px",maxHeight:"calc(100vh - 200px)"},children:[e.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-400 rounded-r-lg mb-4 transform transition-all duration-500 hover:scale-105 hover:shadow-lg hover:from-blue-100 hover:to-purple-100 hover:border-blue-500 hover:border-l-6 backdrop-blur-sm",children:e.jsxs("p",{className:"text-sm text-blue-700 font-medium text-center flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-gentlePulse",children:"🔒"}),"Chats are encrypted and secure. View only for valid purposes like disputes or fraud checks. Unauthorized access or sharing is prohibited and will be logged."]})}),P&&g.length>0&&e.jsx("div",{className:`sticky top-0 left-0 right-0 z-30 pointer-events-none transition-all duration-300 ease-in-out ${d?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:e.jsx("div",{className:"w-full flex justify-center py-2",children:e.jsx("div",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:P})})}),g.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx(Ue,{className:"text-gray-300 text-4xl mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"No messages yet"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Start a conversation to communicate with the parties"})]}):g.map((t,r)=>{var C,B,Q,Me,Nt;const l=t.senderEmail===f.email,o=_===t._id,i=new Date(t.timestamp),h=r>0?new Date(g[r-1].timestamp):null,k=h?i.toDateString()!==h.toDateString():!0;return e.jsxs(j.Fragment,{children:[k&&e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("span",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:rt(i)})}),e.jsx("div",{className:`flex w-full ${l?"justify-end":"justify-start"} animate-fadeInChatBubble`,style:{animationDelay:`${.03*r}s`},children:e.jsxs("div",{ref:$=>n.current[t._id]=$,className:`rounded-2xl px-4 sm:px-5 py-3 text-sm shadow-xl max-w-[90%] sm:max-w-[80%] md:max-w-[70%] lg:max-w-[60%] xl:max-w-[50%] break-words overflow-hidden relative transition-all duration-300 min-h-[60px] ${l?"bg-gradient-to-r from-blue-600 to-purple-700 hover:from-blue-500 hover:to-purple-600 text-white shadow-blue-200 hover:shadow-blue-300 hover:shadow-2xl":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200 shadow-gray-200 hover:shadow-lg hover:border-gray-300 hover:shadow-xl"}`,children:[t.replyTo&&e.jsx("div",{className:"border-l-4 border-purple-400 pl-3 mb-2 text-xs bg-gradient-to-r from-purple-50 to-blue-50 hover:from-purple-100 hover:to-blue-100 rounded-lg w-full max-w-full break-words cursor-pointer transition-all duration-200 hover:shadow-sm",onClick:()=>{n.current[t.replyTo]&&(n.current[t.replyTo].scrollIntoView({behavior:"smooth",block:"center"}),n.current[t.replyTo].classList.add("reply-highlight"),setTimeout(()=>{var $;($=n.current[t.replyTo])==null||$.classList.remove("reply-highlight")},1600))},role:"button",tabIndex:0,"aria-label":"Go to replied message",children:e.jsxs("span",{className:"text-xs text-gray-700 font-medium truncate max-w-[150px] flex items-center gap-1",children:[e.jsx("span",{className:"text-purple-500",children:"↩"}),((B=(C=g.find($=>$._id===t.replyTo))==null?void 0:C.message)==null?void 0:B.substring(0,30))||"Original message",((Me=(Q=g.find($=>$._id===t.replyTo))==null?void 0:Q.message)==null?void 0:Me.length)>30?"...":""]})}),e.jsx("div",{className:"font-semibold mb-2 flex items-center gap-2 justify-start text-left",children:e.jsx("span",{className:`truncate max-w-[120px] min-w-[60px] inline-block align-middle overflow-hidden text-ellipsis text-left ${l?"text-blue-100":"text-gray-700"}`,children:l?"You":(()=>{var Ct,St,At,kt;const $=t.senderEmail===((Ct=s.buyerId)==null?void 0:Ct.email),qt=t.senderEmail===((St=s.sellerId)==null?void 0:St.email);return $?((At=s.buyerId)==null?void 0:At.username)||t.senderName||t.senderEmail:qt?((kt=s.sellerId)==null?void 0:kt.username)||t.senderName||t.senderEmail:t.senderName||t.senderEmail})()})}),e.jsx("div",{className:`text-left ${l?"text-base font-medium":"text-sm"}`,children:t.deleted?(()=>{const $=E.includes(t._id);return f&&(f.role==="admin"||f.role==="rootadmin")?$?e.jsx("div",{className:"border border-gray-300 bg-gray-100 rounded p-2 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 text-xs",children:[e.jsx(Re,{className:"inline-block"}),e.jsx("span",{children:"Deleted message hidden from view"})]}),e.jsx("button",{className:"text-xs text-blue-500 hover:text-blue-700 underline",onClick:()=>Gt(t._id),title:"Show this deleted message content",children:"Show"})]})}):e.jsxs("div",{className:"border border-red-300 bg-red-50 rounded p-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-xs font-semibold mb-1",children:[e.jsx(Re,{className:"inline-block"}),"Message deleted by ",t.deletedBy||"user"," (Admin view - preserved for records)"]}),e.jsx("div",{className:"text-gray-800 bg-white p-2 rounded border-l-4 border-red-400",children:t.originalMessage?e.jsx("span",{className:"whitespace-pre-wrap break-words",children:t.originalMessage}):t.message?e.jsx("span",{className:"whitespace-pre-wrap break-words",children:t.message}):e.jsx("span",{className:"text-gray-500 italic",children:"[Message content not preserved - this message was deleted before content preservation was implemented]"})}),!1,e.jsx("button",{className:"mt-2 text-xs text-red-500 hover:text-red-700 underline",onClick:()=>Yt(t._id),title:"Hide this deleted message from your admin view",children:"Hide from admin view"})]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx(Re,{className:"inline-block text-lg"})," This message has been deleted."]})})():e.jsx("div",{children:o?e.jsx("div",{className:"bg-yellow-100 border-l-4 border-yellow-400 px-2 py-1 rounded",children:e.jsx("span",{className:"text-yellow-800 text-xs font-medium",children:"✏️ Editing this message below..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap break-words",children:(t.message||"").replace(/\n+$/,"")}),t.edited&&e.jsx("span",{className:"ml-2 text-[10px] italic text-gray-300 whitespace-nowrap",children:"(Edited)"})]})})}),e.jsxs("div",{className:"flex items-center gap-1 justify-end mt-2","data-message-actions":!0,children:[e.jsx("span",{className:`${l?"text-blue-200":"text-gray-500"} text-[10px]`,children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),!t.deleted&&e.jsx("button",{className:`${t.senderEmail===f.email?"text-blue-200 hover:text-white":"text-gray-500 hover:text-gray-700"} transition-all duration-200 hover:scale-110 p-1 rounded-full hover:bg-white hover:bg-opacity-20 ml-1`,onClick:$=>{$.stopPropagation(),se(t._id)},title:"Message options","aria-label":"Message options",children:e.jsx(as,{size:t.senderEmail===f.email?14:12})}),t.senderEmail===f.email&&!t.deleted&&e.jsx("span",{className:"ml-1 flex items-center gap-1",children:(Nt=t.readBy)!=null&&Nt.some($=>$!==f._id)?e.jsx(Dt,{className:"text-green-400 text-xs",title:"Read"}):t.status==="delivered"?e.jsx(Dt,{className:"text-blue-200 text-xs",title:"Delivered"}):t.status==="sending"?e.jsx(nt,{className:"text-blue-200 text-xs animate-pulse",title:"Sending..."}):e.jsx(nt,{className:"text-blue-200 text-xs",title:"Sent"})})]})]})})]},t._id||r)}),e.jsx("div",{ref:V})]}),ae&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsxs("span",{className:"text-xs text-gray-600 truncate max-w-[200px]",children:[(vt=ae.message)==null?void 0:vt.substring(0,40),((jt=ae.message)==null?void 0:jt.length)>40?"...":""]}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-1 transition-colors",onClick:()=>ie(null),title:"Cancel reply",children:e.jsx(ue,{className:"w-3 h-3"})})]})}),_&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-yellow-50 border-l-4 border-yellow-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold mr-2",children:"✏️ Editing message:"}),e.jsx("span",{className:"text-xs text-yellow-600 truncate",children:H}),e.jsx("button",{className:"ml-auto text-yellow-400 hover:text-yellow-700 bg-yellow-100 hover:bg-yellow-200 rounded-full p-1 transition-colors",onClick:()=>{Z(null),W(""),U("")},title:"Cancel edit",children:e.jsx(ue,{className:"w-3 h-3"})})]})}),e.jsxs("div",{className:"flex gap-2 mt-1 px-3 pb-2",children:[e.jsx("textarea",{rows:1,className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-2xl text-sm focus:ring-2 focus:ring-blue-300 focus:border-blue-400 shadow-lg transition-all duration-300 bg-white resize-y whitespace-pre-wrap break-all hover:border-blue-300 hover:shadow-xl focus:shadow-2xl transform hover:scale-[1.01]",placeholder:_?"Edit your message...":"Type a message...",value:ee,onChange:t=>{U(t.target.value),_&&W(t.target.value)},onClick:()=>{L&&(se(null),b.info("You can hit reply icon in header to reply"))},onKeyDown:t=>{const r=window.matchMedia("(min-width: 768px)").matches;if(t.key==="Enter"){if(t.isComposing||t.keyCode===229)return;(r&&!t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),_?st(_):tt())}},ref:p}),e.jsx("button",{onClick:t=>{t.preventDefault(),_?st(_):tt()},disabled:_?Ne===_:!ee.trim(),className:"bg-gradient-to-r from-blue-600 to-purple-700 text-white w-12 h-12 rounded-full shadow-lg hover:from-blue-700 hover:to-purple-800 hover:shadow-xl transform hover:scale-110 transition-all duration-300 disabled:opacity-50 disabled:transform-none flex items-center justify-center hover:shadow-2xl active:scale-95 group",children:_?Ne===_?e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-4 h-4 border border-white border-t-transparent rounded-full animate-spin"})}):e.jsx(_t,{className:"text-lg text-white group-hover:scale-110 transition-transform duration-200"}):e.jsx("div",{className:"relative",children:Ft?e.jsx(nt,{className:"text-lg text-white group-hover:scale-110 transition-all duration-300 send-icon animate-sent"}):e.jsx(ls,{className:`text-lg text-white group-hover:scale-110 transition-all duration-300 send-icon ${Qe?"animate-fly":""}`})})})]}),e.jsx("style",{jsx:!0,children:`
                @keyframes fadeInChatBubble {
                  from { opacity: 0; transform: translateY(20px) scale(0.95); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
                .animate-fadeInChatBubble {
                  animation: fadeInChatBubble 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                }
                @keyframes fadeInChat {
                  from { opacity: 0; transform: translateY(10px); }
                  to { opacity: 1; transform: translateY(0); }
                }
                .animate-fadeInChat {
                  animation: fadeInChat 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                }
                @keyframes gentlePulse {
                  0%, 100% { opacity: 1; transform: scale(1); }
                  50% { opacity: 0.9; transform: scale(1.01); }
                }
                .animate-gentlePulse {
                  animation: gentlePulse 3s ease-in-out infinite;
                }
                @keyframes attentionGlow {
                  0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
                  50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6); }
                }
                .animate-attentionGlow {
                  animation: attentionGlow 2s ease-in-out infinite;
                }
                @keyframes slideInFromTop {
                  from { opacity: 0; transform: translateY(-20px) scale(0.95); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
                                  .animate-slideInFromTop {
                    animation: slideInFromTop 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                  }
                  @keyframes sendIconFly {
                    0% { 
                      transform: translate(0, 0) scale(1); 
                      opacity: 1;
                    }
                    20% { 
                      transform: translate(0, 0) scale(1.2); 
                      opacity: 1;
                    }
                    40% { 
                      transform: translate(15px, -20px) scale(1.3); 
                      opacity: 0.8;
                    }
                    60% { 
                      transform: translate(25px, -35px) scale(1.4); 
                      opacity: 0.6;
                    }
                    80% { 
                      transform: translate(15px, -20px) scale(1.2); 
                      opacity: 0.8;
                    }
                    100% { 
                      transform: translate(0, 0) scale(1); 
                      opacity: 1;
                    }
                  }
                  .send-icon.animate-fly {
                    animation: sendIconFly 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                  }
                  @keyframes sentSuccess {
                    0% { 
                      transform: scale(0.8); 
                      opacity: 0;
                    }
                    50% { 
                      transform: scale(1.2); 
                      opacity: 1;
                    }
                    100% { 
                      transform: scale(1); 
                      opacity: 1;
                    }
                  }
                  .send-icon.animate-sent {
                    animation: sentSuccess 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                  }
                `}),!a&&!_&&!ae&&e.jsx("div",{className:"absolute bottom-20 right-6 z-20",children:e.jsxs("button",{onClick:ct,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-xl transition-all duration-200 hover:scale-110 relative transform hover:shadow-2xl",title:u>0?`${u} new message${u>1?"s":""}`:"Scroll to bottom","aria-label":u>0?`${u} new messages, scroll to bottom`:"Scroll to bottom",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})}),u>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 border-2 border-white shadow-lg",children:u>99?"99+":u})]})}),Mt&&e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm relative shadow-2xl",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",onClick:()=>{De(!1),Te("")},title:"Close","aria-label":"Close",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-red-600 flex items-center gap-2",children:[e.jsx(me,{})," Delete Entire Chat"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This will permanently delete all messages for this appointment. Enter admin password to confirm."}),e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-red-200 mb-4",placeholder:"Admin password",value:Ee,onChange:t=>Te(t.target.value),onKeyDown:t=>{t.key==="Enter"&&Ee.trim()&&!We&&(t.preventDefault(),(async()=>{try{Pe(!0);const r=await fetch(`${T}/api/bookings/${s._id}/comments`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Ee})}),l=await r.json();r.ok?(N([]),b.success("Chat deleted successfully."),De(!1),Te("")):b.error(l.message||"Failed to delete chat")}catch{b.error("An error occurred. Please try again.")}finally{Pe(!1)}})())},autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{De(!1),Te("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",disabled:We||!Ee,onClick:async()=>{try{Pe(!0);const t=await fetch(`${T}/api/bookings/${s._id}/comments`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Ee})}),r=await t.json();t.ok?(N([]),b.success("Chat deleted successfully."),De(!1),Te("")):b.error(r.message||"Failed to delete chat")}catch{b.error("An error occurred. Please try again.")}finally{Pe(!1)}},className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-60",children:We?"Deleting...":e.jsxs(e.Fragment,{children:[e.jsx(me,{size:12})," Delete Chat"]})})]})]})})]})}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(me,{className:"text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Delete Message"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to delete this message for everyone?"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{be(!1),pe(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Ht,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(me,{size:14}),"Delete"]})]})]})})}),Ve&&ge===s._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Re,{className:"text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Cancel Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify mb-4",children:"Are you sure you want to cancel this appointment?"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for cancellation (required):"}),e.jsx("textarea",{value:qe,onChange:t=>K(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:"3",placeholder:"Please provide a reason for cancelling this appointment..."})]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{D(!1),J(null),K("")},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Ke,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Re,{size:14}),"Cancel Appointment"]})]})]})})}),Ye&&ge===s._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ye,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Reinitiate Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to reinitiate this appointment? This will notify both buyer and seller."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{we(!1),J(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:R,className:"px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(ye,{size:14}),"Reinitiate"]})]})]})})}),xe&&ge===s._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Oe,{className:"text-blue-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Archive Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to archive this appointment? It will be moved to the archived section."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Ge(!1),J(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Y,className:"px-4 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Oe,{size:14}),"Archive"]})]})]})})}),Le&&ge===s._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ye,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Unarchive Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to unarchive this appointment? It will be moved back to the active appointments."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{ne(!1),J(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:oe,className:"px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(ye,{size:14}),"Unarchive"]})]})]})})}),Rt&&q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(It,{className:"text-blue-500"})," Message Info"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm text-gray-700",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Message:"}),e.jsxs("div",{className:"whitespace-pre-wrap break-words",children:[(q.message||"").slice(0,200),(q.message||"").length>200?"...":""]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Sent:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(q.timestamp).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),q.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Delivered:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(q.deliveredAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),q.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Read:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(q.readAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),!q.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Not delivered yet"})]}),q.deliveredAt&&!q.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Delivered"})]}),q.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-green-600",children:"Read"})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{at(!1),lt(null)},className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})})]})]})}export{is as default};
