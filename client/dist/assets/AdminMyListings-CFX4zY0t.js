import{g as y,r as l,j as e,L as i,Z as p,m as j,x as N,z as w,C as v,y as m}from"./index-DOobVerK.js";import{m as F}from"./addressMasking-3vIUwCOC.js";const P="https://urbansetu.onrender.com";function k(){const{currentUser:a}=y(s=>s.user),[x,n]=l.useState([]),[f,o]=l.useState(!0),[u,c]=l.useState(null);l.useEffect(()=>{(async()=>{if(!a){c("Please sign in to view your listings"),o(!1);return}try{o(!0),c(null);const t=await fetch(`${P}/api/listing/user`,{credentials:"include"});if(t.ok){const r=await t.json();a.role==="rootadmin"||a.isDefaultAdmin?n(r.filter(d=>d.userRef===a._id)):n(r)}else throw new Error("Failed to fetch listings")}catch(t){console.error("Error fetching listings:",t),c("Failed to load listings. Please try again.")}finally{o(!1)}})()},[a]);const g=async s=>{if(window.confirm("Are you sure you want to delete this listing?"))try{const t=await fetch(`/api/listing/delete/${s}`,{method:"DELETE",credentials:"include"});if(t.ok)n(r=>r.filter(d=>d._id!==s)),m.success("Listing deleted successfully!");else{const r=await t.json();m.error(r.message||"Failed to delete listing.")}}catch{m.error("An error occurred. Please try again.")}},h=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),b=s=>s.offer&&s.regularPrice&&s.discountPrice?Math.round((s.regularPrice-s.discountPrice)/s.regularPrice*100):0;return f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading your listings..."})]})}):u?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-6",children:e.jsx("div",{className:"text-center text-red-600 text-lg",children:u})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-6xl w-full mx-auto px-2 sm:px-4 md:px-8 py-8 overflow-x-hidden",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-extrabold text-blue-700 drop-shadow",children:"My Listings (Admin)"}),e.jsxs(i,{to:"/admin/create-listing",className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-sm sm:text-base w-full sm:w-auto justify-center mt-4 md:mt-0",children:[e.jsx(p,{})," ",e.jsx("span",{children:"Create New Listing"})]})]}),x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"🏠"}),e.jsx("h4",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No listings yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Start by creating your first property listing"}),e.jsxs(i,{to:"/admin/create-listing",className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold inline-flex items-center gap-1 sm:gap-2 text-sm sm:text-base w-full sm:w-auto justify-center",children:[e.jsx(p,{})," ",e.jsx("span",{children:"Create Your First Listing"})]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:x.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200",children:[s.imageUrls&&s.imageUrls.length>0?e.jsx("img",{src:s.imageUrls[0],alt:s.name,className:"w-full h-full object-cover",onError:t=>{t.target.src="https://via.placeholder.com/400x300?text=No+Image",t.target.className="w-full h-full object-cover opacity-50"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🏠"}),e.jsx("p",{className:"text-sm",children:"No Image"})]})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full text-white ${s.type==="rent"?"bg-blue-500":"bg-green-500"}`,children:s.type==="rent"?"For Rent":"For Sale"})}),s.offer&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-yellow-500 text-white",children:[b(s),"% OFF"]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-2 line-clamp-1",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:F(s.propertyNumber||s.city?{propertyNumber:s.propertyNumber,landmark:s.landmark,city:s.city,district:s.district,state:s.state,pincode:s.pincode}:s.address,!0)}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-xl font-bold text-blue-600",children:h(s.regularPrice)}),s.type==="rent"&&e.jsx("span",{className:"text-gray-500 text-sm",children:"/month"}),s.offer&&e.jsx("div",{className:"text-sm text-gray-500 line-through",children:h(s.regularPrice)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-4",children:[e.jsxs("span",{children:[s.bedrooms," bed"]}),e.jsxs("span",{children:[s.bathrooms," bath"]}),e.jsx("span",{children:s.furnished?"Furnished":"Unfurnished"}),e.jsx("span",{children:s.parking?"Parking":"No Parking"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{to:`/admin/listing/${s._id}`,className:"flex-1 bg-blue-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-blue-600 transition flex items-center justify-center gap-1",children:[e.jsx(j,{})," View"]}),e.jsxs(i,{to:`/admin/update-listing/${s._id}`,className:"flex-1 bg-yellow-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-yellow-600 transition flex items-center justify-center gap-1",children:[e.jsx(N,{})," Edit"]}),e.jsxs("button",{onClick:()=>g(s._id),className:"flex-1 bg-red-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-red-600 transition flex items-center justify-center gap-1",children:[e.jsx(w,{})," Delete"]})]})]})]},s._id))})]})})}),e.jsx(v,{})]})}export{k as default};
