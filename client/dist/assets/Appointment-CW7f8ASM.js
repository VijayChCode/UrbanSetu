import{b as w,u as k,a as S,r as i,j as e}from"./index-crh2KQ3K.js";function P(){const{currentUser:s}=w(r=>r.user),g=k(),l=S(),a=new URLSearchParams(g.search),d=a.get("listingId"),x=a.get("propertyName"),h=a.get("propertyDescription"),u=a.get("listingType"),[t,f]=i.useState({date:"",time:"",message:"",purpose:"",propertyName:x||"",propertyDescription:h||""}),[b,y]=i.useState(!1),[c,p]=i.useState(!1),[m,j]=i.useState(!1),o=r=>{f(n=>({...n,[r.target.name]:r.target.value}))},N=async r=>{if(r.preventDefault(),!m){alert("You must agree to share your contact information with the seller to book an appointment.");return}if(!s){alert("Please sign in to book an appointment."),l("/sign-in");return}if(!t.date||!t.time||!t.message||!t.purpose||!t.propertyName||!t.propertyDescription){alert("Please fill out all fields before booking the appointment.");return}if(!d){alert("Listing information is missing. Please try again.");return}p(!0);try{const n=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...t,listingId:d})}),v=await n.json();n.ok?(y(!0),setTimeout(()=>{s&&(s.role==="admin"||s.role==="rootadmin")?l("/admin/appointments"):l("/user/my-appointments")},2e3)):alert(v.message||"Failed to book appointment.")}catch(n){console.error("Error booking appointment:",n),alert("An error occurred. Please try again.")}finally{p(!1)}};return s?e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:"Book Appointment"}),b?e.jsxs("div",{className:"text-center text-green-600 text-xl font-semibold py-10",children:["Appointment booked successfully!",e.jsx("br",{}),"The property owner will review your request.",e.jsx("br",{}),"Redirecting to your appointments..."]}):e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"date",name:"date",value:t.date,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:new Date().toISOString().split("T")[0],required:!0}),e.jsx("input",{type:"time",name:"time",value:t.time,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("select",{name:"purpose",value:t.purpose,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Purpose"}),u==="rent"&&e.jsx("option",{value:"rent",children:"Rent"}),(u==="sale"||u==="buy")&&e.jsx("option",{value:"buy",children:"Buy"})]})}),e.jsx("input",{type:"text",name:"propertyName",value:t.propertyName,onChange:o,placeholder:"Property Name",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("textarea",{name:"propertyDescription",value:t.propertyDescription,onChange:o,placeholder:"Property Description",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:"2",required:!0}),e.jsx("textarea",{name:"message",value:t.message,onChange:o,placeholder:"Tell us about your requirements...",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:"4",required:!0}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"agreement",checked:m,onChange:r=>j(r.target.checked),required:!0}),e.jsxs("label",{htmlFor:"agreement",className:"text-sm text-gray-700 select-none",children:["I understand that ",e.jsx("span",{className:"font-semibold text-blue-700",children:"my contact information and details will be shared with the seller"})," for this appointment."]})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{type:"submit",disabled:c,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 px-8 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Booking...":"Book Appointment"})})]})]})}):e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsx("div",{className:"text-center text-red-600 text-xl font-semibold py-10",children:"Please sign in to book an appointment."})})})}export{P as default};
