import{r as l,g as P,u as E,k as D,h as I,j as e,l as T,m as F,L as j,s as A,n as L,o as w,p as O,q as U}from"./index-Djytd6kq.js";import C from"./Oauth-BfywYDps.js";const H="https://urbansetu.onrender.com";function q({bootstrapped:m,sessionChecked:u}){const[h,y]=l.useState({email:"",password:""}),[n,x]=l.useState(""),[o,v]=l.useState(!1),{loading:f,error:g,currentUser:r}=P(a=>a.user),s=E(),i=D(),p=I();l.useEffect(()=>{new URLSearchParams(p.search).get("error")==="password_change_unsuccessful"&&(x("Password change unsuccessful! Please try again."),s("/sign-in",{replace:!0}))},[p.search,s]),l.useEffect(()=>{m&&u&&r&&(r.role==="admin"||r.role==="rootadmin"?r.isDefaultAdmin?s("/admin",{replace:!0}):s("/admin",{replace:!0}):s("/user",{replace:!0}))},[m,u,r,s]);const b=a=>{y({...h,[a.target.id]:a.target.value}),n&&x("")},N=async a=>{a.preventDefault(),i(A());const c=L();c||console.warn("Third-party cookies are blocked. Using localStorage fallback for authentication.");try{const d=`${H}/api/auth/signin`,S={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(h)},t=await(await fetch(d,S)).json();if(t.success===!1){i(w(t.message));return}t.token?(localStorage.setItem("accessToken",t.token),console.log("Saved accessToken to localStorage:",t.token),c||console.log("Authentication will use localStorage since cookies are blocked")):console.warn("No token found in login response!"),i(O(t)),await new Promise(k=>setTimeout(k,50)),console.log("Reconnecting socket after login with token:",localStorage.getItem("accessToken")),U(),t.role==="admin"||t.role==="rootadmin"?(t.isDefaultAdmin,s("/admin")):s("/user")}catch(d){i(w(d.message))}};return e.jsxs("div",{className:"min-h-screen flex",children:[e.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-blue-600 to-purple-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),e.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Welcome Back"}),e.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:`"Home is not a place, it's a feeling. Find your perfect sanctuary with us."`}),e.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Discover Your Dream Home"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("span",{children:"Connect with Trusted Agents"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),e.jsx("span",{children:"Secure & Reliable Platform"})]})]})]})}),e.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),e.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20",children:e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M10 2L2 8V18H18V8L10 2Z",fill:"white",fillOpacity:"0.1"}),e.jsx("path",{d:"M8 12H12V18H8V12Z",fill:"white",fillOpacity:"0.2"}),e.jsx("circle",{cx:"10",cy:"5",r:"1",fill:"white",fillOpacity:"0.3"})]})})]}),e.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8 bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Sign In"}),e.jsx("p",{className:"text-gray-600",children:"Welcome back! Please sign in to your account."})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",placeholder:"Enter your email",id:"email",onChange:b,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",placeholder:"Enter your password",id:"password",onChange:b,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 pr-12",required:!0}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-700 focus:outline-none",tabIndex:-1,onClick:()=>v(a=>!a),"aria-label":o?"Hide password":"Show password",children:o?e.jsx(T,{}):e.jsx(F,{})})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(j,{to:"/forgot-password",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200",children:"Forgot Password?"})}),e.jsx("button",{disabled:f,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:f?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing In..."]}):"Sign In"}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),e.jsx(C,{pageType:"signIn"}),(g||n)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:n||g})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",e.jsx(j,{to:"/sign-up",className:"text-blue-600 hover:text-blue-800 font-semibold hover:underline transition-colors duration-200",children:"Sign Up"})]})})]})]})})]})}export{q as default};
