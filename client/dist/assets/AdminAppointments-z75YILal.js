import{g as Le,r as x,t as U,j as e,L as Ne,_ as Re,$ as Ce,a0 as Ae,a1 as $e,H as Fe,a2 as se,v as Me,f as Pe,a3 as Ue,a4 as ze,y as g,Y as j,a5 as ie,G as ce,D as Oe,z as He}from"./index-VYaW5OKz.js";const S="https://urbansetu.onrender.com";function Je(){const{currentUser:s}=Le(r=>r.user),[p,I]=x.useState([]),[Q,$]=x.useState([]),[oe,z]=x.useState(!0),[_,y]=x.useState("all"),[f,O]=x.useState(""),[h,re]=x.useState(null),[ae,H]=x.useState(!1),[V,B]=x.useState(!1),[k,W]=x.useState(!1),[T,F]=x.useState(""),[D,A]=x.useState("");x.useEffect(()=>{const r=async()=>{try{const m=await(await fetch(`${S}/api/bookings`,{credentials:"include"})).json();I(m),z(!1)}catch(a){console.error("Failed to fetch appointments",a),z(!1)}},n=async()=>{try{const m=await(await fetch(`${S}/api/bookings/archived`,{credentials:"include"})).json();$(m)}catch(a){console.error("Failed to fetch archived appointments",a)}};r(),n();const i=setInterval(()=>{r(),n()},5e3),w=a=>{I(m=>m.map(u=>{const v={...u};return u.buyerId&&(u.buyerId._id===a.userId||u.buyerId===a.userId)&&(v.buyerId={...v.buyerId,username:a.username,email:a.email,mobileNumber:a.mobileNumber,avatar:a.avatar}),u.sellerId&&(u.sellerId._id===a.userId||u.sellerId===a.userId)&&(v.sellerId={...v.sellerId,username:a.username,email:a.email,mobileNumber:a.mobileNumber,avatar:a.avatar}),v})),$(m=>m.map(u=>{const v={...u};return u.buyerId&&(u.buyerId._id===a.userId||u.buyerId===a.userId)&&(v.buyerId={...v.buyerId,username:a.username,email:a.email,mobileNumber:a.mobileNumber,avatar:a.avatar}),u.sellerId&&(u.sellerId._id===a.userId||u.sellerId===a.userId)&&(v.sellerId={...v.sellerId,username:a.username,email:a.email,mobileNumber:a.mobileNumber,avatar:a.avatar}),v}))};return U.on("profileUpdated",w),()=>{clearInterval(i),U.off("profileUpdated",w)}},[]),x.useEffect(()=>{s&&(I(r=>r.map(n=>{const i={...n};return n.buyerId&&(n.buyerId._id===s._id||n.buyerId===s._id)&&(i.buyerId={...i.buyerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),n.sellerId&&(n.sellerId._id===s._id||n.sellerId===s._id)&&(i.sellerId={...i.sellerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),i})),$(r=>r.map(n=>{const i={...n};return n.buyerId&&(n.buyerId._id===s._id||n.buyerId===s._id)&&(i.buyerId={...i.buyerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),n.sellerId&&(n.sellerId._id===s._id||n.sellerId===s._id)&&(i.sellerId={...i.sellerId,username:s.username,email:s.email,mobileNumber:s.mobileNumber,avatar:s.avatar}),i})))},[s]);const K=async r=>{const n=prompt("Please provide a reason for cancelling this appointment:");if(n&&window.confirm("Are you sure you want to cancel this appointment?"))try{console.log("Attempting to cancel appointment:",r),console.log("Current user:",s),console.log("User role:",s.role),console.log("Admin approval status:",s.adminApprovalStatus);const i=p.find(m=>m._id===r);i&&(console.log("Current appointment status:",i.status),console.log("Appointment date:",i.date),console.log("Appointment time:",i.time));const w=await fetch(`${S}/api/bookings/${r}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:n})});console.log("Response status:",w.status);const a=await w.json();console.log("Response data:",a),w.ok?(I(m=>m.map(u=>u._id===r?{...u,status:"cancelledByAdmin",cancelReason:n}:u)),g.success("Appointment cancelled successfully. Both buyer and seller have been notified of the cancellation.")):g.error(a.message||"Failed to cancel appointment.")}catch(i){console.error("Error in handleAdminCancel:",i),g.error("An error occurred. Please try again.")}},ne=async r=>{if(window.confirm("Are you sure you want to reinitiate this appointment? This will notify both buyer and seller."))try{console.log("Attempting to reinitiate appointment:",r);const n=await fetch(`${S}/api/bookings/${r}/reinitiate`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"});console.log("Response status:",n.status);const i=await n.json();console.log("Response data:",i),n.ok?(I(w=>w.map(a=>a._id===r?{...a,status:"pending",cancelReason:""}:a)),g.success("Appointment reinitiated successfully. Both buyer and seller have been notified.")):g.error(i.message||"Failed to reinitiate appointment.")}catch(n){console.error("Error in handleReinitiateAppointment:",n),g.error("An error occurred. Please try again.")}},q=async r=>{if(window.confirm("Are you sure you want to archive this appointment? It will be moved to the archived section."))try{const n=await fetch(`${S}/api/bookings/${r}/archive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),i=await n.json();if(n.ok){const w=p.find(a=>a._id===r);w&&(I(a=>a.filter(m=>m._id!==r)),$(a=>[{...w,archivedByAdmin:!0,archivedAt:new Date},...a])),g.success("Appointment archived successfully.")}else g.error(i.message||"Failed to archive appointment.")}catch(n){console.error("Error in handleArchiveAppointment:",n),g.error("An error occurred. Please try again.")}},X=async r=>{if(window.confirm("Are you sure you want to unarchive this appointment? It will be moved back to the active appointments."))try{const n=await fetch(`${S}/api/bookings/${r}/unarchive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),i=await n.json();if(n.ok){const w=Q.find(a=>a._id===r);w&&($(a=>a.filter(m=>m._id!==r)),I(a=>[{...w,archivedByAdmin:!1,archivedAt:void 0},...a])),g.success("Appointment unarchived successfully.")}else g.error(i.message||"Failed to unarchive appointment.")}catch(n){console.error("Error in handleUnarchiveAppointment:",n),g.error("An error occurred. Please try again.")}},Z=async r=>{if(!r){g.error("User ID not available");return}B(!0),H(!0);try{const n=await fetch(`${S}/api/user/id/${r}`),i=await n.json();n.ok?re(i):(g.error("Failed to fetch user details."),H(!1))}catch{g.error("An error occurred while fetching user details."),H(!1)}B(!1)},ee=p.filter(r=>{var m,u,v,J,G,M,P,Y,R;const n=new Date(r.date)<new Date||new Date(r.date).toDateString()===new Date().toDateString()&&r.time&&r.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),i=_==="all"?!0:_==="outdated"?n:r.status===_,w=((u=(m=r.buyerId)==null?void 0:m.email)==null?void 0:u.toLowerCase().includes(f.toLowerCase()))||((J=(v=r.sellerId)==null?void 0:v.email)==null?void 0:J.toLowerCase().includes(f.toLowerCase()))||((G=r.propertyName)==null?void 0:G.toLowerCase().includes(f.toLowerCase()))||((P=(M=r.buyerId)==null?void 0:M.username)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((R=(Y=r.sellerId)==null?void 0:Y.username)==null?void 0:R.toLowerCase().includes(f.toLowerCase()));let a=!0;return T&&(a=a&&new Date(r.date)>=new Date(T)),D&&(a=a&&new Date(r.date)<=new Date(D)),i&&w&&a}),te=Q.filter(r=>{var m,u,v,J,G,M,P,Y,R;const n=new Date(r.date)<new Date||new Date(r.date).toDateString()===new Date().toDateString()&&r.time&&r.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),i=_==="all"?!0:_==="outdated"?n:r.status===_,w=((u=(m=r.buyerId)==null?void 0:m.email)==null?void 0:u.toLowerCase().includes(f.toLowerCase()))||((J=(v=r.sellerId)==null?void 0:v.email)==null?void 0:J.toLowerCase().includes(f.toLowerCase()))||((G=r.propertyName)==null?void 0:G.toLowerCase().includes(f.toLowerCase()))||((P=(M=r.buyerId)==null?void 0:M.username)==null?void 0:P.toLowerCase().includes(f.toLowerCase()))||((R=(Y=r.sellerId)==null?void 0:Y.username)==null?void 0:R.toLowerCase().includes(f.toLowerCase()));let a=!0;return T&&(a=a&&new Date(r.date)>=new Date(T)),D&&(a=a&&new Date(r.date)<=new Date(D)),i&&w&&a}),L=async()=>{z(!0);try{const r=await fetch(`${S}/api/bookings`,{credentials:"include"});if(r.ok){const i=await r.json();I(i)}const n=await fetch(`${S}/api/bookings/archived`,{credentials:"include"});if(n.ok){const i=await n.json();$(Array.isArray(i)?i:[])}}catch{}finally{z(!1)}};return oe?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading appointments..."})]})}):Array.isArray(p)?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:[e.jsx(Re,{position:"top-center",autoClose:2e3,closeOnClick:!0,containerClassName:"!z-[100]",toastOptions:{style:{fontSize:"0.9rem",borderRadius:"8px",boxShadow:"0 2px 8px #0001"}}}),e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-6",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-extrabold text-blue-700 drop-shadow",children:k?"Archived Appointments":"All Appointments (Admin View)"}),e.jsxs("div",{className:"flex flex-row w-full sm:w-auto gap-2 sm:gap-4 justify-center sm:justify-end mt-2 sm:mt-0",children:[e.jsx("button",{onClick:L,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-2.5 py-1.5 rounded-md hover:from-blue-600 hover:to-purple-600 transition-all font-semibold shadow-md text-xs sm:text-base sm:px-4 sm:py-2 sm:rounded-lg w-1/2 sm:w-auto",title:"Refresh appointments",children:"Refresh"}),e.jsx("button",{onClick:()=>W(!k),className:`bg-gradient-to-r text-white px-2.5 py-1.5 rounded-md transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-xs sm:text-base w-1/2 sm:w-auto sm:px-6 sm:py-3 sm:rounded-lg justify-center ${k?"from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600":"from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:k?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{})," ",e.jsx("span",{children:"Active Appointments"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{})," ",e.jsxs("span",{children:["Archived Appointments (",Q.length,")"]})]})})]})]}),e.jsx("p",{className:"text-center text-gray-600 mb-6",children:k?"View and manage archived appointments. You can unarchive them to move them back to active appointments.":"Monitor all appointments across the platform. Use the status filter to view pending appointments. ðŸ’¡ Outdated appointments (past their scheduled date) are automatically ignored when booking new appointments."}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"Status:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:_,onChange:r=>y(r.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"pending",children:"Pending Appointments"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelledByBuyer",children:"Cancelled by Buyer"}),e.jsx("option",{value:"cancelledBySeller",children:"Cancelled by Seller"}),e.jsx("option",{value:"cancelledByAdmin",children:"Cancelled by Admin"}),e.jsx("option",{value:"deletedByAdmin",children:"Deleted by Admin"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"noShow",children:"No Show"}),e.jsx("option",{value:"outdated",children:"Outdated"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"From:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:T,onChange:r=>F(r.target.value),max:D||void 0}),e.jsx("label",{className:"font-semibold",children:"To:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:D,onChange:r=>A(r.target.value),min:T||void 0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"text-gray-500"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",placeholder:"Search by email, property, or username...",value:f,onChange:r=>O(r.target.value)})]})]}),k?te.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No archived appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:te.map(r=>e.jsx(je,{appt:r,currentUser:s,handleAdminCancel:K,handleReinitiateAppointment:ne,handleArchiveAppointment:q,handleUnarchiveAppointment:X,onUserClick:Z,isArchived:!0},r._id))})]})}):ee.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:ee.map(r=>e.jsx(je,{appt:r,currentUser:s,handleAdminCancel:K,handleReinitiateAppointment:ne,handleArchiveAppointment:q,handleUnarchiveAppointment:X,onUserClick:Z,isArchived:!1},r._id))})]})})]}),ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto relative animate-fadeIn",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>H(!1),title:"Close","aria-label":"Close",children:e.jsx(Fe,{className:"w-4 h-4"})}),V?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-4 text-gray-600",children:"Loading user details..."})]}):h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[h.avatar&&h.avatar.trim()&&h.avatar!=="null"&&h.avatar!=="undefined"?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:h.avatar,alt:h.username,className:"w-16 h-16 rounded-full object-cover border-4 border-white shadow-lg",onError:r=>{r.target.style.display="none",r.target.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"w-16 h-16 rounded-full border-4 border-white shadow-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",style:{display:"none"},children:e.jsx("span",{className:"text-white font-bold text-lg",children:h.username?h.username.split(" ").map(r=>r.charAt(0).toUpperCase()).join("").slice(0,2):"U"})})]}):e.jsx("div",{className:"w-16 h-16 rounded-full border-4 border-white shadow-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-lg",children:h.username?h.username.split(" ").map(r=>r.charAt(0).toUpperCase()).join("").slice(0,2):"U"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 border-2 border-white rounded-full flex items-center justify-center",children:h.role==="admin"||h.role==="rootadmin"?e.jsx(se,{className:"w-3 h-3 text-white"}):e.jsx(Me,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:[h.username,(h.role==="admin"||h.role==="rootadmin")&&e.jsx(se,{className:"text-purple-600 text-base",title:"Admin user"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("p",{className:"text-sm text-gray-600 capitalize font-medium bg-white px-3 py-1 rounded-full shadow-sm",children:h.role||"User"}),h.adminApprovalStatus&&e.jsx("p",{className:`text-xs font-medium px-2 py-1 rounded-full ${h.adminApprovalStatus==="approved"?"bg-green-100 text-green-700":h.adminApprovalStatus==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:h.adminApprovalStatus})]})]})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx(Pe,{className:"text-blue-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Email"}),e.jsx("p",{className:"text-gray-800 font-medium",children:h.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-green-500",children:[e.jsx(Ue,{className:"text-green-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Phone"}),e.jsx("p",{className:"text-gray-800 font-medium",children:h.mobileNumber||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-purple-500",children:[e.jsx(ze,{className:"text-purple-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Member Since"}),e.jsx("p",{className:"text-gray-800 font-medium",children:new Date(h.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]}),e.jsx("button",{onClick:()=>H(!1),className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold",children:"Close"})]})]}):e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("p",{className:"text-gray-600",children:"User not found"})})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-blue-100",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Session expired or unauthorized"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Please sign in again to access admin appointments."}),e.jsx(Ne,{to:"/sign-in",className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Go to Sign In"})]})})}function me(s){const p=new Date,I=new Date;return I.setDate(p.getDate()-1),s.toDateString()===p.toDateString()?"Today":s.toDateString()===I.toDateString()?"Yesterday":s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}function je({appt:s,currentUser:p,handleAdminCancel:I,handleReinitiateAppointment:Q,handleArchiveAppointment:$,handleUnarchiveAppointment:oe,onUserClick:z,isArchived:_}){var ge,be,fe,pe,ye,we;const[y,f]=x.useState(s.comments||[]),[O,h]=x.useState(""),[re,ae]=x.useState(!1),[H,V]=x.useState(null),[B,k]=x.useState(""),[W,T]=x.useState(null),[F,D]=x.useState(null),[A,K]=x.useState(!1),[ne,q]=x.useState(!1),[X,Z]=x.useState(""),[ee,te]=x.useState(!1),L=j.useRef(null),r=j.useRef(null),n=j.useRef(null),i=j.useRef({}),[w,a]=x.useState(!0),[m,u]=x.useState(0),[v,J]=x.useState(""),[G,M]=x.useState(()=>Ee(s._id));j.useEffect(()=>{A&&L.current&&L.current.scrollIntoView({behavior:"smooth"})},[A]);const P=j.useRef(y.length),Y=j.useRef(y);j.useEffect(()=>{const t=y.slice(P.current),o=t.length;if(P.current=y.length,Y.current=y,o>0&&A){const l=t.some(d=>d.senderEmail===p.email),c=t.filter(d=>d.senderEmail!==p.email);l||w?setTimeout(()=>{L.current&&L.current.scrollIntoView({behavior:"smooth"})},100):c.length>0&&u(d=>d+c.length)}},[y.length,w,A,p.email]),j.useEffect(()=>{u(0)},[A]);const R=j.useCallback(()=>{if(!r.current||y.length===0)return;const o=r.current.getBoundingClientRect(),l=o.top+60;let c="";for(let d=0;d<y.length;d++){const b=i.current[y[d]._id];if(b){const N=b.getBoundingClientRect();if(N.top>=l&&N.bottom<=o.bottom){const E=new Date(y[d].timestamp);c=me(E);break}}}if(!c)for(let d=0;d<y.length;d++){const b=i.current[y[d]._id];if(b&&b.getBoundingClientRect().bottom>l){const E=new Date(y[d].timestamp);c=me(E);break}}c&&c!==v&&J(c)},[y,v]),le=j.useCallback(async()=>{const t=y.filter(o=>{var l;return!((l=o.readBy)!=null&&l.includes(p._id))&&o.senderEmail!==p.email});if(t.length>0)try{(await fetch(`${S}/api/bookings/${s._id}/comments/read`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"})).ok&&(f(l=>l.map(c=>t.some(d=>d._id===c._id)?{...c,readBy:[...c.readBy||[],p._id],status:"read"}:c)),t.forEach(l=>{U.emit("messageRead",{appointmentId:s._id,messageId:l._id,userId:p._id})}))}catch(o){console.error("Error marking messages as read:",o)}},[y,p._id,s._id,U]),de=j.useCallback(()=>{if(r.current){const{scrollTop:t,scrollHeight:o,clientHeight:l}=r.current,c=o-t-l<5;a(c),c&&m>0&&(u(0),le())}},[m,le]);j.useEffect(()=>{const t=r.current;if(t&&A){const o=()=>{de(),R()};return t.addEventListener("scroll",o),de(),setTimeout(R,100),()=>{t.removeEventListener("scroll",o)}}},[A,de,R]);const Se=j.useCallback(()=>{L.current&&(L.current.scrollIntoView({behavior:"smooth"}),u(0),setTimeout(()=>{le()},500))},[le]);j.useEffect(()=>(A?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[A]),j.useEffect(()=>{function t(o){o.appointmentId===s._id&&!A&&g.custom(l=>e.jsxs("div",{className:"bg-blue-600 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 animate-bounce-in",children:[e.jsx(ie,{})," New message from ",o.comment.senderEmail||"User",e.jsx("button",{onClick:()=>{K(!0),g.dismiss(l.id)},className:"ml-4 bg-white text-blue-700 px-2 py-1 rounded",children:"Open Chat"})]}))}return U.on("commentUpdate",t),()=>{U.off("commentUpdate",t)}},[s._id,A]),j.useEffect(()=>{function t(o){o.appointmentId===s._id&&f(l=>{const c=l.findIndex(d=>d._id===o.comment._id);if(c!==-1){const d=[...l];return d[c]=o.comment,d}else return[...l,o.comment]})}return U.on("commentUpdate",t),()=>{U.off("commentUpdate",t)}},[s._id,f]);const ue=async()=>{if(!O.trim())return;ae(!0);const t=`temp-${Date.now()}`,o={_id:t,senderEmail:p.email,message:O,status:"sending",timestamp:new Date().toISOString(),readBy:[p._id],...F?{replyTo:F._id}:{}};f(c=>[...c,o]);const l=O;h(""),D(null);try{const c=await fetch(`${S}/api/bookings/${s._id}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:l,...F?{replyTo:F._id}:{}})}),d=await c.json();c.ok?(f(b=>[...b.filter(N=>N._id!==t),...d.comments.filter(N=>!b.some(E=>E._id===N._id))]),g.success("Comment sent successfully!")):(f(b=>b.filter(N=>N._id!==t)),h(l),g.error(d.message||"Failed to send comment."))}catch{f(d=>d.filter(b=>b._id!==t)),h(l),g.error("An error occurred. Please try again.")}ae(!1)},he=async t=>{if(!B.trim())return;T(t),f(l=>l.map(c=>c._id===t?{...c,message:B,edited:!0,editedAt:new Date}:c)),V(null),k("");try{const l=await fetch(`${S}/api/bookings/${s._id}/comment/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:B})}),c=await l.json();l.ok?(f(d=>d.map(b=>{const N=c.comments.find(E=>E._id===b._id);return N?N._id===t?N:b.status==="read"&&N.status!=="read"?{...N,status:"read"}:N:b})),g.success("Comment edited successfully!")):(f(d=>d.map(b=>b._id===t?{...b,message:b.originalMessage||b.message,edited:b.wasEdited||!1}:b)),V(t),k(B),g.error(c.message||"Failed to edit comment."))}catch{f(c=>c.map(d=>d._id===t?{...d,message:d.originalMessage||d.message,edited:d.wasEdited||!1}:d)),V(t),k(B),g.error("An error occurred. Please try again.")}finally{T(null)}},Ie=t=>{V(t._id),k(t.message),f(o=>o.map(l=>l._id===t._id?{...l,originalMessage:l.message,wasEdited:l.edited}:l))},xe=new Date(s.date)>new Date||new Date(s.date).toDateString()===new Date().toDateString()&&(!s.time||s.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),ke=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-700";case"accepted":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"cancelledByBuyer":return"bg-red-100 text-red-700";case"cancelledBySeller":return"bg-red-100 text-red-700";case"cancelledByAdmin":return"bg-red-100 text-red-700";case"deletedByAdmin":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},_e=()=>{q(!0),Z("")},De=async t=>{t.preventDefault(),te(!0);try{const o=await fetch(`${S}/api/auth/verify-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:X})}),l=await o.json();o.ok&&l.success?(q(!1),K(!0)):g.error("Incorrect password. Please try again.")}catch{g.error("Failed to verify password. Please try again.")}te(!1)};function Ee(t){try{return JSON.parse(localStorage.getItem(`hiddenDeletedMsgs_${t}`))||[]}catch{return[]}}const Be=j.useCallback(t=>{M(o=>{if(!o.includes(t)){const l=[...o,t];return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${s._id}`,JSON.stringify(l))},0),l}return o})},[s._id]),Te=j.useCallback(t=>{M(o=>{const l=o.filter(c=>c!==t);return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${s._id}`,JSON.stringify(l))},0),l})},[s._id]);return e.jsxs("tr",{className:`hover:bg-blue-50 transition align-top ${_?"bg-gray-50":""} ${xe?"":"bg-gray-100"}`,children:[e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[e.jsx("div",{children:new Date(s.date).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-sm text-gray-600",children:s.time}),!xe&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"Outdated"}),_&&s.archivedAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Archived: ",new Date(s.archivedAt).toLocaleDateString("en-GB")]})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{children:s.listingId?e.jsx(Ne,{to:`/admin/listing/${s.listingId._id}`,className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:s.propertyName}):e.jsx("div",{className:"font-semibold",children:s.propertyName})})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return z((t=s.buyerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view buyer details",children:[e.jsx("div",{className:"font-semibold",children:((ge=s.buyerId)==null?void 0:ge.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:((be=s.buyerId)==null?void 0:be.email)||s.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((fe=s.buyerId)==null?void 0:fe.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return z((t=s.sellerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view seller details",children:[e.jsx("div",{className:"font-semibold",children:((pe=s.sellerId)==null?void 0:pe.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:(ye=s.sellerId)==null?void 0:ye.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((we=s.sellerId)==null?void 0:we.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2 capitalize",children:s.purpose}),e.jsx("td",{className:"border p-2 max-w-xs truncate",children:s.message}),e.jsxs("td",{className:"border p-2 text-center",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${ke(s.status)}`,children:s.status==="deletedByAdmin"?"Deleted by Admin":s.status==="cancelledByBuyer"?"Cancelled by Buyer":s.status==="cancelledBySeller"?"Cancelled by Seller":s.status==="cancelledByAdmin"?"Cancelled by Admin":s.status.charAt(0).toUpperCase()+s.status.slice(1)}),s.status==="deletedByAdmin"&&s.adminComment&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:['"',s.adminComment,'"']})]}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("div",{className:"flex flex-col gap-2",children:_?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>oe(s._id),title:"Unarchive Appointment",children:[e.jsx(Ce,{})," Unarchive"]}):e.jsxs(e.Fragment,{children:[s.status==="cancelledByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>Q(s._id),title:"Reinitiate Appointment (Admin)",children:[e.jsx(se,{})," Reinitiate"]}):s.status!=="deletedByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>I(s._id),title:"Cancel Appointment (Admin)",children:[e.jsx(se,{})," Cancel"]}):null,e.jsxs("button",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>$(s._id),title:"Archive Appointment",children:[e.jsx(Ae,{})," Archive"]})]})})}),e.jsxs("td",{className:"border p-2 text-center relative",children:[e.jsx("button",{className:"flex items-center justify-center bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-full p-2 shadow-md mx-auto relative",title:"Open Chat",onClick:_e,children:e.jsx(ie,{size:20})}),ne&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs relative flex flex-col items-center",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl",onClick:()=>q(!1),title:"Close",children:"Ã—"}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-blue-700 flex items-center gap-2",children:[e.jsx(se,{})," Admin Password Required"]}),e.jsxs("form",{onSubmit:De,className:"w-full flex flex-col gap-3",children:[e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-blue-200",placeholder:"Enter your password",value:X,onChange:t=>Z(t.target.value),required:!0,autoFocus:!0}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full font-semibold",disabled:ee,children:ee?"Verifying...":"Unlock Chat"})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 rounded-2xl shadow-2xl w-full h-full max-w-6xl max-h-full p-0 relative animate-fadeIn flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-200 to-purple-200 rounded-t-2xl relative",children:[e.jsx(ie,{className:"text-blue-600 text-xl"}),e.jsx("h3",{className:"text-lg font-bold text-blue-800",children:"Chat"}),e.jsx("div",{className:"flex items-center gap-3 ml-auto",children:e.jsx("button",{className:"text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>K(!1),title:"Close","aria-label":"Close",children:"Ã—"})})]}),e.jsxs("div",{ref:r,className:"flex-1 overflow-y-auto space-y-2 mb-4 px-4 pt-4 animate-fadeInChat relative",style:{minHeight:"400px",maxHeight:"calc(100vh - 200px)"},children:[v&&y.length>0&&e.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-30 pointer-events-none",children:e.jsx("div",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white animate-fadeIn",children:v})}),y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx(ie,{className:"text-gray-300 text-4xl mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"No messages yet"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Start a conversation to communicate with the parties"})]}):y.map((t,o)=>{var E;const l=t.senderEmail===p.email,c=H===t._id,d=new Date(t.timestamp),b=o>0?new Date(y[o-1].timestamp):null,N=b?d.toDateString()!==b.toDateString():!0;return e.jsxs(j.Fragment,{children:[N&&e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("span",{className:"bg-gray-200 text-gray-700 text-xs px-3 py-1 rounded-full shadow",children:me(d)})}),e.jsx("div",{className:`flex w-full ${l?"justify-end":"justify-start"} animate-fadeInChatBubble`,style:{animationDelay:`${.03*o}s`},children:e.jsxs("div",{ref:C=>i.current[t._id]=C,className:`rounded-2xl px-4 py-2 text-sm shadow-lg max-w-[80%] break-words relative ${l?"bg-gradient-to-r from-blue-400 to-blue-600 text-white":"bg-white text-gray-800 border border-gray-200"}`,children:[t.replyTo&&e.jsx("div",{className:"border-l-4 border-blue-300 pl-2 mb-1 text-xs text-gray-500 bg-blue-50 rounded w-full max-w-full break-words cursor-pointer",onClick:()=>{i.current[t.replyTo]&&(i.current[t.replyTo].scrollIntoView({behavior:"smooth",block:"center"}),i.current[t.replyTo].classList.add("ring-2","ring-yellow-400"),setTimeout(()=>{i.current[t.replyTo].classList.remove("ring-2","ring-yellow-400")},1e3))},role:"button",tabIndex:0,"aria-label":"Go to replied message",children:e.jsx("span",{className:"text-xs text-gray-600 truncate",children:((E=y.find(C=>C._id===t.replyTo))==null?void 0:E.message)||"Original message"})}),e.jsxs("div",{className:"font-semibold mb-1 flex items-center gap-2",children:[l?"You":t.senderEmail,e.jsx("span",{className:"text-gray-300 ml-2 text-[10px]",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})})]}),e.jsx("div",{className:"text-left",children:c?e.jsxs("div",{className:"w-full",children:[e.jsx("input",{type:"text",className:"border rounded px-2 py-1 text-xs w-full text-gray-900 bg-white focus:bg-white mb-2",value:B,onChange:C=>k(C.target.value),onKeyDown:C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),he(t._id))},autoFocus:!0}),e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx("button",{onClick:()=>he(t._id),disabled:W===t._id,className:"bg-green-700 hover:bg-green-900 disabled:bg-green-500 disabled:cursor-not-allowed text-white font-bold px-2 py-1 rounded text-xs flex items-center gap-1",children:W===t._id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save"}),e.jsx("button",{onClick:()=>{V(null),k("")},disabled:W===t._id,className:"bg-red-700 hover:bg-red-900 disabled:bg-red-500 disabled:cursor-not-allowed text-white font-bold px-2 py-1 rounded text-xs",children:"Cancel"})]})]}):t.deleted?(()=>{const C=G.includes(t._id);return p&&(p.role==="admin"||p.role==="rootadmin")?C?e.jsx("div",{className:"border border-gray-300 bg-gray-100 rounded p-2 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 text-xs",children:[e.jsx(ce,{className:"inline-block"}),e.jsx("span",{children:"Deleted message hidden from view"})]}),e.jsx("button",{className:"text-xs text-blue-500 hover:text-blue-700 underline",onClick:()=>Te(t._id),title:"Show this deleted message content",children:"Show"})]})}):e.jsxs("div",{className:"border border-red-300 bg-red-50 rounded p-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-xs font-semibold mb-1",children:[e.jsx(ce,{className:"inline-block"}),"Message deleted by ",t.deletedBy||"user"," (Admin view - preserved for records)"]}),e.jsx("div",{className:"text-gray-800 bg-white p-2 rounded border-l-4 border-red-400",children:t.originalMessage?e.jsx("span",{children:t.originalMessage}):t.message?e.jsx("span",{children:t.message}):e.jsx("span",{className:"text-gray-500 italic",children:"[Message content not preserved - this message was deleted before content preservation was implemented]"})}),!1,e.jsx("button",{className:"mt-2 text-xs text-red-500 hover:text-red-700 underline",onClick:()=>Be(t._id),title:"Hide this deleted message from your admin view",children:"Hide from admin view"})]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx(ce,{className:"inline-block text-lg"})," This message has been deleted."]})})():e.jsxs("div",{children:[t.message,t.edited&&e.jsx("span",{className:"ml-2 text-[10px] italic text-gray-300",children:"(Edited)"})]})}),e.jsxs("div",{className:"flex items-center gap-2 justify-end mt-1",children:[!t.deleted&&e.jsx("button",{className:`${t.senderEmail===p.email?"text-yellow-500 hover:text-yellow-700":"text-blue-600 hover:text-blue-800"}`,onClick:()=>{var C;D(t),(C=n.current)==null||C.focus()},title:"Reply",children:e.jsx("svg",{width:"18",height:"18",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),t.senderEmail===p.email&&!c&&!t.deleted&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ie(t),className:"text-green-700 hover:text-green-900",title:"Edit comment",children:e.jsx(Oe,{size:12})}),e.jsx("button",{className:"text-red-700 hover:text-red-900",onClick:async()=>{if(window.confirm("Are you sure you want to delete this comment?"))try{const C=await fetch(`${S}/api/bookings/${s._id}/comment/${t._id}`,{method:"DELETE",credentials:"include"}),ve=await C.json();C.ok?(f(ve.comments),g.success("Comment deleted successfully!")):g.error(ve.message||"Failed to delete comment.")}catch{g.error("An error occurred. Please try again.")}},title:"Delete comment",children:e.jsx(He,{size:12})})]})]})]})})]},t._id||o)}),e.jsx("div",{ref:L})]}),e.jsxs("div",{className:"flex gap-2 mt-2 px-4 pb-4",children:[F&&e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 mb-2 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsx("span",{className:"text-xs text-gray-600 truncate",children:F.message}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700",onClick:()=>D(null),title:"Cancel reply",children:"Ã—"})]}),e.jsx("input",{type:"text",className:"flex-1 px-3 py-2 border rounded-full text-sm focus:ring-2 focus:ring-blue-200 shadow",placeholder:"Type a message...",value:O,onChange:t=>h(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ue()},ref:n}),e.jsx("button",{onClick:ue,disabled:re||!O.trim(),className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-5 py-2 rounded-full text-sm font-semibold shadow hover:from-blue-600 hover:to-purple-600 transition disabled:opacity-50 flex items-center gap-2 min-w-20",children:re?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border border-white border-t-transparent rounded-full animate-spin"}),"Sending..."]}):"Send"})]}),e.jsx("style",{jsx:!0,children:`
                @keyframes fadeInChatBubble {
                  from { opacity: 0; transform: translateY(10px) scale(0.98); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
                .animate-fadeInChatBubble {
                  animation: fadeInChatBubble 0.4s cubic-bezier(0.4,0,0.2,1) both;
                }
                @keyframes fadeInChat {
                  from { opacity: 0; }
                  to { opacity: 1; }
                }
                .animate-fadeInChat {
                  animation: fadeInChat 0.3s cubic-bezier(0.4,0,0.2,1) both;
                }
              `}),!w&&e.jsx("div",{className:"absolute bottom-20 right-6 z-20",children:e.jsxs("button",{onClick:Se,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 relative",title:m>0?`${m} new message${m>1?"s":""}`:"Scroll to bottom","aria-label":m>0?`${m} new messages, scroll to bottom`:"Scroll to bottom",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})}),m>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 border-2 border-white shadow-lg",children:m>99?"99+":m})]})})]})})]})]})}export{Je as default};
