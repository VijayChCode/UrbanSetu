import{g as fe,r as c,j as e,t as W,v as we,w as ge,x as De,z as ae,A as Ge,B as ve,D as ke,E as _e,y as p,b as Fe,G as Ke,H as Qe,I as Re,J as Xe,K as Ze,M as es,q as ss,u as ts,h as as,O as rs,L as Se,P as ns,Q as ls,R as is,S as os,T as ds,U as cs,V as ms,W as xs,C as us,X as hs}from"./index-B5y-AYTk.js";import{S as ps,N as gs,a as Ce}from"./navigation-BWZHxKkt.js";import{R as Ae}from"./ReviewForm-wCwkoYfu.js";import{s as Le,m as fs,g as $e}from"./addressMasking-3vIUwCOC.js";const bs="https://urbansetu.onrender.com";function Ee({reviewId:y,onReplyAdded:_}){const{currentUser:F}=fe(S=>S.user),[t,a]=c.useState(""),[j,g]=c.useState(!1),[U,A]=c.useState("");if(!F)return null;const B=async S=>{if(S.preventDefault(),!t.trim()){A("Reply cannot be empty");return}g(!0),A("");try{const C=await fetch(`${bs}/api/review/reply/${y}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:t})}),$=await C.json();C.ok?(a(""),_&&_()):A($.message||"Failed to add reply")}catch{A("Network error. Please try again.")}finally{g(!1)}};return e.jsxs("form",{onSubmit:B,className:"flex flex-col gap-2 mt-2",children:[e.jsx("textarea",{value:t,onChange:S=>a(S.target.value),rows:2,className:"w-full border border-gray-300 rounded p-2 text-sm",placeholder:"Write a reply...",disabled:j}),U&&e.jsx("div",{className:"text-red-600 text-xs",children:U}),e.jsx("button",{type:"submit",className:"self-end bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm",disabled:j||!t.trim(),children:j?"Replying...":"Reply"})]})}const k="https://urbansetu.onrender.com";function ys({listingId:y,onReviewDeleted:_,listingOwnerId:F}){const{currentUser:t}=fe(s=>s.user),a=s=>s&&s.trim()&&s!=="null"&&s!=="undefined"&&s!=="",[j,g]=c.useState([]),[U,A]=c.useState(!0),[B,S]=c.useState(""),[C,$]=c.useState(null),[I,me]=c.useState("date"),[E,q]=c.useState("desc"),[re,ne]=c.useState({}),[le,V]=c.useState({}),[P,Q]=c.useState({}),[O,N]=c.useState({}),[f,T]=c.useState(null),[X,H]=c.useState(!1),[ie,Z]=c.useState(""),[ee,se]=c.useState(null),[M,D]=c.useState(""),[oe,z]=c.useState(!1),[J,Y]=c.useState({}),[te,xe]=c.useState({});c.useEffect(()=>{de();const s=r=>{(r.listingId===y||r.listingId&&r.listingId._id===y)&&(g(d=>d.some(o=>o._id===r._id)?d.map(o=>o._id===r._id?r:o):[r,...d]),G(r._id))};W.on("reviewUpdated",s);const n=({action:r,replies:d,reviewId:m,reply:o,replyId:x})=>{r==="updatedAll"&&m&&d?N(b=>({...b,[m]:d})):r==="deleted"&&m?G(m):o&&o.reviewId&&G(o.reviewId)};W.on("reviewReplyUpdated",n);const l=r=>{console.log("[ReviewList] Received profileUpdated socket event:",r),console.log("[ReviewList] Current reviews:",j.length),g(d=>{const m=d.map(o=>o.userId===r.userId?(console.log("[ReviewList] Updating review:",o._id,"for user:",r.userId),{...o,userName:r.username,userAvatar:r.avatar}):o);return console.log("[ReviewList] Updated reviews:",m.length),m}),N(d=>{const m={...d};return Object.keys(m).forEach(o=>{var x;m[o]=(x=m[o])==null?void 0:x.map(b=>b.userId===r.userId?(console.log("[ReviewList] Updating reply:",b._id,"for user:",r.userId),{...b,userName:r.username,userAvatar:r.avatar}):b)}),m})};return W.on("profileUpdated",l),console.log("[ReviewList] Socket listeners set up for profileUpdated"),W.emit("testConnection",{message:"ReviewList component connected"},r=>{console.log("[ReviewList] Test socket response:",r)}),()=>{W.off("reviewUpdated",s),W.off("reviewReplyUpdated",n),W.off("profileUpdated",l),console.log("[ReviewList] Socket listeners cleaned up")}},[y,I,E]),c.useEffect(()=>{t&&(g(s=>s.map(n=>n.userId===t._id?{...n,userName:t.username,userAvatar:t.avatar}:n)),N(s=>{const n={...s};return Object.keys(n).forEach(l=>{var r;n[l]=(r=n[l])==null?void 0:r.map(d=>d.userId===t._id?{...d,userName:t.username,userAvatar:t.avatar}:d)}),n}))},[t]),c.useEffect(()=>{const s=setInterval(async()=>{if(t)try{const n=await fetch(`${k}/api/user/id/${t._id}`);if(n.ok){const l=await n.json();(l.username!==t.username||l.avatar!==t.avatar)&&(console.log("[ReviewList] Profile updated via polling:",l),g(r=>r.map(d=>d.userId===l._id?{...d,userName:l.username,userAvatar:l.avatar}:d)),N(r=>{const d={...r};return Object.keys(d).forEach(m=>{var o;d[m]=(o=d[m])==null?void 0:o.map(x=>x.userId===l._id?{...x,userName:l.username,userAvatar:l.avatar}:x)}),d}))}}catch(n){console.error("[ReviewList] Error polling for profile updates:",n)}},3e4);return()=>clearInterval(s)},[t]);const de=async()=>{try{const s=await fetch(`${k}/api/review/listing/${y}?sort=${I}&order=${E}`,{credentials:"include"}),n=await s.json();s.ok?g(n):S(n.message||"Failed to load reviews")}catch{S("Network error. Please try again.")}finally{A(!1)}},h=async s=>{if(window.confirm("Are you sure you want to delete this review?"))try{const n=await fetch(`${k}/api/review/delete/${s}`,{method:"DELETE",credentials:"include"}),l=await n.json();n.ok?(g(j.filter(r=>r._id!==s)),_&&_(),p.success("Review deleted successfully")):p.error(l.message||"Failed to delete review")}catch{p.error("Network error. Please try again.")}},w=s=>{$(s)},v=()=>{$(null),de()},ue=async s=>{if(!t){p.info("Please sign in to vote on reviews");return}g(n=>n.map(l=>{var r;if(l._id===s){const d=(r=l.helpfulVotes)==null?void 0:r.some(x=>x.userId===t._id);let m,o=l.helpfulCount||0;return d?(m=l.helpfulVotes.filter(x=>x.userId!==t._id),o=Math.max(0,o-1)):(m=[...l.helpfulVotes||[],{userId:t._id}],o=o+1),{...l,helpfulVotes:m,helpfulCount:o}}return l}));try{const n=await fetch(`${k}/api/review/helpful/${s}`,{method:"POST",credentials:"include"})}catch{p.error("Network error. Please try again.")}},Oe=async s=>{V(n=>({...n,[s]:!0})),Q(n=>({...n,[s]:""}));try{const n=await fetch(`${k}/api/review/respond/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({ownerResponse:re[s]})}),l=await n.json();n.ok?(g(r=>r.map(d=>d._id===s?{...d,ownerResponse:re[s]}:d)),ne(r=>({...r,[s]:""}))):Q(r=>({...r,[s]:l.message||"Failed to submit response"}))}catch{Q(l=>({...l,[s]:"Network error. Please try again."}))}finally{V(n=>({...n,[s]:!1}))}},Te=s=>[...Array(5)].map((n,l)=>e.jsx(Fe,{className:`text-lg ${l<s?"text-yellow-400":"text-gray-300"}`},l)),Ue=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),Be=s=>{const l={pending:{color:"bg-yellow-100 text-yellow-800",icon:Re},approved:{color:"bg-green-100 text-green-800",icon:Re},rejected:{color:"bg-red-100 text-red-800",icon:Qe},removed:{color:"bg-gray-100 text-gray-800",icon:Ke}}[s];if(!l)return e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:s?s.charAt(0).toUpperCase()+s.slice(1):"Unknown"});const r=l.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.color}`,children:[e.jsx(r,{className:"mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},be=s=>{var n;return t?(n=s.helpfulVotes)==null?void 0:n.some(l=>l.userId===t._id):!1},he=s=>I!==s?e.jsx(Xe,{className:"text-gray-400"}):E==="desc"?e.jsx(Ze,{className:"text-blue-600"}):e.jsx(es,{className:"text-blue-600"}),pe=s=>{I===s?(q(E==="desc"?"asc":"desc"),p.info(`Sorted by ${s} (${E==="desc"?"ascending":"descending"})`)):(me(s),q("desc"),p.info(`Sorted by ${s} (descending)`))},G=async s=>{try{const n=await fetch(`${k}/api/review/reply/${s}`);if(n.ok){const l=await n.json();N(r=>({...r,[s]:l}))}}catch{}};c.useEffect(()=>{j.forEach(s=>G(s._id))},[j]);const ye=async(s,n,l)=>{var r,d,m;if(!t){p.info("Please sign in to vote on reviews");return}Y(o=>({...o,[s]:!0}));try{const o=(r=O[l])==null?void 0:r.find(i=>i._id===s);let x=n;o&&(n==="like"?(d=o.likes)!=null&&d.includes(t==null?void 0:t._id)?(x="remove_like",N(i=>({...i,[l]:i[l].map(u=>u._id===s?{...u,likes:u.likes.filter(R=>R!==t._id)}:u)}))):N(i=>({...i,[l]:i[l].map(u=>{var R;return u._id===s?{...u,likes:[...u.likes||[],t._id],dislikes:(R=u.dislikes)==null?void 0:R.filter(K=>K!==t._id)}:u})})):n==="dislike"&&((m=o.dislikes)!=null&&m.includes(t==null?void 0:t._id)?(x="remove_dislike",N(i=>({...i,[l]:i[l].map(u=>u._id===s?{...u,dislikes:u.dislikes.filter(R=>R!==t._id)}:u)}))):N(i=>({...i,[l]:i[l].map(u=>{var R;return u._id===s?{...u,dislikes:[...u.dislikes||[],t._id],likes:(R=u.likes)==null?void 0:R.filter(K=>K!==t._id)}:u})}))));const b=await fetch(`${k}/api/review/reply/like/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:x})})}catch{p.error("Network error. Please try again.")}finally{Y(o=>({...o,[s]:!1}))}},Ie=async s=>{if(!t){p.info("Please sign in to vote on reviews");return}try{g(l=>l.map(r=>{var d;if(r._id===s){const m=(d=r.dislikes)==null?void 0:d.some(b=>b.userId===(t==null?void 0:t._id));let o,x=r.dislikeCount||0;return m?(o=r.dislikes.filter(b=>b.userId!==t._id),x=Math.max(0,x-1)):(o=[...r.dislikes||[],{userId:t._id}],x=x+1),{...r,dislikes:o,dislikeCount:x}}return r}));const n=await fetch(`${k}/api/review/dislike/${s}`,{method:"POST",credentials:"include"})}catch{p.error("Network error. Please try again.")}},Ve=s=>{T(s)},He=async()=>{!f||!f.comment.trim()||(await fetch(`${k}/api/review/reply/${f._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:f.comment})}),T(null))},Me=async s=>{window.confirm("Delete this reply?")&&await fetch(`${k}/api/review/reply/${s}`,{method:"DELETE",credentials:"include"})},ze=s=>{H(s._id),Z(s.ownerResponse||"")},Je=async s=>{await Oe(s),H(!1)},We=async s=>{window.confirm("Delete owner response?")&&(await fetch(`${k}/api/review/respond/${s}`,{method:"DELETE",credentials:"include"}),H(!1))},je=async(s,n)=>{if(!t){p.info("Please sign in to vote on reviews");return}g(l=>l.map(r=>{if(r._id===s){let d=r.ownerResponseLikes||[],m=r.ownerResponseDislikes||[];return n==="like"?d.includes(t._id)?d=d.filter(o=>o!==t._id):(d=[...d,t._id],m=m.filter(o=>o!==t._id)):n==="dislike"&&(m.includes(t._id)?m=m.filter(o=>o!==t._id):(m=[...m,t._id],d=d.filter(o=>o!==t._id))),{...r,ownerResponseLikes:d,ownerResponseDislikes:m}}return r}));try{await fetch(`${k}/api/review/respond/like/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:n})})}catch{}},L=s=>s&&(s.role==="admin"||s.role==="rootadmin"),qe=s=>{se(s),D("")},Ye=async()=>{if(!M.trim()){p.info("Please provide a reason for reporting.");return}z(!0);try{const s=await fetch(`${k}/api/review/report/${ee._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:M})}),n=await s.json();s.ok?(p.success("Thank you for reporting. Our team will review this issue."),se(null),D("")):p.error(n.message||"Failed to report issue.")}catch{p.error("Network error. Please try again.")}finally{z(!1)}};return U?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading reviews..."})]}):B?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800",children:B})}):j.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"No reviews yet. Be the first to review this property!"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800",children:["Reviews (",j.filter(s=>s.status==="approved").length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),e.jsxs("button",{onClick:()=>pe("date"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Date ",he("date")]}),e.jsxs("button",{onClick:()=>pe("rating"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Rating ",he("rating")]}),e.jsxs("button",{onClick:()=>pe("helpful"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Helpful ",he("helpful")]})]})]}),j.filter(s=>s.status==="approved").map(s=>{var n,l,r,d,m,o,x,b;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[!L(s)&&e.jsxs(e.Fragment,{children:[a(s.userAvatar)?e.jsx("img",{src:s.userAvatar,alt:s.userName,className:"w-10 h-10 rounded-full object-cover",onError:i=>{i.target.style.display="none",i.target.nextElementSibling.style.display="flex"}}):null,e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center ${a(s.userAvatar)?"hidden":"flex"}`,children:e.jsx(we,{className:"text-white text-lg"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[L(s)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1",children:["From organization ",e.jsx(ge,{className:"text-green-500"})]}):e.jsx("h4",{className:"font-semibold text-gray-800",children:s.userName}),(s.isVerified||s.verifiedByBooking)&&!L(s)&&e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(ge,{className:"mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[Te(s.rating),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:[s.rating," star",s.rating>1?"s":""]})]})]})]}),t&&(t._id===s.userId||L(t))&&s.status!=="approved"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>w(s),className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit review",children:e.jsx(De,{})}),e.jsx("button",{onClick:()=>h(s._id),className:"text-red-600 hover:text-red-800 p-1",title:"Delete review",children:e.jsx(ae,{})})]})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:s.comment}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:Ue(s.createdAt)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>ue(s._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${be(s)?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,disabled:s.status!=="approved",children:[e.jsx(Ge,{className:be(s)?"text-blue-600":""}),e.jsx("span",{children:"Helpful"}),s.helpfulCount>0&&e.jsxs("span",{className:"ml-1",children:["(",s.helpfulCount,")"]})]}),e.jsxs("button",{onClick:()=>Ie(s._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${(n=s.dislikes)!=null&&n.some(i=>i.userId===(t==null?void 0:t._id))?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("span",{role:"img","aria-label":"dislike",children:"👎"}),e.jsx("span",{children:"Dislike"}),s.dislikeCount>0&&e.jsxs("span",{className:"ml-1",children:["(",s.dislikeCount,")"]})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[Be(s.status),s.verifiedByBooking&&e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded",children:"Booked this property"})]}),s.adminNote&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Admin Note:"})," ",s.adminNote]})}),s.ownerResponse&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-md border border-blue-200 flex justify-between items-center",children:[e.jsx("div",{className:"flex-1",children:X===s._id?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded-md p-2 text-sm mb-2",rows:"2",value:ie,onChange:i=>Z(i.target.value)}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm ml-2",onClick:()=>Je(s._id),children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm ml-2",onClick:()=>H(!1),children:"Cancel"})]}):e.jsx(e.Fragment,{children:e.jsxs("p",{className:"text-sm text-blue-800 flex items-center gap-2",children:[e.jsx(ve,{className:"inline-block text-blue-500"}),e.jsx("strong",{children:"Owner Response:"})," ",s.ownerResponse]})})}),t&&F&&t._id!==F&&!X&&e.jsxs("div",{className:"flex gap-2 ml-4 items-center",children:[e.jsxs("button",{onClick:()=>je(s._id,"like"),className:`flex items-center gap-1 ${(l=s.ownerResponseLikes)!=null&&l.includes(t._id)?"text-blue-600":"text-gray-500"}`,children:["👍 Like ",((r=s.ownerResponseLikes)==null?void 0:r.length)>0&&`(${s.ownerResponseLikes.length})`]}),e.jsxs("button",{onClick:()=>je(s._id,"dislike"),className:`flex items-center gap-1 ${(d=s.ownerResponseDislikes)!=null&&d.includes(t._id)?"text-red-600":"text-gray-500"}`,children:["👎 Dislike ",((m=s.ownerResponseDislikes)==null?void 0:m.length)>0&&`(${s.ownerResponseDislikes.length})`]})]}),t&&F&&t._id===F&&!X&&e.jsxs("span",{className:"flex gap-2 ml-2",children:[e.jsx(ke,{className:"cursor-pointer text-blue-600",title:"Edit",onClick:()=>ze(s)}),e.jsx(ae,{className:"cursor-pointer text-red-600",title:"Delete",onClick:()=>We(s._id)})]})]}),e.jsxs("div",{className:"mt-4 ml-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(ve,{className:"text-blue-500"}),"Replies (",((o=O[s._id])==null?void 0:o.length)||0,")"]}),((x=O[s._id])==null?void 0:x.length)>0&&e.jsxs("button",{onClick:()=>xe(i=>({...i,[s._id]:!i[s._id]})),className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center gap-1 transition-colors",children:[te[s._id]?"Hide":"Show"," Replies",e.jsx("span",{className:`transform transition-transform duration-200 ${te[s._id]?"rotate-180":""}`,children:"▼"})]})]}),te[s._id]&&e.jsxs("div",{className:"space-y-3 animate-slideDown",children:[(b=O[s._id])==null?void 0:b.map(i=>{var u,R,K,Ne;return e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-white rounded-lg p-3 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!L(i)&&e.jsxs(e.Fragment,{children:[a(i.userAvatar)?e.jsx("img",{src:i.userAvatar,alt:i.userName,className:"w-6 h-6 rounded-full object-cover",onError:ce=>{ce.target.style.display="none",ce.target.nextElementSibling.style.display="flex"}}):null,e.jsx("div",{className:`w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center ${a(i.userAvatar)?"hidden":"flex"}`,children:e.jsx(we,{className:"text-white text-xs"})})]}),L(i)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1 text-xs",children:["From organization ",e.jsx(ge,{className:"text-green-500"})]}):e.jsx("span",{className:"font-medium text-gray-800 text-xs",children:i.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(i.createdAt).toLocaleString()}),t&&e.jsxs("div",{className:"flex gap-2 ml-auto",children:[(i.userId===t._id||L(t)&&L(i))&&e.jsx("button",{onClick:()=>Ve(i),className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Edit reply",children:e.jsx(ke,{size:10})}),(i.userId===t._id||L(t))&&e.jsx("button",{onClick:()=>Me(i._id),className:"text-red-600 hover:text-red-800 transition-colors",title:"Delete reply",children:e.jsx(ae,{size:10})})]})]}),f&&f._id===i._id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded p-2 text-sm",value:f.comment,onChange:ce=>T({...f,comment:ce.target.value}),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700 transition-colors",onClick:He,children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-600 transition-colors",onClick:()=>T(null),children:"Cancel"})]})]}):e.jsx("div",{className:"text-gray-700 text-sm leading-relaxed",children:i.comment}),e.jsxs("div",{className:"flex gap-3 mt-2 text-xs",children:[e.jsxs("button",{onClick:()=>ye(i._id,"like",s._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(u=i.likes)!=null&&u.includes(t==null?void 0:t._id)?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"}`,disabled:J[i._id],children:["👍 Like ",((R=i.likes)==null?void 0:R.length)>0&&`(${i.likes.length})`]}),e.jsxs("button",{onClick:()=>ye(i._id,"dislike",s._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(K=i.dislikes)!=null&&K.includes(t==null?void 0:t._id)?"bg-red-100 text-red-700":"text-gray-500 hover:bg-gray-100"}`,disabled:J[i._id],children:["👎 Dislike ",((Ne=i.dislikes)==null?void 0:Ne.length)>0&&`(${i.dislikes.length})`]})]})]},i._id)}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx(Ee,{reviewId:s._id,onReplyAdded:()=>G(s._id)})})]}),(!O[s._id]||O[s._id].length===0)&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx(Ee,{reviewId:s._id,onReplyAdded:()=>G(s._id)})})]}),t&&!L(t)&&e.jsxs("button",{className:"flex items-center gap-1 text-yellow-600 hover:text-yellow-800 text-xs mt-2",title:"Report an issue with this review",onClick:()=>qe(s),children:[e.jsx(_e,{className:"inline-block"}),"Report an Issue"]})]},s._id)}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Review"}),e.jsx(Ae,{listingId:y,existingReview:C,onReviewSubmitted:v}),e.jsx("button",{onClick:()=>$(null),className:"mt-4 w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-yellow-700",children:[e.jsx(_e,{})," Report an Issue"]}),e.jsx("p",{className:"mb-2 text-gray-700",children:"Please describe the issue with this review:"}),e.jsx("textarea",{className:"w-full border border-yellow-300 rounded-md p-2 text-sm mb-2",rows:"3",value:M,onChange:s=>D(s.target.value),placeholder:"Enter reason (required)"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm",onClick:()=>se(null),disabled:oe,children:"Cancel"}),e.jsx("button",{className:"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 text-sm",onClick:Ye,disabled:oe,children:oe?"Reporting...":"Submit Report"})]})]})})]})}const js=`
  @keyframes slideDown {
    from { 
      opacity: 0; 
      transform: translateY(-10px);
    }
    to { 
      opacity: 1; 
      transform: translateY(0);
    }
  }
  .animate-slideDown {
    animation: slideDown 0.3s ease-out;
  }
`;if(typeof document<"u"){const y=document.createElement("style");y.textContent=js,document.head.appendChild(y)}const Pe="https://urbansetu.onrender.com";function _s(){const y=ss(),_=ts(),F=as(),{currentUser:t}=fe(h=>h.user),[a,j]=c.useState(null),[g,U]=c.useState(!1),[A,B]=c.useState(!0),[S,C]=c.useState(!1),[$,I]=c.useState(""),[me,E]=c.useState(!1),[q,re]=c.useState(""),[ne,le]=c.useState(!1),[V,P]=c.useState(""),{addToWishlist:Q,removeFromWishlist:O,isInWishlist:N}=rs(),[f,T]=c.useState(null),[X,H]=c.useState(!1),[ie,Z]=c.useState(""),[ee,se]=c.useState(!1),M=(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="rootadmin",D=F.pathname.includes("/admin"),z=t?D?{path:"/admin",text:"Back to Dashboard"}:{path:"/user",text:"Back to Home"}:{path:"/",text:"Back to Home"},J=h=>`₹${Number(h).toLocaleString("en-IN")}`,Y=()=>a.offer&&a.regularPrice&&a.discountPrice?Math.round((a.regularPrice-a.discountPrice)/a.regularPrice*100):0,te=()=>{I(""),P(""),C(!0)},xe=h=>{if(h.preventDefault(),!$.trim()){P("Reason is required");return}C(!1),P(""),E(!0)},de=async h=>{if(h.preventDefault(),!q){P("Password is required");return}le(!0),P("");try{if(!(await fetch(`/api/user/verify-password/${t._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:q})})).ok){P("Incorrect password. Property not deleted."),le(!1);return}const v=await fetch(`/api/listing/delete/${a._id}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:$})});if(v.ok)p.success("Property deleted successfully!"),E(!1),_("/admin/listings");else{const ue=await v.json();P(ue.message||"Failed to delete property.")}}catch{P("An error occurred while deleting the property.")}finally{le(!1)}};return c.useEffect(()=>{(async()=>{B(!0);try{const v=await(await fetch(`${Pe}/api/listing/get/${y.listingId}`)).json();if(v.success===!1){console.log(v.message);return}j(v)}catch(w){console.error("Error fetching listing:",w)}finally{B(!1)}})()},[y.listingId]),c.useEffect(()=>{(async()=>{if(a&&a.userRef){H(!0),Z("");try{const w=await fetch(`${Pe}/api/user/id/${a.userRef}`);if(!w.ok)throw new Error("Failed to fetch owner details");const v=await w.json();T(v)}catch{Z("Could not load owner details"),T(null)}finally{H(!1)}}else T(null)})()},[a]),A?e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-3 text-lg font-semibold text-blue-600",children:"Loading property details..."})]})})}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl w-full mx-auto bg-white rounded-xl shadow-lg p-3 sm:p-6 relative overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:()=>_(z.path),className:"bg-gradient-to-r from-gray-500 to-gray-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(ns,{})," ",z.text]})}),M&&D&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs(Se,{to:`/admin/update-listing/${a._id}`,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(De,{})," Edit Property"]}),e.jsxs("button",{onClick:te,className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(ae,{})," Delete Property"]})]})]}),e.jsxs("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:["Property Details ",M&&D&&"(Admin View)"]}),e.jsx(ps,{navigation:!0,modules:[gs],className:"rounded-lg overflow-hidden relative mb-6",children:a.imageUrls&&a.imageUrls.length>0?a.imageUrls.map((h,w)=>e.jsx(Ce,{children:e.jsx("img",{src:h,alt:`${a.name} - Image ${w+1}`,className:"w-full h-40 sm:h-64 md:h-96 object-cover",onError:v=>{v.target.src="https://via.placeholder.com/800x600?text=Image+Not+Available",v.target.className="w-full h-40 sm:h-64 md:h-96 object-cover opacity-50"}})},w)):e.jsx(Ce,{children:e.jsx("div",{className:"w-full h-64 md:h-96 bg-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🏠"}),e.jsx("p",{className:"text-lg",children:"No images available"})]})})})}),e.jsx("div",{className:"flex justify-end items-center space-x-4 mb-4 pr-2",children:e.jsx(ls,{className:"cursor-pointer text-gray-500 hover:text-gray-700 text-xl",onClick:()=>{navigator.clipboard.writeText(window.location.href),U(!0),setTimeout(()=>U(!1),2e3)}})}),g&&e.jsx("p",{className:"text-green-500 text-sm text-center mb-4",children:"Link copied!"}),e.jsxs("div",{className:"p-3 sm:p-6 bg-gray-50 shadow-md rounded-lg mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl md:text-3xl font-bold text-gray-800 break-words flex items-center gap-2",children:[a.name,e.jsx("button",{onClick:()=>{if(!t){p.info("Please sign in to add properties to your wishlist."),_("/sign-in");return}N(a._id)?O(a._id):Q(a)},className:`ml-2 p-2 rounded-full transition z-20 ${N(a._id)?"bg-red-500 text-white":"bg-gray-200 text-red-500 hover:text-red-600"} focus:outline-none`,title:N(a._id)?"Remove from wishlist":"Add to wishlist",style:{lineHeight:0},children:e.jsx(is,{className:"text-base sm:text-lg"})})]}),a.offer&&Y()>0&&e.jsxs("span",{className:"bg-yellow-400 text-gray-900 text-sm font-semibold px-4 py-1 rounded-full shadow-md animate-pulse w-max sm:w-auto ml-0 sm:ml-2 mt-2 sm:mt-0",style:{alignSelf:"flex-start"},title:"Limited-time offer!",children:[Y(),"% OFF"]})]}),e.jsx("div",{className:"mb-4",children:a.offer&&Y()>0?e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[J(a.discountPrice),a.type==="rent"&&" / month"]}),e.jsx("p",{className:"text-base sm:text-xl text-gray-500 line-through",children:J(a.regularPrice)}),e.jsxs("span",{className:"text-xs sm:text-sm text-green-600 font-semibold",children:["Save ",J(a.regularPrice-a.discountPrice)]})]}):e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[J(a.regularPrice),a.type==="rent"&&" / month"]})}),e.jsxs("p",{className:"flex items-center text-gray-600 mb-4",children:[e.jsx(os,{className:"mr-2 text-red-500"}),fs(a.propertyNumber||a.city?{propertyNumber:a.propertyNumber,landmark:a.landmark,city:a.city,district:a.district,state:a.state,pincode:a.pincode}:a.address,!!t)]}),a.locationLink&&Le(!!t)&&e.jsx("div",{className:"mb-4",children:e.jsx("a",{href:a.locationLink,rel:"noopener noreferrer",className:"inline-block bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:$e(!!t)})}),a.locationLink&&!Le(!!t)&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>_("/sign-in"),className:"inline-block bg-gradient-to-r from-gray-500 to-gray-600 text-white px-6 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:$e(!!t)})}),e.jsx("div",{className:"flex space-x-4 mb-4",children:e.jsx("span",{className:`px-3 py-1 text-white rounded-md ${a.type==="rent"?"bg-blue-500":"bg-green-500"}`,children:a.type==="rent"?"For Rent":"For Sale"})}),e.jsxs("p",{className:"text-gray-700 mb-4 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Description:"})," ",a.description]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ds,{className:"mr-2 text-blue-500"})," ",a.bedrooms," ",a.bedrooms>1?"beds":"bed"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(cs,{className:"mr-2 text-blue-500"})," ",a.bathrooms," ",a.bathrooms>1?"baths":"bath"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ms,{className:"mr-2 text-blue-500"})," ",a.parking?"Parking":"No Parking"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(xs,{className:"mr-2 text-blue-500"})," ",a.furnished?"Furnished":"Unfurnished"]})]})]}),M&&D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 bg-blue-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-blue-800 mb-4",children:"Admin Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Property ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Updated"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created By"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a.userRef||"Unknown"})]})]})]}),e.jsxs("div",{className:"p-6 bg-green-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-green-800 mb-4",children:"Property Owner Details"}),X?e.jsx("p",{className:"text-gray-500",children:"Loading owner details..."}):ie?e.jsx("p",{className:"text-red-500",children:ie}):f?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Name"}),e.jsx("p",{className:"font-semibold text-gray-800",children:f.username})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Email"}),e.jsx("p",{className:"font-semibold text-gray-800",children:f.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Mobile Number"}),e.jsx("p",{className:"font-semibold text-gray-800",children:f.mobileNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:f._id})]})]}):e.jsx("p",{className:"text-gray-500",children:"No owner details found."})]})]}),e.jsx("div",{className:"flex justify-center",children:t&&(a.sellerId===t._id||a.userRef===t._id)?e.jsx("div",{className:"text-red-500 font-semibold text-lg py-3",children:"You cannot book an appointment for your own property."}):e.jsx("button",{onClick:()=>{if(!t){p.info("Please sign in to book appointments."),_("/sign-in");return}const h=D?`/admin/appointmentlisting?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`:`/user/appointment?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`;_(h)},className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:"📅 Book Appointment"})}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("button",{onClick:()=>se(h=>!h),className:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white px-6 py-2 rounded-lg shadow font-semibold flex items-center gap-2 hover:from-yellow-500 hover:to-yellow-700 transition-all",children:[ee?"Hide Reviews":"Show Reviews",a.reviewCount>0&&e.jsx("span",{className:"ml-2 bg-white text-yellow-700 rounded-full px-2 py-0.5 text-xs font-bold",children:a.reviewCount})]})}),ee&&e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"border-t border-gray-200 pt-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h3",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[e.jsx(Fe,{className:"text-yellow-500 mr-2"}),"Reviews",a.averageRating>0&&e.jsxs("span",{className:"ml-2 text-lg text-gray-600",children:["(",a.averageRating.toFixed(1)," ⭐ • ",a.reviewCount," review",a.reviewCount!==1?"s":"",")"]})]})}),e.jsx(Ae,{listingId:a._id,onReviewSubmitted:()=>{window.location.reload()}}),e.jsx(ys,{listingId:a._id,onReviewDeleted:()=>{window.location.reload()},listingOwnerId:a.userRef})]})})]})}),e.jsx(us,{}),S&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:xe,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(ae,{})," Reason for Deletion"]}),e.jsx("textarea",{className:"border rounded p-2 w-full",placeholder:"Enter reason for deleting this property",value:$,onChange:h=>I(h.target.value),rows:3,autoFocus:!0}),V&&e.jsx("div",{className:"text-red-600 text-sm",children:V}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>C(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-red-600 text-white font-semibold",children:"Next"})]})]})}),me&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:de,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(hs,{})," Confirm Password"]}),e.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:q,onChange:h=>re(h.target.value),autoFocus:!0}),V&&e.jsx("div",{className:"text-red-600 text-sm",children:V}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>E(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:ne,children:ne?"Deleting...":"Confirm & Delete"})]})]})})]}):e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-red-600 mb-4",children:"Property Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The property you're looking for doesn't exist or has been removed."}),e.jsx(Se,{to:z.path,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold",children:z.text})]})})})}export{_s as default};
