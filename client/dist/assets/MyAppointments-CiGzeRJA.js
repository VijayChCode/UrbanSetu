import{g as Be,r as c,u as Re,t as f,j as e,Z as Ee,_ as $e,$ as Oe,a0 as Fe,a5 as Le,f as Pe,a6 as Ue,y as o,h as Me,X as E,L as ze,x as Y,H as _e,G as He,a1 as Je,a2 as ve,E as qe,B as Ye,a7 as ke}from"./index-Mo8yGtIP.js";const v="https://urbansetu.onrender.com";function Ve(){const{currentUser:t}=Be(s=>s.user),[y,p]=c.useState([]),[we,P]=c.useState(!0),[ce,G]=c.useState(null),[B,Ne]=c.useState(""),[U,me]=c.useState("all"),[k,Q]=c.useState("all"),[M,se]=c.useState(""),[K,b]=c.useState(!1),[$,ne]=c.useState(null),[z,re]=c.useState(""),[R,W]=c.useState(""),[ye,j]=c.useState(!1),[w,I]=c.useState(null),[O,V]=c.useState([]),[H,pe]=c.useState(!1),X=Re(),[Ce,je]=c.useState(null);c.useEffect(()=>{const s=async()=>{if(!t){G("Please sign in to view your appointments"),P(!1);return}try{P(!0),G(null);const a=await fetch(`${v}/api/bookings/my`,{credentials:"include"});if(a.ok){const l=await a.json();p(l)}else throw new Error("Failed to fetch appointments")}catch{G("Failed to load appointments. Please try again.")}finally{P(!1)}},r=async()=>{try{const a=await fetch(`${v}/api/bookings/archived`,{credentials:"include"});if(!a.ok)throw new Error("Not allowed");const l=await a.json();V(Array.isArray(l)?l:[])}catch{V([]),t&&(t.role==="admin"||t.role==="rootadmin")&&o.error("Failed to fetch archived appointments")}};s(),r()},[t]),c.useEffect(()=>{const s=r=>{p(a=>a.filter(l=>l._id!==r.detail))};return window.addEventListener("removeAppointmentRow",s),()=>{window.removeEventListener("removeAppointmentRow",s)}},[t]),c.useEffect(()=>{t&&p(s=>s.map(r=>{const a={...r};return r.buyerId&&(r.buyerId._id===t._id||r.buyerId===t._id)&&(a.buyerId={...a.buyerId,username:t.username,email:t.email,mobileNumber:t.mobileNumber,avatar:t.avatar}),r.sellerId&&(r.sellerId._id===t._id||r.sellerId===t._id)&&(a.sellerId={...a.sellerId,username:t.username,email:t.email,mobileNumber:t.mobileNumber,avatar:t.avatar}),a}))},[t]),c.useEffect(()=>{function s(r){p(a=>a.map(l=>l._id===r.appointmentId?{...l,...r.updatedAppointment}:l))}return f.on("appointmentUpdate",s),()=>{f.off("appointmentUpdate",s)}},[]),c.useEffect(()=>{function s(a){const l=a.appointment;l.buyerId&&t&&(l.buyerId._id===t._id||l.buyerId===t._id)?l.role="buyer":l.sellerId&&t&&(l.sellerId._id===t._id||l.sellerId===t._id)&&(l.role="seller"),p(m=>[l,...m])}f.on("appointmentCreated",s);const r=a=>{p(l=>l.map(m=>{const h={...m};return m.buyerId&&(m.buyerId._id===a.userId||m.buyerId===a.userId)&&(h.buyerId={...h.buyerId,username:a.username,email:a.email,mobileNumber:a.mobileNumber,avatar:a.avatar}),m.sellerId&&(m.sellerId._id===a.userId||m.sellerId===a.userId)&&(h.sellerId={...h.sellerId,username:a.username,email:a.email,mobileNumber:a.mobileNumber,avatar:a.avatar}),h}))};return f.on("profileUpdated",r),()=>{f.off("appointmentCreated",s),f.off("profileUpdated",r)}},[t]),c.useEffect(()=>{if(!t)return;const s=setInterval(()=>{f.emit("userAppointmentsActive",{userId:t._id})},5e3);return()=>clearInterval(s)},[t]);const J=async(s,r)=>{se(s+r);try{const a=await fetch(`${v}/api/bookings/${s}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:r})}),l=await a.json();if(a.status===401){o.error("Session expired or unauthorized. Please sign in again."),X("/sign-in");return}if(a.ok){p(h=>h.map(N=>N._id===s?{...N,status:r}:N));const m=r==="accepted"?"accepted":"rejected";o.success(`Appointment ${m} successfully! ${r==="accepted"?"Contact information is now visible to both parties.":""}`),X("/user/my-appointments")}else o.error(l.message||"Failed to update appointment status.")}catch{o.error("An error occurred. Please try again.")}se("")},ae=async s=>{const r=prompt("Please provide a reason for deleting this appointment:");if(r&&window.confirm("Are you sure you want to delete this appointment?"))try{const a=await fetch(`${v}/api/bookings/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:r})}),l=await a.json();if(a.status===401){o.error("Session expired or unauthorized. Please sign in again."),X("/sign-in");return}a.ok?(p(m=>m.map(h=>h._id===s?{...h,status:"deletedByAdmin",adminComment:r}:h)),o.success("Appointment deleted successfully. Both buyer and seller have been notified."),X("/user/my-appointments")):o.error(l.message||"Failed to delete appointment.")}catch{o.error("An error occurred. Please try again.")}},q=async s=>{if(window.confirm("Are you sure you want to archive this appointment? It will be moved to the archived section."))try{const r=await fetch(`${v}/api/bookings/${s}/archive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),a=await r.json();if(r.ok){const l=y.find(m=>m._id===s);l&&(p(m=>m.filter(h=>h._id!==s)),V(m=>[{...l,archivedAt:new Date},...m])),o.success("Appointment archived successfully.")}else o.error(a.message||"Failed to archive appointment.")}catch{o.error("An error occurred. Please try again.")}},ie=async s=>{if(window.confirm("Are you sure you want to unarchive this appointment? It will be moved back to the active appointments."))try{const r=await fetch(`${v}/api/bookings/${s}/unarchive`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"}),a=await r.json();if(r.ok){const l=O.find(m=>m._id===s);l&&(V(m=>m.filter(h=>h._id!==s)),p(m=>[{...l,archivedAt:void 0},...m])),o.success("Appointment unarchived successfully.")}else o.error(a.message||"Failed to unarchive appointment.")}catch{o.error("An error occurred. Please try again.")}},le=y.filter(s=>{var N,D,T,_,he,Z,oe,xe,fe,be;if(t._id===((D=(N=s.buyerId)==null?void 0:N._id)==null?void 0:D.toString())&&s.visibleToBuyer===!1||t._id===((_=(T=s.sellerId)==null?void 0:T._id)==null?void 0:_.toString())&&s.visibleToSeller===!1)return!1;const r=new Date(s.date)<new Date||new Date(s.date).toDateString()===new Date().toDateString()&&s.time&&s.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(U==="outdated")return r;const a=U==="all"?!0:s.status===U,l=k==="all"?!0:s.role===k,m=((he=s.propertyName)==null?void 0:he.toLowerCase().includes(B.toLowerCase()))||((Z=s.message)==null?void 0:Z.toLowerCase().includes(B.toLowerCase()))||((xe=(oe=s.buyerId)==null?void 0:oe.username)==null?void 0:xe.toLowerCase().includes(B.toLowerCase()))||((be=(fe=s.sellerId)==null?void 0:fe.username)==null?void 0:be.toLowerCase().includes(B.toLowerCase()));let h=!0;return z&&(h=h&&new Date(s.date)>=new Date(z)),R&&(h=h&&new Date(s.date)<=new Date(R)),a&&l&&m&&h}),ee=Array.isArray(O)?O.filter(s=>{var m,h,N,D,T,_;const r=new Date(s.date)<new Date||new Date(s.date).toDateString()===new Date().toDateString()&&s.time&&s.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(U==="outdated")return r;U==="all"||s.status;const a=((m=s.propertyName)==null?void 0:m.toLowerCase().includes(B.toLowerCase()))||((h=s.message)==null?void 0:h.toLowerCase().includes(B.toLowerCase()))||((D=(N=s.buyerId)==null?void 0:N.username)==null?void 0:D.toLowerCase().includes(B.toLowerCase()))||((_=(T=s.sellerId)==null?void 0:T.username)==null?void 0:_.toLowerCase().includes(B.toLowerCase()));let l=!0;return z&&(l=l&&new Date(s.date)>=new Date(z)),R&&(l=l&&new Date(s.date)<=new Date(R)),a&&l}):[];function ue(s){I({...s,date:s.date?new Date(s.date).toISOString().split("T")[0]:"",time:s.time||"",message:s.message||"",buyerReinitiationCount:s.buyerReinitiationCount||0,sellerReinitiationCount:s.sellerReinitiationCount||0}),j(!0)}async function A(s){var m,h;if(s.preventDefault(),!w)return;const r=t&&(((m=w.buyerId)==null?void 0:m._id)===t._id||w.buyerId===t._id);if(t&&(((h=w.sellerId)==null?void 0:h._id)===t._id||(w.sellerId,t._id)),(r?w.buyerReinitiationCount||0:w.sellerReinitiationCount||0)>=2){o.error("You have reached the maximum number of reinitiations for your role.");return}if(!w.buyerId||!w.sellerId){o.error("Cannot reinitiate: one of the parties no longer exists.");return}const l={...w,status:"pending"};try{const N=await fetch(`${v}/api/bookings/reinitiate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),D=await N.json();N.ok?(o.success("Appointment reinitiated successfully!"),j(!1),I(null),X("/user/my-appointments"),p(T=>T.map(_=>_._id===D.appointment._id?{..._,...D.appointment}:_))):o.error(D.message||"Failed to reinitiate appointment.")}catch{o.error("An error occurred. Please try again.")}}const F=(s,r)=>{p(a=>a.map(l=>l._id===s?{...l,status:r}:l))},S=async()=>{P(!0),G(null);try{const s=await fetch(`${v}/api/bookings/my`,{credentials:"include"});if(s.ok){const a=await s.json();p(a)}else throw new Error("Failed to fetch appointments");const r=await fetch(`${v}/api/bookings/archived`,{credentials:"include"});if(r.ok){const a=await r.json();V(Array.isArray(a)?a:[])}}catch{G("Failed to refresh appointments. Please try again.")}finally{P(!1)}};return we?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading your appointments..."})]})}):ce?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6",children:e.jsx("div",{className:"text-center text-red-600 text-lg",children:ce})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:[e.jsx(Ee,{position:"top-center",autoClose:2e3,closeOnClick:!0,containerClassName:"!z-[100]",toastOptions:{style:{fontSize:"0.9rem",borderRadius:"8px",boxShadow:"0 2px 8px #0001"}}}),e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 drop-shadow",children:H?"Archived Appointments":"My Appointments"}),!H&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ðŸ’¡ Outdated appointments (past their scheduled date) are automatically ignored when booking new appointments."})]}),e.jsx("button",{onClick:S,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all font-semibold shadow-md ml-4",title:"Refresh appointments",children:"Refresh"}),t&&(t.role==="admin"||t.role==="rootadmin")&&e.jsx("button",{onClick:()=>pe(!H),className:`bg-gradient-to-r text-white px-6 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2 ${H?"from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600":"from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:H?e.jsxs(e.Fragment,{children:[e.jsx($e,{})," Active Appointments"]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{})," Archived Appointments (",O.length,")"]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"Status:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:U,onChange:s=>me(s.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelledByBuyer",children:"Cancelled by Buyer"}),e.jsx("option",{value:"cancelledBySeller",children:"Cancelled by Seller"}),e.jsx("option",{value:"cancelledByAdmin",children:"Cancelled by Admin"}),e.jsx("option",{value:"deletedByAdmin",children:"Deleted by Admin"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"noShow",children:"No Show"}),e.jsx("option",{value:"outdated",children:"Outdated"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"From:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:z,onChange:s=>re(s.target.value),max:R||void 0}),e.jsx("label",{className:"font-semibold",children:"To:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:R,onChange:s=>W(s.target.value),min:z||void 0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold",children:"Role:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",value:k,onChange:s=>Q(s.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"buyer",children:"As Buyer"}),e.jsx("option",{value:"seller",children:"As Seller"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"text-gray-500"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200",placeholder:"Search by property, message, or user...",value:B,onChange:s=>Ne(s.target.value)})]})]}),H&&t&&(t.role==="admin"||t.role==="rootadmin")?ee.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No archived appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Role"}),e.jsx("th",{className:"border p-2",children:"Other Party"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:ee.map(s=>e.jsx(Ie,{appt:s,currentUser:t,handleStatusUpdate:J,handleAdminDelete:ae,actionLoading:M,onShowOtherParty:r=>{ne(r),b(!0)},onOpenReinitiate:()=>ue(s),handleArchiveAppointment:q,handleUnarchiveAppointment:ie,isArchived:!0,onCancelRefresh:F},s._id))})]})}):le.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Role"}),e.jsx("th",{className:"border p-2",children:"Other Party"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:le.map(s=>e.jsx(Ie,{appt:s,currentUser:t,handleStatusUpdate:J,handleAdminDelete:ae,actionLoading:M,onShowOtherParty:r=>{ne(r),b(!0)},onOpenReinitiate:()=>ue(s),handleArchiveAppointment:q,handleUnarchiveAppointment:ie,isArchived:!1,onCancelRefresh:F},s._id))})]})}),K&&$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl",onClick:()=>b(!1),title:"Close",children:"Ã—"}),e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Le,{className:"text-blue-500"}),$.username||"User Details"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"text-gray-500"})," ",e.jsx("span",{children:$.email})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"text-gray-500"})," ",e.jsx("span",{children:$.mobileNumber||"Not provided"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",$.role]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Member Since:"})," ",$.createdAt?new Date($.createdAt).toLocaleDateString():""]})]}),e.jsx("button",{onClick:()=>b(!1),className:"mt-6 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full",children:"Close"})]})}),ye&&w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md relative",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-blue-700",children:"Reinitiate Appointment"}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Date"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 w-full",value:w.date,onChange:s=>I(r=>({...r,date:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Time"}),e.jsx("input",{type:"time",className:"border rounded px-2 py-1 w-full",value:w.time,onChange:s=>I(r=>({...r,time:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Message"}),e.jsx("textarea",{className:"border rounded px-2 py-1 w-full",value:w.message,onChange:s=>I(r=>({...r,message:s.target.value})),required:!0})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full",children:"Submit"}),e.jsx("button",{type:"button",className:"mt-2 w-full bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400",onClick:()=>j(!1),children:"Cancel"})]})]})})]})]})}function Ge(t){const y=new Date,p=new Date;return p.setDate(y.getDate()-1),t.toDateString()===y.toDateString()?"Today":t.toDateString()===p.toDateString()?"Yesterday":t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}function Ie({appt:t,currentUser:y,handleStatusUpdate:p,handleAdminDelete:we,actionLoading:P,onShowOtherParty:ce,onOpenReinitiate:G,handleArchiveAppointment:B,handleUnarchiveAppointment:Ne,isArchived:U,onCancelRefresh:me}){const[k,Q]=c.useState(null),[M,se]=c.useState(""),[K,b]=c.useState(t.comments||[]),[$,ne]=c.useState(!1),[z,re]=c.useState(null),[R,W]=c.useState(""),ye=Me(),[j,w]=c.useState(!1),I=c.useRef(null),O=c.useRef(null),[V,H]=c.useState(!0),[pe,X]=c.useState(!1),[Ce,je]=c.useState(!1),J=c.useRef(null),ae=c.useRef(null),q=c.useRef({});function ie(n){try{return JSON.parse(localStorage.getItem(`removedDeletedMsgs_${n}`))||[]}catch{return[]}}function le(n,i){const d=ie(n);if(!d.includes(i)){const x=[...d,i];localStorage.setItem(`removedDeletedMsgs_${n}`,JSON.stringify(x))}}const ee=(y.role==="admin"||y.role==="rootadmin")&&y.adminApprovalStatus==="approved",ue=ye.pathname.includes("/admin"),A=t.role==="seller",F=t.role==="buyer",S=new Date(t.date)>new Date||new Date(t.date).toDateString()===new Date().toDateString()&&(!t.time||t.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),s=(ee||t.status==="accepted")&&S,r=A?t.buyerId:t.sellerId,a=async()=>{if(!M.trim())return;ne(!0);const n=`temp-${Date.now()}`,i={_id:n,senderEmail:y.email,message:M,status:"sending",timestamp:new Date().toISOString(),readBy:[y._id],...k?{replyTo:k._id}:{}};b(d=>[...d,i]),se(""),Q(null);try{const d=await fetch(`${v}/api/bookings/${t._id}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:M,...k?{replyTo:k._id}:{}})}),x=await d.json();d.ok?(b(u=>[...u.filter(C=>C._id!==n),...x.comments.filter(C=>!u.some(L=>L._id===C._id))]),o.success("Comment sent successfully!")):(b(u=>u.filter(C=>C._id!==n)),o.error(x.message||"Failed to send comment."))}catch{b(x=>x.filter(u=>u._id!==n)),o.error("An error occurred. Please try again.")}ne(!1)},l=async n=>{if(R.trim())try{const i=await fetch(`${v}/api/bookings/${t._id}/comment/${n}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:R})}),d=await i.json();i.ok?(b(x=>d.comments.map(u=>{if(u._id===n)return u;const C=x.find(L=>L._id===u._id);return C&&C.status==="read"&&u.status!=="read"?{...u,status:"read"}:u})),re(null),W(""),o.success("Comment edited successfully!")):o.error(d.message||"Failed to edit comment.")}catch{o.error("An error occurred. Please try again.")}},m=n=>{re(n._id),W(n.message)},h=n=>{switch(n){case"pending":return"bg-yellow-100 text-yellow-700";case"accepted":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"cancelledByBuyer":return"bg-orange-100 text-orange-700";case"cancelledBySeller":return"bg-pink-100 text-pink-700";case"cancelledByAdmin":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},N=async()=>{let n="";if(A){if(n=prompt("Please provide a reason for cancelling this appointment (required):"),!n)return o.error("Reason is required for seller cancellation.")}else n=prompt("Please provide a reason for cancelling this appointment (optional):")||"";if(window.confirm("Are you sure you want to cancel this appointment?"))try{const i=await fetch(`${v}/api/bookings/${t._id}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:n})}),d=await i.json();if(i.status===401){o.error("Session expired or unauthorized. Please sign in again."),navigate("/sign-in");return}i.ok?(o.success("Appointment cancelled successfully."),typeof me=="function"&&me(t._id,A?"cancelledBySeller":"cancelledByBuyer")):o.error(d.message||"Failed to cancel appointment.")}catch{o.error("An error occurred. Please try again.")}},D=async()=>{const n=prompt("Please provide a reason for admin cancellation (required):");if(!n)return o.error("Reason is required for admin cancellation.");if(window.confirm("Are you sure you want to cancel this appointment as admin?"))try{const i=await fetch(`${v}/api/bookings/${t._id}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:n})}),d=await i.json();if(i.status===401){o.error("Session expired or unauthorized. Please sign in again."),navigate("/sign-in");return}i.ok?(o.success("Appointment cancelled by admin."),navigate("/user/my-appointments")):o.error(d.message||"Failed to cancel appointment.")}catch{o.error("An error occurred. Please try again.")}},T=async()=>{if(window.confirm("Are you sure you want to permanently remove this appointment from your table? This cannot be undone."))try{const n=F?"buyer":A?"seller":null;if(!n)return;if((await fetch(`${v}/api/bookings/${t._id}/soft-delete`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({who:n})})).ok){if(typeof window<"u"){const d=new CustomEvent("removeAppointmentRow",{detail:t._id});window.dispatchEvent(d),o.success("Appointment removed from your table sucessfully")}}else o.error("Failed to remove appointment from table.")}catch{o.error("An error occurred. Please try again.")}};E.useEffect(()=>{j&&I.current&&I.current.scrollIntoView({behavior:"smooth"})},[j,K]);const _=E.useCallback(()=>{if(O.current){const{scrollTop:n,scrollHeight:i,clientHeight:d}=O.current,x=i-n-d<5;H(x)}},[]);E.useEffect(()=>{const n=O.current;if(n&&j)return n.addEventListener("scroll",_),_(),()=>{n.removeEventListener("scroll",_)}},[j,_]);const he=E.useCallback(()=>{I.current&&I.current.scrollIntoView({behavior:"smooth"})},[]);E.useEffect(()=>{function n(i){i.appointmentId===t._id&&!j&&o.info(`New message from ${i.comment.senderEmail||"User"}`)}return f.on("commentUpdate",n),()=>{f.off("commentUpdate",n)}},[t._id,j]),E.useEffect(()=>{function n(i){i.appointmentId===t._id&&(b(d=>{const x=d.findIndex(u=>u._id===i.comment._id);if(x!==-1){const u=[...d],C=d[x],L=i.comment;let de=L.status;return C.status==="read"&&L.status!=="read"&&(de="read"),u[x]={...L,status:de},u}else return[...d,i.comment]}),j&&i.comment.senderEmail!==y.email&&fetch(`${v}/api/bookings/${t._id}/comments/read`,{method:"PATCH",credentials:"include"}))}return f.on("commentUpdate",n),()=>{f.off("commentUpdate",n)}},[t._id,b,j,y.email]),E.useEffect(()=>{j&&(fetch(`${v}/api/bookings/${t._id}`).then(n=>n.json()).then(n=>{n&&Array.isArray(n.comments)&&b(i=>n.comments.map(d=>{const x=i.find(u=>u._id===d._id);return x&&x.status==="read"&&d.status!=="read"?{...d,status:"read"}:d}))}),fetch(`${v}/api/bookings/${t._id}/comments/read`,{method:"PATCH",credentials:"include"}))},[j,t._id]),E.useEffect(()=>{function n(d){d.appointmentId===t._id&&b(x=>x.map(u=>u._id===d.commentId?{...u,status:u.status==="read"?"read":"delivered"}:u))}function i(d){d.appointmentId===t._id&&b(x=>x.map(u=>{var C;return(C=u.readBy)!=null&&C.includes(d.userId)?u:{...u,status:"read",readBy:[...u.readBy||[],d.userId]}}))}return f.on("commentDelivered",n),f.on("commentRead",i),()=>{f.off("commentDelivered",n),f.off("commentRead",i)}},[t._id,b]);const Z=K.filter(n=>{var i;return!((i=n.readBy)!=null&&i.includes(y._id))&&n.senderEmail!==y.email}).length;E.useEffect(()=>(j?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[j]);const oe=`chatClearTime_${t._id}`,xe=Number(localStorage.getItem(oe))||0,fe=ie(t._id),be=K.filter(n=>new Date(n.timestamp).getTime()>xe&&!fe.includes(n._id));return c.useEffect(()=>{if(!j||!(r!=null&&r._id))return;f.emit("checkUserOnline",{userId:r._id});function n(i){i.userId===r._id&&X(!!i.online)}return f.on("userOnlineStatus",n),f.on("userOnlineUpdate",n),()=>{f.off("userOnlineStatus",n),f.off("userOnlineUpdate",n)}},[j,r==null?void 0:r._id]),c.useEffect(()=>{function n(i){i.fromUserId===(r==null?void 0:r._id)&&i.appointmentId===t._id&&(je(!0),J.current&&clearTimeout(J.current),J.current=setTimeout(()=>je(!1),2e3))}return f.on("typing",n),()=>{f.off("typing",n),J.current&&clearTimeout(J.current)}},[r==null?void 0:r._id,t._id]),e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-blue-50 transition align-top ${S?"":"bg-gray-100"}`,children:[e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[e.jsx("div",{children:new Date(t.date).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-sm text-gray-600",children:t.time}),!S&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"Outdated"})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{children:t.listingId?e.jsx(ze,{to:ue?`/admin/listing/${t.listingId._id}`:`/user/listing/${t.listingId._id}`,className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:t.propertyName}):e.jsx("div",{className:"font-semibold",children:t.propertyName})})}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${A?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:A?"Seller":"Buyer"})}),e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[s?e.jsx("button",{className:"font-semibold text-blue-700 hover:underline text-left",style:{cursor:"pointer"},onClick:()=>ce(r),title:"Click to view details",children:(r==null?void 0:r.username)||"Unknown"}):e.jsx("span",{className:"font-semibold",children:(r==null?void 0:r.username)||"Unknown"}),s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-600",children:r==null?void 0:r.email}),e.jsx("div",{className:"text-sm text-gray-600",children:r!=null&&r.mobileNumber&&(r==null?void 0:r.mobileNumber)!==""?r.mobileNumber:"No phone"})]}):e.jsx("div",{className:"text-sm text-gray-500 italic",children:ee?"Contact info available":"Contact info hidden until accepted"})]})}),e.jsx("td",{className:"border p-2 capitalize",children:t.purpose}),e.jsx("td",{className:"border p-2 max-w-xs truncate",children:t.message}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${h(t.status)}`,children:t.status==="cancelledByBuyer"?"Cancelled by Buyer":t.status==="cancelledBySeller"?"Cancelled by Seller":t.status==="cancelledByAdmin"?"Cancelled by Admin":t.status.charAt(0).toUpperCase()+t.status.slice(1)})}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("div",{className:"flex flex-col gap-2",children:S?e.jsxs(e.Fragment,{children:[A&&t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-green-500 hover:text-green-700 text-xl disabled:opacity-50",onClick:()=>p(t._id,"accepted"),disabled:P===t._id+"accepted",title:"Accept Appointment",children:e.jsx(_e,{})}),e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl disabled:opacity-50",onClick:()=>p(t._id,"rejected"),disabled:P===t._id+"rejected",title:"Reject Appointment",children:e.jsx(He,{})})]}),A&&t.status==="accepted"&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:N,title:"Cancel Appointment (Seller)",children:e.jsx(Y,{})}),A&&(t.status==="cancelledBySeller"||t.status==="cancelledByBuyer"||t.status==="cancelledByAdmin"||t.status==="rejected"||t.status==="deletedByAdmin")&&e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:T,title:"Remove from table",style:{opacity:.5},children:e.jsx(Y,{className:"group-hover:text-red-900 group-hover:scale-125 group-hover:animate-shake transition-all duration-200"})}),F&&(t.status==="pending"||t.status==="accepted")&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:N,title:"Cancel Appointment (Buyer)",children:e.jsx(Y,{})}),F&&(t.status==="cancelledByBuyer"||t.status==="cancelledBySeller"||t.status==="cancelledByAdmin"||t.status==="deletedByAdmin"||t.status==="rejected")&&e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:T,title:"Remove from table",style:{opacity:.5},children:e.jsx(Y,{className:"group-hover:text-red-900 group-hover:scale-125 group-hover:animate-shake transition-all duration-200"})}),ee&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:D,title:"Cancel Appointment (Admin)",children:e.jsx(Je,{})}),(t.status==="cancelledByBuyer"&&F||t.status==="cancelledBySeller"&&A)&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{className:"text-blue-500 hover:text-blue-700 text-xs border border-blue-500 rounded px-2 py-1 mt-1",onClick:()=>G(t),disabled:t.status==="cancelledByBuyer"&&F&&(t.buyerReinitiationCount||0)>=2||t.status==="cancelledBySeller"&&A&&(t.sellerReinitiationCount||0)>=2||!t.buyerId||!t.sellerId,title:"Reinitiate or Reschedule Appointment",children:"Reinitiate"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:F&&t.status==="cancelledByBuyer"?`${2-(t.buyerReinitiationCount||0)} left`:A&&t.status==="cancelledBySeller"?`${2-(t.sellerReinitiationCount||0)} left`:""})]})]}):e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:T,title:"Delete outdated appointment from table",style:{opacity:.7},children:e.jsx(Y,{size:18})})})}),e.jsx("td",{className:"border p-2 text-center relative",children:e.jsxs("button",{className:`flex items-center justify-center rounded-full p-2 shadow-md mx-auto relative ${S?"bg-blue-100 hover:bg-blue-200 text-blue-700":"bg-gray-100 text-gray-400 cursor-not-allowed opacity-50"}`,title:S?"Open Chat":"Chat not available for outdated appointments",onClick:S?()=>w(!0):void 0,disabled:!S,children:[e.jsx(ve,{size:20}),Z>0&&!S&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-gray-400 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-bold border-2 border-white",children:Z}),Z>0&&S&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-bold border-2 border-white",children:Z})]})})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 rounded-2xl shadow-2xl max-w-md w-full p-0 relative animate-fadeIn flex flex-col",children:[S?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-200 to-purple-200 rounded-t-2xl relative",children:[e.jsx(ve,{className:"text-blue-600 text-xl"}),e.jsx("h3",{className:"text-lg font-bold text-blue-800",children:"Chat"}),Ce?e.jsx("span",{className:"ml-3 text-blue-600 font-semibold text-sm",children:"Typing..."}):pe?e.jsx("span",{className:"ml-3 text-green-600 font-semibold text-sm",children:"Online"}):e.jsx("span",{className:"ml-3 text-gray-600 font-semibold text-sm",children:"Offline"}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsx("button",{className:"text-xs text-red-600 hover:underline",onClick:()=>{localStorage.setItem(oe,Date.now()),b([])},title:"Clear chat locally",children:"Clear Chat"}),e.jsx("button",{className:"text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>w(!1),title:"Close","aria-label":"Close",children:"Ã—"})]})]}),e.jsxs("div",{ref:O,className:"flex-1 max-h-60 overflow-y-auto space-y-2 mb-4 px-4 pt-4 animate-fadeInChat relative",children:[k&&e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 mb-2 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsx("span",{className:"text-xs text-gray-600 truncate",children:k.message}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700",onClick:()=>Q(null),title:"Cancel reply",children:"Ã—"})]}),be.map((n,i)=>{var de,Ae;const d=n.senderEmail===y.email,x=z===n._id,u=new Date(n.timestamp),C=i>0?new Date(K[i-1].timestamp):null,L=C?u.toDateString()!==C.toDateString():!0;return u.toLocaleDateString("en-US",{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),e.jsxs(E.Fragment,{children:[L&&e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("span",{className:"bg-gray-200 text-gray-700 text-xs px-3 py-1 rounded-full shadow",children:Ge(u)})}),e.jsx("div",{className:`flex w-full ${d?"justify-end":"justify-start"} animate-fadeInChatBubble`,style:{animationDelay:`${.03*i}s`},children:e.jsxs("div",{ref:g=>q.current[n._id]=g,className:`rounded-2xl px-4 py-2 text-sm shadow-lg max-w-[60%] break-words relative ${d?"bg-gradient-to-r from-blue-400 to-blue-600 text-white":"bg-white text-gray-800 border border-gray-200"}`,style:{animationDelay:`${.03*i}s`},children:[n.replyTo&&e.jsx("div",{className:"border-l-4 border-blue-300 pl-2 mb-1 text-xs text-gray-500 bg-blue-50 rounded w-full max-w-full break-words cursor-pointer",onClick:()=>{q.current[n.replyTo]&&(q.current[n.replyTo].scrollIntoView({behavior:"smooth",block:"center"}),q.current[n.replyTo].classList.add("ring-2","ring-yellow-400"),setTimeout(()=>{q.current[n.replyTo].classList.remove("ring-2","ring-yellow-400")},1e3))},role:"button",tabIndex:0,"aria-label":"Go to replied message",children:e.jsx("span",{className:"text-xs text-gray-600 truncate",children:((de=K.find(g=>g._id===n.replyTo))==null?void 0:de.message)||"Original message"})}),e.jsxs("div",{className:"font-semibold mb-1 flex items-center gap-2 flex-wrap break-all",children:[e.jsx("span",{className:"truncate max-w-[60%] min-w-[80px] inline-block align-middle overflow-hidden text-ellipsis",children:d?"You":(r==null?void 0:r.username)||n.senderName||n.senderEmail}),e.jsx("span",{className:"text-gray-300 ml-2 text-[10px]",children:new Date(n.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})})]}),e.jsx("div",{className:"flex items-center gap-1",children:n.deleted?e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx(qe,{className:"inline-block text-lg"})," ",n.senderEmail===y.email?"You deleted this message":"This message was deleted.",e.jsx("button",{className:"ml-2 text-red-700 hover:text-red-900",onClick:()=>{b(g=>g.filter(te=>te._id!==n._id)),le(t._id,n._id)},title:"Remove this deleted message from your chat view",children:e.jsx(Y,{className:"group-hover:text-red-900 group-hover:scale-125 group-hover:animate-shake transition-all duration-200"})})]}):x?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",className:"border rounded px-2 py-1 text-xs w-40 text-gray-900 bg-white focus:bg-white",value:R,onChange:g=>W(g.target.value),onKeyDown:g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),l(n._id))},autoFocus:!0}),e.jsx("button",{onClick:()=>l(n._id),className:"bg-green-700 hover:bg-green-900 text-white font-bold ml-1 px-3 py-1 rounded",children:"Save"}),e.jsx("button",{onClick:()=>{re(null),W("")},className:"bg-red-700 hover:bg-red-900 text-white font-bold ml-1 px-3 py-1 rounded",children:"Cancel"})]}):e.jsxs("div",{children:[n.message,n.edited&&e.jsx("span",{className:"ml-2 text-[10px] italic text-gray-300",children:"(Edited)"})]})}),e.jsxs("div",{className:"flex items-center gap-2 justify-end mt-1",children:[e.jsx("button",{className:`${d?"text-yellow-500 hover:text-yellow-700":"text-blue-600 hover:text-blue-800"}`,onClick:()=>{var g;Q(n),(g=ae.current)==null||g.focus()},title:"Reply",children:e.jsx("svg",{width:"18",height:"18",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),n.senderEmail===y.email&&!x&&!n.deleted&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(n),className:"text-green-700 hover:text-green-900",title:"Edit comment",children:e.jsx(Ye,{size:12})}),e.jsx("button",{className:"text-red-700 hover:text-red-900",onClick:async()=>{if(window.confirm("Are you sure you want to delete this comment?"))try{const g=await fetch(`${v}/api/bookings/${t._id}/comment/${n._id}`,{method:"DELETE",credentials:"include"}),te=await g.json();g.ok?(b(De=>te.comments.map(ge=>{const Se=De.find(Te=>Te._id===ge._id);return Se&&Se.status==="read"&&ge.status!=="read"?{...ge,status:"read"}:ge})),o.success("Comment deleted successfully!")):o.error(te.message||"Failed to delete comment.")}catch{o.error("An error occurred. Please try again.")}},children:e.jsx(Y,{className:"group-hover:text-red-900 group-hover:scale-125 group-hover:animate-shake transition-all duration-200"})}),e.jsx("span",{className:"ml-1",children:(Ae=n.readBy)!=null&&Ae.includes(r==null?void 0:r._id)?e.jsx(ke,{className:"text-white inline"}):n.status==="delivered"?e.jsx(ke,{className:"text-white/70 inline"}):e.jsx(_e,{className:"text-white/70 inline"})})]}),!d&&!x&&!n.deleted&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xs",onClick:()=>{b(g=>g.filter(te=>te._id!==n._id)),le(t._id,n._id)},title:"Delete message locally",children:e.jsx(Y,{size:14})})]})]})})]},n._id||i)}),e.jsx("div",{ref:I})]}),e.jsxs("div",{className:"flex gap-2 mt-2 px-4 pb-4",children:[k&&e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 mb-2 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsx("span",{className:"text-xs text-gray-600 truncate",children:k.message}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700",onClick:()=>Q(null),title:"Cancel reply",children:"Ã—"})]}),e.jsx("input",{type:"text",className:"flex-1 px-3 py-2 border rounded-full text-sm focus:ring-2 focus:ring-blue-200 shadow",placeholder:"Type a message...",value:M,onChange:n=>{se(n.target.value),f.emit("typing",{toUserId:r._id,fromUserId:y._id,appointmentId:t._id})},onKeyDown:n=>{n.key==="Enter"&&a()},ref:ae}),e.jsx("button",{onClick:a,disabled:$||!M.trim(),className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-5 py-2 rounded-full text-sm font-semibold shadow hover:from-blue-600 hover:to-purple-600 transition disabled:opacity-50",children:"Send"})]}),e.jsx("style",{jsx:!0,children:`
                  @keyframes fadeInChatBubble {
                    from { opacity: 0; transform: translateY(10px) scale(0.98); }
                    to { opacity: 1; transform: translateY(0) scale(1); }
                  }
                  .animate-fadeInChatBubble {
                    animation: fadeInChatBubble 0.4s cubic-bezier(0.4,0,0.2,1) both;
                  }
                  @keyframes fadeInChat {
                    from { opacity: 0; }
                    to { opacity: 1; }
                  }
                  .animate-fadeInChat {
                    animation: fadeInChat 0.3s cubic-bezier(0.4,0,0.2,1) both;
                  }
                `})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-60 p-8",children:[e.jsx(ve,{className:"text-4xl text-gray-400 mb-4"}),e.jsx("div",{className:"text-lg font-semibold text-gray-500 text-center",children:"Chat not available for outdated appointments"})]}),!V&&S&&e.jsx("div",{className:"absolute bottom-6 right-6 z-20",children:e.jsx("button",{onClick:he,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 animate-pulse",title:"Scroll to bottom","aria-label":"Scroll to bottom",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})})})})]})})]})}export{Ve as default};
