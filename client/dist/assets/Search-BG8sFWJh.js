import{u as L,a as S,r as i,j as e,d as C}from"./index-crh2KQ3K.js";import{L as A}from"./ListingItem-DDkG0D7Z.js";import{L as T}from"./LocationSelector-ch0Ubu6o.js";import"./index-DDjDdRay.js";import"./addressMasking-3vIUwCOC.js";function R(){const d=L(),b=S(),[r,l]=i.useState({searchTerm:"",type:"all",parking:!1,furnished:!1,offer:!1,sort:"createdAt",order:"desc",minPrice:"",maxPrice:"",city:"",state:"",bedrooms:"",bathrooms:""}),[c,m]=i.useState([]),[u,x]=i.useState(!1),[j,h]=i.useState(!1),[g,p]=i.useState(null),[y,f]=i.useState({state:"",district:"",city:""});i.useEffect(()=>{const t=new URLSearchParams(d.search);l({searchTerm:t.get("searchTerm")||"",type:t.get("type")||"all",parking:t.get("parking")==="true",furnished:t.get("furnished")==="true",offer:t.get("offer")==="true",sort:t.get("sort")||"createdAt",order:t.get("order")||"desc",minPrice:t.get("minPrice")||"",maxPrice:t.get("maxPrice")||"",city:t.get("city")||"",state:t.get("state")||"",bedrooms:t.get("bedrooms")||"",bathrooms:t.get("bathrooms")||""}),f({state:t.get("state")||"",district:t.get("district")||"",city:t.get("city")||""}),(async()=>{x(!0),p(null);try{const s=await fetch(`/api/listing/get?${t.toString()}`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const o=await s.json();m(Array.isArray(o)?o:[]),h(Array.isArray(o)&&o.length>8)}catch(s){console.error("Error fetching listings:",s),p("Failed to load listings. Please try again."),m([]),h(!1)}x(!1)})()},[d.search]);const n=t=>{const{name:a,value:s,checked:o,type:P}=t.target;l(k=>({...k,[a]:P==="checkbox"?o:s}))},w=t=>{t.preventDefault();const a=new URLSearchParams(r);b(`?${a.toString()}`)},v=async()=>{try{const t=new URLSearchParams(d.search);t.set("startIndex",c.length);const a=await fetch(`/api/listing/get?${t.toString()}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();Array.isArray(s)&&(m(o=>[...o,...s]),h(s.length>=8))}catch(t){console.error("Error fetching more listings:",t)}},N=t=>{f(t),l(a=>({...a,state:t.state,district:t.district,city:t.city}))};return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:"Explore Properties"}),e.jsxs("form",{onSubmit:w,className:"grid md:grid-cols-2 gap-4 bg-gray-100 p-4 rounded-lg mb-6",children:[e.jsx("input",{type:"text",name:"searchTerm",placeholder:"Search...",value:r.searchTerm,onChange:n,className:"p-2 border rounded-md w-full"}),e.jsxs("select",{name:"sort_order",onChange:t=>{const[a,s]=t.target.value.split("_");l(o=>({...o,sort:a,order:s}))},value:`${r.sort}_${r.order}`,className:"p-2 border rounded-md w-full",children:[e.jsx("option",{value:"regularPrice_desc",children:"Price high to low"}),e.jsx("option",{value:"regularPrice_asc",children:"Price low to high"}),e.jsx("option",{value:"createdAt_desc",children:"Latest"}),e.jsx("option",{value:"createdAt_asc",children:"Oldest"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(T,{value:y,onChange:N,mode:"search"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"type",value:"all",checked:r.type==="all",onChange:n})," ","All"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"type",value:"rent",checked:r.type==="rent",onChange:n})," ","Rent"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"type",value:"sale",checked:r.type==="sale",onChange:n})," ","Sale"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"parking",onChange:n,checked:r.parking})," ","Parking"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"furnished",onChange:n,checked:r.furnished})," ","Furnished"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"offer",onChange:n,checked:r.offer})," ","Offer"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",name:"minPrice",placeholder:"Min Price",value:r.minPrice,onChange:n,className:"p-2 border rounded-md w-full",min:0}),e.jsx("input",{type:"number",name:"maxPrice",placeholder:"Max Price",value:r.maxPrice,onChange:n,className:"p-2 border rounded-md w-full",min:0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",name:"bedrooms",placeholder:"Bedrooms",value:r.bedrooms,onChange:n,className:"p-2 border rounded-md w-full",min:1}),e.jsx("input",{type:"number",name:"bathrooms",placeholder:"Bathrooms",value:r.bathrooms,onChange:n,className:"p-2 border rounded-md w-full",min:1})]}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white p-2 rounded-md w-full",children:"Search"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Listings"}),u&&e.jsx("p",{className:"text-center text-lg font-semibold text-blue-600 animate-pulse",children:"Loading..."}),g&&e.jsx("p",{className:"text-center text-red-600 text-lg mb-4",children:g}),!u&&!g&&c.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("img",{src:C,alt:"No listings found",className:"w-32 h-32 object-contain mx-auto mb-4 animate-float"}),e.jsx("h3",{className:"text-xl font-bold text-gray-700 mb-2",children:"No Listings Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Try adjusting your search criteria or filters"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:c&&c.map(t=>e.jsx(A,{listing:t},t._id))}),j&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx("button",{type:"button",onClick:v,className:"mt-4 bg-gray-600 text-white p-2 rounded-md w-500",children:"Show More"})})]})]})})}export{R as default};
