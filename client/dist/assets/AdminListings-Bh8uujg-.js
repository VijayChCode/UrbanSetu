import{r as t,g as T,j as e,L as i,a2 as F,m as U,v as O,A as E,a0 as z,y as q}from"./index-DKfelPSF.js";import{C as J}from"./ContactSupportWrapper-C4Vxy7DO.js";import{m as B}from"./addressMasking-3vIUwCOC.js";const b="https://urbansetu.onrender.com";function G(){const[y,j]=t.useState([]),[k,w]=t.useState(!0),[N,v]=t.useState(null),{currentUser:D}=T(s=>s.user),[c,m]=t.useState(!1),[x,P]=t.useState(""),[u,p]=t.useState(!1),[h,C]=t.useState(""),[S,f]=t.useState(!1),[n,r]=t.useState(""),[L,R]=t.useState(null);t.useEffect(()=>(c||u?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[c,u]),t.useEffect(()=>{(async()=>{try{w(!0),v(null);const a=await fetch(`${b}/api/listing/get`,{credentials:"include"});if(a.ok){const l=await a.json();j(l)}else throw new Error("Failed to fetch listings")}catch{v("Failed to load listings. Please try again.")}finally{w(!1)}})()},[]);const A=s=>{R(s),P(""),r(""),m(!0)},I=s=>{if(s.preventDefault(),!x.trim()){r("Reason is required");return}m(!1),r(""),p(!0)},_=async s=>{if(s.preventDefault(),!h){r("Password is required");return}f(!0),r("");try{if(!(await fetch(`${b}/api/user/verify-password/${D._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:h})})).ok){r("Incorrect password. Property not deleted."),f(!1);return}const l=await fetch(`${b}/api/listing/delete/${L}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:x})});if(l.ok){j($=>$.filter(M=>M._id!==L)),p(!1);const g=await l.json();q.success(g.message||"Listing deleted successfully!")}else{const g=await l.json();r(g.message||"Failed to delete listing.")}}catch{r("An error occurred. Please try again.")}finally{f(!1)}},o=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),d=s=>s.offer&&s.regularPrice&&s.discountPrice?Math.round((s.regularPrice-s.discountPrice)/s.regularPrice*100):0;return k?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading all listings..."})]})}):N?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-6",children:e.jsx("div",{className:"text-center text-red-600 text-lg",children:N})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-6xl w-full mx-auto px-2 sm:px-4 md:px-8 py-8 overflow-x-hidden",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-extrabold text-blue-700 drop-shadow",children:"All Listings (Admin)"}),e.jsxs(i,{to:"/admin/create-listing",className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-sm sm:text-base w-full sm:w-auto justify-center mt-4 md:mt-0",children:[e.jsx(F,{})," ",e.jsx("span",{children:"Create New Listing"})]})]}),y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"🏠"}),e.jsx("h4",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No listings yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Start by creating your first property listing"}),e.jsxs(i,{to:"/admin/create-listing",className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold inline-flex items-center gap-1 sm:gap-2 text-sm sm:text-base w-full sm:w-auto justify-center",children:[e.jsx(F,{})," ",e.jsx("span",{children:"Create Your First Listing"})]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:y.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200 rounded-t-lg overflow-hidden",children:[s.imageUrls&&s.imageUrls.length>0?e.jsx("img",{src:s.imageUrls[0],alt:s.name,className:"w-full h-full object-cover",onError:a=>{a.target.src="https://via.placeholder.com/400x300?text=No+Image"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx("span",{children:"No Image"})}),s.offer&&d(s)>0&&e.jsx("div",{className:"absolute top-2 left-2 z-20",children:e.jsxs("span",{className:"bg-yellow-400 text-gray-900 text-xs font-semibold px-2 py-1 rounded-full shadow-md animate-pulse",title:"Limited-time offer!",children:[d(s),"% OFF"]})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${s.type==="sale"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:s.type==="sale"?"For Sale":"For Rent"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-lg text-gray-800 mb-2 truncate",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm mb-2 truncate",children:B(s.propertyNumber||s.city?{propertyNumber:s.propertyNumber,landmark:s.landmark,city:s.city,district:s.district,state:s.state,pincode:s.pincode}:s.address,!0)}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-3",children:[e.jsxs("span",{children:[s.bedrooms," bed"]}),e.jsxs("span",{children:[s.bathrooms," bath"]}),s.parking&&e.jsx("span",{children:"Parking"}),s.furnished&&e.jsx("span",{children:"Furnished"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:s.offer&&d(s)>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:o(s.discountPrice)}),e.jsx("span",{className:"text-sm text-gray-500 line-through",children:o(s.regularPrice)})]}):e.jsxs("span",{children:[o(s.regularPrice),s.type==="rent"&&e.jsx("span",{className:"text-sm text-gray-500",children:"/month"})]})}),s.offer&&d(s)>0&&e.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["Save ",o(s.regularPrice-s.discountPrice)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{to:`/admin/listing/${s._id}`,className:"flex-1 bg-blue-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-blue-600 transition flex items-center justify-center gap-1",children:[e.jsx(U,{})," View"]}),e.jsxs(i,{to:`/admin/update-listing/${s._id}`,className:"flex-1 bg-yellow-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-yellow-600 transition flex items-center justify-center gap-1",children:[e.jsx(O,{})," Edit"]}),e.jsxs("button",{onClick:()=>A(s._id),className:"flex-1 bg-red-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-red-600 transition flex items-center justify-center gap-1",children:[e.jsx(E,{})," Delete"]})]})]})]},s._id))})]})})}),e.jsx(J,{}),c&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:I,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(E,{})," Reason for Deletion"]}),e.jsx("textarea",{className:"border rounded p-2 w-full",placeholder:"Enter reason for deleting this property",value:x,onChange:s=>P(s.target.value),rows:3,autoFocus:!0}),n&&e.jsx("div",{className:"text-red-600 text-sm",children:n}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-red-600 text-white font-semibold",children:"Next"})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:_,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(z,{})," Confirm Password"]}),e.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:h,onChange:s=>C(s.target.value),autoFocus:!0}),n&&e.jsx("div",{className:"text-red-600 text-sm",children:n}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:S,children:S?"Deleting...":"Confirm & Delete"})]})]})})]})}export{G as default};
