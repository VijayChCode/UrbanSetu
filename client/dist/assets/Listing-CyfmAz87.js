import{g as Le,r as o,j as e,v as ae,U as Pe,w as Ne,x as ve,z as pe,A as Ze,B as Fe,C as Ae,D as Oe,y as g,b as Ve,E as qe,G as He,H as Te,I as Ke,J as Ge,K as Qe,M as et,O as tt,P as st,Q as at,t as nt,u as rt,h as lt,R as ot,L as Ue,S as it,T as dt,V as ct,W as mt,X as xt,Y as ut,Z as ht,_ as pt,$ as gt,a0 as ft}from"./index-BwPOZE-w.js";import{S as bt,N as yt,a as Ie}from"./navigation-CrsoydvQ.js";import{C as jt}from"./ContactSupportWrapper-DA96KGZs.js";import{R as Je}from"./ReviewForm-lKCvZ12A.js";import{s as Be,m as wt,g as Me}from"./addressMasking-3vIUwCOC.js";const Nt="https://urbansetu.onrender.com";function ze({reviewId:f,onReplyAdded:v}){const{currentUser:j}=Le(N=>N.user),[s,a]=o.useState(""),[b,E]=o.useState(!1),[D,U]=o.useState("");if(!j)return null;const I=async N=>{if(N.preventDefault(),!s.trim()){U("Reply cannot be empty");return}E(!0),U("");try{const k=await fetch(`${Nt}/api/review/reply/${f}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:s})}),S=await k.json();k.ok?(a(""),v&&v()):U(S.message||"Failed to add reply")}catch{U("Network error. Please try again.")}finally{E(!1)}};return e.jsxs("form",{onSubmit:I,className:"flex flex-col gap-2 mt-2",children:[e.jsx("textarea",{value:s,onChange:N=>a(N.target.value),rows:2,className:"w-full border border-gray-300 rounded p-2 text-sm",placeholder:"Write a reply...",disabled:b}),D&&e.jsx("div",{className:"text-red-600 text-xs",children:D}),e.jsx("button",{type:"submit",className:"self-end bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm",disabled:b||!s.trim(),children:b?"Replying...":"Reply"})]})}const $="https://urbansetu.onrender.com";function vt({listingId:f,onReviewDeleted:v,listingOwnerId:j}){const{currentUser:s}=Le(t=>t.user),[a,b]=o.useState([]),[E,D]=o.useState(!0),[U,I]=o.useState(""),[N,k]=o.useState(null),[S,V]=o.useState("date"),[P,H]=o.useState("desc"),[Y,q]=o.useState({}),[K,J]=o.useState({}),[G,R]=o.useState({}),[B,_]=o.useState({}),[C,F]=o.useState(null),[W,X]=o.useState(!1),[x,M]=o.useState(""),[A,O]=o.useState(null),[de,ce]=o.useState(""),[ne,ge]=o.useState(!1),[me,fe]=o.useState({}),[Q,ke]=o.useState({});o.useEffect(()=>{be();const t=n=>{(n.listingId===f||n.listingId&&n.listingId._id===f)&&(b(d=>d.some(i=>i._id===n._id)?d.map(i=>i._id===n._id?n:i):[n,...d]),Z(n._id))};ae.on("reviewUpdated",t);const r=({action:n,replies:d,reviewId:u,reply:i,replyId:h})=>{n==="updatedAll"&&u&&d?_(L=>({...L,[u]:d})):n==="deleted"&&u?Z(u):i&&i.reviewId&&Z(i.reviewId)};ae.on("reviewReplyUpdated",r);const l=n=>{console.log("[ReviewList] Received profileUpdated socket event:",n),console.log("[ReviewList] Current reviews:",a.length),b(d=>{const u=d.map(i=>i.userId===n.userId?(console.log("[ReviewList] Updating review:",i._id,"for user:",n.userId),{...i,userName:n.username,userAvatar:n.avatar}):i);return console.log("[ReviewList] Updated reviews:",u.length),u}),_(d=>{const u={...d};return Object.keys(u).forEach(i=>{var h;u[i]=(h=u[i])==null?void 0:h.map(L=>L.userId===n.userId?(console.log("[ReviewList] Updating reply:",L._id,"for user:",n.userId),{...L,userName:n.username,userAvatar:n.avatar}):L)}),u})};return ae.on("profileUpdated",l),console.log("[ReviewList] Socket listeners set up for profileUpdated"),ae.emit("testConnection",{message:"ReviewList component connected"},n=>{console.log("[ReviewList] Test socket response:",n)}),()=>{ae.off("reviewUpdated",t),ae.off("reviewReplyUpdated",r),ae.off("profileUpdated",l),console.log("[ReviewList] Socket listeners cleaned up"),document.body.style.overflow="unset"}},[f,S,P]),o.useEffect(()=>{s&&(b(t=>t.map(r=>r.userId===s._id?{...r,userName:s.username,userAvatar:s.avatar}:r)),_(t=>{const r={...t};return Object.keys(r).forEach(l=>{var n;r[l]=(n=r[l])==null?void 0:n.map(d=>d.userId===s._id?{...d,userName:s.username,userAvatar:s.avatar}:d)}),r}))},[s]),o.useEffect(()=>{const t=setInterval(async()=>{if(s)try{const r=await fetch(`${$}/api/user/id/${s._id}`);if(r.ok){const l=await r.json();(l.username!==s.username||l.avatar!==s.avatar)&&(console.log("[ReviewList] Profile updated via polling:",l),b(n=>n.map(d=>d.userId===l._id?{...d,userName:l.username,userAvatar:l.avatar}:d)),_(n=>{const d={...n};return Object.keys(d).forEach(u=>{var i;d[u]=(i=d[u])==null?void 0:i.map(h=>h.userId===l._id?{...h,userName:l.username,userAvatar:l.avatar}:h)}),d}))}}catch(r){console.error("[ReviewList] Error polling for profile updates:",r)}},3e4);return()=>clearInterval(t)},[s]);const be=async()=>{try{const t=await fetch(`${$}/api/review/listing/${f}?sort=${S}&order=${P}`,{credentials:"include"}),r=await t.json();t.ok?b(r):I(r.message||"Failed to load reviews")}catch{I("Network error. Please try again.")}finally{D(!1)}},xe=async t=>{if(window.confirm("Are you sure you want to delete this review?"))try{const r=await fetch(`${$}/api/review/delete/${t}`,{method:"DELETE",credentials:"include"}),l=await r.json();r.ok?(b(a.filter(n=>n._id!==t)),v&&v(),g.success("Review deleted successfully")):g.error(l.message||"Failed to delete review")}catch{g.error("Network error. Please try again.")}},ye=t=>{k(t)},re=()=>{k(null),be()},je=async t=>{if(!s){g.info("Please sign in to vote on reviews");return}b(r=>r.map(l=>{var n;if(l._id===t){const d=(n=l.helpfulVotes)==null?void 0:n.some(h=>h.userId===s._id);let u,i=l.helpfulCount||0;return d?(u=l.helpfulVotes.filter(h=>h.userId!==s._id),i=Math.max(0,i-1)):(u=[...l.helpfulVotes||[],{userId:s._id}],i=i+1),{...l,helpfulVotes:u,helpfulCount:i}}return l}));try{const r=await fetch(`${$}/api/review/helpful/${t}`,{method:"POST",credentials:"include"})}catch{g.error("Network error. Please try again.")}},le=async t=>{J(r=>({...r,[t]:!0})),R(r=>({...r,[t]:""}));try{const r=await fetch(`${$}/api/review/respond/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({ownerResponse:Y[t]})}),l=await r.json();r.ok?(b(n=>n.map(d=>d._id===t?{...d,ownerResponse:Y[t]}:d)),q(n=>({...n,[t]:""}))):R(n=>({...n,[t]:l.message||"Failed to submit response"}))}catch{R(l=>({...l,[t]:"Network error. Please try again."}))}finally{J(r=>({...r,[t]:!1}))}},ee=t=>[...Array(5)].map((r,l)=>e.jsx(Ve,{className:`text-lg ${l<t?"text-yellow-400":"text-gray-300"}`},l)),Ee=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),oe=t=>{const l={pending:{color:"bg-yellow-100 text-yellow-800",icon:Te},approved:{color:"bg-green-100 text-green-800",icon:Te},rejected:{color:"bg-red-100 text-red-800",icon:He},removed:{color:"bg-gray-100 text-gray-800",icon:qe}}[t];if(!l)return e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:t?t.charAt(0).toUpperCase()+t.slice(1):"Unknown"});const n=l.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.color}`,children:[e.jsx(n,{className:"mr-1"}),t.charAt(0).toUpperCase()+t.slice(1)]})},te=t=>{var r;return s?(r=t.helpfulVotes)==null?void 0:r.some(l=>l.userId===s._id):!1},se=t=>S!==t?e.jsx(Ke,{className:"text-gray-400"}):P==="desc"?e.jsx(Ge,{className:"text-blue-600"}):e.jsx(Qe,{className:"text-blue-600"}),ue=t=>{S===t?(H(P==="desc"?"asc":"desc"),g.info(`Sorted by ${t} (${P==="desc"?"ascending":"descending"})`)):(V(t),H("desc"),g.info(`Sorted by ${t} (descending)`))},Z=async t=>{try{const r=await fetch(`${$}/api/review/reply/${t}`);if(r.ok){const l=await r.json();_(n=>({...n,[t]:l}))}}catch{}};o.useEffect(()=>{a.forEach(t=>Z(t._id))},[a]);const he=async(t,r,l)=>{var n,d,u;if(!s){g.info("Please sign in to vote on reviews");return}fe(i=>({...i,[t]:!0}));try{const i=(n=B[l])==null?void 0:n.find(c=>c._id===t);let h=r;i&&(r==="like"?(d=i.likes)!=null&&d.includes(s==null?void 0:s._id)?(h="remove_like",_(c=>({...c,[l]:c[l].map(p=>p._id===t?{...p,likes:p.likes.filter(T=>T!==s._id)}:p)}))):_(c=>({...c,[l]:c[l].map(p=>{var T;return p._id===t?{...p,likes:[...p.likes||[],s._id],dislikes:(T=p.dislikes)==null?void 0:T.filter(ie=>ie!==s._id)}:p})})):r==="dislike"&&((u=i.dislikes)!=null&&u.includes(s==null?void 0:s._id)?(h="remove_dislike",_(c=>({...c,[l]:c[l].map(p=>p._id===t?{...p,dislikes:p.dislikes.filter(T=>T!==s._id)}:p)}))):_(c=>({...c,[l]:c[l].map(p=>{var T;return p._id===t?{...p,dislikes:[...p.dislikes||[],s._id],likes:(T=p.likes)==null?void 0:T.filter(ie=>ie!==s._id)}:p})}))));const L=await fetch(`${$}/api/review/reply/like/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:h})})}catch{g.error("Network error. Please try again.")}finally{fe(i=>({...i,[t]:!1}))}},Se=async t=>{if(!s){g.info("Please sign in to vote on reviews");return}try{b(l=>l.map(n=>{var d;if(n._id===t){const u=(d=n.dislikes)==null?void 0:d.some(L=>L.userId===(s==null?void 0:s._id));let i,h=n.dislikeCount||0;return u?(i=n.dislikes.filter(L=>L.userId!==s._id),h=Math.max(0,h-1)):(i=[...n.dislikes||[],{userId:s._id}],h=h+1),{...n,dislikes:i,dislikeCount:h}}return n}));const r=await fetch(`${$}/api/review/dislike/${t}`,{method:"POST",credentials:"include"})}catch{g.error("Network error. Please try again.")}},Re=t=>{F(t)},_e=async()=>{!C||!C.comment.trim()||(await fetch(`${$}/api/review/reply/${C._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({comment:C.comment})}),F(null))},m=async t=>{window.confirm("Delete this reply?")&&await fetch(`${$}/api/review/reply/${t}`,{method:"DELETE",credentials:"include"})},y=t=>{X(t._id),M(t.ownerResponse||"")},w=async t=>{await le(t),X(!1)},Ce=async t=>{window.confirm("Delete owner response?")&&(await fetch(`${$}/api/review/respond/${t}`,{method:"DELETE",credentials:"include"}),X(!1))},$e=async(t,r)=>{if(!s){g.info("Please sign in to vote on reviews");return}b(l=>l.map(n=>{if(n._id===t){let d=n.ownerResponseLikes||[],u=n.ownerResponseDislikes||[];return r==="like"?d.includes(s._id)?d=d.filter(i=>i!==s._id):(d=[...d,s._id],u=u.filter(i=>i!==s._id)):r==="dislike"&&(u.includes(s._id)?u=u.filter(i=>i!==s._id):(u=[...u,s._id],d=d.filter(i=>i!==s._id))),{...n,ownerResponseLikes:d,ownerResponseDislikes:u}}return n}));try{await fetch(`${$}/api/review/respond/like/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:r})})}catch{}},z=t=>t&&(t.role==="admin"||t.role==="rootadmin"),We=t=>{O(t),ce(""),document.body.style.overflow="hidden"},Ye=async()=>{if(!de.trim()){g.info("Please provide a reason for reporting.");return}ge(!0);try{const t=await fetch(`${$}/api/review/report/${A._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:de})}),r=await t.json();t.ok?(g.success("Thank you for reporting. Our team will review this issue."),O(null),ce(""),document.body.style.overflow="unset"):g.error(r.message||"Failed to report issue.")}catch{g.error("Network error. Please try again.")}finally{ge(!1)}};return E?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading reviews..."})]}):U?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800",children:U})}):a.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"No reviews yet. Be the first to review this property!"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800",children:["Reviews (",a.filter(t=>t.status==="approved").length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),e.jsxs("button",{onClick:()=>ue("date"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Date ",se("date")]}),e.jsxs("button",{onClick:()=>ue("rating"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Rating ",se("rating")]}),e.jsxs("button",{onClick:()=>ue("helpful"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:["Helpful ",se("helpful")]})]})]}),a.filter(t=>t.status==="approved").map(t=>{var r,l,n,d,u,i,h,L;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[!z(t)&&e.jsx(Pe,{user:{username:t.userName,avatar:t.userAvatar},size:"w-10 h-10",textSize:"text-sm",showBorder:!1}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[z(t)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1",children:["From organization ",e.jsx(Ne,{className:"text-green-500"})]}):e.jsx("h4",{className:"font-semibold text-gray-800",children:t.userName}),(t.isVerified||t.verifiedByBooking)&&!z(t)&&e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(Ne,{className:"mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[ee(t.rating),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:[t.rating," star",t.rating>1?"s":""]})]})]})]}),s&&(s._id===t.userId||z(s))&&t.status!=="approved"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>ye(t),className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit review",children:e.jsx(ve,{})}),e.jsx("button",{onClick:()=>xe(t._id),className:"text-red-600 hover:text-red-800 p-1",title:"Delete review",children:e.jsx(pe,{})})]})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:t.comment}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:Ee(t.createdAt)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>je(t._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${te(t)?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,disabled:t.status!=="approved",children:[e.jsx(Ze,{className:te(t)?"text-blue-600":""}),e.jsx("span",{children:"Helpful"}),t.helpfulCount>0&&e.jsxs("span",{className:"ml-1",children:["(",t.helpfulCount,")"]})]}),e.jsxs("button",{onClick:()=>Se(t._id),className:`flex items-center gap-1 px-3 py-1 rounded-lg transition-colors ${(r=t.dislikes)!=null&&r.some(c=>c.userId===(s==null?void 0:s._id))?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("span",{role:"img","aria-label":"dislike",children:"ðŸ‘Ž"}),e.jsx("span",{children:"Dislike"}),t.dislikeCount>0&&e.jsxs("span",{className:"ml-1",children:["(",t.dislikeCount,")"]})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[oe(t.status),t.verifiedByBooking&&e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded",children:"Booked this property"})]}),t.adminNote&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Admin Note:"})," ",t.adminNote]})}),t.ownerResponse&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-md border border-blue-200 flex justify-between items-center",children:[e.jsx("div",{className:"flex-1",children:W===t._id?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded-md p-2 text-sm mb-2",rows:"2",value:x,onChange:c=>M(c.target.value)}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm ml-2",onClick:()=>w(t._id),children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm ml-2",onClick:()=>X(!1),children:"Cancel"})]}):e.jsx(e.Fragment,{children:e.jsxs("p",{className:"text-sm text-blue-800 flex items-center gap-2",children:[e.jsx(Fe,{className:"inline-block text-blue-500"}),e.jsx("strong",{children:"Owner Response:"})," ",t.ownerResponse]})})}),s&&j&&s._id!==j&&!W&&e.jsxs("div",{className:"flex gap-2 ml-4 items-center",children:[e.jsxs("button",{onClick:()=>$e(t._id,"like"),className:`flex items-center gap-1 ${(l=t.ownerResponseLikes)!=null&&l.includes(s._id)?"text-blue-600":"text-gray-500"}`,children:["ðŸ‘ Like ",((n=t.ownerResponseLikes)==null?void 0:n.length)>0&&`(${t.ownerResponseLikes.length})`]}),e.jsxs("button",{onClick:()=>$e(t._id,"dislike"),className:`flex items-center gap-1 ${(d=t.ownerResponseDislikes)!=null&&d.includes(s._id)?"text-red-600":"text-gray-500"}`,children:["ðŸ‘Ž Dislike ",((u=t.ownerResponseDislikes)==null?void 0:u.length)>0&&`(${t.ownerResponseDislikes.length})`]})]}),s&&j&&s._id===j&&!W&&e.jsxs("span",{className:"flex gap-2 ml-2",children:[e.jsx(Ae,{className:"cursor-pointer text-blue-600",title:"Edit",onClick:()=>y(t)}),e.jsx(pe,{className:"cursor-pointer text-red-600",title:"Delete",onClick:()=>Ce(t._id)})]})]}),e.jsxs("div",{className:"mt-4 ml-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h5",{className:"text-sm font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(Fe,{className:"text-blue-500"}),"Replies (",((i=B[t._id])==null?void 0:i.length)||0,")"]}),((h=B[t._id])==null?void 0:h.length)>0&&e.jsxs("button",{onClick:()=>ke(c=>({...c,[t._id]:!c[t._id]})),className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center gap-1 transition-colors",children:[Q[t._id]?"Hide":"Show"," Replies",e.jsx("span",{className:`transform transition-transform duration-200 ${Q[t._id]?"rotate-180":""}`,children:"â–¼"})]})]}),Q[t._id]&&e.jsxs("div",{className:"space-y-3 animate-slideDown",children:[(L=B[t._id])==null?void 0:L.map(c=>{var p,T,ie,De;return e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-white rounded-lg p-3 border border-gray-200 shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[!z(c)&&e.jsx(Pe,{user:{username:c.userName,avatar:c.userAvatar},size:"w-6 h-6",textSize:"text-xs",showBorder:!1}),z(c)?e.jsxs("span",{className:"font-semibold text-blue-700 flex items-center gap-1 text-xs",children:["From organization ",e.jsx(Ne,{className:"text-green-500"})]}):e.jsx("span",{className:"font-medium text-gray-800 text-xs",children:c.userName}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(c.createdAt).toLocaleString()}),s&&e.jsxs("div",{className:"flex gap-2 ml-auto",children:[(c.userId===s._id||z(s)&&z(c))&&e.jsx("button",{onClick:()=>Re(c),className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Edit reply",children:e.jsx(Ae,{size:10})}),(c.userId===s._id||z(s))&&e.jsx("button",{onClick:()=>m(c._id),className:"text-red-600 hover:text-red-800 transition-colors",title:"Delete reply",children:e.jsx(pe,{size:10})})]})]}),C&&C._id===c._id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{className:"w-full border border-blue-300 rounded p-2 text-sm",value:C.comment,onChange:Xe=>F({...C,comment:Xe.target.value}),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700 transition-colors",onClick:_e,children:"Save"}),e.jsx("button",{className:"bg-gray-400 text-white px-2 py-1 rounded text-xs hover:bg-gray-600 transition-colors",onClick:()=>F(null),children:"Cancel"})]})]}):e.jsx("div",{className:"text-gray-700 text-sm leading-relaxed",children:c.comment}),e.jsxs("div",{className:"flex gap-3 mt-2 text-xs",children:[e.jsxs("button",{onClick:()=>he(c._id,"like",t._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(p=c.likes)!=null&&p.includes(s==null?void 0:s._id)?"bg-blue-100 text-blue-700":"text-gray-500 hover:bg-gray-100"}`,disabled:me[c._id],children:["ðŸ‘ Like ",((T=c.likes)==null?void 0:T.length)>0&&`(${c.likes.length})`]}),e.jsxs("button",{onClick:()=>he(c._id,"dislike",t._id),className:`flex items-center gap-1 px-2 py-1 rounded transition-colors ${(ie=c.dislikes)!=null&&ie.includes(s==null?void 0:s._id)?"bg-red-100 text-red-700":"text-gray-500 hover:bg-gray-100"}`,disabled:me[c._id],children:["ðŸ‘Ž Dislike ",((De=c.dislikes)==null?void 0:De.length)>0&&`(${c.dislikes.length})`]})]})]},c._id)}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx(ze,{reviewId:t._id,onReplyAdded:()=>Z(t._id)})})]}),(!B[t._id]||B[t._id].length===0)&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200",children:e.jsx(ze,{reviewId:t._id,onReplyAdded:()=>Z(t._id)})})]}),s&&!z(s)&&e.jsxs("button",{className:"flex items-center gap-1 text-yellow-600 hover:text-yellow-800 text-xs mt-2",title:"Report an issue with this review",onClick:()=>We(t),children:[e.jsx(Oe,{className:"inline-block"}),"Report an Issue"]})]},t._id)}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Review"}),e.jsx(Je,{listingId:f,existingReview:N,onReviewSubmitted:re}),e.jsx("button",{onClick:()=>k(null),className:"mt-4 w-full bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-yellow-700",children:[e.jsx(Oe,{})," Report an Issue"]}),e.jsx("p",{className:"mb-2 text-gray-700",children:"Please describe the issue with this review:"}),e.jsx("textarea",{className:"w-full border border-yellow-300 rounded-md p-2 text-sm mb-2",rows:"3",value:de,onChange:t=>ce(t.target.value),placeholder:"Enter reason (required)"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx("button",{className:"bg-gray-400 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm",onClick:()=>{O(null),document.body.style.overflow="unset"},disabled:ne,children:"Cancel"}),e.jsx("button",{className:"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 text-sm",onClick:Ye,disabled:ne,children:ne?"Reporting...":"Submit Report"})]})]})})]})}const kt=`
  @keyframes slideDown {
    from { 
      opacity: 0; 
      transform: translateY(-10px);
    }
    to { 
      opacity: 1; 
      transform: translateY(0);
    }
  }
  .animate-slideDown {
    animation: slideDown 0.3s ease-out;
  }
`;if(typeof document<"u"){const f=document.createElement("style");f.textContent=kt,document.head.appendChild(f)}const St=({isOpen:f,onClose:v,images:j,initialIndex:s=0})=>{const[a,b]=o.useState(s),[E,D]=o.useState(1),[U,I]=o.useState(0),[N,k]=o.useState({x:0,y:0}),[S,V]=o.useState(!1),[P,H]=o.useState({x:0,y:0}),Y=o.useRef(null);o.useEffect(()=>{f&&(b(s),D(1),I(0),k({x:0,y:0}))},[f,s]),o.useEffect(()=>{const x=A=>{if(f)switch(A.key){case"Escape":v();break;case"ArrowLeft":b(O=>O>0?O-1:j.length-1);break;case"ArrowRight":b(O=>O<j.length-1?O+1:0);break;case"+":case"=":A.preventDefault(),q();break;case"-":A.preventDefault(),K();break;case"0":J();break}},M=A=>{f&&(A.preventDefault(),A.deltaY<0?q():K())};return document.addEventListener("keydown",x),document.addEventListener("wheel",M,{passive:!1}),()=>{document.removeEventListener("keydown",x),document.removeEventListener("wheel",M)}},[f,j.length,v]),o.useEffect(()=>(f?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[f]);const q=()=>{D(x=>Math.min(x*1.2,5))},K=()=>{D(x=>Math.max(x/1.2,.1))},J=()=>{D(1),I(0),k({x:0,y:0})},G=()=>{I(x=>x+90)},R=x=>{E>1&&(V(!0),H({x:x.clientX-N.x,y:x.clientY-N.y}))},B=x=>{S&&E>1&&k({x:x.clientX-P.x,y:x.clientY-P.y})},_=()=>{V(!1)},C=x=>{E>1&&x.touches.length===1&&(V(!0),H({x:x.touches[0].clientX-N.x,y:x.touches[0].clientY-N.y}))},F=x=>{S&&E>1&&x.touches.length===1&&(x.preventDefault(),k({x:x.touches[0].clientX-P.x,y:x.touches[0].clientY-P.y}))},W=()=>{V(!1)},X=()=>{const x=document.createElement("a");x.href=j[a],x.download=`property-image-${a+1}.jpg`,document.body.appendChild(x),x.click(),document.body.removeChild(x)};return!f||!j||j.length===0?null:e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",onMouseMove:B,onMouseUp:_,onMouseLeave:_,children:[e.jsx("button",{onClick:v,className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-2",children:e.jsx(He,{size:24})}),j.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>b(x=>x>0?x-1:j.length-1),className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-3",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>b(x=>x<j.length-1?x+1:0),className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-3",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"relative max-w-full max-h-full overflow-hidden",children:e.jsx("img",{ref:Y,src:j[a],alt:`Property image ${a+1}`,className:"max-w-full max-h-full object-contain cursor-move",style:{transform:`scale(${E}) rotate(${U}deg) translate(${N.x}px, ${N.y}px)`,transition:S?"none":"transform 0.1s ease-out"},onMouseDown:R,onTouchStart:C,onTouchMove:F,onTouchEnd:W,draggable:!1})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-2 bg-black bg-opacity-50 rounded-lg p-2",children:[e.jsx("button",{onClick:q,className:"text-white hover:text-gray-300 p-2 rounded",title:"Zoom In (Ctrl + +)",children:e.jsx(et,{size:16})}),e.jsx("button",{onClick:K,className:"text-white hover:text-gray-300 p-2 rounded",title:"Zoom Out (Ctrl + -)",children:e.jsx(tt,{size:16})}),e.jsx("button",{onClick:G,className:"text-white hover:text-gray-300 p-2 rounded",title:"Rotate",children:e.jsx(st,{size:16})}),e.jsx("button",{onClick:J,className:"text-white hover:text-gray-300 p-2 rounded",title:"Reset (0)",children:e.jsx("span",{className:"text-sm font-bold",children:"0"})}),e.jsx("button",{onClick:X,className:"text-white hover:text-gray-300 p-2 rounded",title:"Download",children:e.jsx(at,{size:16})})]}),j.length>1&&e.jsxs("div",{className:"absolute top-4 left-4 text-white bg-black bg-opacity-50 rounded-lg px-3 py-1",children:[a+1," / ",j.length]}),e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 rounded-lg px-3 py-1",children:[Math.round(E*100),"%"]}),e.jsx("div",{className:"absolute bottom-16 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 rounded-lg px-4 py-2 text-sm max-w-xs",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"hidden sm:block",children:"Use mouse wheel or +/- to zoom"}),e.jsx("div",{className:"hidden sm:block",children:"Drag to pan â€¢ Use close icon to exit"}),e.jsx("div",{className:"hidden sm:block",children:"Arrow keys to navigate â€¢ ESC to close"}),e.jsx("div",{className:"sm:hidden",children:"Tap to zoom â€¢ Swipe to navigate"}),e.jsx("div",{className:"sm:hidden",children:"Pinch to zoom â€¢ Use close icon to exit"})]})})]})},we="https://urbansetu.onrender.com";function $t(){const f=nt(),v=rt(),j=lt(),{currentUser:s}=Le(m=>m.user),[a,b]=o.useState(null),[E,D]=o.useState(!1),[U,I]=o.useState(!0),[N,k]=o.useState(!1),[S,V]=o.useState(""),[P,H]=o.useState(!1),[Y,q]=o.useState(""),[K,J]=o.useState(!1),[G,R]=o.useState(""),{addToWishlist:B,removeFromWishlist:_,isInWishlist:C}=ot(),[F,W]=o.useState(null),[X,x]=o.useState(!1),[M,A]=o.useState(""),[O,de]=o.useState(!1),[ce,ne]=o.useState(!1),[ge,me]=o.useState(0),[fe,Q]=o.useState(!1),[ke,be]=o.useState([]),[xe,ye]=o.useState(!1),[re,je]=o.useState(""),le=(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="rootadmin",ee=j.pathname.includes("/admin"),oe=s?ee?{path:"/admin",text:"Back to Dashboard"}:{path:"/user",text:"Back to Home"}:{path:"/",text:"Back to Home"},te=m=>`â‚¹${Number(m).toLocaleString("en-IN")}`,se=()=>a.offer&&a.regularPrice&&a.discountPrice?Math.round((a.regularPrice-a.discountPrice)/a.regularPrice*100):0,ue=()=>{V(""),R(""),k(!0)},Z=m=>{if(m.preventDefault(),!S.trim()){R("Reason is required");return}k(!1),R(""),H(!0)},he=m=>{console.log("Image clicked:",m),me(m),ne(!0)},Se=async m=>{if(m.preventDefault(),!Y){R("Password is required");return}J(!0),R("");try{if(!(await fetch(`/api/user/verify-password/${s._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Y})})).ok){R("Incorrect password. Property not deleted."),J(!1);return}const w=await fetch(`/api/listing/delete/${a._id}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:S})});if(w.ok)g.success("Property deleted successfully!"),H(!1),v("/admin/listings");else{const Ce=await w.json();R(Ce.message||"Failed to delete property.")}}catch{R("An error occurred while deleting the property.")}finally{J(!1)}},Re=async()=>{try{const m=await fetch(`${we}/api/user/all-users-autocomplete`,{credentials:"include"});if(m.ok){const y=await m.json();be(y)}else console.error("Failed to fetch available users")}catch(m){console.error("Error fetching available users:",m)}},_e=async()=>{if(!re){g.error("Please select a new owner");return}ye(!0);try{const m=await fetch(`${we}/api/listing/reassign-owner/${a._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({newOwnerId:re})});if(m.ok){const y=await m.json();g.success(y.message||"Property owner assigned successfully!"),Q(!1),je(""),window.location.reload()}else{const y=await m.json();g.error(y.message||"Failed to assign new owner")}}catch(m){console.error("Error assigning new owner:",m),g.error("An error occurred while assigning new owner")}finally{ye(!1)}};return o.useEffect(()=>{(async()=>{I(!0);try{const w=await(await fetch(`${we}/api/listing/get/${f.listingId}`)).json();if(w.success===!1){console.log(w.message);return}b(w)}catch(y){console.error("Error fetching listing:",y)}finally{I(!1)}})()},[f.listingId]),o.useEffect(()=>{(async()=>{if(a&&a.userRef){x(!0),A("");try{const y=await fetch(`${we}/api/user/id/${a.userRef}`);if(!y.ok)throw new Error("Failed to fetch owner details");const w=await y.json();W(w)}catch{A("Could not load owner details"),W(null)}finally{x(!1)}}else W(null)})()},[a]),U?e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-3 text-lg font-semibold text-blue-600",children:"Loading property details..."})]})})}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl w-full mx-auto bg-white rounded-xl shadow-lg p-3 sm:p-6 relative overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:()=>v(oe.path),className:"bg-gradient-to-r from-gray-500 to-gray-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(it,{})," ",oe.text]})}),le&&ee&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs(Ue,{to:`/admin/update-listing/${a._id}`,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(ve,{})," Edit Property"]}),e.jsxs("button",{onClick:ue,className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 text-sm sm:px-6 sm:py-3 sm:text-base rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(pe,{})," Delete Property"]})]})]}),e.jsxs("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:["Property Details ",le&&ee&&"(Admin View)"]}),e.jsx("div",{className:"relative mb-6",children:e.jsx(bt,{navigation:!0,modules:[yt],className:"rounded-lg overflow-hidden relative",onSlideChange:m=>{me(m.activeIndex)},children:a.imageUrls&&a.imageUrls.length>0?a.imageUrls.map((m,y)=>e.jsx(Ie,{children:e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:m,alt:`${a.name} - Image ${y+1}`,className:"w-full h-40 sm:h-64 md:h-96 object-cover transition-transform duration-200 group-hover:scale-105",onError:w=>{w.target.src="https://via.placeholder.com/800x600?text=Image+Not+Available",w.target.className="w-full h-40 sm:h-64 md:h-96 object-cover opacity-50"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center",children:e.jsx("div",{className:"bg-white bg-opacity-90 rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx(dt,{className:"text-gray-700"})})}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"Click to expand"}),e.jsx("button",{className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onClick:w=>{w.preventDefault(),w.stopPropagation(),he(y)},onTouchEnd:w=>{w.preventDefault(),w.stopPropagation(),he(y)},"aria-label":`Expand image ${y+1}`})]})},y)):e.jsx(Ie,{children:e.jsx("div",{className:"w-full h-64 md:h-96 bg-gray-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ "}),e.jsx("p",{className:"text-lg",children:"No images available"})]})})})})}),e.jsx("div",{className:"flex justify-end items-center space-x-4 mb-4 pr-2",children:e.jsx(ct,{className:"cursor-pointer text-gray-500 hover:text-gray-700 text-xl",onClick:()=>{navigator.clipboard.writeText(window.location.href),D(!0),setTimeout(()=>D(!1),2e3)}})}),E&&e.jsx("p",{className:"text-green-500 text-sm text-center mb-4",children:"Link copied!"}),e.jsxs("div",{className:"p-3 sm:p-6 bg-gray-50 shadow-md rounded-lg mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2",children:[e.jsxs("h2",{className:"text-lg sm:text-2xl md:text-3xl font-bold text-gray-800 break-words flex items-center gap-2",children:[a.name,e.jsx("button",{onClick:()=>{if(!s){g.info("Please sign in to add properties to your wishlist."),v("/sign-in");return}C(a._id)?_(a._id):B(a)},className:`ml-2 p-2 rounded-full transition z-20 ${C(a._id)?"bg-red-500 text-white":"bg-gray-200 text-red-500 hover:text-red-600"} focus:outline-none`,title:C(a._id)?"Remove from wishlist":"Add to wishlist",style:{lineHeight:0},children:e.jsx(mt,{className:"text-base sm:text-lg"})})]}),a.offer&&se()>0&&e.jsxs("span",{className:"bg-yellow-400 text-gray-900 text-sm font-semibold px-4 py-1 rounded-full shadow-md animate-pulse w-max sm:w-auto ml-0 sm:ml-2 mt-2 sm:mt-0",style:{alignSelf:"flex-start"},title:"Limited-time offer!",children:[se(),"% OFF"]})]}),e.jsx("div",{className:"mb-4",children:a.offer&&se()>0?e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[te(a.discountPrice),a.type==="rent"&&" / month"]}),e.jsx("p",{className:"text-base sm:text-xl text-gray-500 line-through",children:te(a.regularPrice)}),e.jsxs("span",{className:"text-xs sm:text-sm text-green-600 font-semibold",children:["Save ",te(a.regularPrice-a.discountPrice)]})]}):e.jsxs("p",{className:"text-lg sm:text-2xl md:text-3xl text-blue-600 font-semibold",children:[te(a.regularPrice),a.type==="rent"&&" / month"]})}),e.jsxs("p",{className:"flex items-center text-gray-600 mb-4",children:[e.jsx(xt,{className:"mr-2 text-red-500"}),wt(a.propertyNumber||a.city?{propertyNumber:a.propertyNumber,landmark:a.landmark,city:a.city,district:a.district,state:a.state,pincode:a.pincode}:a.address,!!s)]}),a.locationLink&&Be(!!s)&&e.jsx("div",{className:"mb-4",children:e.jsx("a",{href:a.locationLink,rel:"noopener noreferrer",className:"inline-block bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:Me(!!s)})}),a.locationLink&&!Be(!!s)&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>v("/sign-in"),className:"inline-block bg-gradient-to-r from-gray-500 to-gray-600 text-white px-6 py-3 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg font-semibold",children:Me(!!s)})}),e.jsx("div",{className:"flex space-x-4 mb-4",children:e.jsx("span",{className:`px-3 py-1 text-white rounded-md ${a.type==="rent"?"bg-blue-500":"bg-green-500"}`,children:a.type==="rent"?"For Rent":"For Sale"})}),e.jsxs("p",{className:"text-gray-700 mb-4 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Description:"})," ",a.description]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ut,{className:"mr-2 text-blue-500"})," ",a.bedrooms," ",a.bedrooms>1?"beds":"bed"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(ht,{className:"mr-2 text-blue-500"})," ",a.bathrooms," ",a.bathrooms>1?"baths":"bath"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(pt,{className:"mr-2 text-blue-500"})," ",a.parking?"Parking":"No Parking"]}),e.jsxs("div",{className:"flex items-center p-3 bg-white rounded-lg shadow-sm",children:[e.jsx(gt,{className:"mr-2 text-blue-500"})," ",a.furnished?"Furnished":"Unfurnished"]})]})]}),le&&ee&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 bg-blue-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-blue-800 mb-4",children:"Admin Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Property ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created Date"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Updated"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(a.updatedAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Created By"}),e.jsx("p",{className:"font-semibold text-gray-800",children:a.userRef||"Unknown"})]})]})]}),e.jsxs("div",{className:"p-6 bg-green-50 shadow-md rounded-lg mb-6",children:[e.jsx("h4",{className:"text-xl font-bold text-green-800 mb-4",children:"Property Owner Details"}),X?e.jsx("p",{className:"text-gray-500",children:"Loading owner details..."}):M&&le?e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2",children:[e.jsx("p",{className:"text-red-500",children:M}),e.jsxs("button",{onClick:()=>{Re(),Q(!0)},className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(ve,{})," Assign New Owner"]})]}):M?e.jsx("p",{className:"text-red-500",children:M}):F?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Name"}),e.jsx("p",{className:"font-semibold text-gray-800",children:F.username})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner Email"}),e.jsx("p",{className:"font-semibold text-gray-800",children:F.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Mobile Number"}),e.jsx("p",{className:"font-semibold text-gray-800",children:F.mobileNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner ID"}),e.jsx("p",{className:"font-semibold text-gray-800",children:F._id})]})]}):e.jsx("p",{className:"text-gray-500",children:"No owner details found."})]})]}),e.jsx("div",{className:"flex justify-center",children:s&&(a.sellerId===s._id||a.userRef===s._id)?e.jsx("div",{className:"text-red-500 font-semibold text-lg py-3",children:"You cannot book an appointment for your own property."}):e.jsx("button",{onClick:()=>{if(!s){g.info("Please sign in to book appointments."),v("/sign-in");return}const m=ee?`/admin/appointmentlisting?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`:`/user/appointment?listingId=${a._id}&propertyName=${encodeURIComponent(a.name)}&propertyDescription=${encodeURIComponent(a.description)}&listingType=${a.type}`;v(m)},className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:"ðŸ“… Book Appointment"})}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("button",{onClick:()=>de(m=>!m),className:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white px-6 py-2 rounded-lg shadow font-semibold flex items-center gap-2 hover:from-yellow-500 hover:to-yellow-700 transition-all",children:[O?"Hide Reviews":"Show Reviews",a.reviewCount>0&&e.jsx("span",{className:"ml-2 bg-white text-yellow-700 rounded-full px-2 py-0.5 text-xs font-bold",children:a.reviewCount})]})}),O&&e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"border-t border-gray-200 pt-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h3",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[e.jsx(Ve,{className:"text-yellow-500 mr-2"}),"Reviews",a.averageRating>0&&e.jsxs("span",{className:"ml-2 text-lg text-gray-600",children:["(",a.averageRating.toFixed(1)," â­ â€¢ ",a.reviewCount," review",a.reviewCount!==1?"s":"",")"]})]})}),e.jsx(Je,{listingId:a._id,onReviewSubmitted:()=>{window.location.reload()}}),e.jsx(vt,{listingId:a._id,onReviewDeleted:()=>{window.location.reload()},listingOwnerId:a.userRef})]})})]})}),e.jsx(jt,{}),N&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:Z,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(pe,{})," Reason for Deletion"]}),e.jsx("textarea",{className:"border rounded p-2 w-full",placeholder:"Enter reason for deleting this property",value:S,onChange:m=>V(m.target.value),rows:3,autoFocus:!0}),G&&e.jsx("div",{className:"text-red-600 text-sm",children:G}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>k(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-red-600 text-white font-semibold",children:"Next"})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:Se,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(ft,{})," Confirm Password"]}),e.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:Y,onChange:m=>q(m.target.value),autoFocus:!0}),G&&e.jsx("div",{className:"text-red-600 text-sm",children:G}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>H(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:K,children:K?"Deleting...":"Confirm & Delete"})]})]})}),a&&a.imageUrls&&a.imageUrls.length>0&&e.jsx(St,{isOpen:ce,onClose:()=>ne(!1),images:a.imageUrls,initialIndex:ge}),fe&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(ve,{})," Assign New Owner"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a user to assign as the new owner of this property."}),e.jsxs("select",{className:"border rounded p-2 w-full",value:re,onChange:m=>je(m.target.value),disabled:xe,children:[e.jsx("option",{value:"",children:"Select a user"}),ke.map(m=>e.jsxs("option",{value:m._id,children:[m.username," (",m.email,")"]},m._id))]}),xe&&e.jsx("p",{className:"text-gray-500",children:"Assigning new owner..."}),re&&!xe&&e.jsxs("button",{onClick:_e,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",children:[e.jsx(Ne,{})," Confirm Assignment"]}),e.jsx("button",{onClick:()=>Q(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"})]})})]}):e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-red-600 mb-4",children:"Property Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The property you're looking for doesn't exist or has been removed."}),e.jsx(Ue,{to:oe.path,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold",children:oe.text})]})})})}export{$t as default};
